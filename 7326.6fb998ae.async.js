var r_=(vr,se,Z)=>new Promise((ge,oe)=>{var _=ue=>{try{j(Z.next(ue))}catch(ie){oe(ie)}},de=ue=>{try{j(Z.throw(ue))}catch(ie){oe(ie)}},j=ue=>ue.done?ge(ue.value):Promise.resolve(ue.value).then(_,de);j((Z=Z.apply(vr,se)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7326],{64335:function(vr,se,Z){"use strict";var ge=Z(67294),oe=(0,ge.createContext)({});se.Z=oe},21349:function(vr,se,Z){"use strict";var ge=Z(84305),oe=Z(39559),_=Z(85893),de=Z(94184),j=Z.n(de),ue=Z(67294),ie=Z(64335),De=Z(53645),ne=Z.n(De),Ze=function(rt){var Pt=(0,ue.useContext)(ie.Z),Ct=rt.children,$t=rt.contentWidth,rr=rt.className,zt=rt.style,Mt=(0,ue.useContext)(oe.ZP.ConfigContext),Et=Mt.getPrefixCls,Fr=rt.prefixCls||Et("pro"),Ar=$t||Pt.contentWidth,dr="".concat(Fr,"-grid-content");return(0,_.jsx)("div",{className:j()(dr,rr,{wide:Ar==="Fixed"}),style:zt,children:(0,_.jsx)("div",{className:"".concat(Fr,"-grid-content-children"),children:Ct})})};se.Z=Ze},90857:function(vr){"use strict";var se=Object.prototype.hasOwnProperty,Z="~";function ge(){}Object.create&&(ge.prototype=Object.create(null),new ge().__proto__||(Z=!1));function oe(ue,ie,De){this.fn=ue,this.context=ie,this.once=De||!1}function _(ue,ie,De,ne,Ze){if(typeof De!="function")throw new TypeError("The listener must be a function");var nt=new oe(De,ne||ue,Ze),rt=Z?Z+ie:ie;return ue._events[rt]?ue._events[rt].fn?ue._events[rt]=[ue._events[rt],nt]:ue._events[rt].push(nt):(ue._events[rt]=nt,ue._eventsCount++),ue}function de(ue,ie){--ue._eventsCount==0?ue._events=new ge:delete ue._events[ie]}function j(){this._events=new ge,this._eventsCount=0}j.prototype.eventNames=function(){var ie=[],De,ne;if(this._eventsCount===0)return ie;for(ne in De=this._events)se.call(De,ne)&&ie.push(Z?ne.slice(1):ne);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols(De)):ie},j.prototype.listeners=function(ie){var De=Z?Z+ie:ie,ne=this._events[De];if(!ne)return[];if(ne.fn)return[ne.fn];for(var Ze=0,nt=ne.length,rt=new Array(nt);Ze<nt;Ze++)rt[Ze]=ne[Ze].fn;return rt},j.prototype.listenerCount=function(ie){var De=Z?Z+ie:ie,ne=this._events[De];return ne?ne.fn?1:ne.length:0},j.prototype.emit=function(ie,De,ne,Ze,nt,rt){var Pt=Z?Z+ie:ie;if(!this._events[Pt])return!1;var Ct=this._events[Pt],$t=arguments.length,rr,zt;if(Ct.fn){switch(Ct.once&&this.removeListener(ie,Ct.fn,void 0,!0),$t){case 1:return Ct.fn.call(Ct.context),!0;case 2:return Ct.fn.call(Ct.context,De),!0;case 3:return Ct.fn.call(Ct.context,De,ne),!0;case 4:return Ct.fn.call(Ct.context,De,ne,Ze),!0;case 5:return Ct.fn.call(Ct.context,De,ne,Ze,nt),!0;case 6:return Ct.fn.call(Ct.context,De,ne,Ze,nt,rt),!0}for(zt=1,rr=new Array($t-1);zt<$t;zt++)rr[zt-1]=arguments[zt];Ct.fn.apply(Ct.context,rr)}else{var Mt=Ct.length,Et;for(zt=0;zt<Mt;zt++)switch(Ct[zt].once&&this.removeListener(ie,Ct[zt].fn,void 0,!0),$t){case 1:Ct[zt].fn.call(Ct[zt].context);break;case 2:Ct[zt].fn.call(Ct[zt].context,De);break;case 3:Ct[zt].fn.call(Ct[zt].context,De,ne);break;case 4:Ct[zt].fn.call(Ct[zt].context,De,ne,Ze);break;default:if(!rr)for(Et=1,rr=new Array($t-1);Et<$t;Et++)rr[Et-1]=arguments[Et];Ct[zt].fn.apply(Ct[zt].context,rr)}}return!0},j.prototype.on=function(ie,De,ne){return _(this,ie,De,ne,!1)},j.prototype.once=function(ie,De,ne){return _(this,ie,De,ne,!0)},j.prototype.removeListener=function(ie,De,ne,Ze){var nt=Z?Z+ie:ie;if(!this._events[nt])return this;if(!De)return de(this,nt),this;var rt=this._events[nt];if(rt.fn)rt.fn===De&&(!Ze||rt.once)&&(!ne||rt.context===ne)&&de(this,nt);else{for(var Pt=0,Ct=[],$t=rt.length;Pt<$t;Pt++)(rt[Pt].fn!==De||Ze&&!rt[Pt].once||ne&&rt[Pt].context!==ne)&&Ct.push(rt[Pt]);Ct.length?this._events[nt]=Ct.length===1?Ct[0]:Ct:de(this,nt)}return this},j.prototype.removeAllListeners=function(ie){var De;return ie?(De=Z?Z+ie:ie,this._events[De]&&de(this,De)):(this._events=new ge,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=Z,j.EventEmitter=j,vr.exports=j},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(vr){try{let ne=function(){j||(j=!0,_())},Ze=function(){try{de.documentElement.doScroll("left")}catch(nt){return void setTimeout(Ze,50)}ne()};var De=ne,ie=Ze,se=(se=document.getElementsByTagName("script"))[se.length-1],Z=se.getAttribute("data-injectcss"),se=se.getAttribute("data-disable-injectsvg");if(!se){var ge,oe,_,de,j,ue=function(rt,Pt){Pt.parentNode.insertBefore(rt,Pt)};if(Z&&!vr.__iconfont__svg__cssinject__){vr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(nt){console&&console.log(nt)}}ge=function(){var rt,Pt=document.createElement("div");Pt.innerHTML=vr._iconfont_svg_string_3580659,(Pt=Pt.getElementsByTagName("svg")[0])&&(Pt.setAttribute("aria-hidden","true"),Pt.style.position="absolute",Pt.style.width=0,Pt.style.height=0,Pt.style.overflow="hidden",Pt=Pt,(rt=document.body).firstChild?ue(Pt,rt.firstChild):rt.appendChild(Pt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ge,0):(oe=function(){document.removeEventListener("DOMContentLoaded",oe,!1),ge()},document.addEventListener("DOMContentLoaded",oe,!1)):document.attachEvent&&(_=ge,de=vr.document,j=!1,Ze(),de.onreadystatechange=function(){de.readyState=="complete"&&(de.onreadystatechange=null,ne())})}}catch(ne){}}(window)},83557:function(vr,se,Z){var ge=Z(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var oe;(function(_){(function(de){var j=typeof Z.g=="object"?Z.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ue=ie(_);typeof j.Reflect=="undefined"?j.Reflect=_:ue=ie(j.Reflect,ue),de(ue);function ie(De,ne){return function(Ze,nt){typeof De[Ze]!="function"&&Object.defineProperty(De,Ze,{configurable:!0,writable:!0,value:nt}),ne&&ne(Ze,nt)}}})(function(de){var j=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",ie=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",De=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",Ze={__proto__:[]}instanceof Array,nt=!ne&&!Ze,rt={create:ne?function(){return bs(Object.create(null))}:Ze?function(){return bs({__proto__:null})}:function(){return bs({})},has:nt?function(Wt,xr){return j.call(Wt,xr)}:function(Wt,xr){return xr in Wt},get:nt?function(Wt,xr){return j.call(Wt,xr)?Wt[xr]:void 0}:function(Wt,xr){return Wt[xr]}},Pt=Object.getPrototypeOf(Function),Ct=typeof ge=="object"&&ge["env"]&&ge["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",$t=!Ct&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:to(),rr=!Ct&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Zs(),zt=!Ct&&typeof WeakMap=="function"?WeakMap:xs(),Mt=new zt;function Et(Wt,xr,Yr,sn){if(wt(Yr)){if(!ta(Wt))throw new TypeError;if(!Bn(xr))throw new TypeError;return te(Wt,xr)}else{if(!ta(Wt))throw new TypeError;if(!Vr(xr))throw new TypeError;if(!Vr(sn)&&!wt(sn)&&!hn(sn))throw new TypeError;return hn(sn)&&(sn=void 0),Yr=di(Yr),Ne(Wt,xr,Yr,sn)}}de("decorate",Et);function Fr(Wt,xr){function Yr(sn,Vn){if(!Vr(sn))throw new TypeError;if(!wt(Vn)&&!_a(Vn))throw new TypeError;We(Wt,xr,sn,Vn)}return Yr}de("metadata",Fr);function Ar(Wt,xr,Yr,sn){if(!Vr(Yr))throw new TypeError;return wt(sn)||(sn=di(sn)),We(Wt,xr,Yr,sn)}de("defineMetadata",Ar);function dr(Wt,xr,Yr){if(!Vr(xr))throw new TypeError;return wt(Yr)||(Yr=di(Yr)),Pe(Wt,xr,Yr)}de("hasMetadata",dr);function It(Wt,xr,Yr){if(!Vr(xr))throw new TypeError;return wt(Yr)||(Yr=di(Yr)),Ce(Wt,xr,Yr)}de("hasOwnMetadata",It);function ct(Wt,xr,Yr){if(!Vr(xr))throw new TypeError;return wt(Yr)||(Yr=di(Yr)),pt(Wt,xr,Yr)}de("getMetadata",ct);function Ft(Wt,xr,Yr){if(!Vr(xr))throw new TypeError;return wt(Yr)||(Yr=di(Yr)),Ye(Wt,xr,Yr)}de("getOwnMetadata",Ft);function ht(Wt,xr){if(!Vr(Wt))throw new TypeError;return wt(xr)||(xr=di(xr)),ot(Wt,xr)}de("getMetadataKeys",ht);function sr(Wt,xr){if(!Vr(Wt))throw new TypeError;return wt(xr)||(xr=di(xr)),Tt(Wt,xr)}de("getOwnMetadataKeys",sr);function br(Wt,xr,Yr){if(!Vr(xr))throw new TypeError;wt(Yr)||(Yr=di(Yr));var sn=O(xr,Yr,!1);if(wt(sn)||!sn.delete(Wt))return!1;if(sn.size>0)return!0;var Vn=Mt.get(xr);return Vn.delete(Yr),Vn.size>0||Mt.delete(xr),!0}de("deleteMetadata",br);function te(Wt,xr){for(var Yr=Wt.length-1;Yr>=0;--Yr){var sn=Wt[Yr],Vn=sn(xr);if(!wt(Vn)&&!hn(Vn)){if(!Bn(Vn))throw new TypeError;xr=Vn}}return xr}function Ne(Wt,xr,Yr,sn){for(var Vn=Wt.length-1;Vn>=0;--Vn){var Wi=Wt[Vn],fe=Wi(xr,Yr,sn);if(!wt(fe)&&!hn(fe)){if(!Vr(fe))throw new TypeError;sn=fe}}return sn}function O(Wt,xr,Yr){var sn=Mt.get(Wt);if(wt(sn)){if(!Yr)return;sn=new $t,Mt.set(Wt,sn)}var Vn=sn.get(xr);if(wt(Vn)){if(!Yr)return;Vn=new $t,sn.set(xr,Vn)}return Vn}function Pe(Wt,xr,Yr){var sn=Ce(Wt,xr,Yr);if(sn)return!0;var Vn=ua(xr);return hn(Vn)?!1:Pe(Wt,Vn,Yr)}function Ce(Wt,xr,Yr){var sn=O(xr,Yr,!1);return wt(sn)?!1:dn(sn.has(Wt))}function pt(Wt,xr,Yr){var sn=Ce(Wt,xr,Yr);if(sn)return Ye(Wt,xr,Yr);var Vn=ua(xr);if(!hn(Vn))return pt(Wt,Vn,Yr)}function Ye(Wt,xr,Yr){var sn=O(xr,Yr,!1);if(!wt(sn))return sn.get(Wt)}function We(Wt,xr,Yr,sn){var Vn=O(Yr,sn,!0);Vn.set(Wt,xr)}function ot(Wt,xr){var Yr=Tt(Wt,xr),sn=ua(Wt);if(sn===null)return Yr;var Vn=ot(sn,xr);if(Vn.length<=0)return Yr;if(Yr.length<=0)return Vn;for(var Wi=new rr,fe=[],D=0,z=Yr;D<z.length;D++){var ae=z[D],Se=Wi.has(ae);Se||(Wi.add(ae),fe.push(ae))}for(var Le=0,Ht=Vn;Le<Ht.length;Le++){var ae=Ht[Le],Se=Wi.has(ae);Se||(Wi.add(ae),fe.push(ae))}return fe}function Tt(Wt,xr){var Yr=[],sn=O(Wt,xr,!1);if(wt(sn))return Yr;for(var Vn=sn.keys(),Wi=Wa(Vn),fe=0;;){var D=Re(Wi);if(!D)return Yr.length=fe,Yr;var z=Ga(D);try{Yr[fe]=z}catch(ae){try{Xa(Wi)}finally{throw ae}}fe++}}function gr(Wt){if(Wt===null)return 1;switch(typeof Wt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Wt===null?1:6;default:return 6}}function wt(Wt){return Wt===void 0}function hn(Wt){return Wt===null}function Hr(Wt){return typeof Wt=="symbol"}function Vr(Wt){return typeof Wt=="object"?Wt!==null:typeof Wt=="function"}function qn(Wt,xr){switch(gr(Wt)){case 0:return Wt;case 1:return Wt;case 2:return Wt;case 3:return Wt;case 4:return Wt;case 5:return Wt}var Yr=xr===3?"string":xr===5?"number":"default",sn=Hi(Wt,ie);if(sn!==void 0){var Vn=sn.call(Wt,Yr);if(Vr(Vn))throw new TypeError;return Vn}return Nn(Wt,Yr==="default"?"number":Yr)}function Nn(Wt,xr){if(xr==="string"){var Yr=Wt.toString;if(Rn(Yr)){var sn=Yr.call(Wt);if(!Vr(sn))return sn}var Vn=Wt.valueOf;if(Rn(Vn)){var sn=Vn.call(Wt);if(!Vr(sn))return sn}}else{var Vn=Wt.valueOf;if(Rn(Vn)){var sn=Vn.call(Wt);if(!Vr(sn))return sn}var Wi=Wt.toString;if(Rn(Wi)){var sn=Wi.call(Wt);if(!Vr(sn))return sn}}throw new TypeError}function dn(Wt){return!!Wt}function Ci(Wt){return""+Wt}function di(Wt){var xr=qn(Wt,3);return Hr(xr)?xr:Ci(xr)}function ta(Wt){return Array.isArray?Array.isArray(Wt):Wt instanceof Object?Wt instanceof Array:Object.prototype.toString.call(Wt)==="[object Array]"}function Rn(Wt){return typeof Wt=="function"}function Bn(Wt){return typeof Wt=="function"}function _a(Wt){switch(gr(Wt)){case 3:return!0;case 4:return!0;default:return!1}}function Hi(Wt,xr){var Yr=Wt[xr];if(Yr!=null){if(!Rn(Yr))throw new TypeError;return Yr}}function Wa(Wt){var xr=Hi(Wt,De);if(!Rn(xr))throw new TypeError;var Yr=xr.call(Wt);if(!Vr(Yr))throw new TypeError;return Yr}function Ga(Wt){return Wt.value}function Re(Wt){var xr=Wt.next();return xr.done?!1:xr}function Xa(Wt){var xr=Wt.return;xr&&xr.call(Wt)}function ua(Wt){var xr=Object.getPrototypeOf(Wt);if(typeof Wt!="function"||Wt===Pt||xr!==Pt)return xr;var Yr=Wt.prototype,sn=Yr&&Object.getPrototypeOf(Yr);if(sn==null||sn===Object.prototype)return xr;var Vn=sn.constructor;return typeof Vn!="function"||Vn===Wt?xr:Vn}function to(){var Wt={},xr=[],Yr=function(){function fe(D,z,ae){this._index=0,this._keys=D,this._values=z,this._selector=ae}return fe.prototype["@@iterator"]=function(){return this},fe.prototype[De]=function(){return this},fe.prototype.next=function(){var D=this._index;if(D>=0&&D<this._keys.length){var z=this._selector(this._keys[D],this._values[D]);return D+1>=this._keys.length?(this._index=-1,this._keys=xr,this._values=xr):this._index++,{value:z,done:!1}}return{value:void 0,done:!0}},fe.prototype.throw=function(D){throw this._index>=0&&(this._index=-1,this._keys=xr,this._values=xr),D},fe.prototype.return=function(D){return this._index>=0&&(this._index=-1,this._keys=xr,this._values=xr),{value:D,done:!0}},fe}();return function(){function fe(){this._keys=[],this._values=[],this._cacheKey=Wt,this._cacheIndex=-2}return Object.defineProperty(fe.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),fe.prototype.has=function(D){return this._find(D,!1)>=0},fe.prototype.get=function(D){var z=this._find(D,!1);return z>=0?this._values[z]:void 0},fe.prototype.set=function(D,z){var ae=this._find(D,!0);return this._values[ae]=z,this},fe.prototype.delete=function(D){var z=this._find(D,!1);if(z>=0){for(var ae=this._keys.length,Se=z+1;Se<ae;Se++)this._keys[Se-1]=this._keys[Se],this._values[Se-1]=this._values[Se];return this._keys.length--,this._values.length--,D===this._cacheKey&&(this._cacheKey=Wt,this._cacheIndex=-2),!0}return!1},fe.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Wt,this._cacheIndex=-2},fe.prototype.keys=function(){return new Yr(this._keys,this._values,sn)},fe.prototype.values=function(){return new Yr(this._keys,this._values,Vn)},fe.prototype.entries=function(){return new Yr(this._keys,this._values,Wi)},fe.prototype["@@iterator"]=function(){return this.entries()},fe.prototype[De]=function(){return this.entries()},fe.prototype._find=function(D,z){return this._cacheKey!==D&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=D)),this._cacheIndex<0&&z&&(this._cacheIndex=this._keys.length,this._keys.push(D),this._values.push(void 0)),this._cacheIndex},fe}();function sn(fe,D){return fe}function Vn(fe,D){return D}function Wi(fe,D){return[fe,D]}}function Zs(){return function(){function Wt(){this._map=new $t}return Object.defineProperty(Wt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Wt.prototype.has=function(xr){return this._map.has(xr)},Wt.prototype.add=function(xr){return this._map.set(xr,xr),this},Wt.prototype.delete=function(xr){return this._map.delete(xr)},Wt.prototype.clear=function(){this._map.clear()},Wt.prototype.keys=function(){return this._map.keys()},Wt.prototype.values=function(){return this._map.values()},Wt.prototype.entries=function(){return this._map.entries()},Wt.prototype["@@iterator"]=function(){return this.keys()},Wt.prototype[De]=function(){return this.keys()},Wt}()}function xs(){var Wt=16,xr=rt.create(),Yr=sn();return function(){function z(){this._key=sn()}return z.prototype.has=function(ae){var Se=Vn(ae,!1);return Se!==void 0?rt.has(Se,this._key):!1},z.prototype.get=function(ae){var Se=Vn(ae,!1);return Se!==void 0?rt.get(Se,this._key):void 0},z.prototype.set=function(ae,Se){var Le=Vn(ae,!0);return Le[this._key]=Se,this},z.prototype.delete=function(ae){var Se=Vn(ae,!1);return Se!==void 0?delete Se[this._key]:!1},z.prototype.clear=function(){this._key=sn()},z}();function sn(){var z;do z="@@WeakMap@@"+D();while(rt.has(xr,z));return xr[z]=!0,z}function Vn(z,ae){if(!j.call(z,Yr)){if(!ae)return;Object.defineProperty(z,Yr,{value:rt.create()})}return z[Yr]}function Wi(z,ae){for(var Se=0;Se<ae;++Se)z[Se]=Math.random()*255|0;return z}function fe(z){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(z)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(z)):Wi(new Uint8Array(z),z):Wi(new Array(z),z)}function D(){var z=fe(Wt);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var ae="",Se=0;Se<Wt;++Se){var Le=z[Se];(Se===4||Se===6||Se===8)&&(ae+="-"),Le<16&&(ae+="0"),ae+=Le.toString(16).toLowerCase()}return ae}}function bs(Wt){return Wt.__=void 0,delete Wt.__,Wt}})})(oe||(oe={}))},26179:function(vr,se,Z){"use strict";Z.d(se,{zP:function(){return IF},JE:function(){return RB},ns:function(){return MF}});var ge={};Z.r(ge),Z.d(ge,{add:function(){return E0},adjoint:function(){return ea},clone:function(){return Sr},copy:function(){return Dr},create:function(){return wr},determinant:function(){return Ro},equals:function(){return $d},exactEquals:function(){return Kf},frob:function(){return hf},fromQuat:function(){return x0},fromQuat2:function(){return Fo},fromRotation:function(){return Wd},fromRotationTranslation:function(){return Yv},fromRotationTranslationScale:function(){return y0},fromRotationTranslationScaleOrigin:function(){return _0},fromScaling:function(){return m0},fromTranslation:function(){return Xv},fromValues:function(){return Dn},fromXRotation:function(){return Mh},fromYRotation:function(){return $v},fromZRotation:function(){return fp},frustum:function(){return Kv},getRotation:function(){return g0},getScaling:function(){return qv},getTranslation:function(){return Za},identity:function(){return Mn},invert:function(){return ai},lookAt:function(){return Xd},mul:function(){return o},multiply:function(){return Ko},multiplyScalar:function(){return Bg},multiplyScalarAndAdd:function(){return as},ortho:function(){return ff},orthoNO:function(){return hp},orthoZO:function(){return Gd},perspective:function(){return qf},perspectiveFromFieldOfView:function(){return No},perspectiveNO:function(){return Yf},perspectiveZO:function(){return b0},rotate:function(){return jd},rotateX:function(){return Wu},rotateY:function(){return Rh},rotateZ:function(){return Hd},scale:function(){return Ls},set:function(){return Tn},str:function(){return pp},sub:function(){return u},subtract:function(){return Jv},targetTo:function(){return Qv},translate:function(){return cf},transpose:function(){return Qn}});var oe=Z(67294),_=(0,oe.createContext)({});function de(){return(0,oe.useContext)(_)}var j={},ue={},ie=function(t){return ue[t]},De=function(t,r){ue[t]=r},ne=function(t){return j[t]},Ze=function(t,r){j[t]=r},nt={},rt={},Pt=34,Ct=10,$t=13;function rr(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function zt(e,t){var r=rr(e);return function(n,i){return t(r(n),i,e)}}function Mt(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var i in n)i in t||r.push(t[i]=i)}),r}function Et(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function Fr(e){return e<0?"-"+Et(-e,6):e>9999?"+"+Et(e,6):Et(e,4)}function Ar(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Fr(e.getUTCFullYear(),4)+"-"+Et(e.getUTCMonth()+1,2)+"-"+Et(e.getUTCDate(),2)+(i?"T"+Et(t,2)+":"+Et(r,2)+":"+Et(n,2)+"."+Et(i,3)+"Z":n?"T"+Et(t,2)+":"+Et(r,2)+":"+Et(n,2)+"Z":r||t?"T"+Et(t,2)+":"+Et(r,2)+"Z":"")}function dr(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(b,A){var w,I,P=i(b,function(L,V){if(w)return w(L,V-1);I=L,w=A?zt(L,A):rr(L)});return P.columns=I||[],P}function i(b,A){var w=[],I=b.length,P=0,L=0,V,K=I<=0,le=!1;b.charCodeAt(I-1)===Ct&&--I,b.charCodeAt(I-1)===$t&&--I;function xe(){if(K)return rt;if(le)return le=!1,nt;var je,it=P,vt;if(b.charCodeAt(it)===Pt){for(;P++<I&&b.charCodeAt(P)!==Pt||b.charCodeAt(++P)===Pt;);return(je=P)>=I?K=!0:(vt=b.charCodeAt(P++))===Ct?le=!0:vt===$t&&(le=!0,b.charCodeAt(P)===Ct&&++P),b.slice(it+1,je-1).replace(/""/g,'"')}for(;P<I;){if((vt=b.charCodeAt(je=P++))===Ct)le=!0;else if(vt===$t)le=!0,b.charCodeAt(P)===Ct&&++P;else if(vt!==r)continue;return b.slice(it,je)}return K=!0,b.slice(it,I)}for(;(V=xe())!==rt;){for(var ke=[];V!==nt&&V!==rt;)ke.push(V),V=xe();A&&(ke=A(ke,L++))==null||w.push(ke)}return w}function a(b,A){return b.map(function(w){return A.map(function(I){return y(w[I])}).join(e)})}function s(b,A){return A==null&&(A=Mt(b)),[A.map(y).join(e)].concat(a(b,A)).join(`
`)}function l(b,A){return A==null&&(A=Mt(b)),a(b,A).join(`
`)}function c(b){return b.map(p).join(`
`)}function p(b){return b.map(y).join(e)}function y(b){return b==null?"":b instanceof Date?Ar(b):t.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:c,formatRow:p,formatValue:y}}var It=dr(","),ct=It.parse,Ft=It.parseRows,ht=It.format,sr=It.formatBody,br=It.formatRows,te=It.formatRow,Ne=It.formatValue,O=Z(28991),Pe=63710088e-1,Ce={centimeters:Pe*100,centimetres:Pe*100,degrees:Pe/111325,feet:Pe*3.28084,inches:Pe*39.37,kilometers:Pe/1e3,kilometres:Pe/1e3,meters:Pe,metres:Pe,miles:Pe/1609.344,millimeters:Pe*1e3,millimetres:Pe*1e3,nauticalmiles:Pe/1852,radians:1,yards:Pe*1.0936},pt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Pe,yards:1.0936133},Ye={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function We(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function ot(e,t,r){switch(r===void 0&&(r={}),e){case"Point":return Tt(t).geometry;case"LineString":return Hr(t).geometry;case"Polygon":return wt(t).geometry;case"MultiPoint":return dn(t).geometry;case"MultiLineString":return Nn(t).geometry;case"MultiPolygon":return Ci(t).geometry;default:throw new Error(e+" is invalid")}}function Tt(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ua(e[0])||!ua(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return We(n,t,r)}function gr(e,t,r){return r===void 0&&(r={}),qn(e.map(function(n){return Tt(n,t)}),r)}function wt(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return We(l,t,r)}function hn(e,t,r){return r===void 0&&(r={}),qn(e.map(function(n){return wt(n,t)}),r)}function Hr(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return We(n,t,r)}function Vr(e,t,r){return r===void 0&&(r={}),qn(e.map(function(n){return Hr(n,t)}),r)}function qn(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function Nn(e,t,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return We(n,t,r)}function dn(e,t,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return We(n,t,r)}function Ci(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return We(n,t,r)}function di(e,t,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return We(n,t,r)}function ta(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function Rn(e,t){t===void 0&&(t="kilometers");var r=Ce[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Bn(e,t){t===void 0&&(t="kilometers");var r=Ce[t];if(!r)throw new Error(t+" units is invalid");return e/r}function _a(e,t){return Wa(Bn(e,t))}function Hi(e){var t=e%360;return t<0&&(t+=360),t}function Wa(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Ga(e){var t=e%360;return t*Math.PI/180}function Re(e,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Rn(Bn(e,t),r)}function Xa(e,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Ye[t];if(!n)throw new Error("invalid original units");var i=Ye[r];if(!i)throw new Error("invalid final units");return e/n*i}function ua(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function to(e){return!!e&&e.constructor===Object}function Zs(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!ua(t))throw new Error("bbox must only contain numbers")})}function xs(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function bs(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Wt(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function xr(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return xr(e[0]);throw new Error("coordinates must only contain numbers")}function Yr(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function sn(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function Vn(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+a.geometry.type)}}function Wi(e){return e.type==="Feature"?e.geometry:e}function fe(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function D(e,t,r){if(e!==null)for(var n,i,a,s,l,c,p,y=0,b=0,A,w=e.type,I=w==="FeatureCollection",P=w==="Feature",L=I?e.features.length:1,V=0;V<L;V++){p=I?e.features[V].geometry:P?e.geometry:e,A=p?p.type==="GeometryCollection":!1,l=A?p.geometries.length:1;for(var K=0;K<l;K++){var le=0,xe=0;if(s=A?p.geometries[K]:p,s!==null){c=s.coordinates;var ke=s.type;switch(y=r&&(ke==="Polygon"||ke==="MultiPolygon")?1:0,ke){case null:break;case"Point":if(t(c,b,V,le,xe)===!1)return!1;b++,le++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(t(c[n],b,V,le,xe)===!1)return!1;b++,ke==="MultiPoint"&&le++}ke==="LineString"&&le++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-y;i++){if(t(c[n][i],b,V,le,xe)===!1)return!1;b++}ke==="MultiLineString"&&le++,ke==="Polygon"&&xe++}ke==="Polygon"&&le++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(xe=0,i=0;i<c[n].length;i++){for(a=0;a<c[n][i].length-y;a++){if(t(c[n][i][a],b,V,le,xe)===!1)return!1;b++}xe++}le++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(D(s.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function z(e,t,r,n){var i=r;return D(e,function(a,s,l,c,p){s===0&&r===void 0?i=a:i=t(i,a,s,l,c,p)},n),i}function ae(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&t(e.features[r].properties,r)!==!1;r++);break;case"Feature":t(e.properties,0);break}}function Se(e,t,r){var n=r;return ae(e,function(i,a){a===0&&r===void 0?n=i:n=t(n,i,a)}),n}function Le(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function Ht(e,t,r){var n=r;return Le(e,function(i,a){a===0&&r===void 0?n=i:n=t(n,i,a)}),n}function Ot(e){var t=[];return D(e,function(r){t.push(r)}),t}function kt(e,t){var r,n,i,a,s,l,c,p,y,b,A=0,w=e.type==="FeatureCollection",I=e.type==="Feature",P=w?e.features.length:1;for(r=0;r<P;r++){for(l=w?e.features[r].geometry:I?e.geometry:e,p=w?e.features[r].properties:I?e.properties:{},y=w?e.features[r].bbox:I?e.bbox:void 0,b=w?e.features[r].id:I?e.id:void 0,c=l?l.type==="GeometryCollection":!1,s=c?l.geometries.length:1,i=0;i<s;i++){if(a=c?l.geometries[i]:l,a===null){if(t(null,A,p,y,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,A,p,y,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(t(a.geometries[n],A,p,y,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function yt(e,t,r){var n=r;return kt(e,function(i,a,s,l,c){a===0&&r===void 0?n=i:n=t(n,i,a,s,l,c)}),n}function U(e,t){kt(e,function(r,n,i,a,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return t(We(r,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var c;switch(l){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var p=0;p<r.coordinates.length;p++){var y=r.coordinates[p],b={type:c,coordinates:y};if(t(We(b,i),n,p)===!1)return!1}})}function N(e,t,r){var n=r;return U(e,function(i,a,s){a===0&&s===0&&r===void 0?n=i:n=t(n,i,a,s)}),n}function X(e,t){U(e,function(r,n,i){var a=0;if(!!r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,c=0,p=0,y=0;if(D(r,function(b,A,w,I,P){if(l===void 0||n>c||I>p||P>y){l=b,c=n,p=I,y=P,a=0;return}var L=lineString([l,b],r.properties);if(t(L,n,i,P,a)===!1)return!1;a++,l=b})===!1)return!1}}})}function ee(e,t,r){var n=r,i=!1;return X(e,function(a,s,l,c,p){i===!1&&r===void 0?n=a:n=t(n,a,s,l,c,p),i=!0}),n}function Ee(e,t){if(!e)throw new Error("geojson is required");U(e,function(r,n,i){if(r.geometry!==null){var a=r.geometry.type,s=r.geometry.coordinates;switch(a){case"LineString":if(t(r,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(t(lineString(s[l],r.properties),n,i,l)===!1)return!1;break}}})}function Ue(e,t,r){var n=r;return Ee(e,function(i,a,s,l){a===0&&r===void 0?n=i:n=t(n,i,a,s,l)}),n}function et(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),s=s||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),lineString([c[a],c[a+1]],s,t);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a-1),lineString([c[i][a],c[i][a+1]],s,t);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a-1),lineString([c[n][a],c[n][a+1]],s,t);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a-1),lineString([c[n][i][a],c[n][i][a+1]],s,t)}throw new Error("geojson is invalid")}function he(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),s=s||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":return point(c,s,t);case"MultiPoint":return n<0&&(n=c.length+n),point(c[n],s,t);case"LineString":return a<0&&(a=c.length+a),point(c[a],s,t);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a),point(c[i][a],s,t);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a),point(c[n][a],s,t);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a),point(c[n][i][a],s,t)}throw new Error("geojson is invalid")}var Q=Z(5991),ye=Z(6610),Je=Z(10379),_t=Z(46070),pe=Z(77608),yr=Z(14665);function tn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(t){return typeof e=="function"}}var rn=Z(51814);function Jt(e,t,r){return(0,rn.Z)()?Jt=Reflect.construct.bind():Jt=function(i,a,s){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return s&&(0,yr.Z)(p,s.prototype),p},Jt.apply(null,arguments)}function Kr(e){var t=typeof Map=="function"?new Map:void 0;return Kr=function(n){if(n===null||!tn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Jt(n,arguments,(0,pe.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,yr.Z)(i,n)},Kr(e)}var Nr={REGISTERED_PROTOCOLS:{}};function Xr(e){var t=si();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var un=function(t){return Nr.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]},vi=function(e){(0,Je.Z)(r,e);var t=Xr(r);function r(n,i,a,s){var l;return(0,ye.Z)(this,r),l=t.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,Q.Z)(r)}(Kr(Error));function Ni(e,t){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){t(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var a=r.response;if(e.type==="json")try{a=JSON.parse(r.response)}catch(l){return t(l)}t(null,a,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var s=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new vi(r.status,r.statusText,n.toString(),s))}},r.cancel=r.abort,r.send(e.body),r}function yi(e){return new Promise(function(t,r){Ni(e,function(n,i,a,s,l){n?r({err:n,data:null,xhr:l}):t({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function Mi(e,t){return Ni(e,t)}var Ii=function(t,r){var n=un(t.url)||Mi;return n((0,O.Z)((0,O.Z)({},t),{},{type:"json"}),r)},xo=function(t,r){var n=un(t.url)||Mi;return n((0,O.Z)((0,O.Z)({},t),{},{type:"arrayBuffer"}),r)},Qi=function(t,r){return Mi(_objectSpread(_objectSpread({},t),{},{method:"POST"}),r)},xa=function(t,r){return Mi((0,O.Z)((0,O.Z)({},t),{},{method:"GET"}),r)};function Pi(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var _i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ti(e,t){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){t(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=_i})},r.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(i):_i}function Ca(e,t){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){t(null,n)}).catch(function(n){t(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Vs=function(t,r,n){var i=function(s,l){if(s)r(s);else if(l){var c=typeof createImageBitmap=="function",p=n?n(l):l;c?Ca(p,r):Ti(p,r)}};return t.type==="json"?Ii(t,i):xo(t,i)},ca=function(t,r){var n=typeof createImageBitmap=="function";n?Ca(t,r):Ti(t,r)},Ra=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function tu(e,t,r){var n=e.classList;for(var i in qu)qu.hasOwnProperty(i)&&n.remove("l7-".concat(r,"-anchor-").concat(i));n.add("l7-".concat(r,"-anchor-").concat(t))}var va=Z(2650);function ls(e){return typeof e=="string"?!!d3.color(e):!1}function fi(e){var t=va.ZP(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function ia(e){var t=e&&e[0],r=e&&e[1],n=e&&e[2],i=t+r*256+n*65536-1;return i}function Ma(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function aa(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;for(var n=null,i=r.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var c=(e.positions[l]-a)/(s-a);i.addColorStop(c,e.colors[l])}return r.fillStyle=i,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:n,width:256,height:1}}function Jo(e,t){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=t[1]-t[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-t[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var c=n.getImageData(0,0,256,1).data,p=pc(n,c);return r=null,n=null,p}function jo(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=fi(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),t=null,r=null,n}function Pu(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[i],r.moveTo(i*n,0),r.lineTo((i+1)*n,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=pc(r,a);return t=null,r=null,s}function Rs(e,t){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-t[0])/i*255,0),n.lineTo((e.positions[a+1]-t[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=pc(n,s);return r=null,n=null,l}function pc(e,t){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=t[n+0],r.data[n+1]=t[n+1],r.data[n+2]=t[n+2],r.data[n+3]=t[n+3];return r}function Fa(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var zi={BACK:1029,FRONT:1028};function Ho(e){switch(e){case"GAODE1.x":return zi.BACK;case"GAODE2.x":return zi.BACK;case"MAPBOX":return zi.FRONT;case"SIMPLE":return zi.FRONT;case"GLOBEL":return zi.BACK;case"DEBAULT":return zi.FRONT;default:return zi.FRONT}}var Yt=Z(85061),re=Z(28481),Oe=Z(74691),gt=Z.n(Oe),ur=Z(50361),Jr=Z.n(ur),Ln=Z(23279),Zi=Z.n(Ln),so=Z(27361),bo=Z.n(so),io=Z(51584),Ms=Z.n(io),Zc=Z(60442),ru=Z.n(Zc),Ef=Z(14293),Wo=Z.n(Ef),bl=Z(81763),El=Z.n(bl),Ou=Z(68630),ku=Z.n(Ou),Ku=Z(47037),Vc=Z.n(Ku),Is=Z(36719),$a=Z.n(Is),Sl=Z(82492),Qu=Z.n(Sl),Sf=Z(30236),Wh=Z.n(Sf),Af=Z(97019),ch=Z.n(Af),fh=Z(23493),hh=Z.n(fh),Gh=Z(44908),Xh=Z.n(Gh),Np=Z(11700),jc=Z.n(Np),Du=Z(23560),$h=Z.n(Du),Go=Z(13218),Hl=Z.n(Go),Al=Z(52353),js=Z.n(Al),Tl=Z(68929),nu=Z.n(Tl),mi={isNil:Wo(),merge:Qu(),throttle:hh(),isString:Vc(),debounce:Zi(),pull:ch(),isTypedArray:$a(),isPlainObject:ku(),isNumber:El(),isBoolean:Ms(),isEqual:ru(),cloneDeep:Jr(),uniq:Xh(),clamp:gt(),upperFirst:jc(),get:bo(),mergeWith:Wh(),isFunction:$h(),isObject:Hl(),isUndefined:js(),camelCase:nu()},Hs=mi.pull;function Lu(e){var t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function Ju(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ph(e){return Ju(e).split(/\s+/)}function Yh(e){var t,r=(t=document)===null||t===void 0||(t=t.documentElement)===null||t===void 0?void 0:t.style;if(!r)return e[0];for(var n in e)if(e[n]&&e[n]in r)return e[n];return e[0]}function On(e,t,r){var n=window.document.createElement(e);return t&&(n.className=t||""),r&&r.appendChild(n),n}function Ws(e){var t=e.parentNode;t&&t.removeChild(e)}function cs(e,t){if(e.classList!==void 0)for(var r=ph(t),n=0,i=r.length;n<i;n++)e.classList.add(r[n]);else if(!Na(e,t)){var a=es(e);Tf(e,(a?a+" ":"")+t)}}function du(e,t){if(e.classList!==void 0){var r=ph(t);r.forEach(function(n){e.classList.remove(n)})}else Tf(e,Ju((" "+es(e)+" ").replace(" "+t+" "," ")))}function Na(e,t){if(e.classList!==void 0)return e.classList.contains(t);var r=es(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function Tf(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function qh(e,t,r){r===void 0?Na(e,t)?du(e,t):cs(e,t):r?cs(e,t):du(e,t)}function es(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function wl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Bu=Yh(["transform","WebkitTransform"]);function el(e,t){e.style[Bu]=t}function wf(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Hc(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,t.join(""))}function vu(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var r=(e=t.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(i){var a=i.split("="),s=(0,re.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var Aa=vu()<1?1:window.devicePixelRatio;function tl(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function Fu(e){return e.split(";").map(function(t){return t.trim()}).filter(function(t){return t})}function Kh(e,t){var r,n=Fu((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),i=Fu(t),a=Hs.apply(void 0,[n].concat((0,Yt.Z)(i)));e.setAttribute("style",a.join(";"))}function Wc(e){return Object.entries(e).map(function(t){var r=(0,re.Z)(t,2),n=r[0],i=r[1];return"".concat(n,": ").concat(i)}).join(";")}function ma(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function dc(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Gc(e){e.innerHTML=""}function rl(e){e.setAttribute("draggable","false")}function mu(e,t){if(typeof t=="string"){var r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append.apply(e,(0,Yt.Z)(t)):e.append(t)}function dh(e,t){for(var r=Array.isArray(t)?t:[t],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(r.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var vc;function nl(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Cl(){return typeof importScripts=="function"}var mc=Cl()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},il=(vc=navigator)===null||vc===void 0?void 0:vc.userAgent,gc=!!il.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),yc=il.indexOf("Android")>-1||il.indexOf("Adr")>-1;function vh(){for(var e=il,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,i=t;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){r=!1;break}}return r}function Rl(e,t){e.forEach(function(r){!t[r]||(t[r]=t[r].bind(t))})}var gu=null;function Xc(e){var t=[Infinity,Infinity,-Infinity,-Infinity];return D(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Xc.default=Xc;var mh=Xc;function $c(e){return typeof e=="number"}var yu=2*Math.PI*6378137/2;function Nu(e,t){var r=(0,re.Z)(t,4),n=r[0],i=r[1],a=r[2],s=r[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function _c(e){var t=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;xc(t,n)}),t}function xc(e,t){return Array.isArray(t[0])?t.forEach(function(r){xc(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function Wl(e,t){return Qh(e,t)}function Qh(e,t){return Array.isArray(e[0])?e.map(function(r){return Qh(r,t)}):t(e)}function bc(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Rf(e,t);var n=e[0],i=e[1],a=n*yu/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*yu/180,r.enable&&(a=Number(a.toFixed(r.decimal)),s=Number(s.toFixed(r.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function Jh(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],i=r/yu*180,a=n/yu*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),t!=null&&(i=Number(i.toFixed(t)),a=Number(a.toFixed(t))),e.length===3?[i,a,e[2]]:[i,a]}function Cf(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function ep(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Rf(e,t){if(t===!1)return e;var r=Cf(e[0]),n=ep(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Ya(e){var t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),n=256<<20,i=Math.PI/180,a=e[0]*i,s=r*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,c=.5,p=-.5/Math.PI;return i=.5,a=n*(l*a+c),s=n*(p*s+i),[Math.floor(a),Math.floor(s)]}function Mf(e){var t=.5/Math.PI,r=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],c=s[1];l=(l/a-r)/t,c=(c/a-i)/n,c=(Math.atan(Math.pow(Math.E,c))-Math.PI/4)*2,i=Math.PI/180;var p=c/i,y=l/i;return[y,p]}function tp(e,t){var r=85.0511287798,n=Math.PI/180,i=6378137;return t=Math.max(Math.min(r,t),-r),e*=n,t*=n,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*i,t*i]}function Ec(e,t){var r=Math.PI/180,n=6378137,i=e/n/r,a=2*(Math.atan(Math.exp(t/n))-Math.PI/4)/r;return[i,a]}function gh(e,t,r){var n=Ga(t[1]-e[1]),i=Ga(t[0]-e[0]),a=Ga(e[1]),s=Ga(t[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Rn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function Gl(e){var t=Math.PI/180,r=85.0511287798,n=6378137,i=Math.max(Math.min(r,e[1]),-r),a=Math.sin(i*t),s=n*e[0]*t,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function oa(e,t){var r=Math.abs(e[1][1]-e[0][1])*t,n=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Sc(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Gs(e){return[[e[0],e[1]],[e[2],e[3]]]}function Ml(e){var t=Di(e,[0,0]);return[e[0]/t,e[1]/t]}function Di(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function ga(e,t){return e[0]*t[0]+e[1]*t[1]}function Ps(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function If(e,t){return Math.acos(ga(e,t)/(Ps(e)*Ps(t)))*180/Math.PI}function Ac(e,t){return t[0]>0?t[1]>0?90-Math.atan(t[1]/t[0])*180/Math.PI:90+Math.atan(-t[1]/t[0])*180/Math.PI:t[1]<0?180+(90-Math.atan(t[1]/t[0])*180/Math.PI):270+Math.atan(t[1]/-t[0])*180/Math.PI}function Pf(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],c=Di(s,l);n+=c;var p=[s[0]-l[0],s[1]-l[1]],y=Ac(r,p);if(a>0){var b=i[a-1].rotation;b-y>360-b+y&&(y=y+360)}i.push({start:s,end:l,dis:c,rotation:y,duration:0})}return i.map(function(A){A.duration=t*(A.dis/n)}),i}}function Uu(e){if($c(e[0]))return e;if($c(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if($c(e[0][0][0])){var t=e,r=0,n=0,i=0;return t.forEach(function(a){a.forEach(function(s){r+=s[0],n+=s[1],i++})}),[r/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Of(e){for(var t=e[0],r=e[1],n=e[0],i=e[1],a=0,s=0,l=0,c=0;c<e.length;c+=2){var p=e[c],y=e[c+1];p&&y&&(t=Math.max(p,t),r=Math.max(y,r),n=Math.min(p,n),i=Math.min(y,i),a+=p,s+=y,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(t-n,2)+Math.pow(r-i,2))/2}}function Yc(e){return mh(qn([Hr(e)]))}function Xl(e){var t=131,r=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/r),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/r)),n=n*t+e.charCodeAt(a);return n}function Po(e){e=e.toString();for(var t=5381,r=e.length;r;)t=t*33^e.charCodeAt(--r);return t>>>0}function Ia(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}var qc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function rp(e,t,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=r;return s&&(l=Math.round(r*(a-1))/(a-1)),n?Tc(e,t,l,n,i):Tc(e,t,l,.314,i)}function Pa(e,t){var r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function An(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function fs(e,t,r){var n=[t[0]-e[0],t[1]-e[1]],i=An(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(r),l=a+r,c=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return c}function Tc(e,t,r,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(t[0],t[1]),l=fs(a,s,n),c=[a[0],l[0],s[0]],p=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(Pa(c,r),Pa(p,r))),[0])}else{var y=fs(e,t,n),b=[e[0],y[0],t[0]],A=[e[1],y[1],t[1]];return[Pa(b,r),Pa(A,r),0]}}function Kc(e,t,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=r;return s&&(l=Math.round(r*29)/29),ln(e,t,l,i)}function hs(e,t){var r=[t[0]-e[0],t[1]-e[1]],n=calDistance(r,[0,0]),i=Math.atan2(r[1],r[0]),a=.314,s=n/2/Math.cos(a),l=i+a,c=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return c}function sa(e,t){var r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function kf(e,t){var r=[e[0]-t[0],e[1]-t[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(t[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function ln(e,t,r,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(t[0]),degreesToRadians(t[1])];if(n==="GAODE2.x"){var s=hs(i,a),l=[i[0],s[0],a[0]],c=[i[1],s[1],a[1]];return[sa(l,r),sa(c,r),0]}else{var p=kf(i,a);if(Math.abs(p-Math.PI)<.001)return[(1-r)*i[0]+r*a[0],(1-r)*i[1]+r*a[1]];var y=Math.sin((1-r)*p)/Math.sin(p),b=Math.sin(r*p)/Math.sin(p),A=[Math.sin(i[0]),Math.sin(i[1])],w=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],P=[Math.cos(a[0]),Math.cos(a[1])],L=y*w[1]*w[0]+b*P[1]*P[0],V=y*w[1]*A[0]+b*P[1]*I[0],K=y*A[1]+b*I[1];return[radiansToDegrees(Math.atan2(V,L)),radiansToDegrees(Math.atan2(K,Math.sqrt(L*L+V*V)))]}}function Il(e,t){for(var r=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=Df(a,s),c=r;r+=l,n.push({p1:a,p2:s,totalDistance:r,distance:l,lastTotalDistance:c})}for(var p=r*t,y,b,A=0,w=n;A<w.length;A++){var I=w[A],P=I.totalDistance;if(P>p){var L=I.p1,V=I.p2,K=(p-I.lastTotalDistance)/I.distance,le=Qc(V,L,K);y=le[0],b=le[1];break}}return{lng:y,lat:b,height:0}}function Qc(e,t,r){return[e[0]*r+t[0]*(1-r),e[1]*r+t[1]*(1-r)]}function Df(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Xs(e,t){var r=t.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(i){var a=i.id;return a===r})),n.map(function(i){var a=Lf(i,t);return _objectSpread(_objectSpread({},i),a)})}function $s(e,t){return new Promise(function(r){e.inited?r(Xs(e,t)):e.once("update",function(){r(Xs(e,t))})})}function Lf(e,t){var r=t.offset,n=t.shape,i=t.thetaOffset,a=t.mapVersion,s=t.segmentNumber,l=s===void 0?30:s,c=t.autoFit,p=c===void 0?!0:c,y=e.coordinates;if(n==="line")return pathLineAtOffset(y,r);var b=y[0],A=y[1],w=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=arcLineAtOffset;break;case"greatcircle":I=greatCircleLineAtOffset;break;default:I=arcLineAtOffset}var P=I(b,A,r,w,a,l,p),L=_slicedToArray(P,3),V=L[0],K=L[1],le=L[2];return{lng:V,lat:K,height:le}}var Bf=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ye.Z)(this,e),this.limit=t,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Q.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(i){return i===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function ps(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function zu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function yh(e){if(e.length===0)return 0;for(var t=e[0]*1,r=1;r<e.length;r++)t+=e[r]*1;return t}function wc(e){if(e.length===0)throw new Error("mean requires at least one data point");return yh(e)/e.length}function Ff(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],r=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==t?(i>n&&(n=i,r=t),i=1,t=e[a]):i++;return r*1}var Jc={min:zu,max:ps,mean:wc,sum:yh,mode:Ff};function ds(e,t){return e.map(function(r){return r[t]})}function Ys(e,t){return Jc[e](t)}var St=Z(92137),Be=Z(63349),F=Z(96156),Oo=Z(87757),Ae=Z.n(Oo);function al(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[r,n],l=[r,a],c=[i,a],p=[i,n];return wt([[s,p,c,l,s]],t.properties,{bbox:e,id:t.id})}var ba=Z(26729),ko=Z.n(ba),ol=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),wn=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Cn=0,Es=1,Eo=2;function _u(e){e.forEach(function(t){t.isCurrent&&(t.isVisible=t.isLoaded)})}function Oa(e){e.forEach(function(t){t.properties.state=Cn}),e.forEach(function(t){t.isCurrent&&!Zu(t)&&sl(t)}),e.forEach(function(t){t.isVisible=Boolean(t.properties.state&Eo)})}function iu(e){e.forEach(function(r){r.properties.state=Cn}),e.forEach(function(r){r.isCurrent&&Zu(r)});var t=e.slice().sort(function(r,n){return r.z-n.z});t.forEach(function(r){r.isVisible=Boolean(r.properties.state&Eo),r.children.length&&(r.isVisible||r.properties.state&Es)?r.children.forEach(function(n){n.properties.state=Es}):r.isCurrent&&sl(r)})}function Zu(e){for(;e;){if(e.isLoaded)return e.properties.state|=Eo,!0;e=e.parent}return!1}function sl(e){e.children.forEach(function(t){t.isLoaded?t.properties.state|=Eo:sl(t)})}var Vi,Do=256,Nf=[-Infinity,-Infinity,Infinity,Infinity],Pl=.2,Uf=5,ul=(Vi={},(0,F.Z)(Vi,ol.Realtime,_u),(0,F.Z)(Vi,ol.Overlap,Oa),(0,F.Z)(Vi,ol.Replace,iu),Vi),Os=function(){};function Ol(e,t,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),i=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,i]}function xu(e,t,r){var n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var ef=function(t,r,n){var i=xu(t,r,n),a=(0,re.Z)(i,2),s=a[0],l=a[1],c=xu(t+1,r+1,n),p=(0,re.Z)(c,2),y=p[0],b=p[1];return[s,b,y,l]};function Cc(e){var t=e.zoom,r=e.latLonBounds,n=e.maxZoom,i=n===void 0?Infinity:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,c=l===void 0?0:l,p=e.extent,y=p===void 0?Nf:p,b=Math.ceil(t)+c;if(Number.isFinite(s)&&b<s)return[];Number.isFinite(i)&&b>i&&(b=i);for(var A=(0,re.Z)(r,4),w=A[0],I=A[1],P=A[2],L=A[3],V=[Math.max(w,y[0]),Math.max(I,y[1]),Math.min(P,y[2]),Math.min(L,y[3])],K=[],le=Ol(V[0],V[1],b),xe=(0,re.Z)(le,2),ke=xe[0],je=xe[1],it=Ol(V[2],V[3],b),vt=(0,re.Z)(it,2),Lt=vt[0],lr=vt[1],cr=ke;cr<=Lt;cr++)for(var Rr=lr;Rr<=je;Rr++)K.push({x:cr,y:Rr,z:b});var fn=(Lt+ke)/2,Pn=(je+lr)/2,Ri=function(Ha,no){return Math.abs(Ha-fn)+Math.abs(no-Pn)};return K.sort(function(ya,Ha){return Ri(ya.x,ya.y)-Ri(Ha.x,Ha.y)}),K}var tf=function(t,r,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,c=t,p=r;return i&&(c<0?c=c+l:c>s&&(c=c%l)),{warpX:c,warpY:p}};function zf(e){var t=$l();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function $l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yl=function(e){(0,Je.Z)(r,e);var t=zf(r);function r(n){var i;(0,ye.Z)(this,r),i=t.call(this),(0,F.Z)((0,Be.Z)(i),"tileSize",256),(0,F.Z)((0,Be.Z)(i),"isVisible",!1),(0,F.Z)((0,Be.Z)(i),"isCurrent",!1),(0,F.Z)((0,Be.Z)(i),"isVisibleChange",!1),(0,F.Z)((0,Be.Z)(i),"loadedLayers",0),(0,F.Z)((0,Be.Z)(i),"isLayerLoaded",!1),(0,F.Z)((0,Be.Z)(i),"isLoad",!1),(0,F.Z)((0,Be.Z)(i),"isChildLoad",!1),(0,F.Z)((0,Be.Z)(i),"parent",null),(0,F.Z)((0,Be.Z)(i),"children",[]),(0,F.Z)((0,Be.Z)(i),"data",null),(0,F.Z)((0,Be.Z)(i),"properties",{}),(0,F.Z)((0,Be.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,c=n.tileSize,p=n.warp,y=p===void 0?!0:p;return i.x=a,i.y=s,i.z=l,i.warp=y||!0,i.tileSize=c,i}return(0,Q.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===wn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===wn.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===wn.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===wn.Cancelled}},{key:"isDone",get:function(){return[wn.Loaded,wn.Cancelled,wn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return ef(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,re.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],c=i[3],p=[(l-a)/2,(c-s)/2],y=al(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return y}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l,c,p,y,b,A,w,I,P,L,V,K,le,xe,ke,je,it;return Ae().wrap(function(Lt){for(;;)switch(Lt.prev=Lt.next){case 0:return l=s.getData,c=s.onLoad,p=s.onError,this.loadDataId++,y=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=wn.Loading,b=null,Lt.prev=7,w=this.x,I=this.y,P=this.z,L=this.bounds,V=this.tileSize,K=this.warp,le=tf(w,I,P,K),xe=le.warpX,ke=le.warpY,je=this.abortController.signal,it={x:xe,y:ke,z:P,bounds:L,tileSize:V,signal:je,warp:K},Lt.next=14,l(it,this);case 14:b=Lt.sent,Lt.next=20;break;case 17:Lt.prev=17,Lt.t0=Lt.catch(7),A=Lt.t0;case 20:if(y===this.loadDataId){Lt.next=22;break}return Lt.abrupt("return");case 22:if(!(this.isCancelled&&!b)){Lt.next=24;break}return Lt.abrupt("return");case 24:if(!(A||!b)){Lt.next=28;break}return this.loadStatus=wn.Failure,p(A,this),Lt.abrupt("return");case 28:this.loadStatus=wn.Loaded,this.data=b,c(this);case 31:case"end":return Lt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=wn.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(ba.EventEmitter),_h=function(t,r){var n=Gs(t),i=oa(n,r),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},Vu=function(t,r){var n=Gs(t),i=Gs(r),a=Sc(n,i);return a};function Xo(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zf(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Zf(e,t){if(!!e){if(typeof e=="string")return ll(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ll(e,t)}}function ll(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function au(e){var t=xh();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function xh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rf=mi.throttle,cl=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Vf=function(e){(0,Je.Z)(r,e);var t=au(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),(0,F.Z)((0,Be.Z)(i),"currentTiles",[]),(0,F.Z)((0,Be.Z)(i),"cacheTiles",new Map),(0,F.Z)((0,Be.Z)(i),"throttleUpdate",rf(function(a,s){i.update(a,s)},16)),(0,F.Z)((0,Be.Z)(i),"onTileLoad",function(a){i.emit(cl.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Be.Z)(i),"onTileError",function(a,s){i.emit(cl.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Be.Z)(i),"onTileUnload",function(a){i.emit(cl.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Nf,getTileData:Os,warp:!0,updateStrategy:ol.Replace},i.updateOptions(n),i}return(0,Q.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,O.Z)((0,O.Z)((0,O.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Vu(this.lastViewStates.latLonBoundsBuffer,a))){var c=_h(a,Pl);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:c},this.currentZoom=l;var p=!1,y=this.getTileIndices(l,c).filter(function(b){return s.options.warp||b.x>=0&&b.x<Math.pow(2,l)});this.emit(cl.TilesLoadStart),this.currentTiles=y.map(function(b){var A=b.x,w=b.y,I=b.z,P=s.getTile(A,w,I);if(P){var L,V,K=((L=P)===null||L===void 0?void 0:L.isFailure)||((V=P)===null||V===void 0?void 0:V.isCancelled);return K&&P.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),P}return P=s.createTile(A,w,I),p=!0,P}),p&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Xo(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,re.Z)(a.value,2),l=s[0],c=s[1];if(!this.currentTiles.includes(c)){this.cacheTiles.delete(l),this.onTileUnload(c);return}this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(p){i.e(p)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(c){s.reloadTileById(c.z,c.x,c.y)})}},{key:"pruneRequests",value:function(){var i=[],a=Xo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(p){a.e(p)}finally{a.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,c=Math.ceil(s)+l,p=Ol(i,a,c),y=this.tiles.filter(function(b){return b.key==="".concat(p[0],"_").concat(p[1],"_").concat(c)});return y[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(c){return c.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Xo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=Xo(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;a.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(I){s.e(I)}finally{s.f()}var p=Xo(this.currentTiles),y;try{for(p.s();!(y=p.n()).done;){var b=y.value;b.isCurrent=!0,b.isVisible=!0}}catch(I){p.e(I)}finally{p.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):ul[i](A);var w=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,w=!0):I.isVisibleChange=!1}),w&&this.emit(cl.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,c=s.extent,p=s.zoomOffset,y=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),A=Cc({maxZoom:y,minZoom:b,zoomOffset:p,tileSize:l,zoom:i,latLonBounds:a,extent:c});return A}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(cl.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),c=this.cacheTiles.get(l);return c}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),c=new Yl({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=Uf*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=Xo(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var c=(0,re.Z)(l.value,2),p=c[0],y=c[1];if(!y.isVisible&&!this.currentTiles.includes(y)&&(this.cacheTiles.delete(p),this.onTileUnload(y)),this.cacheTiles.size<=i)break}}catch(b){s.e(b)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Xo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=Xo(this.cacheTiles.values()),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,y=this.getNearestAncestor(p.x,p.y,p.z);p.parent=y,y!=null&&y.children&&y.children.push(p)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),r}(ko());function h(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function v(e){var t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),a;for(a=n;a<=i;++a)t.push(e.replace(r[0],String.fromCharCode(a)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var s=parseInt(r[2],10),l=parseInt(r[1],10);l<=s;l++)t.push(e.replace(r[0],l.toString()));return t}return t.push(e),t}function d(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=t.x,n=t.y,i=t.z,a=v(e),s=Math.abs(r+n)%a.length,l=un(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,ef(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function g(e,t){var r=t.x,n=t.y,i=t.z,a=t.layer,s=t.version,l=s===void 0?"1.0.0":s,c=t.style,p=c===void 0?"default":c,y=t.format,b=t.service,A=b===void 0?"WMTS":b,w=t.tileMatrixset,I="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(p,"&TILEMATRIXSET=").concat(w,"&FORMAT=").concat(y,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function S(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var C={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},R=C.self||C.window||{},k=C.window||C.self||{},G=C.self||C.window||{},J=C.document||{},_e=typeof importScripts=="function",be=typeof window!="undefined"&&typeof window.orientation!="undefined",Te=function(){function e(t,r){var n=this;this.name=t,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(t,r){this.workerThread.postMessage({source:"Main thread",type:t,payload:r})},e.prototype.done=function(t){S(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},e.prototype.error=function(t){S(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},e}(),$e=Te,Ve=new Map;function st(e){S(e.source&&!e.url||!e.source&&e.url);var t=Ve.get(e.source||e.url);return t||(e.url&&(t=Fe(e.url),Ve.set(e.url,t)),e.source&&(t=at(e.source),Ve.set(e.source,t))),S(t),t}function Fe(e){if(!e.startsWith("http"))return e;var t=bt(e);return at(t)}function at(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function bt(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Nt(e,t,r){t===void 0&&(t=!0);var n=r||new Set;if(e){if(nr(e))n.add(e);else if(nr(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(var i in e)Nt(e[i],t,n)}}return r===void 0?Array.from(n):[]}function nr(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var qt=function(){},fr=function(){function e(t){this.terminated=!1,this.loadableURL="";var r=t.name,n=t.source,i=t.url;S(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=qt,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=qt,this.onError=qt,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(t,r){r=r||Nt(t),this.worker.postMessage(t,r)},e.prototype.getErrorFromErrorEvent=function(t){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",t.message&&(r+=t.message+" in "),t.lineno&&(r+=":"+t.lineno+":"+t.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=st({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?t.onMessage(n.data):t.onError(new Error("No data received"))},r.onerror=function(n){t.onError(t.getErrorFromErrorEvent(n)),t.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+t.name+", message error: "+n)},r},e}(),Er=fr,Gr=function(){return Gr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Gr.apply(this,arguments)},Zr=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(y){try{p(n.next(y))}catch(b){s(b)}}function c(y){try{p(n.throw(y))}catch(b){s(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,t||[])).next())})},vn=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,i=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){r.label=p[1];break}if(p[0]===6&&r.label<a[1]){r.label=a[1],a=p;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(p);break}a[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(e,r)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},zn=function(){function e(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(t){return t.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(t){this.props=Gr(Gr({},this.props),t),t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)},e.prototype.startJob=function(t,r,n){return r===void 0&&(r=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),Zr(this,void 0,void 0,function(){var i,a=this;return vn(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:t,onMessage:r,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return Zr(this,void 0,void 0,function(){var t,r,n;return vn(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(t=this.getAvailableWorker(),!t)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:t}),n=new $e(r.name,t),t.onMessage=function(a){return r.onMessage(n,a.type,a.payload)},t.onError=function(a){return r.onError(n,a)},r.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(t){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Er({name:t,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return be?this.maxMobileConcurrency:this.maxConcurrency},e}(),Hn=zn,Fn=function(){return Fn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Fn.apply(this,arguments)},Bi=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},bn={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ui=function(){function e(t){this.workerPools=new Map,this.props=Fn({},bn),this.setProps(t),this.workerPools=new Map}return e.isSupported=function(){return Er.isSupported()},e.getWorkerFarm=function(t){return t===void 0&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var t,r;try{for(var n=Bi(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setProps=function(t){var r,n;this.props=Fn(Fn({},this.props),t);try{for(var i=Bi(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(t){var r=t.name,n=t.source,i=t.url,a=this.workerPools.get(r);return a||(a=new Hn({name:r,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),bi=null,ti=new Map,ii=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(t){self.onmessage=function(r){if(!!Jn(r)){var n=r.data,i=n.type,a=n.payload;t(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(t){var r=ti.get(t);r||(r=function(n){if(!!Jn(n)){var i=n.data,a=i.type,s=i.payload;t(a,s)}}),self.addEventListener("message",r)},e.removeEventListener=function(t){var r=ti.get(t);ti.delete(t),self.removeEventListener("message",r)},e.postMessage=function(t,r){if(self){var n={source:"Worker thread",type:t,payload:r},i=Nt(r);self.postMessage(n,i)}},e}(),gi=null;function Jn(e){var t=e.type,r=e.data;return t==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function ei(e){return JSON.parse(uo(e))}function uo(e){var t=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(t.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}t.add(n)}return n})}function qa(e){return""+e.name}function $o(e,t){t===void 0&&(t={});var r=t[e.id]||{},n=e.name+".worker.js",i=r.workerUrl;return t._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var lo=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(y){try{p(n.next(y))}catch(b){s(b)}}function c(y){try{p(n.throw(y))}catch(b){s(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,t||[])).next())})},Ta=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,i=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){r.label=p[1];break}if(p[0]===6&&r.label<a[1]){r.label=a[1],a=p;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(p);break}a[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(e,r)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};function Ka(e,t){return WorkerFarm.isSupported()?e.worker&&(t==null?void 0:t.worker):!1}function Ss(e,t,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),lo(this,void 0,void 0,function(){var i,a,s,l,c,p,y,b;return Ta(this,function(A){switch(A.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,r),s=WorkerFarm.getWorkerFarm(r),l=s.getWorkerPool({name:i,url:a}),c=r.jobName||e.name,[4,l.startJob(c,ts.bind(null,n))];case 1:return p=A.sent(),y=removeNontransferableOptions(r),p.postMessage("process",{input:t,options:y}),[4,p.result];case 2:return b=A.sent(),[2,b.result]}})})}function ts(e,t,r,n){return lo(this,void 0,void 0,function(){var i,a,s,l,c,p,y;return Ta(this,function(b){switch(b.label){case 0:switch(i=r,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return t.done(n),[3,9];case 2:return t.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,b.label=4;case 4:return b.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(t.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return c=b.sent(),t.postMessage("done",{id:a,result:c}),[3,7];case 6:return p=b.sent(),y=p instanceof Error?p.message:"unknown error",t.postMessage("error",{id:a,error:y}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),b.label=9;case 9:return[2]}})})}var fl=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(t){return this.enqueue(t)},e.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();t instanceof Error?r.reject(t):r.resolve({value:t})}else this._values.push(t)},e.prototype.close=function(){for(;this._settlers.length>0;){var t=this._settlers.shift();t.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var t=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){t._settlers.push({resolve:n,reject:i})})},e}(),As=null,ou=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(y){try{p(n.next(y))}catch(b){s(b)}}function c(y){try{p(n.throw(y))}catch(b){s(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,t||[])).next())})},ks=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,i=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){r.label=p[1];break}if(p[0]===6&&r.label<a[1]){r.label=a[1],a=p;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(p);break}a[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(e,r)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Rc=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(a){r[a]=e[a]&&function(s){return new Promise(function(l,c){s=e[a](s),i(l,c,s.done,s.value)})}}function i(a,s,l,c){Promise.resolve(c).then(function(p){a({value:p,done:l})},s)}},ql=0,qs,hl;function kl(e,t){var r=this;if(typeof self!="undefined"){var n={process:bu};WorkerBody.onmessage=function(i,a){return ou(r,void 0,void 0,function(){var s,l,c,p,y,b,A,w,I,P,L;return ks(this,function(V){switch(V.label){case 0:switch(V.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=V.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");qs=new AsyncQueue,hl=a.options||{},c=t(qs,hl,n),V.label=4;case 4:V.trys.push([4,9,10,15]),p=Rc(c),V.label=5;case 5:return[4,p.next()];case 6:if(y=V.sent(),!!y.done)return[3,8];b=y.value,WorkerBody.postMessage("output-batch",{result:b}),V.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=V.sent(),P={error:A},[3,15];case 10:return V.trys.push([10,,13,14]),y&&!y.done&&(L=p.return)?[4,L.call(p)]:[3,12];case 11:V.sent(),V.label=12;case 12:return[3,14];case 13:if(P)throw P.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return qs.push(a.input),[3,18];case 17:return qs.close(),[3,18];case 18:return[3,20];case 19:return w=V.sent(),I=w instanceof Error?w.message:"",WorkerBody.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function bu(e,t){return t===void 0&&(t={}),new Promise(function(r,n){var i=ql++,a=function(l,c){if(c.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),r(c.result);break;case"error":WorkerBody.removeEventListener(a),n(c.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:t};WorkerBody.postMessage("process",s)})}var pl=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(y){try{p(n.next(y))}catch(b){s(b)}}function c(y){try{p(n.throw(y))}catch(b){s(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,t||[])).next())})},Lo=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,i=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){r.label=p[1];break}if(p[0]===6&&r.label<a[1]){r.label=a[1],a=p;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(p);break}a[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(e,r)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},ka={};function Ds(e,t,r){return t===void 0&&(t=null),r===void 0&&(r={}),pl(this,void 0,void 0,function(){return Lo(this,function(n){switch(n.label){case 0:return t&&(e=su(e,t,r)),ka[e]=ka[e]||Eu(e),[4,ka[e]];case 1:return[2,n.sent()]}})})}function su(e,t,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+t+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+t+"/src/libs/"+e}function Eu(e){return pl(this,void 0,void 0,function(){var t,r,n;return Lo(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return t=i.sent(),[4,t.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=i.sent(),[4,r.text()];case 5:return n=i.sent(),[2,Li(n,e)]}})})}function Li(e,t){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var Yo="0.0.3",So={id:"null",name:"null",module:"web-worker-helper",options:{}};function uu(e){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function Mc(e,t,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ju(e){var t=e.filter;return t?[1]:[0]}function nf(e,t){return[t]}var Kl=Z(9187),Ao=Z.n(Kl),Mr=Z(31437),Ql=Mr.create(),Pd=Mr.create(),Ua=Mr.create(),ao=Mr.create(),af=Mr.create();function np(e,t,r,n,i){Mr.add(e,r,n),Mr.normalize(e,e),t=Mr.fromValues(-e[1],e[0]);var a=Mr.fromValues(-r[1],r[0]);return[i/Mr.dot(t,a),t]}function Su(e,t){return Mr.set(e,-t[1],t[0])}function jf(e,t,r){return Mr.sub(e,t,r),Mr.normalize(e,e),e}function Up(e,t){return e[0]===t[0]&&e[1]===t[1]}function d0(e){for(var t=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();t.get(n)?(e.splice(r,1),r++):t.set(n,n)}return e}var ip=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ye.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Mr.fromValues(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Q.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var c,p,y,b=r[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=r[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<r.length-1?[].concat((0,Yt.Z)(r[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,L=l<n.length-1?n[l+1]:null,V=this.segment_gaode2(i,s,b,w,P,A,I,L);s+=V}if(this.dash)for(var K=0;K<i.positions.length/6;K++)i.positions[K*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var c,p,y,b=r[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=r[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<r.length-1?[].concat((0,Yt.Z)(r[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,L=l<n.length-1?n[l+1]:null,V=this.simpleSegment(i,s,b,w,P,A,I,L);s+=V}if(this.dash)for(var K=0;K<i.positions.length/6;K++)i.positions[K*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],c=r[s],p=s<r.length-1?r[s+1]:null,y=this.segment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],c=r[s],p=s<r.length-1?r[s+1]:null,y=this.simpleSegment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,i,a,s,l,c,p){var y=0,b=r.indices,A=r.positions,w=r.normals,I=this.cap==="square",P=this.join==="bevel",L=Ya([c[0],c[1]]),V=Ya([l[0],l[1]]);jf(Ua,a,i);var K=0;if(this.dash&&(K=this.lineSegmentDistance(L,V),this.totalDistance+=K),this.normal||(this.normal=Mr.create(),Su(this.normal,Ua)),!this.started)if(this.started=!0,I){var le=Mr.create(),xe=Mr.create();Mr.add(le,this.normal,Ua),Mr.add(xe,this.normal,Ua),w.push(xe[0],xe[1],0),w.push(le[0],le[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-K,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-K,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-K);if(b.push(n+0,n+1,n+2),s){Up(a,s)&&Mr.add(s,a,Mr.normalize(s,Mr.subtract(s,a,i))),jf(ao,s,a);var it=np(af,Mr.create(),Ua,ao,this.thickness),vt=(0,re.Z)(it,2),Lt=vt[0],lr=vt[1],cr=Mr.dot(af,this.normal)<0?-1:1,Rr=P;if(!Rr&&this.join==="miter"){var fn=Lt;fn>this.miterLimit&&(Rr=!0)}Rr?(w.push(this.normal[0],this.normal[1],0),w.push(lr[0],lr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Yt.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Su(Ql,ao),Mr.copy(this.normal,Ql),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(A,w,a,lr,Lt,this.totalDistance),b.push.apply(b,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,Mr.copy(this.normal,lr),y+=2),this.lastFlip=cr}else{if(Su(this.normal,Ua),I){var ke=Mr.create(),je=Mr.create();Mr.sub(je,Ua,this.normal),Mr.add(ke,Ua,this.normal),w.push(je[0],je[1],0),w.push(ke[0],ke[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"simpleSegment",value:function(r,n,i,a,s){var l=0,c=r.indices,p=r.positions,y=r.normals,b=Ya([a[0],a[1]]),A=Ya([i[0],i[1]]);jf(Ua,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Mr.create(),Su(this.normal,Ua)),this.started||(this.started=!0,this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!s)Su(this.normal,Ua),this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ya([s[0],s[1]]);Up(b,I)&&Mr.add(I,b,Mr.normalize(I,Mr.subtract(I,b,A))),jf(ao,I,b);var P=np(af,Mr.create(),Ua,ao,this.thickness),L=(0,re.Z)(P,2),V=L[0],K=L[1],le=Mr.dot(af,this.normal)<0?-1:1;this.extrusions(p,y,a,K,V,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),le=-1,Mr.copy(this.normal,K),l+=2,this.lastFlip=le}return l}},{key:"segment",value:function(r,n,i,a,s){var l=0,c=r.indices,p=r.positions,y=r.normals,b=this.cap==="square",A=this.join==="bevel",w=Ya([a[0],a[1]]),I=Ya([i[0],i[1]]);jf(Ua,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Mr.create(),Su(this.normal,Ua)),!this.started)if(this.started=!0,b){var L=Mr.create(),V=Mr.create();Mr.add(L,this.normal,Ua),Mr.add(V,this.normal,Ua),y.push(V[0],V[1],0),y.push(L[0],L[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),s){var xe=Ya([s[0],s[1]]);Up(w,xe)&&Mr.add(xe,w,Mr.normalize(xe,Mr.subtract(xe,w,I))),jf(ao,xe,w);var ke=np(af,Mr.create(),Ua,ao,this.thickness),je=(0,re.Z)(ke,2),it=je[0],vt=je[1],Lt=Mr.dot(af,this.normal)<0?-1:1,lr=A;if(!lr&&this.join==="miter"){var cr=it;cr>this.miterLimit&&(lr=!0)}lr?(y.push(this.normal[0],this.normal[1],0),y.push(vt[0],vt[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,Yt.Z)(this.lastFlip!==-Lt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Su(Ql,ao),Mr.copy(this.normal,Ql),y.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,y,a,vt,it,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Lt=-1,Mr.copy(this.normal,vt),l+=2),this.lastFlip=Lt}else{if(Su(this.normal,Ua),b){var K=Mr.create(),le=Mr.create();Mr.sub(le,Ua,this.normal),Mr.add(K,Ua,this.normal),y.push(le[0],le[1],0),y.push(K[0],K[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),r.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],a=n[1]-r[1];return Math.sqrt(i*i+a*a)}}]),e}();function zp(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new ip({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=t;Array.isArray(a[0][0])||(a=[t]);var s=r;Array.isArray(s[0][0])||(s=[r]);for(var l=0;l<a.length;l++){var c=a[l],p=s[l];i.extrude_gaode2(c,p)}}else{var y=t;y[0]&&!Array.isArray(y[0][0])&&(y=[t]),y.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function of(e){var t=Uu(e.coordinates);return{vertices:[].concat((0,Yt.Z)(t),(0,Yt.Z)(t),(0,Yt.Z)(t),(0,Yt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Zp(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes,s=Ao()(n,a,i);return{indices:s,vertices:n,size:i}}var Ic=function(){var e=(0,St.Z)(Ae().mark(function t(r){var n,i,a,s,l,c,p,y,b;return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s=r.iconMap,l={a_Color:uu,a_Position:Mc,filter:ju,a_vertexId:nf,a_PickingColor:function(P){var L=P.id;return a?Ma(L):[0,0,0]},a_DistanceAndIndex:function(P,L,V,K,le,xe){return xe===void 0?[V[3],10]:[V[3],xe]},a_Total_Distance:function(P,L,V){return[V[5]]},a_Size:function(P){var L=P.size,V=L===void 0?1:L;return Array.isArray(V)?[V[0],V[1]]:[V,0]},a_Normal:function(P,L,V,K,le){return le},a_Miter:function(P,L,V){return[V[4]]},a_iconMapUV:function(P){var L=P.texture,V=s[L]||{x:0,y:0},K=V.x,le=V.y;return[K,le]}},c={sizePerElement:0,elements:[]},p=0,y=[],b=3,i.forEach(function(I,P){var L=zp(I),V=L.indices,K=L.vertices,le=L.normals,xe=L.size,ke=L.indexes;V.forEach(function(Lt){y.push(Lt+p)}),b=xe;var je=K.length/xe;c.sizePerElement=b,c.elements.push({featureIdx:P,vertices:K,normals:le,offset:p}),p+=je;for(var it=function(lr){var cr=(le==null?void 0:le.slice(lr*3,lr*3+3))||[],Rr=K.slice(lr*xe,lr*xe+xe),fn=0;ke&&ke[lr]!==void 0&&(fn=ke[lr]),n.forEach(function(Pn){if(Pn&&l[Pn.name]){var Ri;(Ri=Pn.buffer.data).push.apply(Ri,(0,Yt.Z)(l[Pn.name](I,P,Rr,lr,cr,fn)))}})},vt=0;vt<je;vt++)it(vt)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return w.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),bh=function(){var e=(0,St.Z)(Ae().mark(function t(r){var n,i,a,s,l,c,p,y,b;return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s=r.shape2d,l={a_Color:uu,a_Position:Mc,filter:ju,a_vertexId:nf,a_PickingColor:function(P){var L=P.id;return a?Ma(L):[0,0,0]},a_Shape:function(P){var L=P.shape,V=L===void 0?2:L,K=s.indexOf(V);return[K]},a_Extrude:function(P,L,V,K){var le=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],xe=K%4*3;return[le[xe],le[xe+1],le[xe+2]]},a_Size:function(P){var L=P.size,V=L===void 0?5:L;return Array.isArray(V)?[V[0]]:[V]}},c={sizePerElement:0,elements:[]},p=0,y=[],b=3,i.forEach(function(I,P){var L=of(I),V=L.indices,K=L.vertices,le=L.normals,xe=L.size,ke=L.indexes;V.forEach(function(Lt){y.push(Lt+p)}),b=xe;var je=K.length/xe;c.sizePerElement=b,c.elements.push({featureIdx:P,vertices:K,normals:le,offset:p}),p+=je;for(var it=function(lr){var cr=(le==null?void 0:le.slice(lr*3,lr*3+3))||[],Rr=K.slice(lr*xe,lr*xe+xe),fn=0;ke&&ke[lr]!==void 0&&(fn=ke[lr]),n.forEach(function(Pn){if(Pn&&l[Pn.name]){var Ri;(Ri=Pn.buffer.data).push.apply(Ri,(0,Yt.Z)(l[Pn.name](I,P,Rr,lr,cr,fn)))}})},vt=0;vt<je;vt++)it(vt)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return w.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),Zv=function(){var e=(0,St.Z)(Ae().mark(function t(r){var n,i,a,s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s={a_Color:uu,a_Position:Mc,filter:ju,a_vertexId:nf,a_PickingColor:function(I){var P=I.id;return a?Ma(P):[0,0,0]}},l={sizePerElement:0,elements:[]},c=0,p=[],y=3,i.forEach(function(w,I){var P=Zp(w),L=P.indices,V=P.vertices,K=P.normals,le=P.size,xe=P.indexes;L.forEach(function(vt){p.push(vt+c)}),y=le;var ke=V.length/le;l.sizePerElement=y,l.elements.push({featureIdx:I,vertices:V,normals:K,offset:c}),c+=ke;for(var je=function(Lt){var lr=(K==null?void 0:K.slice(Lt*3,Lt*3+3))||[],cr=V.slice(Lt*le,Lt*le+le),Rr=0;xe&&xe[Lt]!==void 0&&(Rr=xe[Lt]),n.forEach(function(fn){if(fn&&s[fn.name]){var Pn;(Pn=fn.buffer.data).push.apply(Pn,(0,Yt.Z)(s[fn.name](w,I,cr,Lt,lr,Rr)))}})},it=0;it<ke;it++)je(it)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:p});case 8:case"end":return A.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),Vv={pointFill:bh,line:Ic,polygonFill:Zv},Od=(0,O.Z)({},Vv);function v0(e){return Vp.apply(this,arguments)}function Vp(){return Vp=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t.workerType,n=t.data,!Od[r]){a.next=3;break}return a.abrupt("return",Od[r](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),Vp.apply(this,arguments)}var ap=new Map;function jp(e,t){ap.set(e,t)}function Eh(e){var t=ap.get(e);return t}var Pc="l7-worker",Oc=3,op=!0;function ro(e){registerWorkerSource(Pc,e)}function sf(){var e=getWorkerSource(Pc);if(!e)throw new Error("get worker failed by workerName: ".concat(Pc,"."));return e}function Hp(e,t){return Jl.apply(this,arguments)}function Jl(){return Jl=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=sf(),i=WorkerFarm.getWorkerFarm({maxConcurrency:Oc,reuseWorkers:op}),a=i.getWorkerPool({name:Pc,source:n}),p.next=5,a.startJob(Pc,function(y,b,A){return y.done(A)});case 5:return s=p.sent,s.postMessage("process",{input:{workerType:t,data:r}}),p.next=9,s.result;case 9:return l=p.sent,p.abrupt("return",l.result);case 11:case"end":return p.stop()}},e)})),Jl.apply(this,arguments)}function dl(e,t){return e==null?t:e}var kc=Z(38163),Hf=Z.n(kc);function Wf(e,t){return e.map(function(r){return r[t]*1})}function ec(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Gf(e){return Array.isArray(e)?e.length===0?!1:!!ec(e[0]):!1}function Dc(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function sp(e){var t=Object.isFrozen(e)?mi.cloneDeep(e):e;return Hf()(t,!0),t}function Dl(e,t){var r=t.x,n=t.y,i=t.x1,a=t.y1,s=t.coordinates,l=t.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(V){return V[l]&&V[l].type&&V[l].coordinates&&V[l].coordinates.length>0}).forEach(function(V,K){var le=sp(V[l]);U(le,function(xe){var ke=Wt(xe),je=(0,O.Z)((0,O.Z)({},V),{},{_id:K,coordinates:ke});c.push(je)})}),{dataArray:c};for(var p=0;p<e.length;p++){var y=e[p],b=[];if(s){var A="Polygon";Array.isArray(s[0])||(A="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(A="LineString");var w=sp({type:A,coordinates:y[s]});b=w.coordinates}else if(r&&n&&i&&a){var I=[parseFloat(y[r]),parseFloat(y[n])],P=[parseFloat(y[i]),parseFloat(y[a])];b=[I,P]}else r&&n&&(b=[parseFloat(y[r]),parseFloat(y[n])]);var L=(0,O.Z)((0,O.Z)({},y),{},{_id:p,coordinates:b});c.push(L)}return{dataArray:c}}function uf(e,t){var r=ct(e);return Dl(r,t)}var Au=Z(90484);function Wp(e){for(var t=e.toString(),r=5381,n=t.length;n;)r=r*33^t.charCodeAt(--n);return r>>>0}function Gp(e,t){return t===void 0?null:(0,Au.Z)(e.properties[t])*1==="number"?e.properties[t]*1:e.properties&&e.properties[t]?Wp(e.properties[t]+"")%1000019:null}function Xp(e,t){var r=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=sp(e),e.features.length===0?{dataArray:[],featureKeys:n}:(U(e,function(i,a){var s=Gp(i,t==null?void 0:t.featureId);s===null&&(s=a);var l=s,c=Wt(i),p=(0,O.Z)((0,O.Z)({},i.properties),{},{coordinates:c,_id:l});r.push(p)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function Tu(e,t,r,n){for(var i=n,a=r-t>>1,s=r-t,l,c=e[t],p=e[t+1],y=e[r],b=e[r+1],A=t+3;A<r;A+=3){var w=Lc(e[A],e[A+1],c,p,y,b);if(w>i)l=A,i=w;else if(w===i){var I=Math.abs(A-a);I<s&&(l=A,s=I)}}i>n&&(l-t>3&&Tu(e,t,l,n),e[l+2]=i,r-l>3&&Tu(e,l,r,n))}function Lc(e,t,r,n,i,a){var s=i-r,l=a-n;if(s!==0||l!==0){var c=((e-r)*s+(t-n)*l)/(s*s+l*l);c>1?(r=i,n=a):c>0&&(r+=s*c,n+=l*c)}return s=e-r,l=t-n,s*s+l*l}function Xf(e,t,r,n){var i={id:typeof e=="undefined"?null:e,type:t,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return kd(i),i}function kd(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")up(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<t.length;n++)up(e,t[n]);else if(r==="MultiPolygon")for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)up(e,t[n][i])}function up(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Dd(e,t){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Ll(r,e.features[n],t,n);else e.type==="Feature"?Ll(r,e,t):Ll(r,{geometry:e},t);return r}function Ll(e,t,r,n){if(!!t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],c=t.id;if(r.promoteId?c=t.properties[r.promoteId]:r.generateId&&(c=n||0),a==="Point")Ld(i,l);else if(a==="MultiPoint")for(var p=0;p<i.length;p++)Ld(i[p],l);else if(a==="LineString")Hu(i,l,s,!1);else if(a==="MultiLineString")if(r.lineMetrics){for(p=0;p<i.length;p++)l=[],Hu(i[p],l,s,!1),e.push(Xf(c,"LineString",l,t.properties));return}else Sh(i,l,s,!1);else if(a==="Polygon")Sh(i,l,s,!0);else if(a==="MultiPolygon")for(p=0;p<i.length;p++){var y=[];Sh(i[p],y,s,!0),l.push(y)}else if(a==="GeometryCollection"){for(p=0;p<t.geometry.geometries.length;p++)Ll(e,{id:c,geometry:t.geometry.geometries[p],properties:t.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Xf(c,a,l,t.properties))}}function Ld(e,t){t.push(Bc(e[0])),t.push(tc(e[1])),t.push(0)}function Hu(e,t,r,n){for(var i,a,s=0,l=0;l<e.length;l++){var c=Bc(e[l][0]),p=tc(e[l][1]);t.push(c),t.push(p),t.push(0),l>0&&(n?s+=(i*p-c*a)/2:s+=Math.sqrt(Math.pow(c-i,2)+Math.pow(p-a,2))),i=c,a=p}var y=t.length-3;t[2]=1,Tu(t,0,y,r),t[y+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function Sh(e,t,r,n){for(var i=0;i<e.length;i++){var a=[];Hu(e[i],a,r,n),t.push(a)}}function Bc(e){return e/360+.5}function tc(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Bl(e,t,r,n,i,a,s,l){if(r/=t,n/=t,a>=r&&s<n)return e;if(s<r||a>=n)return null;for(var c=[],p=0;p<e.length;p++){var y=e[p],b=y.geometry,A=y.type,w=i===0?y.minX:y.minY,I=i===0?y.maxX:y.maxY;if(w>=r&&I<n){c.push(y);continue}else if(I<r||w>=n)continue;var P=[];if(A==="Point"||A==="MultiPoint")Fc(b,P,r,n,i);else if(A==="LineString")Ah(b,P,r,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")rs(b,P,r,n,i,!1);else if(A==="Polygon")rs(b,P,r,n,i,!0);else if(A==="MultiPolygon")for(var L=0;L<b.length;L++){var V=[];rs(b[L],V,r,n,i,!0),V.length&&P.push(V)}if(P.length){if(l.lineMetrics&&A==="LineString"){for(L=0;L<P.length;L++)c.push(Xf(y.id,A,P[L],y.tags));continue}(A==="LineString"||A==="MultiLineString")&&(P.length===1?(A="LineString",P=P[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=P.length===3?"Point":"MultiPoint"),c.push(Xf(y.id,A,P,y.tags))}}return c.length?c:null}function Fc(e,t,r,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=r&&s<=n&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function Ah(e,t,r,n,i,a,s){for(var l=Th(e),c=i===0?To:lu,p=e.start,y,b,A=0;A<e.length-3;A+=3){var w=e[A],I=e[A+1],P=e[A+2],L=e[A+3],V=e[A+4],K=i===0?w:I,le=i===0?L:V,xe=!1;s&&(y=Math.sqrt(Math.pow(w-L,2)+Math.pow(I-V,2))),K<r?le>r&&(b=c(l,w,I,L,V,r),s&&(l.start=p+y*b)):K>n?le<n&&(b=c(l,w,I,L,V,n),s&&(l.start=p+y*b)):qo(l,w,I,P),le<r&&K>=r&&(b=c(l,w,I,L,V,r),xe=!0),le>n&&K<=n&&(b=c(l,w,I,L,V,n),xe=!0),!a&&xe&&(s&&(l.end=p+y*b),t.push(l),l=Th(e)),s&&(p+=y)}var ke=e.length-3;w=e[ke],I=e[ke+1],P=e[ke+2],K=i===0?w:I,K>=r&&K<=n&&qo(l,w,I,P),ke=l.length-3,a&&ke>=3&&(l[ke]!==l[0]||l[ke+1]!==l[1])&&qo(l,l[0],l[1],l[2]),l.length&&t.push(l)}function Th(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function rs(e,t,r,n,i,a){for(var s=0;s<e.length;s++)Ah(e[s],t,r,n,i,a,!1)}function qo(e,t,r,n){e.push(t),e.push(r),e.push(n)}function To(e,t,r,n,i,a){var s=(a-t)/(n-t);return e.push(a),e.push(r+(i-r)*s),e.push(1),s}function lu(e,t,r,n,i,a){var s=(a-r)/(i-r);return e.push(t+(n-t)*s),e.push(a),e.push(1),s}function Bd(e,t){var r=t.buffer/t.extent,n=e,i=Bl(e,1,-1-r,r,0,-1,2,t),a=Bl(e,1,1-r,2+r,0,-1,2,t);return(i||a)&&(n=Bl(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=$f(i,1).concat(n)),a&&(n=n.concat($f(a,-1)))),n}function $f(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=lp(i.geometry,t);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(lp(i.geometry[l],t))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var c=[],p=0;p<i.geometry[l].length;p++)c.push(lp(i.geometry[l][p],t));s.push(c)}r.push(Xf(i.id,a,s,i.tags))}return r}function lp(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function Fd(e,t){if(e.transformed)return e;var r=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var c=e.features[a],p=c.geometry,y=c.type;if(c.geometry=[],y===1)for(s=0;s<p.length;s+=2)c.geometry.push(Nd(p[s],p[s+1],t,r,n,i));else for(s=0;s<p.length;s++){var b=[];for(l=0;l<p[s].length;l+=2)b.push(Nd(p[s][l],p[s][l+1],t,r,n,i));c.geometry.push(b)}}return e.transformed=!0,e}function Nd(e,t,r,n,i,a){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-a))]}function Ud(e,t,r,n,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,jv(s,e[l],a,i);var c=e[l].minX,p=e[l].minY,y=e[l].maxX,b=e[l].maxY;c<s.minX&&(s.minX=c),p<s.minY&&(s.minY=p),y>s.maxX&&(s.maxX=y),b>s.maxY&&(s.maxY=b)}return s}function jv(e,t,r,n){var i=t.geometry,a=t.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")cp(s,i,e,r,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)cp(s,i[l],e,r,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var c=0;c<i.length;c++){var p=i[c];for(l=0;l<p.length;l++)cp(s,p[l],e,r,!0,l===0)}if(s.length){var y=t.tags||null;if(a==="LineString"&&n.lineMetrics){y={};for(var b in t.tags)y[b]=t.tags[b];y.mapbox_clip_start=i.start/i.size,y.mapbox_clip_end=i.end/i.size}var A={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:y};t.id!==null&&(A.id=t.id),e.features.push(A)}}function cp(e,t,r,n,i,a){var s=n*n;if(n>0&&t.size<(i?s:n)){r.numPoints+=t.length/3;return}for(var l=[],c=0;c<t.length;c+=3)(n===0||t[c+2]>s)&&(r.numSimplified++,l.push(t[c]),l.push(t[c+1])),r.numPoints++;i&&Ts(l,a),e.push(l)}function Ts(e,t){for(var r=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)r+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Hv(e,t){return new wh(e,t)}function wh(e,t){t=this.options=zd(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Dd(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Bd(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}wh.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wh.prototype.splitTile=function(e,t,r,n,i,a,s){for(var l=[e,t,r,n],c=this.options,p=c.debug;l.length;){n=l.pop(),r=l.pop(),t=l.pop(),e=l.pop();var y=1<<t,b=Ch(t,r,n),A=this.tiles[b];if(!A&&(p>1&&console.time("creation"),A=this.tiles[b]=Ud(e,t,r,n,c),this.tileCoords.push({z:t,x:r,y:n}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var w="z"+t;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(A.source=e,i){if(t===c.maxZoom||t===i)continue;var I=1<<i-t;if(r!==Math.floor(a/I)||n!==Math.floor(s/I))continue}else if(t===c.indexMaxZoom||A.numPoints<=c.indexMaxPoints)continue;if(A.source=null,e.length!==0){p>1&&console.time("clipping");var P=.5*c.buffer/c.extent,L=.5-P,V=.5+P,K=1+P,le,xe,ke,je,it,vt;le=xe=ke=je=null,it=Bl(e,y,r-P,r+V,0,A.minX,A.maxX,c),vt=Bl(e,y,r+L,r+K,0,A.minX,A.maxX,c),e=null,it&&(le=Bl(it,y,n-P,n+V,1,A.minY,A.maxY,c),xe=Bl(it,y,n+L,n+K,1,A.minY,A.maxY,c),it=null),vt&&(ke=Bl(vt,y,n-P,n+V,1,A.minY,A.maxY,c),je=Bl(vt,y,n+L,n+K,1,A.minY,A.maxY,c),vt=null),p>1&&console.timeEnd("clipping"),l.push(le||[],t+1,r*2,n*2),l.push(xe||[],t+1,r*2,n*2+1),l.push(ke||[],t+1,r*2+1,n*2),l.push(je||[],t+1,r*2+1,n*2+1)}}},wh.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;t=(t%s+s)%s;var l=Ch(e,t,r);if(this.tiles[l])return Fd(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var c=e,p=t,y=r,b;!b&&c>0;)c--,p=Math.floor(p/2),y=Math.floor(y/2),b=this.tiles[Ch(c,p,y)];return!b||!b.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",c,p,y),a>1&&console.time("drilling down"),this.splitTile(b.source,c,p,y,e,t,r),a>1&&console.timeEnd("drilling down"),this.tiles[l]?Fd(this.tiles[l],i):null)};function Ch(e,t,r){return((1<<e)*r+t)*32+e}function zd(e,t){for(var r in t)e[r]=t[r];return e}var lf=function(){function e(t,r,n,i){(0,ye.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=t}return(0,Q.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Wv={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Gv(e){for(var t=0,r=0,n=e.length,i=n-1,a,s;r<n;i=r++)a=e[r],s=e[i],t+=(s.x-a.x)*(a.y+s.y);return t}function Zd(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,a=0;a<t;a++){var s=Gv(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}var Vd=["Unknown","Point","LineString","Polygon"];function W(e,t,r,n,i){var a=i.geometry,s=i.type,l=i.tags,c=i.id,p=e*Math.pow(2,n),y=e*t,b=e*r,A=Vd[s],w,I;function P(K){for(var le=0;le<K.length;le++){var xe=K[le];if(xe[3])break;var ke=180-(xe[1]+b)*360/p,je=(xe[0]+y)*360/p-180,it=360/Math.PI*Math.atan(Math.exp(ke*Math.PI/180))-90;K[le]=[je,it,0,1]}}switch(s){case 1:var L=[];for(w=0;w<a.length;w++)L[w]=a[w][0];a=L,P(a);break;case 2:for(w=0;w<a.length;w++)P(a[w]);break;case 3:for(a=Zd(a),w=0;w<a.length;w++)for(I=0;I<a[w].length;I++)P(a[w][I]);break}a.length===1?a=a[0]:A="Multi"+A;var V={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:c,tileOrigin:[0,0],coord:""};return V}var we=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c){var p=n.getTile(r.z,r.x,r.y),y=p?p.features.map(function(w){return W(a,i.x,i.y,i.z,w)}):[],b={layers:{defaultLayer:{features:y}}},A=new lf(b,r.x,r.y,r.z);c(A)}));case 1:case"end":return l.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}();function Qe(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?t:(0,O.Z)((0,O.Z)({},t),e.geojsonvtOptions)}function Qt(e,t){var r=Qe(t),n=r.extent||4096,i=Hv(e,r),a=function(c,p){return we(p,i,c,n)},s=(0,O.Z)((0,O.Z)((0,O.Z)({},Wv),t),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function mr(e,t){var r=t.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,i=t.requestParameters,a=i===void 0?{}:i,s=new Promise(function(c){e instanceof HTMLImageElement||nl(e)?c([e]):er(e,a,function(p){c(p)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function er(e,t,r){var n=[];if(typeof e=="string")Vs((0,O.Z)((0,O.Z)({},t),{},{url:e}),function(s,l){l&&(n.push(l),r(n))});else{var i=e.length,a=0;e.forEach(function(s){Vs((0,O.Z)((0,O.Z)({},t),{},{url:s}),function(l,c){a++,c&&n.push(c),a===i&&r(n)})})}return mr}var Zt=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a){var s,l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=d(r,s),p.abrupt("return",new Promise(function(y){a?a(s,function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new lf(w,n.x,n.y,n.z);y(I)}else{var P={layers:{defaultLayer:{features:A.features}}},L=new lf(P,n.x,n.y,n.z);y(L)}}):xa((0,O.Z)((0,O.Z)({},i),{},{url:l}),function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new lf(w,n.x,n.y,n.z);y(I)}else{var P=JSON.parse(A),L={layers:{defaultLayer:{features:P}}},V=new lf(L,n.x,n.y,n.z);y(V)}})}));case 3:case"end":return p.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}();function Ur(e,t){var r=function(a,s){return Zt(e,s,t==null?void 0:t.requestParameters,t.getCustomData)},n=(0,O.Z)((0,O.Z)({},t),{},{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Or=Z(38929),Qr=Z(3614),jr=Z.n(Qr),$r=function(){function e(t,r,n,i){(0,ye.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=new Or.VectorTile(new(jr())(t))}return(0,Q.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,O.Z)((0,O.Z)({},l),{},{properties:(0,O.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),en={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},kr=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a,s){var l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=d(r,n),p.abrupt("return",new Promise(function(y){if(s)s({x:i.x,y:i.y,z:i.z},function(A,w){if(A||!w)y(void 0);else{var I=new $r(w,i.x,i.y,i.z);y(I)}});else{var b=xo((0,O.Z)((0,O.Z)({},a),{},{url:l}),function(A,w){if(A||!w)y(void 0);else{var I=new $r(w,i.x,i.y,i.z);y(I)}});i.xhrCancel=function(){return b.cancel()}}}));case 2:case"end":return p.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}();function qr(e,t){var r=Array.isArray(e)?e[0]:e,n=function(s,l){return kr(r,s,l,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData)},i=(0,O.Z)((0,O.Z)((0,O.Z)({},en),t),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}function Bt(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function or(e,t){for(var r=t[0],n=r.width,i=r.height,a=t.map(function(w){return w.rasterData}),s=n*i,l=[],c=JSON.stringify(e),p=0;p<s;p++){var y=JSON.parse(c),b=zr(y,a,p);if(typeof b=="number")l.push(b);else{var A=Tr(y);l.push(A)}}return l}function zr(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=t[n[1]][r]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:zr(n,t,r)}})}function pn(e){var t=(0,re.Z)(e,3),r=t[0],n=t[1],i=n===void 0?-1:n,a=t[2],s=a===void 0?-1:a;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,i,s]}function Tr(e){var t=pn(e),r=t[0],n=t[1],i=t[2];return Array.isArray(n)&&(n=Tr(e[1])),Array.isArray(i)&&(i=Tr(e[2])),Bt(r,n,i)}var gn={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Br}};function Br(e,t){for(var r=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(t==null?void 0:t.countCut)||[2,98],l=(0,re.Z)(s,2),c=l[0],p=l[1],y=(t==null?void 0:t.RMinMax)||cn(r,c,p),b=(t==null?void 0:t.GMinMax)||cn(n,c,p),A=(t==null?void 0:t.BMinMax)||cn(i,c,p),w=0;w<r.length;w++)a.push(Math.max(0,r[w]-y[0])),a.push(Math.max(0,n[w]-b[0])),a.push(Math.max(0,i[w]-A[0]));return{rasterData:a,rMinMax:y,gMinMax:b,bMinMax:A}}function cn(e,t,r){var n=e.slice().sort(function(l,c){return l-c}),i=n.length,a=n[Math.ceil(i*t/100)],s=n[Math.ceil(i*r/100)];return[a,s]}function Cr(e,t,r){return nn.apply(this,arguments)}function nn(){return nn=(0,St.Z)(Ae().mark(function e(t,r,n){var i,a,s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t.length!==0){b.next=2;break}return b.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return b.next=4,Promise.all(t.map(function(A){var w=A.data,I=A.bands,P=I===void 0?[0]:I;return r(w,P)}));case 4:i=b.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,(0,Yt.Z)(A)):a.push(A)}),s=a[0],l=s.width,c=s.height,b.t0=(0,Au.Z)(n),b.next=b.t0==="function"?11:b.t0==="object"?13:15;break;case 11:return p=n(a),b.abrupt("break",16);case 13:return Array.isArray(n)?p={rasterData:or(n,a)}:p=Wn(n,a),b.abrupt("break",16);case 15:p={rasterData:a[0].rasterData};case 16:return b.abrupt("return",(0,O.Z)((0,O.Z)({},p),{},{width:l,height:c}));case 17:case"end":return b.stop()}},e)})),nn.apply(this,arguments)}function Wn(e,t){var r=gn[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?hi(r.expression,t):{rasterData:or(r.expression,t)}}function hi(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=or(e.r||["band",0],t),n=or(e.g||["band",0],t),i=or(e.b||["band",0],t);return[r,n,i]}function an(e,t,r,n){return Lr.apply(this,arguments)}function Lr(){return Lr=(0,St.Z)(Ae().mark(function e(t,r,n,i){var a;return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Cr(t,r,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),Lr.apply(this,arguments)}function _r(e,t){var r=t.extent,n=t.width,i=t.height,a=t.min,s=t.max,l=t.format,c=t.operation,p,y,b;if(l===void 0||Dc(e))p=Array.from(e),y=n,b=i;else{var A=Array.isArray(e)?e:[e];p=Cr(A,l,c)}var w={_id:1,dataArray:[{_id:1,data:p,width:y,height:b,min:a,max:s,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return w}var Xn=Z(28660),pr=Z(86700),yn=Z(84879),xt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},ci=Z(49296),ri=Z.n(ci);function Gi(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=co(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function co(e,t){if(!!e){if(typeof e=="string")return Bo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bo(e,t)}}function Bo(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ai=30;function fo(e){var t=e.characterSet,r=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,c=e.xOffset,p=c===void 0?0:c,y=e.yOffset,b=y===void 0?0:y,A=0,w=p;Array.from(t).forEach(function(P,L){if(!l[P]){var V=r(P,L);w+Ai>a&&(w=0,A++),l[P]={x:w,y:b+A*Ai,width:Ai,height:Ai,advance:V},w+=Ai}});var I=n+i*2;return{mapping:l,xOffset:w,yOffset:b+A*I,canvasHeight:po(b+(A+1)*I)}}function Ea(e,t,r){var n=0,i=0,a=0,s=[],l={},c=Gi(e),p;try{for(c.s();!(p=c.n()).done;){var y=p.value;if(!l[y.id]){var b=y.size;n+b+t>r&&(ho(l,s,i),n=0,i=a+i+t,a=0,s=[]),s.push({icon:y,xOffset:n}),n=n+b+t,a=Math.max(a,b)}}}catch(w){c.e(w)}finally{c.f()}s.length>0&&ho(l,s,i);var A=po(a+i+t);return{mapping:l,canvasHeight:A}}function ho(e,t,r){var n=Gi(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,O.Z)((0,O.Z)({},s),{},{x:l,y:r,image:s.image,width:s.width,height:s.height})}}catch(c){n.e(c)}finally{n.f()}}function po(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var za,wo;function ns(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Co(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Co(e,t){if(!!e){if(typeof e=="string")return Ei(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ei(e,t)}}function Ei(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function is(e){var t=Ji();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function Ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kn=Ie(),Oi="sans-serif",Xi="normal",vo=24,vl=3,Ge=.25,tr=8,Gt=1024,xn=1,Si=1,la=3,ve=null;function Ie(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function Ke(e,t,r,n){e.font="".concat(n," ").concat(r,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function Xt(e,t){for(var r=0;r<e.length;r++)t.data[4*r+3]=e[r]}var Vt=(za=(0,pr.b2)(),za(wo=function(e){(0,Je.Z)(r,e);var t=is(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"fontAtlas",void 0),(0,F.Z)((0,Be.Z)(n),"iconFontMap",void 0),(0,F.Z)((0,Be.Z)(n),"iconFontGlyphs",{}),(0,F.Z)((0,Be.Z)(n),"fontOptions",void 0),(0,F.Z)((0,Be.Z)(n),"key",void 0),(0,F.Z)((0,Be.Z)(n),"cache",new Bf(la)),n}return(0,Q.Z)(r,[{key:"scale",get:function(){return Si}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Oi,fontWeight:Xi,characterSet:Kn,fontSize:vo,buffer:vl,sdf:!0,cutoff:Ge,radius:tr,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,O.Z)((0,O.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(c){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(c)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,c=l.fontFamily,p=l.fontWeight,y=l.fontSize,b=l.buffer,A=l.sdf,w=l.radius,I=l.cutoff,P=l.iconfont,L=s&&s.data;L||(L=window.document.createElement("canvas"),L.width=Gt);var V=L.getContext("2d",{willReadFrequently:!0});Ke(V,c,y,p);var K=fo((0,O.Z)({getFontWidth:function(us){return V.measureText(us).width},fontHeight:y*Si,buffer:b,characterSet:a,maxCanvasWidth:Gt},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),le=K.mapping,xe=K.canvasHeight,ke=K.xOffset,je=K.yOffset,it=V.getImageData(0,0,L.width,L.height);if(L.height=xe,V.putImageData(it,0,0),Ke(V,c,y,p),A){var vt=new(ri())(y,b,w,I,c,p),Lt=V.getImageData(0,0,vt.size,vt.size),lr=ns(a),cr;try{for(lr.s();!(cr=lr.n()).done;){var Rr=cr.value;if(P){var fn=String.fromCharCode(parseInt(Rr.replace("&#x","").replace(";",""),16)),Pn=vt.draw(fn);Xt(Pn,Lt)}else Xt(vt.draw(Rr),Lt);V.putImageData(Lt,le[Rr].x,le[Rr].y)}}catch(no){lr.e(no)}finally{lr.f()}}else{var Ri=ns(a),ya;try{for(Ri.s();!(ya=Ri.n()).done;){var Ha=ya.value;V.fillText(Ha,le[Ha].x,le[Ha].y+y*xn)}}catch(no){Ri.e(no)}finally{Ri.f()}}return{xOffset:ke,yOffset:je,mapping:le,data:L,width:L.width,height:L.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],c=s.mapping,p=new Set(Object.keys(c)),y=new Set(a);return y.forEach(function(b){p.has(b)||l.push(b)}),l}}]),r}(ba.EventEmitter))||wo),ut,mt;function At(e){var t=Xe();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function Xe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ft=3,Me=1024,dt=64,ir=(ut=(0,pr.b2)(),ut(mt=function(e){(0,Je.Z)(r,e);var t=At(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"canvasHeight",128),(0,F.Z)((0,Be.Z)(n),"texture",void 0),(0,F.Z)((0,Be.Z)(n),"canvas",void 0),(0,F.Z)((0,Be.Z)(n),"iconData",void 0),(0,F.Z)((0,Be.Z)(n),"iconMap",void 0),(0,F.Z)((0,Be.Z)(n),"ctx",void 0),(0,F.Z)((0,Be.Z)(n),"loadingImageCount",0),n}return(0,Q.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,St.Z)(Ae().mark(function a(s,l){var c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:dt}),this.updateIconMap(),b.next=6,this.loadImage(l);case 6:c=b.sent,p=this.iconData.find(function(A){return A.id===s}),p&&(p.image=c,p.width=c.width,p.height=c.height),this.update();case 10:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,c=s.getSceneConfig().canvas,p=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:dt}),this.updateIconMap(),this.loadImageMini(a,c).then(function(y){p=y;var b=l.iconData.find(function(A){return A.id===i});b&&(b.image=p,b.width=p.width,b.height=p.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=Me,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,c=s.y,p=s.image,y=s.width,b=y===void 0?64:y,A=s.height,w=A===void 0?64:A,I=Math.max(b,w),P=I/dt,L=w/P,V=b/P;p&&i.ctx.drawImage(p,l+(dt-V)/2,c+(dt-L)/2,V,L)})}},{key:"updateIconMap",value:function(){var i=Ea(this.iconData,ft,Me),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var c=a.createImage();c.crossOrigin="anonymous",c.onload=function(){s(c)},c.onerror=function(){l(new Error("Could not load image at "+i))},c.src=i})}}]),r}(ba.EventEmitter))||mt),jt=Z(49685);function wr(){var e=new jt.WT(16);return jt.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Sr(e){var t=new jt.WT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Dr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Dn(e,t,r,n,i,a,s,l,c,p,y,b,A,w,I,P){var L=new jt.WT(16);return L[0]=e,L[1]=t,L[2]=r,L[3]=n,L[4]=i,L[5]=a,L[6]=s,L[7]=l,L[8]=c,L[9]=p,L[10]=y,L[11]=b,L[12]=A,L[13]=w,L[14]=I,L[15]=P,L}function Tn(e,t,r,n,i,a,s,l,c,p,y,b,A,w,I,P,L){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=l,e[7]=c,e[8]=p,e[9]=y,e[10]=b,e[11]=A,e[12]=w,e[13]=I,e[14]=P,e[15]=L,e}function Mn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qn(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],s=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=s,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ai(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],p=t[7],y=t[8],b=t[9],A=t[10],w=t[11],I=t[12],P=t[13],L=t[14],V=t[15],K=r*l-n*s,le=r*c-i*s,xe=r*p-a*s,ke=n*c-i*l,je=n*p-a*l,it=i*p-a*c,vt=y*P-b*I,Lt=y*L-A*I,lr=y*V-w*I,cr=b*L-A*P,Rr=b*V-w*P,fn=A*V-w*L,Pn=K*fn-le*Rr+xe*cr+ke*lr-je*Lt+it*vt;return Pn?(Pn=1/Pn,e[0]=(l*fn-c*Rr+p*cr)*Pn,e[1]=(i*Rr-n*fn-a*cr)*Pn,e[2]=(P*it-L*je+V*ke)*Pn,e[3]=(A*je-b*it-w*ke)*Pn,e[4]=(c*lr-s*fn-p*Lt)*Pn,e[5]=(r*fn-i*lr+a*Lt)*Pn,e[6]=(L*xe-I*it-V*le)*Pn,e[7]=(y*it-A*xe+w*le)*Pn,e[8]=(s*Rr-l*lr+p*vt)*Pn,e[9]=(n*lr-r*Rr-a*vt)*Pn,e[10]=(I*je-P*xe+V*K)*Pn,e[11]=(b*xe-y*je-w*K)*Pn,e[12]=(l*Lt-s*cr-c*vt)*Pn,e[13]=(r*cr-n*Lt+i*vt)*Pn,e[14]=(P*le-I*ke-L*K)*Pn,e[15]=(y*ke-b*le+A*K)*Pn,e):null}function ea(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],p=t[7],y=t[8],b=t[9],A=t[10],w=t[11],I=t[12],P=t[13],L=t[14],V=t[15];return e[0]=l*(A*V-w*L)-b*(c*V-p*L)+P*(c*w-p*A),e[1]=-(n*(A*V-w*L)-b*(i*V-a*L)+P*(i*w-a*A)),e[2]=n*(c*V-p*L)-l*(i*V-a*L)+P*(i*p-a*c),e[3]=-(n*(c*w-p*A)-l*(i*w-a*A)+b*(i*p-a*c)),e[4]=-(s*(A*V-w*L)-y*(c*V-p*L)+I*(c*w-p*A)),e[5]=r*(A*V-w*L)-y*(i*V-a*L)+I*(i*w-a*A),e[6]=-(r*(c*V-p*L)-s*(i*V-a*L)+I*(i*p-a*c)),e[7]=r*(c*w-p*A)-s*(i*w-a*A)+y*(i*p-a*c),e[8]=s*(b*V-w*P)-y*(l*V-p*P)+I*(l*w-p*b),e[9]=-(r*(b*V-w*P)-y*(n*V-a*P)+I*(n*w-a*b)),e[10]=r*(l*V-p*P)-s*(n*V-a*P)+I*(n*p-a*l),e[11]=-(r*(l*w-p*b)-s*(n*w-a*b)+y*(n*p-a*l)),e[12]=-(s*(b*L-A*P)-y*(l*L-c*P)+I*(l*A-c*b)),e[13]=r*(b*L-A*P)-y*(n*L-i*P)+I*(n*A-i*b),e[14]=-(r*(l*L-c*P)-s*(n*L-i*P)+I*(n*c-i*l)),e[15]=r*(l*A-c*b)-s*(n*A-i*b)+y*(n*c-i*l),e}function Ro(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],p=e[8],y=e[9],b=e[10],A=e[11],w=e[12],I=e[13],P=e[14],L=e[15],V=t*s-r*a,K=t*l-n*a,le=t*c-i*a,xe=r*l-n*s,ke=r*c-i*s,je=n*c-i*l,it=p*I-y*w,vt=p*P-b*w,Lt=p*L-A*w,lr=y*P-b*I,cr=y*L-A*I,Rr=b*L-A*P;return V*Rr-K*cr+le*lr+xe*Lt-ke*vt+je*it}function Ko(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],l=t[4],c=t[5],p=t[6],y=t[7],b=t[8],A=t[9],w=t[10],I=t[11],P=t[12],L=t[13],V=t[14],K=t[15],le=r[0],xe=r[1],ke=r[2],je=r[3];return e[0]=le*n+xe*l+ke*b+je*P,e[1]=le*i+xe*c+ke*A+je*L,e[2]=le*a+xe*p+ke*w+je*V,e[3]=le*s+xe*y+ke*I+je*K,le=r[4],xe=r[5],ke=r[6],je=r[7],e[4]=le*n+xe*l+ke*b+je*P,e[5]=le*i+xe*c+ke*A+je*L,e[6]=le*a+xe*p+ke*w+je*V,e[7]=le*s+xe*y+ke*I+je*K,le=r[8],xe=r[9],ke=r[10],je=r[11],e[8]=le*n+xe*l+ke*b+je*P,e[9]=le*i+xe*c+ke*A+je*L,e[10]=le*a+xe*p+ke*w+je*V,e[11]=le*s+xe*y+ke*I+je*K,le=r[12],xe=r[13],ke=r[14],je=r[15],e[12]=le*n+xe*l+ke*b+je*P,e[13]=le*i+xe*c+ke*A+je*L,e[14]=le*a+xe*p+ke*w+je*V,e[15]=le*s+xe*y+ke*I+je*K,e}function cf(e,t,r){var n=r[0],i=r[1],a=r[2],s,l,c,p,y,b,A,w,I,P,L,V;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(s=t[0],l=t[1],c=t[2],p=t[3],y=t[4],b=t[5],A=t[6],w=t[7],I=t[8],P=t[9],L=t[10],V=t[11],e[0]=s,e[1]=l,e[2]=c,e[3]=p,e[4]=y,e[5]=b,e[6]=A,e[7]=w,e[8]=I,e[9]=P,e[10]=L,e[11]=V,e[12]=s*n+y*i+I*a+t[12],e[13]=l*n+b*i+P*a+t[13],e[14]=c*n+A*i+L*a+t[14],e[15]=p*n+w*i+V*a+t[15]),e}function Ls(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function jd(e,t,r,n){var i=n[0],a=n[1],s=n[2],l=Math.hypot(i,a,s),c,p,y,b,A,w,I,P,L,V,K,le,xe,ke,je,it,vt,Lt,lr,cr,Rr,fn,Pn,Ri;return l<jt.Ib?null:(l=1/l,i*=l,a*=l,s*=l,c=Math.sin(r),p=Math.cos(r),y=1-p,b=t[0],A=t[1],w=t[2],I=t[3],P=t[4],L=t[5],V=t[6],K=t[7],le=t[8],xe=t[9],ke=t[10],je=t[11],it=i*i*y+p,vt=a*i*y+s*c,Lt=s*i*y-a*c,lr=i*a*y-s*c,cr=a*a*y+p,Rr=s*a*y+i*c,fn=i*s*y+a*c,Pn=a*s*y-i*c,Ri=s*s*y+p,e[0]=b*it+P*vt+le*Lt,e[1]=A*it+L*vt+xe*Lt,e[2]=w*it+V*vt+ke*Lt,e[3]=I*it+K*vt+je*Lt,e[4]=b*lr+P*cr+le*Rr,e[5]=A*lr+L*cr+xe*Rr,e[6]=w*lr+V*cr+ke*Rr,e[7]=I*lr+K*cr+je*Rr,e[8]=b*fn+P*Pn+le*Ri,e[9]=A*fn+L*Pn+xe*Ri,e[10]=w*fn+V*Pn+ke*Ri,e[11]=I*fn+K*Pn+je*Ri,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Wu(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],s=t[5],l=t[6],c=t[7],p=t[8],y=t[9],b=t[10],A=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+p*n,e[5]=s*i+y*n,e[6]=l*i+b*n,e[7]=c*i+A*n,e[8]=p*i-a*n,e[9]=y*i-s*n,e[10]=b*i-l*n,e[11]=A*i-c*n,e}function Rh(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],l=t[2],c=t[3],p=t[8],y=t[9],b=t[10],A=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-p*n,e[1]=s*i-y*n,e[2]=l*i-b*n,e[3]=c*i-A*n,e[8]=a*n+p*i,e[9]=s*n+y*i,e[10]=l*n+b*i,e[11]=c*n+A*i,e}function Hd(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],l=t[2],c=t[3],p=t[4],y=t[5],b=t[6],A=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+p*n,e[1]=s*i+y*n,e[2]=l*i+b*n,e[3]=c*i+A*n,e[4]=p*i-a*n,e[5]=y*i-s*n,e[6]=b*i-l*n,e[7]=A*i-c*n,e}function Xv(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function m0(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wd(e,t,r){var n=r[0],i=r[1],a=r[2],s=Math.hypot(n,i,a),l,c,p;return s<jt.Ib?null:(s=1/s,n*=s,i*=s,a*=s,l=Math.sin(t),c=Math.cos(t),p=1-c,e[0]=n*n*p+c,e[1]=i*n*p+a*l,e[2]=a*n*p-i*l,e[3]=0,e[4]=n*i*p-a*l,e[5]=i*i*p+c,e[6]=a*i*p+n*l,e[7]=0,e[8]=n*a*p+i*l,e[9]=i*a*p-n*l,e[10]=a*a*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Mh(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $v(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fp(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yv(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],l=n+n,c=i+i,p=a+a,y=n*l,b=n*c,A=n*p,w=i*c,I=i*p,P=a*p,L=s*l,V=s*c,K=s*p;return e[0]=1-(w+P),e[1]=b+K,e[2]=A-V,e[3]=0,e[4]=b-K,e[5]=1-(y+P),e[6]=I+L,e[7]=0,e[8]=A+V,e[9]=I-L,e[10]=1-(y+w),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Fo(e,t){var r=new jt.WT(3),n=-t[0],i=-t[1],a=-t[2],s=t[3],l=t[4],c=t[5],p=t[6],y=t[7],b=n*n+i*i+a*a+s*s;return b>0?(r[0]=(l*s+y*n+c*a-p*i)*2/b,r[1]=(c*s+y*i+p*n-l*a)*2/b,r[2]=(p*s+y*a+l*i-c*n)*2/b):(r[0]=(l*s+y*n+c*a-p*i)*2,r[1]=(c*s+y*i+p*n-l*a)*2,r[2]=(p*s+y*a+l*i-c*n)*2),Yv(e,t,r),e}function Za(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function qv(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],s=t[5],l=t[6],c=t[8],p=t[9],y=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(a,s,l),e[2]=Math.hypot(c,p,y),e}function g0(e,t){var r=new jt.WT(3);qv(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],s=t[0]*n,l=t[1]*i,c=t[2]*a,p=t[4]*n,y=t[5]*i,b=t[6]*a,A=t[8]*n,w=t[9]*i,I=t[10]*a,P=s+y+I,L=0;return P>0?(L=Math.sqrt(P+1)*2,e[3]=.25*L,e[0]=(b-w)/L,e[1]=(A-c)/L,e[2]=(l-p)/L):s>y&&s>I?(L=Math.sqrt(1+s-y-I)*2,e[3]=(b-w)/L,e[0]=.25*L,e[1]=(l+p)/L,e[2]=(A+c)/L):y>I?(L=Math.sqrt(1+y-s-I)*2,e[3]=(A-c)/L,e[0]=(l+p)/L,e[1]=.25*L,e[2]=(b+w)/L):(L=Math.sqrt(1+I-s-y)*2,e[3]=(l-p)/L,e[0]=(A+c)/L,e[1]=(b+w)/L,e[2]=.25*L),e}function y0(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=t[3],c=i+i,p=a+a,y=s+s,b=i*c,A=i*p,w=i*y,I=a*p,P=a*y,L=s*y,V=l*c,K=l*p,le=l*y,xe=n[0],ke=n[1],je=n[2];return e[0]=(1-(I+L))*xe,e[1]=(A+le)*xe,e[2]=(w-K)*xe,e[3]=0,e[4]=(A-le)*ke,e[5]=(1-(b+L))*ke,e[6]=(P+V)*ke,e[7]=0,e[8]=(w+K)*je,e[9]=(P-V)*je,e[10]=(1-(b+I))*je,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function _0(e,t,r,n,i){var a=t[0],s=t[1],l=t[2],c=t[3],p=a+a,y=s+s,b=l+l,A=a*p,w=a*y,I=a*b,P=s*y,L=s*b,V=l*b,K=c*p,le=c*y,xe=c*b,ke=n[0],je=n[1],it=n[2],vt=i[0],Lt=i[1],lr=i[2],cr=(1-(P+V))*ke,Rr=(w+xe)*ke,fn=(I-le)*ke,Pn=(w-xe)*je,Ri=(1-(A+V))*je,ya=(L+K)*je,Ha=(I+le)*it,no=(L-K)*it,us=(1-(A+P))*it;return e[0]=cr,e[1]=Rr,e[2]=fn,e[3]=0,e[4]=Pn,e[5]=Ri,e[6]=ya,e[7]=0,e[8]=Ha,e[9]=no,e[10]=us,e[11]=0,e[12]=r[0]+vt-(cr*vt+Pn*Lt+Ha*lr),e[13]=r[1]+Lt-(Rr*vt+Ri*Lt+no*lr),e[14]=r[2]+lr-(fn*vt+ya*Lt+us*lr),e[15]=1,e}function x0(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,l=n+n,c=i+i,p=r*s,y=n*s,b=n*l,A=i*s,w=i*l,I=i*c,P=a*s,L=a*l,V=a*c;return e[0]=1-b-I,e[1]=y+V,e[2]=A-L,e[3]=0,e[4]=y-V,e[5]=1-p-I,e[6]=w+P,e[7]=0,e[8]=A+L,e[9]=w-P,e[10]=1-p-b,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kv(e,t,r,n,i,a,s){var l=1/(r-t),c=1/(i-n),p=1/(a-s);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*l,e[9]=(i+n)*c,e[10]=(s+a)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*p,e[15]=0,e}function Yf(e,t,r,n,i){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var qf=Yf;function b0(e,t,r,n,i){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=i*s,e[14]=i*n*s):(e[10]=-1,e[14]=-n),e}function No(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+l),p=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-((s-l)*c*.5),e[9]=(i-a)*p*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function hp(e,t,r,n,i,a,s){var l=1/(t-r),c=1/(n-i),p=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(t+r)*l,e[13]=(i+n)*c,e[14]=(s+a)*p,e[15]=1,e}var ff=hp;function Gd(e,t,r,n,i,a,s){var l=1/(t-r),c=1/(n-i),p=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(t+r)*l,e[13]=(i+n)*c,e[14]=a*p,e[15]=1,e}function Xd(e,t,r,n){var i,a,s,l,c,p,y,b,A,w,I=t[0],P=t[1],L=t[2],V=n[0],K=n[1],le=n[2],xe=r[0],ke=r[1],je=r[2];return Math.abs(I-xe)<jt.Ib&&Math.abs(P-ke)<jt.Ib&&Math.abs(L-je)<jt.Ib?Mn(e):(y=I-xe,b=P-ke,A=L-je,w=1/Math.hypot(y,b,A),y*=w,b*=w,A*=w,i=K*A-le*b,a=le*y-V*A,s=V*b-K*y,w=Math.hypot(i,a,s),w?(w=1/w,i*=w,a*=w,s*=w):(i=0,a=0,s=0),l=b*s-A*a,c=A*i-y*s,p=y*a-b*i,w=Math.hypot(l,c,p),w?(w=1/w,l*=w,c*=w,p*=w):(l=0,c=0,p=0),e[0]=i,e[1]=l,e[2]=y,e[3]=0,e[4]=a,e[5]=c,e[6]=b,e[7]=0,e[8]=s,e[9]=p,e[10]=A,e[11]=0,e[12]=-(i*I+a*P+s*L),e[13]=-(l*I+c*P+p*L),e[14]=-(y*I+b*P+A*L),e[15]=1,e)}function Qv(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=n[0],c=n[1],p=n[2],y=i-r[0],b=a-r[1],A=s-r[2],w=y*y+b*b+A*A;w>0&&(w=1/Math.sqrt(w),y*=w,b*=w,A*=w);var I=c*A-p*b,P=p*y-l*A,L=l*b-c*y;return w=I*I+P*P+L*L,w>0&&(w=1/Math.sqrt(w),I*=w,P*=w,L*=w),e[0]=I,e[1]=P,e[2]=L,e[3]=0,e[4]=b*L-A*P,e[5]=A*I-y*L,e[6]=y*P-b*I,e[7]=0,e[8]=y,e[9]=b,e[10]=A,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e}function pp(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hf(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function E0(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Jv(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Bg(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function as(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Kf(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function $d(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=e[6],p=e[7],y=e[8],b=e[9],A=e[10],w=e[11],I=e[12],P=e[13],L=e[14],V=e[15],K=t[0],le=t[1],xe=t[2],ke=t[3],je=t[4],it=t[5],vt=t[6],Lt=t[7],lr=t[8],cr=t[9],Rr=t[10],fn=t[11],Pn=t[12],Ri=t[13],ya=t[14],Ha=t[15];return Math.abs(r-K)<=jt.Ib*Math.max(1,Math.abs(r),Math.abs(K))&&Math.abs(n-le)<=jt.Ib*Math.max(1,Math.abs(n),Math.abs(le))&&Math.abs(i-xe)<=jt.Ib*Math.max(1,Math.abs(i),Math.abs(xe))&&Math.abs(a-ke)<=jt.Ib*Math.max(1,Math.abs(a),Math.abs(ke))&&Math.abs(s-je)<=jt.Ib*Math.max(1,Math.abs(s),Math.abs(je))&&Math.abs(l-it)<=jt.Ib*Math.max(1,Math.abs(l),Math.abs(it))&&Math.abs(c-vt)<=jt.Ib*Math.max(1,Math.abs(c),Math.abs(vt))&&Math.abs(p-Lt)<=jt.Ib*Math.max(1,Math.abs(p),Math.abs(Lt))&&Math.abs(y-lr)<=jt.Ib*Math.max(1,Math.abs(y),Math.abs(lr))&&Math.abs(b-cr)<=jt.Ib*Math.max(1,Math.abs(b),Math.abs(cr))&&Math.abs(A-Rr)<=jt.Ib*Math.max(1,Math.abs(A),Math.abs(Rr))&&Math.abs(w-fn)<=jt.Ib*Math.max(1,Math.abs(w),Math.abs(fn))&&Math.abs(I-Pn)<=jt.Ib*Math.max(1,Math.abs(I),Math.abs(Pn))&&Math.abs(P-Ri)<=jt.Ib*Math.max(1,Math.abs(P),Math.abs(Ri))&&Math.abs(L-ya)<=jt.Ib*Math.max(1,Math.abs(L),Math.abs(ya))&&Math.abs(V-Ha)<=jt.Ib*Math.max(1,Math.abs(V),Math.abs(Ha))}var o=Ko,u=Jv,f,m,x=(f=(0,pr.b2)(),f(m=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"viewport",void 0),(0,F.Z)(this,"overridedViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredProjectionMatrix",void 0),(0,F.Z)(this,"viewMatrixInverse",void 0),(0,F.Z)(this,"cameraPosition",void 0)}return(0,Q.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=wr(),ai(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,re.Z)(r,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var i=Xv(wr(),[r,n,0]);this.jitteredProjectionMatrix=Ko(wr(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ko(wr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||m),E=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),T,M;function B(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=H(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function H(e,t){if(!!e){if(typeof e=="string")return $(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $(e,t)}}function $(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var q={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},ce=(T=(0,pr.b2)(),T(M=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"controlCorners",void 0),(0,F.Z)(this,"controlContainer",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"controls",[]),(0,F.Z)(this,"unAddControls",[])}return(0,Q.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(xt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var i=n.get(xt.IMapService);i.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=B(this.controls),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.remove()}}catch(a){r.e(a)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",i=this.controlContainer=On("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=l.map(function(p){return n+p}).join(" ");r[l.filter(function(p){return!["row","column"].includes(p)}).join("")]=On("div",c,i)}function s(l){var c=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Yt.Z)(c),[q[l]])}Object.values(E).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Ws(this.controlCorners[r]);this.controlContainer&&Ws(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(!!n)for(var i=function(){var c=s[a],p=c.match(/^(top|bottom)(left|right)$/);if(p){var y=(0,re.Z)(p,3),b=y[1],A=y[2],w=r.controlCorners["".concat(b).concat(A)],I=new n(function(P){var L=(0,re.Z)(P,1),V=L[0].target;w&&(w.style[b]=V.clientHeight+"px")});I.observe(r.controlCorners["".concat(A).concat(b)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||M),me,ze,He=(me=(0,pr.b2)(),me(ze=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"markers",[]),(0,F.Z)(this,"markerLayers",[]),(0,F.Z)(this,"unAddMarkers",[]),(0,F.Z)(this,"unAddMarkerLayers",[])}return(0,Q.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(xt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ze),lt,tt,Rt=(lt=(0,pr.b2)(),lt(tt=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"popups",[]),(0,F.Z)(this,"unAddPopups",[])}return(0,Q.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(r);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,Yt.Z)(this.popups),(0,Yt.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(xt.IMapService)}}]),e}())||tt),Ut=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Kt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),ar=function(e){return e.AND="and",e.OR="or",e}({}),hr=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Wr={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},on=Wr,Un,_n,Gn=mi.merge,En={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},wi={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:ar.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},oi=(Un=(0,pr.b2)(),Un(_n=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"sceneConfigCache",{}),(0,F.Z)(this,"layerConfigCache",{}),(0,F.Z)(this,"layerAttributeConfigCache",{})}return(0,Q.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return on[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,O.Z)((0,O.Z)({},En),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,i){this.layerConfigCache[n]=(0,O.Z)({},Gn({},this.sceneConfigCache[r],wi,i))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,O.Z)((0,O.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||_n);function Ir(e,t,r,n){!r||Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function mn(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(s,l){return l(e,t,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,t,a),a=null),a}function xi(){var e=new jt.WT(4);return jt.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yi(e){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function $n(e,t,r,n){var i=new jt.WT(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function ra(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Qa(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function mo(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function oo(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Ja(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function go(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function os(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function ss(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Ks(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function vs(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Qs(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function yo(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ms(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Ui(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,n,i,a)}function Sa(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function fa(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function qi(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function cu(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Bs(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Va(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e}function Uo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Fs(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],p=r[2]*n[3]-r[3]*n[2],y=t[0],b=t[1],A=t[2],w=t[3];return e[0]=b*p-A*c+w*l,e[1]=-(y*p)+A*s-w*a,e[2]=y*c-b*s+w*i,e[3]=-(y*l)+b*a-A*i,e}function na(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=l+n*(r[3]-l),e}function pf(e,t){t=t||1;var r,n,i,a,s,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,s=r*r+n*n;while(s>=1);do i=glMatrix.RANDOM()*2-1,a=glMatrix.RANDOM()*2-1,l=i*i+a*a;while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=t*r,e[1]=t*n,e[2]=t*i*c,e[3]=t*a*c,e}function fu(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*s,e}function df(e,t,r){var n=t[0],i=t[1],a=t[2],s=r[0],l=r[1],c=r[2],p=r[3],y=p*n+l*a-c*i,b=p*i+c*n-s*a,A=p*a+s*i-l*n,w=-s*n-l*i-c*a;return e[0]=y*p+w*-s+b*-c-A*-l,e[1]=b*p+w*-l+A*-s-y*-c,e[2]=A*p+w*-c+y*-l-b*-s,e[3]=t[3],e}function Mo(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function vf(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function rc(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function $p(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=t[0],l=t[1],c=t[2],p=t[3];return Math.abs(r-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))}var dp=null,Yp=null,Qf=null,qp=null,em=null,Kp=null,Yd=null,tm=function(){var e=xi();return function(t,r,n,i,a,s){var l,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,l=n;l<c;l+=r)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],a(e,e,s),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}}(),vp=Math.PI/180,mf=512,mp=4003e4;function Ih(e){var t=e.latitude,r=t===void 0?0:t,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,c=e.flipY,p=c===void 0?!1:c;a=a!==void 0?a:Math.pow(2,i);var y={},b=mf*a,A=Math.cos(r*vp),w=b/360,I=w/A,P=b/mp/A;if(y.pixelsPerMeter=[P,-P,P],y.metersPerPixel=[1/P,-1/P,1/P],y.pixelsPerDegree=[w,-I,P],y.degreesPerPixel=[1/w,-1/I,1/P],l){var L=vp*Math.tan(r*vp)/A,V=w*L/2,K=b/mp*L,le=K/I*P;y.pixelsPerDegree2=[0,-V,K],y.pixelsPerMeter2=[le,0,le],p&&(y.pixelsPerDegree2[1]=-y.pixelsPerDegree2[1],y.pixelsPerMeter2[1]=-y.pixelsPerMeter2[1])}return p&&(y.pixelsPerMeter[1]=-y.pixelsPerMeter[1],y.metersPerPixel[1]=-y.metersPerPixel[1],y.pixelsPerDegree[1]=-y.pixelsPerDegree[1],y.degreesPerPixel[1]=-y.degreesPerPixel[1]),y}var ml=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Fl={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Qp,Jp,gp,Ph,ed,td=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],rd=(Qp=(0,pr.b2)(),Jp=(0,pr.f3)(xt.ICameraService),Qp(gp=(Ph=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"needRefresh",!0),Ir(this,"cameraService",ed,this),(0,F.Z)(this,"coordinateSystem",void 0),(0,F.Z)(this,"viewportCenter",void 0),(0,F.Z)(this,"viewportCenterProjection",void 0),(0,F.Z)(this,"pixelsPerDegree",void 0),(0,F.Z)(this,"pixelsPerDegree2",void 0),(0,F.Z)(this,"pixelsPerMeter",void 0)}return(0,Q.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=r||this.cameraService.getCenter(),s=Ih({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,c=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ml.LNGLAT||this.coordinateSystem===ml.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ml.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===ml.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,i,a){var s=Ih({latitude:r[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,c=s.pixelsPerDegree,p=s.pixelsPerDegree2,y=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),A=Ko([],b,y),w=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=fu([],[w[0],w[1],0,1],A),y=this.cameraService.getViewMatrixUncentered()||y,A=Ko([],b,y),A=Ko([],A,td),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=p}}]),e}(),ed=mn(Ph.prototype,"cameraService",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ph))||gp),yp,nd;function _p(e){var t=qd();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function qd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xp=(yp=(0,pr.b2)(),yp(nd=function(e){(0,Je.Z)(r,e);var t=_p(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"renderMap",new Map),(0,F.Z)((0,Be.Z)(n),"enable",!1),(0,F.Z)((0,Be.Z)(n),"renderEnable",!1),(0,F.Z)((0,Be.Z)(n),"cacheLogs",{}),n}return(0,Q.Z)(r,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(!!this.enable){var l=i.split("."),c=null;l.forEach(function(p,y){c!==null?(c[p]||(c[p]={}),y!==l.length-1&&(c=c[p])):(s.cacheLogs[p]||(s.cacheLogs[p]={}),y!==l.length-1&&(c=s.cacheLogs[p])),y===l.length-1&&(c[p]=(0,O.Z)((0,O.Z)({time:Date.now()},c[p]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,Au.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Ia():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,O.Z)((0,O.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,O.Z)((0,O.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(ba.EventEmitter))||nd),id=Z(50840),nc=Z.n(id),ws=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Oh,Kd,rm,ad,nm;function im(e){var t=Fg();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function Fg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var od={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},_o=(Oh=(0,pr.b2)(),Kd=(0,pr.f3)(xt.IMapService),Oh(rm=(ad=function(e){(0,Je.Z)(r,e);var t=im(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"indragging",!1),Ir((0,Be.Z)(n),"mapService",nm,(0,Be.Z)(n)),(0,F.Z)((0,Be.Z)(n),"hammertime",void 0),(0,F.Z)((0,Be.Z)(n),"lastClickTime",0),(0,F.Z)((0,Be.Z)(n),"lastClickXY",[-1,-1]),(0,F.Z)((0,Be.Z)(n),"clickTimer",void 0),(0,F.Z)((0,Be.Z)(n),"$containter",void 0),(0,F.Z)((0,Be.Z)(n),"onDrag",function(l){var c=n.interactionEvent(l);c.type=od[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(ws.Drag,c)}),(0,F.Z)((0,Be.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var c=n.interactionEvent(l);n.emit(ws.Hover,c)}),(0,F.Z)((0,Be.Z)(n),"onTouch",function(l){var c=l.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),(0,F.Z)((0,Be.Z)(n),"onHover",function(l){var c=l.clientX,p=l.clientY,y=c,b=p,A=l.type,w=n.mapService.getMapContainer();if(w){var I=w.getBoundingClientRect(),P=I.top,L=I.left;y=y-L-w.clientLeft,b=b-P-w.clientTop}var V=n.mapService.containerToLngLat([y,b]);if(A==="click"){n.isDoubleTap(y,b,V);return}if(A==="touch"){n.isDoubleTap(y,b,V);return}A!=="click"&&A!=="dblclick"&&n.emit(ws.Hover,{x:y,y:b,lngLat:V,type:A,target:l})}),n}return(0,Q.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ws.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(ws.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(ws.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(ws.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(nc()).Manager(i);a.add(new(nc()).Tap({event:"dblclick",taps:2})),a.add(new(nc()).Tap({event:"click"})),a.add(new(nc()).Pan({threshold:0,pointers:0})),a.add(new(nc()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,c;s==="touch"?(c=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var p=this.mapService.getMapContainer();if(p){var y=p.getBoundingClientRect(),b=y.top,A=y.left;l-=A,c-=b}var w=this.mapService.containerToLngLat([l,c]);return{x:l,y:c,lngLat:w,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,c=new Date().getTime(),p="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),p="dblclick",this.emit(ws.Hover,{x:i,y:a,lngLat:s,type:p})):(this.lastClickTime=c,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){p="click",l.emit(ws.Hover,{x:i,y:a,lngLat:s,type:p})},400))}}]),r}(ko()),nm=mn(ad.prototype,"mapService",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad))||rm),ic=0;function Ng(e){var t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(ic++),r.classList.add("l7-scene"),t.appendChild(r),r}return null}function Jf(e){var t,r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){r=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return r}var Y=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),bp=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({}),sd,ac,ud,Ep,ld,cd,Qd,eh,Sp,am,om,sm,um,S0=(sd=(0,pr.b2)(),ac=(0,pr.f3)(xt.IMapService),ud=(0,pr.f3)(xt.IRendererService),Ep=(0,pr.f3)(xt.IGlobalConfigService),ld=(0,pr.f3)(xt.IInteractionService),cd=(0,pr.f3)(xt.ILayerService),sd(Qd=(eh=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,F.Z)(this,"pickedColors",void 0),(0,F.Z)(this,"pickedTileLayers",[]),Ir(this,"mapService",Sp,this),Ir(this,"rendererService",am,this),Ir(this,"configService",om,this),Ir(this,"interactionService",sm,this),Ir(this,"layerService",um,this),(0,F.Z)(this,"pickingFBO",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0),(0,F.Z)(this,"alreadyInPicking",!1),(0,F.Z)(this,"pickBufferScale",1),(0,F.Z)(this,"pickFromPickingFBO",function(r,n){var i=n.x,a=n.y,s=n.lngLat,l=n.type,c=n.target,p=!1,y=t.rendererService,b=y.readPixels,A=y.getContainer,w=t.getContainerSize(A()),I=w.width,P=w.height;I*=Aa,P*=Aa;var L=r.getLayerConfig(),V=L.enableHighlight,K=L.enableSelect,le=i*Aa,xe=a*Aa;if(le>I-1*Aa||le<0||xe>P-1*Aa||xe<0)return!1;var ke=b({x:Math.floor(le/t.pickBufferScale),y:Math.floor((P-(a+1)*Aa)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO});if(t.pickedColors=ke,ke[0]!==0||ke[1]!==0||ke[2]!==0){var je=ia(ke),it=r.layerPickService.getFeatureById(je);je!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var vt={x:i,y:a,type:l,lngLat:s,featureId:je,feature:it,target:c};it&&(p=!0,r.setCurrentPickId(je),t.triggerHoverOnLayer(r,vt))}else{var Lt={x:i,y:a,lngLat:s,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:c,feature:null};t.triggerHoverOnLayer(r,(0,O.Z)((0,O.Z)({},Lt),{},{type:"unpick"})),t.triggerHoverOnLayer(r,Lt),r.setCurrentPickId(null)}if(V&&r.layerPickService.highlightPickedFeature(ke),K&&l==="click"&&(ke==null?void 0:ke.toString())!==[0,0,0,0].toString()){var lr=ia(ke);r.getCurrentSelectedId()===null||lr!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(ke),r.setCurrentSelectedId(lr)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return p})}return(0,Q.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),c=l.width,p=l.height;c*=Aa,p*=Aa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,c=Math.round(c/this.pickBufferScale),p=Math.round(p/this.pickBufferScale),this.pickingFBO=a({color:i({width:c,height:p,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,usage:bp.RENDER_TARGET}),depth:!0,width:c,height:p}),this.interactionService.on(ws.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a,s){var l=this,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:c=this.rendererService,p=c.useFramebuffer,y=c.clear,this.resizePickingFBO(),p(this.pickingFBO,function(){y({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var w=l.pickBox(i,a);s(w)});case 3:case"end":return A.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var i=this,a=n.map(function(lr){var cr=lr<0?0:lr;return Math.floor(cr*Aa/i.pickBufferScale)}),s=(0,re.Z)(a,4),l=s[0],c=s[1],p=s[2],y=s[3],b=this.rendererService,A=b.readPixels,w=b.getContainer,I=this.getContainerSize(w()),P=I.width,L=I.height;if(P*=Aa,L*=Aa,l>(P-1)*Aa/this.pickBufferScale||p<0||c>(L-1)*Aa/this.pickBufferScale||y<0)return[];for(var V=Math.min(P/this.pickBufferScale,p)-l,K=Math.min(L/this.pickBufferScale,y)-c,le=A({x:l,y:Math.floor(L/this.pickBufferScale-(y+1)),width:V,height:K,data:new Uint8Array(V*K*4),framebuffer:this.pickingFBO}),xe=[],ke={},je=0;je<le.length/4;je=je+1){var it=le.slice(je*4,je*4+4),vt=ia(it);if(vt!==-1&&!ke[vt]){var Lt=r.layerPickService.getFeatureById(vt);xe.push((0,O.Z)((0,O.Z)({},Lt),{},{pickedFeatureIdx:vt})),ke[vt]=!0}}return xe}},{key:"handleCursor",value:function(r,n){var i=r.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var c=this.mapService.version,p=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),y=p==null?void 0:p.style.getPropertyValue("cursor");n==="unmousemove"&&y!==""?p==null||p.style.setProperty("cursor",""):n==="mousemove"&&(p==null||p.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Aa,height:r.height/Aa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),i=n.width,a=n.height;i*=Aa,a*=Aa,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){var a=this,s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:s=this.rendererService.clear,this.resizePickingFBO(),this.rendererService.useFramebuffer(this.pickingFBO,function(){var p=a.layerService.getRenderList();p.filter(function(y){return y.needPick(i.type)}).reverse().some(function(y){s({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),y.layerPickService.pickRender(i);var b=a.pickFromPickingFBO(y,i);return a.layerService.pickedLayerId=b?+y.id:-1,b&&!y.getLayerConfig().enablePropagation})});case 3:case"end":return c.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Jf(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),Sp=mn(eh.prototype,"mapService",[ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=mn(eh.prototype,"rendererService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=mn(eh.prototype,"configService",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm=mn(eh.prototype,"interactionService",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=mn(eh.prototype,"layerService",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh))||Qd),Gu=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ye.Z)(this,e),(0,F.Z)(this,"autoStart",void 0),(0,F.Z)(this,"startTime",0),(0,F.Z)(this,"oldTime",0),(0,F.Z)(this,"running",!1),(0,F.Z)(this,"elapsedTime",0),this.autoStart=t}return(0,Q.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),fd,lm,oc,A0,cm,sc,kh,Dh,Lh;function gf(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=T0(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function T0(e,t){if(!!e){if(typeof e=="string")return fm(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fm(e,t)}}function fm(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w0(e){var t=C0();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function C0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jd=mi.throttle,hm=(fd=(0,pr.b2)(),lm=(0,pr.f3)(xt.IRendererService),oc=(0,pr.f3)(xt.IMapService),A0=(0,pr.f3)(xt.IDebugService),fd(cm=(sc=function(e){(0,Je.Z)(r,e);var t=w0(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"pickedLayerId",-1),(0,F.Z)((0,Be.Z)(n),"clock",new Gu),(0,F.Z)((0,Be.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Be.Z)(n),"layers",[]),(0,F.Z)((0,Be.Z)(n),"layerList",[]),(0,F.Z)((0,Be.Z)(n),"layerRenderID",void 0),(0,F.Z)((0,Be.Z)(n),"sceneInited",!1),(0,F.Z)((0,Be.Z)(n),"animateInstanceCount",0),(0,F.Z)((0,Be.Z)(n),"shaderPicking",!0),(0,F.Z)((0,Be.Z)(n),"enableRender",!0),Ir((0,Be.Z)(n),"renderService",kh,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"mapService",Dh,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"debugService",Lh,(0,Be.Z)(n)),(0,F.Z)((0,Be.Z)(n),"reRender",Jd(function(){n.renderLayers()},32)),(0,F.Z)((0,Be.Z)(n),"throttleRenderLayers",Jd(function(){n.renderLayers()},16)),n}return(0,Q.Z)(r,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s=this;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var p=(0,St.Z)(Ae().mark(function y(b){return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(b.startInit){w.next=4;break}return w.next=3,b.init();case 3:s.updateLayerRenderList();case 4:case"end":return w.stop()}},y)}));return function(y){return p.apply(this,arguments)}}());case 2:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,St.Z)(Ae().mark(function a(s,l){var c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:l?(c=l.layerChildren.indexOf(s),c>-1&&l.layerChildren.splice(c,1)):(p=this.layers.indexOf(s),p>-1&&this.layers.splice(p,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w,I;return Ae().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){L.next=2;break}return L.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),l=gf(this.layerList);try{for(l.s();!(c=l.n()).done;)p=c.value,p.prerender()}catch(V){l.e(V)}finally{l.f()}this.renderService.beginFrame(),y=gf(this.layerList),L.prev=11,y.s();case 13:if((b=y.n()).done){L.next=25;break}if(A=b.value,w=A.getLayerConfig(),I=w.enableMask,A.masks.filter(function(V){return V.inited}).length>0&&I&&this.renderMask(A.masks),!A.getLayerConfig().enableMultiPassRenderer){L.next=22;break}return L.next=20,A.renderMultiPass();case 20:L.next=23;break;case 22:A.render();case 23:L.next=13;break;case 25:L.next=30;break;case 27:L.prev=27,L.t0=L.catch(11),y.e(L.t0);case 30:return L.prev=30,y.f(),L.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 36:case"end":return L.stop()}},a,this,[[11,27,30,33]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?Kt.MULTIPLE:Kt.SINGLE,l=gf(i),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;p.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(y){l.e(y)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,s.hooks.beforeRenderData.promise();case 2:l=p.sent,l&&this.renderLayers();case 4:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,c=l===void 0?!0:l,p=i.tileMask?1:0,y=i.masks.filter(function(P){return P.inited});p=p+(c?y.length:1);var b=p>1?Kt.MULTIPLE:Kt.SINGLE;if((i.tileMask||y.length&&c)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),y.length&&c){var A=gf(y),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;I.render({isStencil:!0,stencilType:b,stencilIndex:a++})}}catch(P){A.e(P)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:b,stencilIndex:a++,stencilOperation:ar.OR})}},{key:"renderTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){c.next=6;break}return c.next=4,s.renderMultiPass();case 4:c.next=8;break;case 6:return c.next=8,s.render();case 8:case"end":return c.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=fi(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(ba.EventEmitter),kh=mn(sc.prototype,"renderService",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=mn(sc.prototype,"mapService",[oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh=mn(sc.prototype,"debugService",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sc))||cm),gs=Z(81253),R0=mi.isNil,pm=function(){function e(t){var r=this;(0,ye.Z)(this,e),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"type",void 0),(0,F.Z)(this,"scale",void 0),(0,F.Z)(this,"descriptor",void 0),(0,F.Z)(this,"featureBufferLayout",[]),(0,F.Z)(this,"needRescale",!1),(0,F.Z)(this,"needRemapping",!1),(0,F.Z)(this,"needRegenerateVertices",!1),(0,F.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,F.Z)(this,"vertexAttribute",void 0),(0,F.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=r.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,c=(l=r.scale)===null||l===void 0?void 0:l.scalers[s].func,p=c(a);return p})}),this.setProps(t)}return(0,Q.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,Yt.Z)(r));if(!R0(a))return[a]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),dm=["buffer","update","name"],M0=["buffer","update","name"],Bh,vm,mm,ev,tv,Ap,I0=(Bh={},(0,F.Z)(Bh,Y.FLOAT,4),(0,F.Z)(Bh,Y.UNSIGNED_BYTE,1),(0,F.Z)(Bh,Y.UNSIGNED_SHORT,2),Bh),rv=(vm=(0,pr.b2)(),mm=(0,pr.f3)(xt.IRendererService),vm(ev=(tv=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"attributesAndIndices",void 0),Ir(this,"rendererService",Ap,this),(0,F.Z)(this,"attributes",[]),(0,F.Z)(this,"triangulation",void 0),(0,F.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Q.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new pm(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(i){return i.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(r[a]||s&&r[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,i){var a=this.getLayerStyleAttribute(r);a||(a=this.registerStyleAttribute((0,O.Z)((0,O.Z)({},n),{},{name:r})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,i=this.getLayerStyleAttribute(r),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(ke){return ke.name===r});if(l&&l.descriptor){var c=l.descriptor,p=c.update,y=c.buffer,b=c.size,A=b===void 0?0:b,w=I0[y.type||Y.FLOAT];if(p){var I=this.featureLayout,P=I.elements,L=I.sizePerElement,V=P.slice(i,a);if(!V.length)return;var K=V[0].offset,le=K*A*w,xe=V.map(function(ke,je){for(var it=ke.featureIdx,vt=ke.vertices,Lt=ke.normals,lr=vt.length/L,cr=[],Rr=0;Rr<lr;Rr++){var fn=Lt?Lt.slice(Rr*3,Rr*3+3):[];cr.push.apply(cr,(0,Yt.Z)(p(n[it],it,vt.slice(Rr*L,Rr*L+L),je,fn)))}return cr}).flat();l.vertexAttribute.updateBuffer({data:xe,offset:le}),s==null||s.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndices",value:function(r,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(V){return V.resetDescriptor(),V.descriptor}),l=0,c=0,p=[],y=3;r.forEach(function(V,K){var le=a.triangulation(V,i),xe=le.indices,ke=le.vertices,je=le.normals,it=le.size,vt=le.indexes,Lt=le.count;typeof Lt=="number"&&(c+=Lt),xe.forEach(function(fn){p.push(fn+l)}),y=it;var lr=ke.length/it;a.featureLayout.sizePerElement=y,a.featureLayout.elements.push({featureIdx:K,vertices:ke,normals:je,offset:l}),l+=lr;for(var cr=function(Pn){var Ri=(je==null?void 0:je.slice(Pn*3,Pn*3+3))||[],ya=ke.slice(Pn*it,Pn*it+it),Ha=0;vt&&vt[Pn]!==void 0&&(Ha=vt[Pn]),s.forEach(function(no,us){if(no&&no.update){var xl;(xl=no.buffer.data).push.apply(xl,(0,Yt.Z)(no.update(V,K,ya,Pn,Ri,Ha)))}})},Rr=0;Rr<lr;Rr++)cr(Rr)});var b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createElements,P={};s.forEach(function(V,K){if(V){var le=V.buffer,xe=V.update,ke=V.name,je=(0,gs.Z)(V,dm),it=A((0,O.Z)({buffer:w(le)},je));P[V.name||""]=it,a.attributes[K].vertexAttribute=it}});var L=I({data:p,type:Y.UNSIGNED_INT,count:p.length});return this.attributesAndIndices={attributes:P,elements:L,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(w){return w.resetDescriptor(),w.descriptor}),s=0,l=[],c=3;r.forEach(function(w,I){var P=i.triangulation(w),L=P.indices,V=P.vertices,K=P.normals,le=P.size,xe=P.indexes;L.forEach(function(vt){l.push(vt+s)}),c=le;var ke=V.length/le;i.featureLayout.sizePerElement=c,i.featureLayout.elements.push({featureIdx:I,vertices:V,normals:K,offset:s}),s+=ke;for(var je=function(Lt){var lr=(K==null?void 0:K.slice(Lt*3,Lt*3+3))||[],cr=V.slice(Lt*le,Lt*le+le),Rr=0;xe&&xe[Lt]!==void 0&&(Rr=xe[Lt]),a.forEach(function(fn,Pn){if(fn&&fn.update){var Ri;(Ri=fn.buffer.data).push.apply(Ri,(0,Yt.Z)(fn.update(w,I,cr,Lt,lr,Rr)))}})},it=0;it<ke;it++)je(it)});var p=this.rendererService,y=p.createAttribute,b=p.createBuffer,A={};return a.forEach(function(w,I){if(w){var P=w.buffer,L=w.update,V=w.name,K=(0,gs.Z)(w,M0),le=y((0,O.Z)({buffer:b(P)},K));A[w.name||""]=le,i.attributes[I].vertexAttribute=le}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ap=mn(tv.prototype,"rendererService",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv))||ev),gm=Z(34155);function nv(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(y){try{p(n.next(y))}catch(b){s(b)}}function c(y){try{p(n.throw(y))}catch(b){s(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,t||[])).next())})}function ym(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,i=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){r.label=p[1];break}if(p[0]===6&&r.label<a[1]){r.label=a[1],a=p;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(p);break}a[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(e,r)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function iv(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a}function av(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function _m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xm={exports:{}},ov={exports:{}},hd={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=t.default})(hd,hd.exports);var Xu={},Nl={exports:{}},Tp={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return r.call(this,n,a)}},e.exports=t.default})(Tp,Tp.exports);var yf={};Object.defineProperty(yf,"__esModule",{value:!0}),yf.fallback=n_,yf.wrap=i_;var pd=yf.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,P0=yf.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,sA=yf.hasNextTick=typeof gm=="object"&&typeof gm.nextTick=="function";function n_(e){setTimeout(e,0)}function i_(e){return function(t){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return t.apply(void 0,r)})}}var bm;pd?bm=queueMicrotask:P0?bm=setImmediate:sA?bm=gm.nextTick:bm=n_,yf.default=i_(bm),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=Tp.exports,n=l(r),i=yf,a=l(i),s=Xu;function l(b){return b&&b.__esModule?b:{default:b}}function c(b){return(0,s.isAsync)(b)?function(){for(var A=[],w=arguments.length;w--;)A[w]=arguments[w];var I=A.pop(),P=b.apply(this,A);return p(P,I)}:(0,n.default)(function(A,w){var I;try{I=b.apply(this,A)}catch(P){return w(P)}if(I&&typeof I.then=="function")return p(I,w);w(null,I)})}function p(b,A){return b.then(function(w){y(A,null,w)},function(w){y(A,w&&w.message?w:new Error(w))})}function y(b,A,w){try{b(A,w)}catch(I){(0,a.default)(function(P){throw P},I)}}e.exports=t.default}(Nl,Nl.exports),Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.isAsyncIterable=Xu.isAsyncGenerator=Xu.isAsync=void 0;var uA=Nl.exports,lA=cA(uA);function cA(e){return e&&e.__esModule?e:{default:e}}function a_(e){return e[Symbol.toStringTag]==="AsyncFunction"}function fA(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function hA(e){return typeof e[Symbol.asyncIterator]=="function"}function pA(e){if(typeof e!="function")throw new Error("expected a function");return a_(e)?(0,lA.default)(e):e}Xu.default=pA,Xu.isAsync=a_,Xu.isAsyncGenerator=fA,Xu.isAsyncIterable=hA;var dd={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],c=arguments.length;c--;)l[c]=arguments[c];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(p,y){l[i-1]=function(b){for(var A=[],w=arguments.length-1;w-- >0;)A[w]=arguments[w+1];if(b)return y(b);p(A.length>1?A:A[0])},n.apply(s,l)})}return a}e.exports=t.default})(dd,dd.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hd.exports,n=c(r),i=Xu,a=c(i),s=dd.exports,l=c(s);function c(p){return p&&p.__esModule?p:{default:p}}t.default=(0,l.default)(function(p,y,b){var A=(0,n.default)(y)?[]:{};p(y,function(w,I,P){(0,a.default)(w)(function(L){for(var V,K=[],le=arguments.length-1;le-- >0;)K[le]=arguments[le+1];K.length<2&&(V=K,K=V[0]),A[I]=K,P(L)})},function(w){return b(w,A)})},3),e.exports=t.default}(ov,ov.exports);var Ug={exports:{}},O0={exports:{}},zg={exports:{}},Em={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=t.default})(Em,Em.exports);var Zg={exports:{}},Vg={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(Vg,Vg.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=y;var r=hd.exports,n=s(r),i=Vg.exports,a=s(i);function s(b){return b&&b.__esModule?b:{default:b}}function l(b){var A=-1,w=b.length;return function(){return++A<w?{value:b[A],key:A}:null}}function c(b){var A=-1;return function(){var I=b.next();return I.done?null:(A++,{value:I.value,key:A})}}function p(b){var A=b?Object.keys(b):[],w=-1,I=A.length;return function P(){var L=A[++w];return L==="__proto__"?P():w<I?{value:b[L],key:L}:null}}function y(b){if((0,n.default)(b))return l(b);var A=(0,a.default)(b);return A?c(A):p(b)}e.exports=t.default}(Zg,Zg.exports);var Sm={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=t.default})(Sm,Sm.exports);var jg={exports:{}},Am={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(Am,Am.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=Am.exports,n=i(r);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,c,p){var y=!1,b=!1,A=!1,w=0,I=0;function P(){w>=l||A||y||(A=!0,s.next().then(function(K){var le=K.value,xe=K.done;if(!(b||y)){if(A=!1,xe){y=!0,w<=0&&p(null);return}w++,c(le,I,L),I++,P()}}).catch(V))}function L(K,le){if(w-=1,!b){if(K)return V(K);if(K===!1){y=!0,b=!0;return}if(le===n.default||y&&w<=0)return y=!0,p(null);P()}}function V(K){b||(A=!1,y=!0,p(K))}P()}e.exports=t.default}(jg,jg.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Em.exports,n=w(r),i=Zg.exports,a=w(i),s=Sm.exports,l=w(s),c=Xu,p=jg.exports,y=w(p),b=Am.exports,A=w(b);function w(I){return I&&I.__esModule?I:{default:I}}t.default=function(I){return function(P,L,V){if(V=(0,n.default)(V),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!P)return V(null);if((0,c.isAsyncGenerator)(P))return(0,y.default)(P,I,L,V);if((0,c.isAsyncIterable)(P))return(0,y.default)(P[Symbol.asyncIterator](),I,L,V);var K=(0,a.default)(P),le=!1,xe=!1,ke=0,je=!1;function it(Lt,lr){if(!xe)if(ke-=1,Lt)le=!0,V(Lt);else if(Lt===!1)le=!0,xe=!0;else{if(lr===A.default||le&&ke<=0)return le=!0,V(null);je||vt()}}function vt(){for(je=!0;ke<I&&!le;){var Lt=K();if(Lt===null){le=!0,ke<=0&&V(null);return}ke+=1,L(Lt.value,Lt.key,(0,l.default)(it))}je=!1}vt()}},e.exports=t.default}(zg,zg.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=zg.exports,n=c(r),i=Xu,a=c(i),s=dd.exports,l=c(s);function c(y){return y&&y.__esModule?y:{default:y}}function p(y,b,A,w){return(0,n.default)(b)(y,(0,a.default)(A),w)}t.default=(0,l.default)(p,4),e.exports=t.default}(O0,O0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=O0.exports,n=s(r),i=dd.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p,y){return(0,n.default)(c,1,p,y)}t.default=(0,a.default)(l,3),e.exports=t.default}(Ug,Ug.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=ov.exports,n=s(r),i=Ug.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,n.default)(a.default,c,p)}e.exports=t.default}(xm,xm.exports);var k0=_m(xm.exports),th=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,k0(this.tasks)},e.prototype.tap=function(t,r){var n=this;this.tasks.push(function(i){r.apply(void 0,av([],iv(n.args),!1)),i(null,t)})},e}(),Hg={exports:{}},Wg={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hd.exports,n=L(r),i=Am.exports,a=L(i),s=O0.exports,l=L(s),c=Em.exports,p=L(c),y=Sm.exports,b=L(y),A=Xu,w=L(A),I=dd.exports,P=L(I);function L(xe){return xe&&xe.__esModule?xe:{default:xe}}function V(xe,ke,je){je=(0,p.default)(je);var it=0,vt=0,Lt=xe.length,lr=!1;Lt===0&&je(null);function cr(Rr,fn){Rr===!1&&(lr=!0),lr!==!0&&(Rr?je(Rr):(++vt===Lt||fn===a.default)&&je(null))}for(;it<Lt;it++)ke(xe[it],it,(0,b.default)(cr))}function K(xe,ke,je){return(0,l.default)(xe,Infinity,ke,je)}function le(xe,ke,je){var it=(0,n.default)(xe)?V:K;return it(xe,(0,w.default)(ke),je)}t.default=(0,P.default)(le,3),e.exports=t.default})(Wg,Wg.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=Wg.exports,n=s(r),i=ov.exports,a=s(i);function s(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,a.default)(n.default,c,p)}e.exports=t.default}(Hg,Hg.exports);var dA=_m(Hg.exports),nN=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return dA(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return nv(n,void 0,void 0,function(){return ym(this,function(a){switch(a.label){case 0:return[4,r()];case 1:return a.sent(),i(null,t),[2]}})})})},e}(),Gg={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Em.exports,n=y(r),i=Sm.exports,a=y(i),s=Xu,l=y(s),c=dd.exports,p=y(c);function y(A){return A&&A.__esModule?A:{default:A}}function b(A,w){if(w=(0,n.default)(w),!Array.isArray(A))return w(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return w();var I=0;function P(V){var K=(0,l.default)(A[I++]);K.apply(void 0,V.concat([(0,a.default)(L)]))}function L(V){for(var K=[],le=arguments.length-1;le-- >0;)K[le]=arguments[le+1];if(V!==!1){if(V||I===A.length)return w.apply(void 0,[V].concat(K));P(K)}}P([])}t.default=(0,p.default)(b),e.exports=t.default})(Gg,Gg.exports);var o_=_m(Gg.exports),iN=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return o_(this.tasks)},e.prototype.tap=function(t,r){this.tasks.length===0?this.tasks.push(function(n){var i=r();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=r.apply(void 0,av([],iv(n),!1));i(a?null:!1,t)})},e}(),s_=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return k0(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(n){var i=r();n(i,t)})},e}(),vA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,k0(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return nv(n,void 0,void 0,function(){return ym(this,function(a){switch(a.label){case 0:return[4,r.apply(void 0,av([],iv(this.args),!1))];case 1:return a.sent(),i(null,t),[2]}})})})},e}(),mA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,k0(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return nv(n,void 0,void 0,function(){var a;return ym(this,function(s){switch(s.label){case 0:return[4,r.apply(void 0,av([],iv(this.args),!1))];case 1:return a=s.sent(),i(a,t),[2]}})})})},e}(),gA=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return o_(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){r(n).then(function(a){i(null,a)})})},e}(),u_=Z(67709),yA=Z.n(u_),l_,c_,f_,h_,p_,d_,v_,m_,g_,y_,__,x_,b_,E_,S_,A_,T_,w_,hu,C_,R_,M_,I_,P_,O_,k_,D_,L_,B_,F_,N_,U_,z_,Z_,V_;function _A(e){var t=xA();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=(l_=(0,pr.b2)(),c_=(0,pr.f3)(xt.SceneID),f_=(0,pr.f3)(xt.IIconService),h_=(0,pr.f3)(xt.IFontService),p_=(0,pr.f3)(xt.IControlService),d_=(0,pr.f3)(xt.IGlobalConfigService),v_=(0,pr.f3)(xt.IMapService),m_=(0,pr.f3)(xt.ICoordinateSystemService),g_=(0,pr.f3)(xt.IRendererService),y_=(0,pr.f3)(xt.ILayerService),__=(0,pr.f3)(xt.IDebugService),x_=(0,pr.f3)(xt.ICameraService),b_=(0,pr.f3)(xt.IInteractionService),E_=(0,pr.f3)(xt.IPickingService),S_=(0,pr.f3)(xt.IShaderModuleService),A_=(0,pr.f3)(xt.IMarkerService),T_=(0,pr.f3)(xt.IPopupService),l_(w_=(hu=function(e){(0,Je.Z)(r,e);var t=_A(r);function r(){var n;return(0,ye.Z)(this,r),n=t.call(this),(0,F.Z)((0,Be.Z)(n),"destroyed",!1),(0,F.Z)((0,Be.Z)(n),"loaded",!1),Ir((0,Be.Z)(n),"id",C_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"iconService",R_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"fontService",M_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"controlService",I_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"configService",P_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"map",O_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"coordinateSystemService",k_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"rendererService",D_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"layerService",L_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"debugService",B_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"cameraService",F_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"interactionService",N_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"pickingService",U_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"shaderModuleService",z_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"markerService",Z_,(0,Be.Z)(n)),Ir((0,Be.Z)(n),"popupService",V_,(0,Be.Z)(n)),(0,F.Z)((0,Be.Z)(n),"inited",!1),(0,F.Z)((0,Be.Z)(n),"initPromise",void 0),(0,F.Z)((0,Be.Z)(n),"rendering",!1),(0,F.Z)((0,Be.Z)(n),"$container",void 0),(0,F.Z)((0,Be.Z)(n),"canvas",void 0),(0,F.Z)((0,Be.Z)(n),"markerContainer",void 0),(0,F.Z)((0,Be.Z)(n),"hooks",void 0),(0,F.Z)((0,Be.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),wf(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,F.Z)((0,Be.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new vA},n}return(0,Q.Z)(r,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,St.Z)(Ae().mark(function s(){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),c.next=3,new Promise(function(p){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),p()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(ws.Drag,a.addSceneEvent.bind(a));case 10:case"end":return c.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,St.Z)(Ae().mark(function s(){var l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,c?a.$container=c:a.$container=Ng(a.configService.getSceneConfig(a.id).id||""),!a.$container){b.next=13;break}return a.canvas=On("canvas","",a.$container),a.setCanvas(),b.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),yA()(a.$container,a.handleWindowResized),window.matchMedia&&((p=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(a.handleWindowResized)),b.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return b.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,St.Z)(Ae().mark(function s(){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(p){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),a.map.version!=="GAODE2.x"&&p()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(ws.Drag,a.addSceneEvent.bind(a));case 5:case"end":return c.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,St.Z)(Ae().mark(function s(){var l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){p.next=7;break}return p.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:p.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return p.stop()}},s)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],b.next=3,this.render();case 3:return p=s==="jpg"?c==null?void 0:c.toDataURL("image/jpeg"):c==null?void 0:c.toDataURL("image/png"),b.abrupt("return",p);case 5:case"end":return b.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=On("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if((0,u_.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var s;(s=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=Aa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p&&(p.width=l*s,p.height=c*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*c})}},{key:"setCanvas",value:function(){var i,a,s=Aa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p.width=l*s,p.height=c*s,p.style.width="100%",p.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),r}(ba.EventEmitter),C_=mn(hu.prototype,"id",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=mn(hu.prototype,"iconService",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=mn(hu.prototype,"fontService",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I_=mn(hu.prototype,"controlService",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_=mn(hu.prototype,"configService",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=mn(hu.prototype,"map",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=mn(hu.prototype,"coordinateSystemService",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=mn(hu.prototype,"rendererService",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=mn(hu.prototype,"layerService",[y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=mn(hu.prototype,"debugService",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=mn(hu.prototype,"cameraService",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=mn(hu.prototype,"interactionService",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=mn(hu.prototype,"pickingService",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=mn(hu.prototype,"shaderModuleService",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z_=mn(hu.prototype,"markerService",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=mn(hu.prototype,"popupService",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hu))||w_);function EA(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break;default:}return t}var j_=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function H_(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r={};return e=e.replace(j_,function(n,i,a){var s=a.split(":"),l=s[0].trim(),c="";switch(s.length>1&&(c=s[1].trim()),i){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(p,y){return p.push(Number(y.trim())),p},[]):c=new Array(EA(i)).fill(0);break;default:}return r[l]=c,"".concat(t?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:r}}function Xg(e){var t=H_(e,!0),r=t.content,n=t.uniforms;return r=r.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(y){return"uniform ".concat(y)});var l=H_(s),c=l.content,p=l.uniforms;return Object.assign(n,p),"".concat(a,`{
`).concat(c,`
};`)}),{content:r,uniforms:n}}function W_(e){var t={};return e.replace(j_,function(r,n,i){var a=i.trim();return t[a]?"":(t[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var G_,X_,SA=mi.uniq,$_="#define PI 3.14159265359",AA=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Y_=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,q_=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,TA=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,wA=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,CA=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,RA=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,MA=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,K_=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,IA=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,PA=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Q_=/precision\s+(high|low|medium)p\s+float/,J_=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,OA=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,kA=/void\s+main\s*\([^)]*\)\s*\{\n?/,aN=/}\n?[^{}]*$/,DA=(G_=(0,pr.b2)(),G_(X_=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"moduleCache",{}),(0,F.Z)(this,"rawContentCache",{})}return(0,Q.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:$_,fs:$_}),this.registerModule("decode",{vs:AA,fs:""}),this.registerModule("scene_uniforms",{vs:Y_,fs:Y_}),this.registerModule("picking_uniforms",{vs:q_,fs:q_}),this.registerModule("projection",{vs:K_,fs:K_}),this.registerModule("project",{vs:MA,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:PA}),this.registerModule("lighting",{vs:wA,fs:""}),this.registerModule("light",{vs:TA,fs:""}),this.registerModule("picking",{vs:RA,fs:CA}),this.registerModule("rotation_2d",{vs:IA,fs:""})}},{key:"registerModule",value:function(r,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,c=Xg(i),p=c.content,y=c.uniforms,b=Xg(a),A=b.content,w=b.uniforms;this.rawContentCache[r]={fs:A,inject:l,uniforms:(0,O.Z)((0,O.Z)((0,O.Z)({},y),w),s),vs:p}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,i=this.rawContentCache[r].vs,a=this.rawContentCache[r].fs,s=this.rawContentCache[r].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=Xg(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(kA,function(V){return V+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var c=this.processModule(i,[],"vs"),p=c.content,y=c.includeList,b=this.processModule(a,[],"fs"),A=b.content,w=b.includeList,I="",P=SA(y.concat(w).concat(r)).reduce(function(V,K){return(0,O.Z)((0,O.Z)({},V),n.rawContentCache[K].uniforms)},(0,O.Z)({},l));Q_.test(A)||(I=I+J_),I=I+A;var L="";return Q_.test(p)||(L=L+J_),L=L+p,this.moduleCache[r]={fs:I.trim(),uniforms:P,vs:L.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var a=this,s=r.replace(OA,function(l,c){var p=c.split(" "),y=p[0].replace(/"/g,"");if(n.indexOf(y)>-1)return"";var b=a.rawContentCache[y][i];n.push(y);var A=a.processModule(b,n,i),w=A.content;return w});return{content:s,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(r[a],`;
`)},`
`);return n}}]),e}())||X_),ha=Z(66213),sv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),e1,t1,D0=(e1=(0,pr.b2)(),e1(t1=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"shaderModuleService",void 0),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"cameraService",void 0),(0,F.Z)(this,"mapService",void 0),(0,F.Z)(this,"interactionService",void 0),(0,F.Z)(this,"layerService",void 0),(0,F.Z)(this,"config",void 0)}return(0,Q.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return sv.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(xt.IRendererService),this.cameraService=r.getContainer().get(xt.ICameraService),this.mapService=r.getContainer().get(xt.IMapService),this.interactionService=r.getContainer().get(xt.IInteractionService),this.layerService=r.getContainer().get(xt.ILayerService),this.shaderModuleService=r.getContainer().get(xt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||t1),r1,n1;function LA(e){var t=BA();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function BA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=(r1=(0,pr.b2)(),r1(n1=function(e){(0,Je.Z)(r,e);var t=LA(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){(0,ha.Z)((0,pe.Z)(r.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(D0))||n1),i1,a1,o1,$g,s1;function NA(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=UA(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function UA(e,t){if(!!e){if(typeof e=="string")return u1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u1(e,t)}}function u1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var zA=(i1=(0,pr.b2)(),a1=(0,pr.f3)(xt.IPostProcessor),i1(o1=($g=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"passes",[]),Ir(this,"postProcessor",s1,this),(0,F.Z)(this,"layer",void 0),(0,F.Z)(this,"renderFlag",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0)}return(0,Q.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var t=(0,St.Z)(Ae().mark(function n(){var i,a,s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=NA(this.passes),c.prev=1,i.s();case 3:if((a=i.n()).done){c.next=9;break}return s=a.value,c.next=7,s.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===sv.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,i){r.init(this.layer,n),this.passes.splice(i,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),s1=mn($g.prototype,"postProcessor",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$g))||o1),l1,c1;function ZA(e){var t=VA();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jA=(l1=(0,pr.b2)(),l1(c1=function(e){(0,Je.Z)(r,e);var t=ZA(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"pickingFBO",void 0),(0,F.Z)((0,Be.Z)(n),"layer",void 0),(0,F.Z)((0,Be.Z)(n),"width",0),(0,F.Z)((0,Be.Z)(n),"height",0),(0,F.Z)((0,Be.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Be.Z)(n),"pickFromPickingFBO",function(l){var c=l.x,p=l.y,y=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var A=n.rendererService,w=A.getViewportSize,I=A.readPixels,P=A.useFramebuffer,L=w(),V=L.width,K=L.height,le=n.layer.getLayerConfig(),xe=le.enableHighlight,ke=le.enableSelect,je=c*Aa,it=p*Aa;if(!(je>V||je<0||it>K||it<0)){var vt;P(n.pickingFBO,function(){var Lt;if(vt=I({x:Math.round(je),y:Math.round(K-(p+1)*Aa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),vt[0]!==0||vt[1]!==0||vt[2]!==0){var lr=ia(vt),cr=n.layer.getSource().getFeatureById(lr),Rr={x:c,y:p,type:b,lngLat:y,featureId:lr,feature:cr};cr&&(n.layer.setCurrentPickId(lr),n.triggerHoverOnLayer(Rr))}else{var fn={x:c,y:p,lngLat:y,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,O.Z)((0,O.Z)({},fn),{},{type:"unpick"})),n.triggerHoverOnLayer(fn),n.layer.setCurrentPickId(null)}xe&&n.highlightPickedFeature(vt),ke&&b==="click"&&((Lt=vt)===null||Lt===void 0?void 0:Lt.toString())!==[0,0,0,0].toString()&&n.selectFeature(vt)})}}}),n}return(0,Q.Z)(r,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){(0,ha.Z)((0,pe.Z)(r.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,c=s.createFramebuffer,p=s.getViewportSize,y=p(),b=y.width,A=y.height;this.pickingFBO=c({color:l({width:b,height:A,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(ws.Hover,this.pickFromPickingFBO),this.interactionService.on(ws.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ws.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,c=s.useFramebuffer,p=s.clear,y=l(),b=y.width,A=y.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==A)&&(this.pickingFBO.resize({width:b,height:A}),this.width=b,this.height=A),c(this.pickingFBO,function(){p({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var w=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(w),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.layer.hooks.beforeHighlight.call([s,l,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.layer.hooks.beforeSelect.call([s,l,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=Ma(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=Ma(a);this.highlightPickedFeature(new Uint8Array(s))}}]),r}(D0))||c1),f1,h1,p1,Yg,d1,HA=mi.camelCase,WA=mi.isNil,GA=mi.upperFirst,XA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fh=(f1=(0,pr.b2)(),h1=(0,pr.f3)(xt.IShaderModuleService),f1(p1=(Yg=function(){function e(){(0,ye.Z)(this,e),Ir(this,"shaderModuleService",d1,this),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"config",void 0),(0,F.Z)(this,"quad",XA),(0,F.Z)(this,"enabled",!0),(0,F.Z)(this,"renderToScreen",!1),(0,F.Z)(this,"model",void 0),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"optionsToUpdate",{})}return(0,Q.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return sv.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(xt.IRendererService),this.shaderModuleService=r.getContainer().get(xt.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,c=this.setupShaders(),p=c.vs,y=c.fs,b=c.uniforms;this.model=l({vs:p,fs:y,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,O.Z)((0,O.Z)({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var i=this,a=r.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,c=s.getViewportSize,p=s.clear,y=c(),b=y.width,A=y.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){p({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var w=(0,O.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[b,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(w.u_BloomFinal=1,w.u_Texture2=n),i.model.draw({uniforms:w})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,O.Z)((0,O.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(i){WA(r[i])||(n["u_".concat(GA(HA(i)))]=r[i])}),n}}]),e}(),d1=mn(Yg.prototype,"shaderModuleService",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg))||p1),v1,m1;function $A(e){var t=YA();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,KA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qg=mi.isNil,QA=(v1=(0,pr.b2)(),v1(m1=function(e){(0,Je.Z)(r,e);var t=$A(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:KA,fs:qA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return qg(i.bloomRadius)||(a.u_radius=i.bloomRadius),qg(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),qg(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),r}(Fh))||m1),g1,y1;function JA(e){var t=eT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,rT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nT=mi.isNil,iT=(g1=(0,pr.b2)(),g1(y1=function(e){(0,Je.Z)(r,e);var t=JA(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:rT,fs:tT});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return nT(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),r}(Fh))||y1),_1,x1;function aT(e){var t=oT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,uT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lT=mi.isNil,cT=(_1=(0,pr.b2)(),_1(x1=function(e){(0,Je.Z)(r,e);var t=aT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:uT,fs:sT});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return lT(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),r}(Fh))||x1),b1,E1;function fT(e){var t=hT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,dT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vT=(b1=(0,pr.b2)(),b1(E1=function(e){(0,Je.Z)(r,e);var t=fT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:dT,fs:pT});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}}]),r}(Fh))||E1),S1,A1;function mT(e){var t=gT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_T=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xT=(S1=(0,pr.b2)(),S1(A1=function(e){(0,Je.Z)(r,e);var t=mT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:_T,fs:yT}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Fh))||A1),T1,w1;function bT(e){var t=ET();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,AT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TT=(T1=(0,pr.b2)(),T1(w1=function(e){(0,Je.Z)(r,e);var t=bT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:AT,fs:ST});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}}]),r}(Fh))||w1),C1,R1;function wT(e){var t=CT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function CT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,MT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IT=(C1=(0,pr.b2)(),C1(R1=function(e){(0,Je.Z)(r,e);var t=wT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:MT,fs:RT});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:s,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[p,y]})}}}]),r}(Fh))||R1),M1,I1;function PT(e){var t=OT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,DT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LT=(M1=(0,pr.b2)(),M1(I1=function(e){(0,Je.Z)(r,e);var t=PT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:DT,fs:kT}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Fh))||I1),P1,O1;function BT(e){var t=FT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,UT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,zT=(P1=(0,pr.b2)(),P1(O1=function(e){(0,Je.Z)(r,e);var t=BT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:NT,fs:UT}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Fh))||O1),k1,D1,L1,B1,uv,F1,ZT=(k1=(0,pr.b2)(),D1=(0,pr.f3)(xt.IRendererService),L1=(0,pr.zY)(),k1(B1=(uv=function(){function e(){(0,ye.Z)(this,e),Ir(this,"rendererService",F1,this),(0,F.Z)(this,"passes",[]),(0,F.Z)(this,"readFBO",void 0),(0,F.Z)(this,"writeFBO",void 0)}return(0,Q.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,i=r.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(r.readFBO,(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a){var s,l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.getReadFBOTex();case 2:s=p.sent,l=0;case 4:if(!(l<4)){p.next=11;break}return p.next=7,a.render(i,s);case 7:this.swap(),l++,p.next=4;break;case 11:case"end":return p.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){var a,s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<this.passes.length)){c.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,s);case 7:c.next=12;break;case 9:return c.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,i){r.init(n,i),this.passes.push(r)}},{key:"insert",value:function(r,n,i,a){r.init(i,a),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,i=r.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),F1=mn(uv.prototype,"rendererService",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mn(uv.prototype,"init",[L1],Object.getOwnPropertyDescriptor(uv.prototype,"init"),uv.prototype),uv))||B1),N1,U1;function VT(e){var t=jT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function jT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HT=(N1=(0,pr.b2)(),N1(U1=function(e){(0,Je.Z)(r,e);var t=VT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){(0,ha.Z)((0,pe.Z)(r.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();s(c,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(p){p.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),r}(D0))||U1),z1,Z1,V1,Kg,j1;function WT(e){var t=GT();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function GT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,H1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,$T=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function W1(e,t){for(var r=0,n=1/t,i=e;i>0;)r=r+n*(i%t),i=Math.floor(i/t),n=n/t;return r}var YT=1,qT=(z1=(0,pr.b2)(),Z1=(0,pr.f3)(xt.IShaderModuleService),z1(V1=(Kg=function(e){(0,Je.Z)(r,e);var t=WT(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),Ir((0,Be.Z)(n),"shaderModuleService",j1,(0,Be.Z)(n)),(0,F.Z)((0,Be.Z)(n),"haltonSequence",[]),(0,F.Z)((0,Be.Z)(n),"accumulatingId",0),(0,F.Z)((0,Be.Z)(n),"frame",0),(0,F.Z)((0,Be.Z)(n),"timer",void 0),(0,F.Z)((0,Be.Z)(n),"sampleRenderTarget",void 0),(0,F.Z)((0,Be.Z)(n),"prevRenderTarget",void 0),(0,F.Z)((0,Be.Z)(n),"outputRenderTarget",void 0),(0,F.Z)((0,Be.Z)(n),"copyRenderTarget",void 0),(0,F.Z)((0,Be.Z)(n),"blendModel",void 0),(0,F.Z)((0,Be.Z)(n),"outputModel",void 0),(0,F.Z)((0,Be.Z)(n),"copyModel",void 0),n}return(0,Q.Z)(r,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){(0,ha.Z)((0,pe.Z)(r.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,c=s.createTexture2D;this.sampleRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})});for(var p=0;p<30;p++)this.haltonSequence.push([W1(p,2),W1(p,3)]);this.blendModel=this.createTriangleModel("blend-pass",XT),this.outputModel=this.createTriangleModel("copy-pass",H1,{blend:{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:Y.ONE,dstAlpha:Y.ONE_MINUS_SRC_ALPHA},equation:{rgb:Y.FUNC_ADD,alpha:Y.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",H1)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,c=s.getViewportSize,p=s.useFramebuffer,y=c(),b=y.width,A=y.height;this.sampleRenderTarget.resize({width:b,height:A}),this.prevRenderTarget.resize({width:b,height:A}),this.outputRenderTarget.resize({width:b,height:A}),this.copyRenderTarget.resize({width:b,height:A}),this.resetFrame(),this.stopAccumulating();var w=i.multiPassRenderer.getPostProcessor().getReadFBO();p(w,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:w}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function P(L){!a.accumulatingId||L!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){P(L)}))};this.accumulatingId=YT++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,c=s.getViewportSize,p=s.useFramebuffer,y=c(),b=y.width,A=y.height,w=i.getLayerConfig(),I=w.jitterScale,P=I===void 0?1:I,L=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((L[0]*2-1)/b*P,(L[1]*2-1)/A*P),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),p(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var V=i.getLayerConfig();p(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:V.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(p(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),p(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var K=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=K,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:$T,fs:a});var l=this.shaderModuleService.getModule(i),c=l.vs,p=l.fs,y=l.uniforms,b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createModel;return I((0,O.Z)({vs:c,fs:p,attributes:{a_Position:A({buffer:w({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,O.Z)({},y),depth:{enable:!1},count:3},s))}}]),r}(D0),j1=mn(Kg.prototype,"shaderModuleService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg))||V1),Tm=new pr.W2;Tm.bind(xt.IGlobalConfigService).to(oi).inSingletonScope(),(0,pr.GW)((0,pr.b2)(),ba.EventEmitter),Tm.bind(xt.IEventEmitter).to(ba.EventEmitter);var G1=(0,yn.Z)(Tm,!1),Qg=function(t){var r=G1.lazyInject(t);return function(n,i,a){r.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},oN=function(t){var r=G1.lazyMultiInject(t);return function(n,i,a){r.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Ul=Tm,KT=0;function QT(){var e=new pr.W2;return e.parent=Tm,e.bind(xt.SceneID).toConstantValue("".concat(KT++)),e.bind(xt.IShaderModuleService).to(DA).inSingletonScope(),e.bind(xt.ILayerService).to(hm).inSingletonScope(),e.bind(xt.IDebugService).to(xp).inSingletonScope(),e.bind(xt.ISceneService).to(bA).inSingletonScope(),e.bind(xt.ICameraService).to(x).inSingletonScope(),e.bind(xt.ICoordinateSystemService).to(rd).inSingletonScope(),e.bind(xt.IInteractionService).to(_o).inSingletonScope(),e.bind(xt.IPickingService).to(S0).inSingletonScope(),e.bind(xt.IControlService).to(ce).inSingletonScope(),e.bind(xt.IMarkerService).to(He).inSingletonScope(),e.bind(xt.IIconService).to(ir).inSingletonScope(),e.bind(xt.IFontService).to(Vt).inSingletonScope(),e.bind(xt.IPopupService).to(Rt).inSingletonScope(),e.bind(xt.INormalPass).to(FA).whenTargetNamed("clear"),e.bind(xt.INormalPass).to(jA).whenTargetNamed("pixelPicking"),e.bind(xt.INormalPass).to(HT).whenTargetNamed("render"),e.bind(xt.INormalPass).to(qT).whenTargetNamed("taa"),e.bind(xt.IFactoryNormalPass).toFactory(function(t){return function(r){return t.container.getNamed(xt.INormalPass,r)}}),e.bind(xt.IPostProcessingPass).to(xT).whenTargetNamed("copy"),e.bind(xt.IPostProcessingPass).to(QA).whenTargetNamed("bloom"),e.bind(xt.IPostProcessingPass).to(iT).whenTargetNamed("blurH"),e.bind(xt.IPostProcessingPass).to(cT).whenTargetNamed("blurV"),e.bind(xt.IPostProcessingPass).to(LT).whenTargetNamed("noise"),e.bind(xt.IPostProcessingPass).to(zT).whenTargetNamed("sepia"),e.bind(xt.IPostProcessingPass).to(vT).whenTargetNamed("colorHalftone"),e.bind(xt.IPostProcessingPass).to(TT).whenTargetNamed("hexagonalPixelate"),e.bind(xt.IPostProcessingPass).to(IT).whenTargetNamed("ink"),e.bind(xt.IFactoryPostProcessingPass).toFactory(function(t){return function(r){var n=t.container.getNamed(xt.IPostProcessingPass,r);return n.setName(r),n}}),e}function lv(e){var t=new pr.W2;return t.parent=e,t.bind(xt.IStyleAttributeService).to(rv).inSingletonScope(),t.bind(xt.IMultiPassRenderer).to(zA).inSingletonScope(),t.bind(xt.IPostProcessor).to(ZT).inSingletonScope(),t}var JT=null;function sN(e){return JT.indexOf(e)}var X1=mi.clamp,ew=2,uN=4,tw=64,lN=128,rw=256,nw=512,cN=8192,fN=16384,hN=32768,iw=null,$1=131072,pN=262144,aw=524288,dN=1048576,ow=2097152,vN=4194304,sw=8388608,uw=16777216,lw=null;function L0(e,t){return e=X1(Math.floor(e),0,255),t=X1(Math.floor(t),0,255),256*e+t}function mN(e){var t=e.color,r=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,c=e.strokeWidth,p=e.strokeOpacity,y=[],b=[],A=[],w=[L0(t[0],t[1]),L0(t[2],t[3])],I=[L0(l[0],l[1]),L0(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(P){var L=_slicedToArray(P,2),V=L[0],K=L[1];y.push([].concat(w,[(V+1)*sw+(K+1)*ow+getShapeIndex(a)*$1+r,(n+512)*aw+(i+512)*tw])),b.push([].concat(I,[c,p])),A.push([s,0,0,0])}),{packedBuffer:y,packedBuffer2:b,packedBuffer3:A}}function gN(e,t){if(e===0&&!t)return 0;if(e===1&&t)return 4294967295;var r=t?1:0,n=Math.floor(e*127);return n*lw+r*uw+n*$1+r*iw+n*nw+r*rw+n*ew+r}var vd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Cs={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},ja=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),cv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Zn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),cw=["mapload","mapchange","mapAfterFrameChange"],B0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],wu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),fw=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c,p){n({x:r.x,y:r.y,z:r.z},function(y,b){if(y||b.length===0){p(y);return}b&&an([{data:b,bands:[0]}],i,a,function(A,w){A?p(A):w&&c(w)})})}));case 1:case"end":return l.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}(),hw=function(){var e=(0,St.Z)(Ae().mark(function t(r,n){return Ae().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:r.x,y:r.y,z:r.z},function(c,p){if(c||!p){l(c);return}p instanceof ArrayBuffer?ca(p,function(y,b){y&&l(y),s(b)}):p instanceof HTMLImageElement?s(p):l(c)})}));case 1:case"end":return a.stop()}},t)}));return function(r,n){return e.apply(this,arguments)}}();function pw(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return d(r,t)}):e.map(function(r){return{url:d(r.url,t),bands:r.bands||[0]}}):d(e,t)}function dw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(t){return{url:t,bands:[0]}}):e}function Y1(e,t){e.xhrCancel=function(){t.map(function(r){r.abort()})}}var vw=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a,s){var l,c,p,y,b,A;return Ae().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=dw(n.url),!(l.length>1)){I.next=15;break}return I.next=4,mw(l,n);case 4:if(c=I.sent,p=c.rasterFiles,y=c.xhrList,b=c.errList,Y1(r,y),!(b.length>0)){I.next=12;break}return i(b,null),I.abrupt("return");case 12:an(p,a,s,i),I.next=17;break;case 15:A=xo(n,function(P,L){if(P)i(P);else if(L){var V=[{data:L,bands:l[0].bands}];an(V,a,s,i)}}),Y1(r,[A]);case 17:case"end":return I.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}();function mw(e,t){return Jg.apply(this,arguments)}function Jg(){return Jg=(0,St.Z)(Ae().mark(function e(t,r){var n,i,a,s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<t.length)){P.next=20;break}return l=t[s],c=(0,O.Z)((0,O.Z)({},r),{},{url:l.url}),p=l.bands,P.next=10,yi((0,O.Z)((0,O.Z)({},c),{},{type:"arrayBuffer"}));case 10:y=P.sent,b=y.err,A=y.data,w=y.xhr,b&&a.push(b),i.push(w),n.push({data:A,bands:p});case 17:s++,P.next=4;break;case 20:return P.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return P.stop()}},e)})),Jg.apply(this,arguments)}var gw=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a,s){var l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l={url:pw(r,n)},p.abrupt("return",new Promise(function(y,b){vw(i,l,function(A,w){A?b(A):w&&y(w)},a,s)}));case 2:case"end":return p.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}(),q1=function(){var e=(0,St.Z)(Ae().mark(function t(r,n,i,a){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return l=Array.isArray(r)?r[0]:r,a.wmtsOptions?(c=(a==null?void 0:a.getURLFromTemplate)||g,s=c(l,(0,O.Z)((0,O.Z)({},n),a.wmtsOptions))):(p=(a==null?void 0:a.getURLFromTemplate)||d,s=p(l,n)),b.abrupt("return",new Promise(function(A,w){var I,P=Vs({url:s,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(L,V){L?w(L):V&&A(V)},a.transformResponse);i.xhrCancel=function(){return P.cancel()}}));case 3:case"end":return b.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}(),K1=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},yw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},yN=[wu.ARRAYBUFFER,wu.RGB];function _w(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function xw(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(_w(e))throw new Error("tile server url is error");var r=(t==null?void 0:t.dataType)||wu.IMAGE;r===wu.RGB&&(r=wu.ARRAYBUFFER);var n=function(s,l){switch(r){case wu.IMAGE:return q1(e,s,l,t);case wu.CUSTOMIMAGE:case wu.CUSTOMTERRAINRGB:return hw(l,t==null?void 0:t.getCustomData);case wu.ARRAYBUFFER:return gw(e,s,l,(t==null?void 0:t.format)||K1,t==null?void 0:t.operation);case wu.CUSTOMARRAYBUFFER:case wu.CUSTOMRGB:return fw(l,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||K1,t==null?void 0:t.operation);default:return q1(e,s,l,t)}},i=(0,O.Z)((0,O.Z)((0,O.Z)({},yw),t),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var bw=["extent","min","max","width","height","format","operation"];function Ew(e,t){var r=t.extent,n=t.min,i=t.max,a=t.width,s=t.height,l=t.format,c=t.operation,p=(0,gs.Z)(t,bw),y;if(l===void 0||Dc(e))y=Array.from(e);else{var b=Array.isArray(e)?e:[e];y=Cr(b,l,c)}var A={_id:1,dataArray:[(0,O.Z)((0,O.Z)({_id:1,data:y,width:a,height:s},p),{},{min:n,max:i,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return A}var Sw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Aw=function(){var e=(0,St.Z)(Ae().mark(function t(r){return Ae().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,re.Z)(r.bounds,4),l=s[0],c=s[1],p=s[2],y=s[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(l+p)/2,y:(c+y)/2},geometry:{type:"LineString",coordinates:[[p,y],[p,c],[l,c],[l,c]]}}]}}};a(b)}));case 1:case"end":return i.stop()}},t)}));return function(r){return e.apply(this,arguments)}}();function Tw(e,t){var r=function(a){return Aw(a)},n=(0,O.Z)((0,O.Z)((0,O.Z)({},Sw),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var ww=["extent","width","height"];function Cw(e,t){for(var r=t.extent,n=t.width,i=t.height,a=(0,gs.Z)(t,ww),s=a.bands,l=(0,re.Z)(s,3),c=l[0],p=l[1],y=l[2],b=[e[c],e[p],e[y]],A=[],w=(a==null?void 0:a.countCut)||[2,98],I=(0,re.Z)(w,2),P=I[0],L=I[1],V=(a==null?void 0:a.RMinMax)||cn(b[0],P,L),K=(a==null?void 0:a.GMinMax)||cn(b[1],P,L),le=(a==null?void 0:a.BMinMax)||cn(b[2],P,L),xe=0;xe<b[0].length;xe++)A.push(Math.max(0,b[0][xe]-V[0])),A.push(Math.max(0,b[1][xe]-K[0])),A.push(Math.max(0,b[2][xe]-le[0]));var ke={_id:1,dataArray:[(0,O.Z)((0,O.Z)({_id:1,data:A,width:n,height:i,rMinMax:V,gMinMax:K,bMinMax:le},a),{},{coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return ke}var Rw=Z(69848),Q1=Z.n(Rw);function J1(e,t){var r=t.radius,n=r===void 0?40:r,i=t.maxZoom,a=i===void 0?18:i,s=t.minZoom,l=s===void 0?0:s,c=t.zoom,p=c===void 0?2:c;if(e.pointIndex){var y=e.pointIndex.getClusters(e.extent,Math.floor(p));return e.dataArray=Mw(y),e}var b=new(Q1())({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(w){return{type:"Feature",geometry:{type:"Point",coordinates:w.coordinates},properties:(0,O.Z)({},w)}}),b.load(A.features),b}function Mw(e){return e.map(function(t,r){return(0,O.Z)({coordinates:t.geometry.coordinates,_id:r+1},t.properties)})}function Iw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function Pw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function ex(e){if(e.length===0)return 0;for(var t=e[0],r=0,n,i=1;i<e.length;i++)n=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?r+=t-n+e[i]:r+=e[i]-n+t,t=n;return t+r*1}function Ow(e){if(e.length===0)throw new Error("mean requires at least one data point");return ex(e)/e.length}var kw={min:Pw,max:Iw,mean:Ow,sum:ex};function Dw(e){var t=Lw();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function Lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bw=mi.cloneDeep,tx=mi.isFunction,Fw=mi.isString,Nw=mi.mergeWith;function Uw(e,t){if(Array.isArray(t))return t}var zw=function(e){(0,Je.Z)(r,e);var t=Dw(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,F.Z)((0,Be.Z)(a),"type","source"),(0,F.Z)((0,Be.Z)(a),"isTile",!1),(0,F.Z)((0,Be.Z)(a),"inited",!1),(0,F.Z)((0,Be.Z)(a),"hooks",{init:new th}),(0,F.Z)((0,Be.Z)(a),"parser",{type:"geojson"}),(0,F.Z)((0,Be.Z)(a),"transforms",[]),(0,F.Z)((0,Be.Z)(a),"cluster",!1),(0,F.Z)((0,Be.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,F.Z)((0,Be.Z)(a),"invalidExtent",!1),(0,F.Z)((0,Be.Z)(a),"dataArrayChanged",!1),(0,F.Z)((0,Be.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,Q.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,c=l===void 0?"sum":l,p=s.field,y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,y.forEach(function(b){b.id||(b.properties.point_count=1)}),(p||tx(c))&&(y=y.map(function(b){var A=b.id;if(A){var w=a.clusterIndex.getLeaves(A,Infinity),I=w.map(function(V){return V.properties}),P;if(Fw(c)&&p){var L=Wf(I,p);P=kw[c](L)}tx(c)&&(P=c(I)),b.properties.stat=P}else b.properties.point_count=1;return b})),this.data=ie("geojson")({type:"FeatureCollection",features:y}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,c=a.geometry;if(l==="geojson"&&!this.cluster){var p=i<this.originData.features.length?this.originData.features[i]:"null",y=Bw(p);if(y!=null&&y.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var b=this.data.dataArray.find(function(A){return A._id===i});y.properties=b}return y}else return l==="json"&&c?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,O.Z)((0,O.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s=this;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(p,y){try{s.excuteParser(),s.initCluster(),s.executeTrans(),p({})}catch(b){y(b)}}));case 1:case"end":return c.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=Nw(this.cfg,i,Uw);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,O.Z)((0,O.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=ie(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=_c(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Vf((0,O.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,c=ne(l)(i.data,s);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=J1(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=oa(Gs(this.extent),i)),a[0].concat(a[1])}}]),r}(ba.EventEmitter);function Zw(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function rx(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vw(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Vw(e,t){if(!!e){if(typeof e=="string")return nx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nx(e,t)}}function nx(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ey=6378e3;function jw(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,a=i/(2*Math.PI*ey)*(256<<20)/2,s=Hw(r,i),l=s.gridHash,c=s.gridOffset,p=$w(l,c,t);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:p}}function Hw(e,t){var r=Infinity,n=-Infinity,i,a=rx(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(r=i<r?i:r,n=i>n?i:n)}}catch(le){a.e(le)}finally{a.f()}var c=(r+n)/2,p=Ww(t,c);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};var y={},b=rx(e),A;try{for(b.s();!(A=b.n()).done;){var w=A.value,I=w.coordinates[1],P=w.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(P)){var L=Math.floor((I+90)/p.yOffset),V=Math.floor((P+180)/p.xOffset),K="".concat(L,"-").concat(V);y[K]=y[K]||{count:0,points:[]},y[K].count+=1,y[K].points.push(w)}}}catch(le){b.e(le)}finally{b.f()}return{gridHash:y,gridOffset:p}}function Ww(e,t){var r=Gw(e),n=Xw(t,e);return{yOffset:r,xOffset:n}}function Gw(e){return e/ey*(180/Math.PI)}function Xw(e,t){return t/ey*(180/Math.PI)/Math.cos(e*Math.PI/180)}function $w(e,t,r){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),c=parseInt(s[1],10),p={};if(r.field&&r.method){var y=ds(e[i].points,r.field);p[r.method]=Jc[r.method](y)}return Object.assign(p,{_id:a,coordinates:Ya([-180+t.xOffset*(c+.5),-90+t.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(p),n},[])}var fv=Math.PI/3,Yw=[0,fv,2*fv,3*fv,4*fv,5*fv];function qw(e){return e[0]}function Kw(e){return e[1]}function Qw(){var e=0,t=0,r=1,n=1,i=qw,a=Kw,s,l,c;function p(b){var A={},w=[],I,P=b.length;for(I=0;I<P;++I)if(!(isNaN(V=+i.call(null,L=b[I],I,b))||isNaN(K=+a.call(null,L,I,b)))){var L,V,K,le=Math.round(K=K/c),xe=Math.round(V=V/l-(le&1)/2),ke=K-le;if(Math.abs(ke)*3>1){var je=V-xe,it=xe+(V<xe?-1:1)/2,vt=le+(K<le?-1:1),Lt=V-it,lr=K-vt;je*je+ke*ke>Lt*Lt+lr*lr&&(xe=it+(le&1?1:-1)/2,le=vt)}var cr=xe+"-"+le,Rr=A[cr];Rr?Rr.push(L):(w.push(Rr=A[cr]=[L]),Rr.x=(xe+(le&1)/2)*l,Rr.y=le*c)}return w}function y(b){var A=0,w=0;return Yw.map(function(I){var P=Math.sin(I)*b,L=-Math.cos(I)*b,V=P-A,K=L-w;return A=P,w=L,[V,K]})}return p.hexagon=function(b){return"m"+y(b==null?s:+b).join("l")+"z"},p.centers=function(){for(var b=[],A=Math.round(t/c),w=Math.round(e/l),I=A*c;I<n+s;I+=c,++A)for(var P=w*l+(A&1)*l/2;P<r+l/2;P+=l)b.push([P,I]);return b},p.mesh=function(){var b=y(s).slice(0,4).join("l");return p.centers().map(function(A){return"M"+A+"m"+b}).join("")},p.x=function(b){return arguments.length?(i=b,p):i},p.y=function(b){return arguments.length?(a=b,p):a},p.radius=function(b){return arguments.length?(s=+b,l=s*2*Math.sin(fv),c=s*1.5,p):s},p.size=function(b){return arguments.length?(e=t=0,r=+b[0],n=+b[1],p):[r-e,n-t]},p.extent=function(b){return arguments.length?(e=+b[0][0],t=+b[0][1],r=+b[1][0],n=+b[1][1],p):[[e,t],[r,n]]},p.radius(1)}var Jw=6378e3;function e3(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,a=t.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*Jw)*(256<<20)/2,c=r.map(function(A){var w=Ya(A.coordinates),I=(0,re.Z)(w,2),P=I[0],L=I[1];return(0,O.Z)((0,O.Z)({},A),{},{coordinates:[P,L]})}),p=Qw().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),y=p(c),b={dataArray:y.map(function(A,w){var I;if(t.field&&s){var P=ds(A,t.field);A[s]=Jc[s](P)}return I={},(0,F.Z)(I,t.method,A[s]),(0,F.Z)(I,"count",A.length),(0,F.Z)(I,"rawData",A),(0,F.Z)(I,"coordinates",[A.x,A.y]),(0,F.Z)(I,"_id",w),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function t3(e,t){var r=t.sourceField,n=t.targetField,i=t.data,a={};return i.forEach(function(s){a[s[r]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,O.Z)((0,O.Z)({},s),a[l])}),e}function r3(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}De("rasterTile",xw),De("mvt",qr),De("geojsonvt",Qt),De("testTile",Tw),De("geojson",Xp),De("jsonTile",Ur),De("image",mr),De("csv",uf),De("json",Dl),De("raster",_r),De("rasterRgb",Ew),De("rgb",Cw),Ze("cluster",J1),Ze("filter",Zw),Ze("join",t3),Ze("map",r3),Ze("grid",jw),Ze("hexagon",e3);var ix=zw;function n3(e){var t=i3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ax=function(e){(0,Je.Z)(r,e);var t=n3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),(0,F.Z)((0,Be.Z)(i),"added",!1),(0,F.Z)((0,Be.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,O.Z)((0,O.Z)({},i.getDefault()),n),Rl(["update","onMove","onMapClick"],(0,Be.Z)(i)),i.init(),i}return(0,Q.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ra.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(xt.IMapService),this.sceneSerive=i.get(xt.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ws(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&Ws(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),el(a,"".concat(qu[s]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,c=l.lng,p=l.lat,y=this.mapsService.lngLatToContainer([c,p]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=b.containerHeight,w=b.containerWidth,I=b.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(y.x>w){var P=this.mapsService.lngLatToContainer([c-360,p]);y.x=P.x}if(y.x<0){var L=this.mapsService.lngLatToContainer([c+360,p]);y.x=L.x}}(y.x>w||y.x<0||y.y>A||y.y<0)&&(a.style.display="none"),a.style.left=y.x+s[0]+"px",a.style.top=y.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,c=s.anchor;if(!a){this.defaultMarker=!0,a=On("div"),this.markerOption.element=a;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","48px"),p.setAttributeNS(null,"width","48px"),p.setAttributeNS(null,"viewBox","0 0 1024 1024");var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),y.setAttributeNS(null,"fill",l),p.appendChild(y),a.appendChild(p)}cs(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var A,w,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((w=i.markerOption)===null||w===void 0?void 0:w.style[b]);a&&(a.style[b]=I)}),tu(a,c,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||vh()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),r}(ba.EventEmitter);function a3(e){var t=o3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s3=mi.merge,_N=function(e){(0,Je.Z)(r,e);var t=a3(r);function r(n){var i,a;return(0,ye.Z)(this,r),a=t.call(this),(0,F.Z)((0,Be.Z)(a),"markers",[]),(0,F.Z)((0,Be.Z)(a),"points",[]),(0,F.Z)((0,Be.Z)(a),"clusterMarkers",[]),a.markerLayerOption=s3(a.getDefault(),n),Rl(["update"],(0,Be.Z)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return(0,Q.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(xt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var i=this.mapsService.getContainer();this.containerSize={containerWidth:(i==null?void 0:i.scrollWidth)||0,containerHeight:(i==null?void 0:i.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;if(i.getMarkerLayerContainerSize=this.getContainerSize.bind(this),a&&(this.addPoint(i,this.markers.length),this.mapsService)){var s=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=oa(l,.5),this.zoom=Math.floor(s),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&(this.markers.splice(a,1),this.markerLayerOption.cluster&&(this.removePoint(a),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(i,a){var s=i.getLnglat(),l=s.lng,c=s.lat,p={geometry:{type:"Point",coordinates:[l,c]},properties:(0,O.Z)((0,O.Z)({},i.getExtData()),{},{marker_id:a})};this.points.push(p),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(i){var a=this.points.findIndex(function(s){return s.properties.marker_id===i});a>-1&&this.points.splice(a,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,s=i.minZoom,l=s===void 0?0:s,c=i.maxZoom;this.clusterIndex=new(Q1())({radius:a,minZoom:l,maxZoom:c}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var s=this,l=i[0].concat(i[1]),c=this.clusterIndex.getClusters(l,a);this.clusterMarkers.forEach(function(p){p.remove()}),this.clusterMarkers=[],c.forEach(function(p){var y,b=s.markerLayerOption.clusterOption,A=b.field,w=b.method;if((y=p.properties)!==null&&y!==void 0&&y.cluster_id){var I,P=s.getLeaves((I=p.properties)===null||I===void 0?void 0:I.cluster_id);if(p.properties.clusterData=P,A&&w){var L=P==null?void 0:P.map(function(ke){var je=(0,F.Z)({},A,ke.properties[A]);return je}),V=ds(L,A),K=Ys(w,V),le="point_"+w;p.properties[le]=K.toFixed(2)}}var xe=s.clusterMarker(p);s.clusterMarkers.push(xe),xe.addTo(s.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,s):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,s=a,l=s.element,c=l===void 0?this.generateElement.bind(this):l,p=new ax({element:c(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return p}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!Sc(this.bbox,a))&&(this.bbox=oa(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(i){var a=On("div","l7-marker-cluster"),s=On("div","",a),l=On("span","",s),c=this.markerLayerOption.clusterOption,p=c.field,y=c.method;i.properties.point_count=i.properties.point_count||1;var b=p&&y?i.properties["point_"+y]||i.properties[p]:i.properties.point_count;return l.textContent=b,a}}]),r}(ba.EventEmitter),xN=Z(4157);function u3(e){var t=l3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var md=function(e){(0,Je.Z)(r,e);var t=u3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),r.controlCount++,i.controlOption=(0,O.Z)((0,O.Z)({},i.getDefault(n)),n||{}),i}return(0,Q.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,re.Z)(s,2),c=l[0],p=l[1];p===void 0&&(i[c]=a[c])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,O.Z)((0,O.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(xt.IMapService),this.renderService=i.get(xt.IRendererService),this.layerService=i.get(xt.ILayerService),this.controlService=i.get(xt.IControlService),this.configService=i.get(xt.IGlobalConfigService),this.scene=i.get(xt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),cs(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ws(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return On("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;du(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;cs(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:E.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&du(a,s),i&&cs(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),r}(ko());(0,F.Z)(md,"controlCount",0);function c3(e){var t=f3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function f3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F0=function(e){(0,Je.Z)(r,e);var t=c3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"isDisable",!1),n}return(0,Q.Z)(r,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return On("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Ws(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var c;(c=this.button)===null||c===void 0||c.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(!!this.button)if(du(this.button,"l7-button-control--row"),du(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=On("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,cs(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Ws(this.buttonText),this.buttonText=void 0)}}]),r}(md);function h3(e){var t=p3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ox=function(e){(0,Je.Z)(r,e);var t=h3(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,F.Z)((0,Be.Z)(a),"isShow",!1),(0,F.Z)((0,Be.Z)(a),"timeout",null),(0,F.Z)((0,Be.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),du(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&r.conflictPopperList.forEach(function(s){s!==(0,Be.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,Be.Z)(a)}),(0,F.Z)((0,Be.Z)(a),"hide",function(){return a.isShow&&(cs(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,Be.Z)(a)}),(0,F.Z)((0,Be.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){!a.isShow||(a.hide(),a.timeout=null)},300))}),(0,F.Z)((0,Be.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,F.Z)((0,Be.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,F.Z)((0,Be.Z)(a),"onPopperUnClick",function(s){dh(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,F.Z)((0,Be.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,F.Z)((0,Be.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&r.conflictPopperList.push((0,Be.Z)(a)),a}return(0,Q.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(Gc(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ws(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,c=l===void 0?[0,0]:l,p=a.placement,y=(0,re.Z)(c,2),b=y[0],A=y[1],w=this.button.getBoundingClientRect(),I=s.getBoundingClientRect(),P=ma(w,I),L=P.left,V=P.right,K=P.top,le=P.bottom,xe=!1,ke=!1;/^(left|right)/.test(p)?(p.includes("left")?i.right="".concat(w.width+V,"px"):p.includes("right")&&(i.left="".concat(w.width+L,"px")),p.includes("start")?i.top="".concat(K,"px"):p.includes("end")?i.bottom="".concat(le,"px"):(i.top="".concat(K+w.height/2,"px"),ke=!0,i.transform="translate(".concat(b,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(p)&&(p.includes("top")?i.bottom="".concat(w.height+le,"px"):p.includes("bottom")&&(i.top="".concat(w.height+K,"px")),p.includes("start")?i.left="".concat(L,"px"):p.includes("end")?i.right="".concat(V,"px"):(i.left="".concat(L+w.width/2,"px"),xe=!0,i.transform="translate(calc(".concat(b,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(b,"px - ").concat(xe?"50%":"0%","), calc(").concat(A,"px - ").concat(ke?"50%":"0%",")");var je=p.split("-");je.length&&cs(this.popperDOM,je.map(function(it){return"l7-popper-".concat(it)}).join(" ")),tl(this.popperDOM,Wc(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,c=i.content,p=On("div","l7-popper l7-popper-hide ".concat(l)),y=On("div","l7-popper-content"),b=On("div","l7-popper-arrow");return p.appendChild(y),p.appendChild(b),a.appendChild(p),this.popperDOM=p,this.contentDOM=y,c&&this.setContent(c),p}}]),r}(ba.EventEmitter);(0,F.Z)(ox,"conflictPopperList",[]);function v3(e){var t=m3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function m3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g3={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},y3=function(e){(0,Je.Z)(r,e);var t=v3(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,ha.Z)((0,pe.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":g3[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,c=a.popperTrigger,p=this.mapsService.getMapContainer();return this.popper=new ox(this.button,{className:s,placement:l,trigger:c,container:p,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if((0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),r}(F0);function _3(e){var t=x3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function x3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gd=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(gd||{}),sx=function(e){(0,Je.Z)(r,e);var t=_3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"selectValue",[]),(0,F.Z)((0,Be.Z)(n),"createNormalOption",function(l){var c=n.selectValue.includes(l.value),p=On("div","l7-select-control-item ".concat(c?gd.ActiveOptionClassName:""));n.getIsMultiple()?p.appendChild(n.createCheckbox(c)):p.appendChild(n.createRadio(c)),l.icon&&p.appendChild(l.icon);var y=On("span");return y.innerText=l.text,p.appendChild(y),p}),(0,F.Z)((0,Be.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var c=n.selectValue.findIndex(function(p){return p===l.value});c>-1?n.selectValue.splice(c,1):n.selectValue=[].concat((0,Yt.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,Q.Z)(r,[{key:"setOptions",value:function(i){(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=this.transSelectValue(i);this.optionDOMList.forEach(function(l){var c=l.getAttribute(gd.OptionValueAttrKey),p=l.querySelector("input[type=checkbox]"),y=l.querySelector("input[type=radio]"),b=s.includes(c),A=function(I,P){qh(l,gd.ActiveOptionClassName,P),I&&dc(I,P)};A(p,b),A(y,b)}),this.selectValue=s,a&&this.emit("selectChange",this.getIsMultiple()?s:s[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=On("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&cs(l,"l7-select-control--multiple");var c=i.map(function(p,y){var b=s?a.createImageOption(p):a.createNormalOption(p);return b.setAttribute(gd.OptionValueAttrKey,p.value),b.setAttribute(gd.OptionIndexAttrKey,window.String(y)),b.addEventListener("click",a.onItemClick.bind(a,p)),b});return l.append.apply(l,(0,Yt.Z)(c)),this.optionDOMList=c,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=On("div","l7-select-control-item ".concat(a?gd.ActiveOptionClassName:"")),l=On("img");l.setAttribute("src",i.img),rl(l),s.appendChild(l);var c=On("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var p=On("span");return p.innerText=i.text,c.appendChild(p),s.appendChild(c),s}},{key:"createCheckbox",value:function(i){var a=On("input");return a.setAttribute("type","checkbox"),i&&dc(a,!0),a}},{key:"createRadio",value:function(i){var a=On("input");return a.setAttribute("type","radio"),i&&dc(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),r}(y3),Nh=function(t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),r.appendChild(n),r};function b3(e){var t=E3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function E3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S3=function(e){(0,Je.Z)(r,e);var t=b3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"onClick",(0,St.Z)(Ae().mark(function l(){var c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(c=n.controlOption.onExport,y.t0=c==null,y.t0){y.next=8;break}return y.t1=c,y.next=6,n.getImage();case 6:y.t2=y.sent,(0,y.t1)(y.t2);case 8:case"end":return y.stop()}},l)}))),(0,F.Z)((0,Be.Z)(n),"mergeImage",(0,St.Z)(Ae().mark(function l(){var c,p,y,b,A,w,I,P,L,V,K,le,xe,ke,je=arguments;return Ae().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:for(y=n.controlOption.imageType,b=(c=(p=n.mapsService.getContainer())===null||p===void 0?void 0:p.getBoundingClientRect())!==null&&c!==void 0?c:{},A=b.width,w=A===void 0?0:A,I=b.height,P=I===void 0?0:I,L=document.createElement("canvas"),L.width=w,L.height=P,V=L.getContext("2d"),K=je.length,le=new Array(K),xe=0;xe<K;xe++)le[xe]=je[xe];return vt.next=9,Promise.all(le.map(function(Lt){return new Promise(function(lr){var cr=new Image;cr.onload=function(){lr(cr)},cr.src=Lt})}));case 9:return ke=vt.sent,ke.forEach(function(Lt){V==null||V.drawImage(Lt,0,0,w,P)}),vt.abrupt("return",L.toDataURL("image/".concat(y)));case 12:case"end":return vt.stop()}},l)}))),n}return(0,Q.Z)(r,[{key:"onAdd",value:function(){var i=(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Nh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.mapsService.exportMap("png");case 2:return s=p.sent,p.next=5,this.scene.exportPng("png");case 5:return l=p.sent,p.abrupt("return",this.mergeImage.apply(this,(0,Yt.Z)([s,l].filter(function(y){return y}))));case 7:case"end":return p.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(F0);function A3(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=T3(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function T3(e,t){if(!!e){if(typeof e=="string")return ux(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ux(e,t)}}function ux(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var lx=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Uh=function(){if(typeof document=="undefined")return!1;for(var e=lx[0],t={},r=0,n=lx;r<n.length;r++){var i=n[r],a=i==null?void 0:i[1];if(a in document){var s=A3(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var c=(0,re.Z)(l.value,2),p=c[0],y=c[1];t[e[p]]=y}}catch(b){s.e(b)}finally{s.f()}return t}}return!1}(),cx={change:Uh.fullscreenchange,error:Uh.fullscreenerror},uc={request:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){uc.off("change",l),n()};uc.on("change",a);var s=t[Uh.requestFullscreen](r);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(t,r){if(!uc.isFullscreen){t();return}var n=function a(){uc.off("change",a),t()};uc.on("change",n);var i=document[Uh.exitFullscreen]();i instanceof Promise&&i.then(n).catch(r)})},toggle:function(t,r){return uc.isFullscreen?uc.exit():uc.request(t,r)},onchange:function(t){uc.on("change",t)},onerror:function(t){uc.on("error",t)},on:function(t,r){var n=cx[t];n&&document.addEventListener(n,r,!1)},off:function(t,r){var n=cx[t];n&&document.removeEventListener(n,r,!1)},raw:Uh};Object.defineProperties(uc,{isFullscreen:{get:function(){return Boolean(document[Uh.fullscreenElement])}},element:{enumerable:!0,get:function(){var t;return(t=document[Uh.fullscreenElement])!==null&&t!==void 0?t:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Uh.fullscreenEnabled])}}}),Uh||(uc={isEnabled:!1});var ty=uc;function w3(e){var t=C3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R3=function(e){(0,Je.Z)(r,e);var t=w3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this,n),(0,F.Z)((0,Be.Z)(i),"isFullscreen",!1),(0,F.Z)((0,Be.Z)(i),"toggleFullscreen",(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!ty.isEnabled){l.next=3;break}return l.next=3,ty.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,F.Z)((0,Be.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,F.Z)((0,Be.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,c=a.title,p=a.exitBtnText,y=a.exitBtnIcon,b=a.exitTitle;i.isFullscreen?(i.setBtnTitle(b),i.setBtnText(p),i.setBtnIcon(y)):(i.setBtnTitle(c),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),ty.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,Q.Z)(r,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Lu(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){(0,ha.Z)((0,pe.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Nh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Nh("l7-icon-exit-fullscreen")})}}]),r}(F0);function M3(e){var t=I3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function I3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P3=function(e){(0,Je.Z)(r,e);var t=M3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this,n),(0,F.Z)((0,Be.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var c=l.coords,p=c!=null?c:{},y=p.longitude,b=p.latitude;!isNaN(y)&&!isNaN(b)?a([y,b]):s()},function(l){s(l)})})}),(0,F.Z)((0,Be.Z)(i),"onClick",(0,St.Z)(Ae().mark(function a(){var s,l,c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(window.navigator.geolocation){y.next=2;break}return y.abrupt("return");case 2:return s=i.controlOption.transform,y.next=5,i.getGeoLocation();case 5:if(l=y.sent,c=i.mapsService.getZoom(),y.t0=i.mapsService,y.t1=c>15?c:15,!s){y.next=15;break}return y.next=12,s(l);case 12:y.t2=y.sent,y.next=16;break;case 15:y.t2=l;case 16:y.t3=y.t2,y.t0.setZoomAndCenter.call(y.t0,y.t1,y.t3);case 18:case"end":return y.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,Q.Z)(r,[{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Nh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),r}(F0);function O3(e){var t=k3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function k3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function fx(e){return Object.keys(e!=null?e:{}).every(function(t){return["layer","name","img"].includes(t)})}var hx=function(e){(0,Je.Z)(r,e);var t=O3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,F.Z)((0,Be.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,F.Z)((0,Be.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var c=n.selectValue.includes(l.name),p=l.isVisible();c&&!p&&l.show(),!c&&p&&l.hide()})}),n}return(0,Q.Z)(r,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(fx(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var c=i.getLayer(l)||i.getLayerByName(l);c&&s.push(c)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){var a;return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Nh("l7-icon-layer"),options:[],multiple:(a=i==null?void 0:i.multiple)!==null&&a!==void 0?a:!0})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(fx(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var c=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:c==null?void 0:c.name,value:c==null?void 0:c.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers","multiple"]);(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i),a&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return this.controlOption.multiple===!1&&this.layers.forEach(function(a,s){s===0?a.show():a.hide()}),(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),r}(sx);function D3(e){var t=L3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function L3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var px=function(e){(0,Je.Z)(r,e);var t=D3(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getDefault",value:function(){return{position:E.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=On("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(Gc(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,c=On("img");if(c.setAttribute("src",l),c.setAttribute("aria-label","AntV logo"),rl(c),s){var p=On("a","l7-control-logo-link");p.target="_blank",p.href=s,p.rel="noopener nofollow",p.setAttribute("rel","noopener nofollow"),p.appendChild(c),i.appendChild(p)}else i.appendChild(c)}}]),r}(md),B3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},F3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function N3(e){var t=U3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function U3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z3=function(e){(0,Je.Z)(r,e);var t=N3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,Q.Z)(r,[{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Nh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?F3:B3;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,re.Z)(a,2),l=s[0],c=s[1];return typeof c=="string"&&l!=="blank"}).map(function(a){var s,l=(0,re.Z)(a,2),c=l[0],p=l[1],y=(s=i[c])!==null&&s!==void 0?s:{},b=y.text,A=y.img;return{text:b!=null?b:c,value:p,img:A,key:c}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,c=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(y){return y.key===c}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:c}else{var p=this.getMapStyle();p?this.controlOption.defaultValue=p:this.mapsService.map.once("styledata",function(){var y=a.mapsService.getMapStyle();a.controlOption.defaultValue=y,a.setSelectValue(y,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,ha.Z)((0,pe.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(sx);function Z3(e){var t=V3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j3=function(e){(0,Je.Z)(r,e);var t=Z3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"location",[0,0]),(0,F.Z)((0,Be.Z)(n),"onMouseMove",function(l){var c=n.location,p=l.lngLat||l.lnglat,y=n.controlOption.transform;p&&(c=[p.lng,p.lat]),n.location=c,y&&(c=y(c)),n.insertLocation2HTML(c),n.emit("locationChange",c)}),n}return(0,Q.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{position:E.BOTTOMLEFT,transform:function(s){var l=(0,re.Z)(s,2),c=l[0],p=l[1];return[+(+c).toFixed(6),+(+p).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=On("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),r}(md);function H3(e){var t=W3();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function W3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3=function(e){(0,Je.Z)(r,e);var t=H3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"update",function(){var l=n.mapsService,c=n.controlOption.maxWidth,p=l.getSize()[1]/2,y=l.containerToLngLat([0,p]),b=l.containerToLngLat([c,p]),A=gh([y.lng,y.lat],[b.lng,b.lat]);n.updateScales(A)}),n}return(0,Q.Z)(r,[{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:E.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=On("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){Gc(i);var a=this.controlOption,s=a.metric,l=a.imperial,c=a.maxWidth,p=a.lockWidth;p&&tl(i,"width: ".concat(c,"px")),s&&(this.mScale=On("div","l7-control-scale-line",i)),l&&(this.iScale=On("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,c;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(c=this.getRoundNum(a),this.updateScale(this.iScale,c+" ft",c/a))}}]),r}(md),wp,dx=(wp={},(0,F.Z)(wp,Ut.additive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(wp,Ut.none,{enable:!1}),(0,F.Z)(wp,Ut.normal,{enable:!0,func:{srcRGB:Y.SRC_ALPHA,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(wp,Ut.subtractive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:Y.ZERO,dstAlpha:Y.ONE_MINUS_SRC_COLOR},equation:{rgb:Y.FUNC_SUBTRACT,alpha:Y.FUNC_SUBTRACT}}),(0,F.Z)(wp,Ut.max,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MAX_EXT}}),(0,F.Z)(wp,Ut.min,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MIN_EXT}}),wp);function vx(e){return e.map(function(t){return typeof t=="string"&&(t=[t,{}]),t})}function mx(e,t,r,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),vx(t).forEach(function(l){var c=(0,re.Z)(l,2),p=c[0],y=c[1];i.add(r(p),y)}),i.add(r("copy")),i}var X3=function(){function e(t){(0,ye.Z)(this,e),this.layer=t}return(0,Q.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),i=n.get(xt.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(r);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var i=this.layer.getContainer(),a=i.get(xt.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),a.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,i){var a=this.layer.getContainer(),s=a.get(xt.IPickingService),l=a.get(xt.IMapService),c=this.layer.getSource().extent,p=Nu(n.lngLat,c),y={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},b=i||r;if(p){var A=this.readRasterValue(r,c,l,n.x,n.y);return y.rasterValue=A,s.triggerHoverOnLayer(b,y),!0}else return y.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(b,(0,O.Z)((0,O.Z)({},y),{},{type:"unpick"})),s.triggerHoverOnLayer(b,y),!1}},{key:"readRasterValue",value:function(r,n,i,a,s){var l=r.getSource().data.dataArray[0],c=(0,re.Z)(n,4),p=c[0],y=p===void 0?0:p,b=c[1],A=b===void 0?0:b,w=c[2],I=w===void 0?10:w,P=c[3],L=P===void 0?-10:P,V=i.lngLatToContainer([y,A]),K=i.lngLatToContainer([I,L]),le=K.x-V.x,xe=V.y-K.y,ke=[(a-V.x)/le,(s-K.y)/xe],je=l.width||1,it=l.height||1,vt=Math.floor(ke[0]*je),Lt=Math.floor(ke[1]*it),lr=Math.max(0,Lt-1)*je+vt,cr=l.data[lr];return cr}},{key:"selectFeature",value:function(r){var n=this.layer,i=(0,re.Z)(r,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,re.Z)(r,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),$3=function(){function e(t){(0,ye.Z)(this,e),this.layer=t;var r=this.layer.getContainer();this.rendererService=r.get(xt.IRendererService)}return(0,Q.Z)(e,[{key:"getColorTexture",value:function(r,n){var i=this.getTextureKey(r,n);return this.key===i?this.colorTexture:(this.createColorTexture(r,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(r,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(r,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return jo(r);case"quantize":return Pu(r);case"custom":return Rs(r,n);case"linear":return Jo(r,n);default:return aa(r)}}},{key:"getTextureKey",value:function(r,n){var i;return"".concat(r.colors.join("_"),"_").concat(r==null||(i=r.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),Y3=["passes"],q3=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],gx,ry,yx;function K3(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Q3(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Q3(e,t){if(!!e){if(typeof e=="string")return _x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _x(e,t)}}function _x(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function J3(e){var t=eC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ny=mi.isEqual,xx=mi.isFunction,bx=mi.isNumber,Cu=mi.isObject,tC=mi.isPlainObject,rC=mi.isUndefined,Ex=0,Cp=(gx=Qg(xt.IGlobalConfigService),ry=function(e){(0,Je.Z)(r,e);var t=J3(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ye.Z)(this,r),n=t.call(this),(0,F.Z)((0,Be.Z)(n),"id","".concat(Ex++)),(0,F.Z)((0,Be.Z)(n),"name","".concat(Ex)),(0,F.Z)((0,Be.Z)(n),"visible",!0),(0,F.Z)((0,Be.Z)(n),"zIndex",0),(0,F.Z)((0,Be.Z)(n),"inited",!1),(0,F.Z)((0,Be.Z)(n),"layerModelNeedUpdate",!1),(0,F.Z)((0,Be.Z)(n),"pickedFeatureID",null),(0,F.Z)((0,Be.Z)(n),"selectedFeatureID",null),(0,F.Z)((0,Be.Z)(n),"styleNeedUpdate",!1),(0,F.Z)((0,Be.Z)(n),"forceRender",!1),(0,F.Z)((0,Be.Z)(n),"clusterZoom",0),(0,F.Z)((0,Be.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,F.Z)((0,Be.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,F.Z)((0,Be.Z)(n),"hooks",{init:new mA,afterInit:new s_,beforeRender:new s_,beforeRenderData:new gA,afterRender:new th,beforePickingEncode:new th,afterPickingEncode:new th,beforeHighlight:new th(["pickedColor"]),afterHighlight:new th,beforeSelect:new th(["pickedColor"]),afterSelect:new th,beforeDestroy:new th,afterDestroy:new th}),(0,F.Z)((0,Be.Z)(n),"models",[]),(0,F.Z)((0,Be.Z)(n),"startInit",!1),(0,F.Z)((0,Be.Z)(n),"layerChildren",[]),(0,F.Z)((0,Be.Z)(n),"masks",[]),Ir((0,Be.Z)(n),"configService",yx,(0,Be.Z)(n)),(0,F.Z)((0,Be.Z)(n),"animateOptions",{enable:!1}),(0,F.Z)((0,Be.Z)(n),"currentPickId",null),(0,F.Z)((0,Be.Z)(n),"encodeStyleAttribute",{}),(0,F.Z)((0,Be.Z)(n),"enableShaderEncodeStyles",[]),(0,F.Z)((0,Be.Z)(n),"enableDataEncodeStyles",[]),(0,F.Z)((0,Be.Z)(n),"enablg",[]),(0,F.Z)((0,Be.Z)(n),"pendingStyleAttributes",[]),(0,F.Z)((0,Be.Z)(n),"scaleOptions",{}),(0,F.Z)((0,Be.Z)(n),"animateStatus",!1),(0,F.Z)((0,Be.Z)(n),"isDestroyed",!1),(0,F.Z)((0,Be.Z)(n),"uniformBuffers",[]),(0,F.Z)((0,Be.Z)(n),"encodeDataLength",0),(0,F.Z)((0,Be.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,Q.Z)(r,[{key:"addMask",value:function(i){this.masks.push(i),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,O.Z)((0,O.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(xt.SceneID);this.configService.setLayerConfig(s,this.id,(0,O.Z)((0,O.Z)((0,O.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s=this,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:l=this.container.get(xt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(xt.IIconService),this.fontService=this.container.get(xt.IFontService),this.rendererService=this.container.get(xt.IRendererService),this.layerService=this.container.get(xt.ILayerService),this.debugService=this.container.get(xt.IDebugService),this.interactionService=this.container.get(xt.IInteractionService),this.pickingService=this.container.get(xt.IPickingService),this.mapService=this.container.get(xt.IMapService),c=this.getLayerConfig(),p=c.enableMultiPassRenderer,y=c.passes,p&&y!==null&&y!==void 0&&y.length&&y.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(xt.ICameraService),this.coordinateService=this.container.get(xt.ICoordinateSystemService),this.shaderModuleService=this.container.get(xt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(xt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(xt.IFactoryNormalPass),this.styleAttributeService=this.container.get(xt.IStyleAttributeService),p&&(this.multiPassRenderer=this.container.get(xt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(L){var V=L.attributeName,K=L.attributeField,le=L.attributeValues,xe=L.updateOptions;s.styleAttributeService.updateStyleAttribute(V,{scale:(0,O.Z)({field:K},s.splitValuesAndCallbackInAttribute(le,K?void 0:s.getLayerConfig()[V]))},xe)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(xt.ILayerPlugin),b=K3(this.plugins);try{for(b.s();!(A=b.n()).done;)w=A.value,w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(L){b.e(L)}finally{b.f()}return this.layerPickService=new X3(this),this.textureService=new $3(this),this.log(Cs.LayerInitStart),P.next=31,this.hooks.init.promise();case 31:this.log(Cs.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),c={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,c)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Cu(i)?(a.enable=!0,a=(0,O.Z)((0,O.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(Cs.SourceInitStart,hr.UPDATE),this.layerSource.setData(i,a),this.log(Cs.SourceInitEnd,hr.UPDATE)):this.on("inited",function(){s.log(Cs.SourceInitStart,hr.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new ix(i,a)),s.layerSource.once("update",function(){s.log(Cs.SourceInitEnd,hr.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,gs.Z)(i,Y3);s&&vx(s).forEach(function(p){var y=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);y&&y.updateOptions(p[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var c=l;return Object.keys(l).forEach(function(p){var y=l[p];Array.isArray(y)&&y.length===2&&!bx(y[0])&&!bx(y[1])&&(c[p]={field:y[0],value:y[1]})}),this.encodeStyle(c),this.updateLayerConfig(c),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,Yt.Z)(a.enableShaderEncodeStyles),(0,Yt.Z)(a.enableDataEncodeStyles)).includes(s)&&tC(i[s])&&(i[s].field||i[s].value)&&!ny(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,O.Z)({},this.scaleOptions);if(Cu(i)?this.scaleOptions=(0,O.Z)((0,O.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!ny(s,this.scaleOptions)){var l=Cu(i)?i:(0,F.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Cu(i)?!0:i,Cu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Cu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,y=p===void 0?0:p;this.updateLayerConfig({highlightColor:Cu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Cu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Cu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Cu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ma(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Cu(i)?!0:i,Cu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Cu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,y=p===void 0?0:p;this.updateLayerConfig({selectColor:Cu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Cu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Cu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Cu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ma(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,c=l===void 0?-Infinity:l,p=a.maxZoom,y=p===void 0?Infinity:p;return!!s&&i>=c&&i<y}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,c=l===void 0?[]:l;this.multiPassRenderer=mx(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var p=this.rendererService.getViewportSize(),y=p.width,b=p.height;this.multiPassRenderer.resize(y,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(c){return Math.abs(c)===Infinity});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,c,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var y=this.getLayerConfig(),b=y.maskfence;b&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(p),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(c=this.debugService)===null||c===void 0||c.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var c=l.type;if(a.coordCenter===void 0){var p,y=a.layerSource.center;a.coordCenter=y,(p=a.mapService)!==null&&p!==void 0&&p.setCoordCenter&&a.mapService.setCoordCenter(y)}if(c==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,c=this.styleAttributeService.getLayerStyleAttribute(i),p=(c==null||(a=c.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=p[0].option)===null||s===void 0?void 0:s.type,field:c==null||(l=c.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(p){return(0,F.Z)({value:a.invertExtent(p)},i,p)});return s}else if(a.ticks){var l=a.ticks().map(function(p){return(0,F.Z)({value:p},i,a(p))});return l}else if(a!=null&&a.domain){var c=a.domain().filter(function(p){return!rC(p)}).map(function(p){return(0,F.Z)({value:p},i,a(p))});return c}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l=this,c,p,y,b,A,w,I,P,L,V,K,le;return Ae().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return c=s.moduleName,p=s.vertexShader,y=s.fragmentShader,b=s.inject,A=s.triangulation,w=s.styleOption,I=(0,gs.Z)(s,q3),this.shaderModuleService.registerModule(c,{vs:p,fs:y,inject:b}),P=this.shaderModuleService.getModule(c),L=P.vs,V=P.fs,K=P.uniforms,le=this.rendererService.createModel,ke.abrupt("return",new Promise(function(je){var it=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,w),vt=it.attributes,Lt=it.elements,lr=it.count,cr=(0,O.Z)({attributes:vt,uniforms:K,fs:V,vs:L,elements:Lt,blend:dx[Ut.normal],uniformBuffers:[].concat((0,Yt.Z)(l.layerModel.uniformBuffers),(0,Yt.Z)(l.rendererService.uniformBuffers),[l.getLayerUniformBuffer(),l.getPickingUniformBuffer()]),textures:l.layerModel.textures},I);lr&&(cr.count=lr);var Rr=le(cr);je(Rr)}));case 5:case"end":return ke.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,c=a.enableSelect,p=c===void 0?!0:c,y=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&p&&(y=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(y=!0),this.isVisible()&&y}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,s.render();case 2:case"end":return c.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a),textures:i.layerModel.textures},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var c=this.configService.getAttributeConfig(this.id)||{};return ny(c[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,F.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,O.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.models.forEach(function(y){return y.destroy()}),this.models=[],this.uniformBuffers.forEach(function(y){y.destroy()}),this.uniformBuffers=[],s=this.rendererService.createBuffer({data:new Float32Array(16+4).fill(0),isUBO:!0}),this.uniformBuffers.push(s),l=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(l),p.next=10,this.layerModel.initModels();case 10:this.models=p.sent;case 11:case"end":return p.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:xx(i)?void 0:i,callback:xx(i)?i:void 0}}}]),r}(ba.EventEmitter),yx=mn(ry.prototype,"configService",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry);function nC(e,t){return{enable:e,mask:255,func:{cmp:Y.EQUAL,ref:t?1:0,mask:1}}}function Sx(e){return e.maskOperation===ar.OR?{enable:!0,mask:255,func:{cmp:Y.ALWAYS,ref:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Kt.SINGLE||e.stencilIndex===0?Y.ALWAYS:Y.LESS,ref:e.stencilType===Kt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}}var ni=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function iC(e){switch(e){case"rotation":return{name:"Rotation",type:Zn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:ni.ROTATION,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r){var n=r.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Zn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:ni.STROKE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(r){var n=r.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Zn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:ni.OPACITY,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r){var n=r.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Zn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:ni.EXTRUSION_BASE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r){var n=r.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Zn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:ni.OFFSETS,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Zn.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r){var n=r.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var aC={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},N0={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function bN(e){var t="";return Object.keys(e).forEach(function(r){var n=e[r];Array.isArray(n)?t+="vec".concat(n.length," ").concat(r,`;
`):t+="flot ".concat(r,`;
`)}),t}function Ax(e){return Math.max(Math.ceil(e/4)*4,4)}var Tx,iy,Cx,ay={opacity:ni.OPACITY,stroke:ni.STROKE,offsets:ni.OFFSETS,rotation:ni.ROTATION,extrusionBase:ni.EXTRUSION_BASE,thetaOffset:15},Da=(Tx=Qg(xt.IGlobalConfigService),iy=function(){function e(t){(0,ye.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"textures",[]),(0,F.Z)(this,"preStyleAttribute",{}),(0,F.Z)(this,"encodeStyleAttribute",{}),Ir(this,"configService",Cx,this),this.layer=t,this.rendererService=t.getContainer().get(xt.IRendererService),this.pickingService=t.getContainer().get(xt.IPickingService),this.shaderModuleService=t.getContainer().get(xt.IShaderModuleService),this.styleAttributeService=t.getContainer().get(xt.IStyleAttributeService),this.mapService=t.getContainer().get(xt.IMapService),this.iconService=t.getContainer().get(xt.IIconService),this.fontService=t.getContainer().get(xt.IFontService),this.cameraService=t.getContainer().get(xt.ICameraService),this.layerService=t.getContainer().get(xt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,Q.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,i=n===void 0?"normal":n;return dx[Ut[i]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,c=n.enableMask,p=n.maskOperation,y=p===void 0?ar.AND:p;if(this.layer.type==="MaskLayer")return Sx({isStencil:!0,stencilType:Kt.SINGLE});if(r.isStencil)return Sx((0,O.Z)((0,O.Z)({},r),{},{maskOperation:y}));var b=a||c&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return nC(b,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var r=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var i=(0,O.Z)((0,O.Z)({},n.uniformsOption),r.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var t=(0,St.Z)(Ae().mark(function n(){return Ae().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var t=(0,St.Z)(Ae().mark(function n(){return Ae().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var t=(0,St.Z)(Ae().mark(function n(){return Ae().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){r[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(N0[l]," u_").concat(l,";"));var c=ay[l];!c&&l==="THETA_OFFSET"&&(c=15),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(ay[l],") in ").concat(N0[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(N0[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(N0[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var r=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!r.layer.encodeStyleAttribute[i]){var a=r.layer.getLayerConfig()[i],s=typeof a=="undefined"?aC[i]:a;i==="stroke"&&(s=fi(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=iC(n);i&&(r.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=ay[n]))})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}},{key:"initUniformsBuffer",value:function(){var r=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();r.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ax(r.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),n.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ax(n.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(r){var n=0,i=[];return Object.values(r).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,Yt.Z)(a)),n+=a.length):typeof a=="number"?(i.push(a),n+=1):typeof a=="boolean"&&(i.push(Number(a)),n+=1)}),{uniformsOption:r,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var r,n,i=this.getUniformsBufferInfo(this.getStyleAttribute()),a=i.uniformsArray,s=this.getCommonUniformsInfo(),l=s.uniformsArray;(r=this.attributeUnifoms)===null||r===void 0||r.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)}),(n=this.commonUnifoms)===null||n===void 0||n.subData({offset:0,data:new Uint8Array(new Float32Array(l).buffer)})}}]),e}(),Cx=mn(iy.prototype,"configService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iy),Rx=100,EN=36,SN=40;function Mx(e){return e/180*Math.acos(-1)}function Ix(e){var t=Mx(e[0])+Math.PI/2,r=Mx(e[1]),n=Rx+Math.random()*.4,i=n*Math.cos(r)*Math.cos(t),a=n*Math.cos(r)*Math.sin(t),s=n*Math.sin(r);return[a,s,i]}function AN(e,t){var r=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);t=t||{},e=typeof e!="undefined"?e:1;for(var s=typeof t.segments!="undefined"?t.segments:32,l=2+s,c=2*l,p=[],y=[],b=[],A=[],w=[],I=[],P=0;P<=l;P++){for(var L=P/l,V=L*Math.PI,K=0;K<=c;K++){var le=K/c,xe=le*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-V),mat4.identity(r),mat4.rotateY(r,r,xe),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,r),vec3.scale(a,a,-e),b.push(a.slice()),A.push.apply(A,_toConsumableArray(a.slice())),vec3.normalize(a,a),w.push.apply(w,_toConsumableArray(a.slice())),I.push([le,1-L]),A.push(le,1-L)}if(P>0)for(var ke=b.length,je=ke-2*(c+1);je+c+2<ke;je++)p.push([je,je+1,je+c+1]),y.push(je,je+1,je+c+1),p.push([je+c+1,je+1,je+c+2]),y.push(je+c+1,je+1,je+c+2)}return{cells:p,positions:b,uvs:I,positionsArr:A,indicesArr:y,normalArr:w}}var U0=Mr.create(),TN=Mr.create(),Ns=Mr.create(),Rp=Mr.create(),hv=Mr.create();function oy(e,t,r,n,i){Mr.add(e,r,n),Mr.normalize(e,e),t=Mr.fromValues(-e[1],e[0]);var a=Mr.fromValues(-r[1],r[0]);return[i/Mr.dot(t,a),t]}function Mp(e,t){return Mr.set(e,-t[1],t[0])}function pv(e,t,r){return Mr.sub(e,t,r),Mr.normalize(e,e),e}function sy(e,t){return e[0]===t[0]&&e[1]===t[1]}function wN(e){for(var t=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();t.get(n)?(e.splice(r,1),r++):t.set(n,n)}return e}var oC=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ye.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Mr.fromValues(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Q.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],c=r[s],p=s<r.length-1?r[s+1]:null,y=this.simpleSegment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var c,p,y,b=r[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=r[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<r.length-1?[].concat((0,Yt.Z)(r[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,L=l<n.length-1?n[l+1]:null,V=this.simpleSegment(i,s,b,w,P,A,I,L);s+=V}if(this.dash)for(var K=0;K<i.positions.length/6;K++)i.positions[K*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var c,p,y,b=r[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=r[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<r.length-1?[].concat((0,Yt.Z)(r[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,L=l<n.length-1?n[l+1]:null,V=this.segment_gaode2(i,s,b,w,P,A,I,L);s+=V}if(this.dash)for(var K=0;K<i.positions.length/6;K++)i.positions[K*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],c=r[s],p=s<r.length-1?r[s+1]:null,y=this.segment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,i,a,s){var l=0,c=r.indices,p=r.positions,y=r.normals,b=Ya([a[0],a[1]]),A=Ya([i[0],i[1]]);pv(Ns,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Mr.create(),Mp(this.normal,Ns)),this.started||(this.started=!0,this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!s)Mp(this.normal,Ns),this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Ya([s[0],s[1]]);sy(b,I)&&Mr.add(I,b,Mr.normalize(I,Mr.subtract(I,b,A))),pv(Rp,I,b);var P=oy(hv,Mr.create(),Ns,Rp,this.thickness),L=(0,re.Z)(P,2),V=L[0],K=L[1],le=Mr.dot(hv,this.normal)<0?-1:1;this.extrusions(p,y,a,K,V,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),le=-1,Mr.copy(this.normal,K),l+=2,this.lastFlip=le}return l}},{key:"segment_gaode2",value:function(r,n,i,a,s,l,c,p){var y=0,b=r.indices,A=r.positions,w=r.normals,I=this.cap==="square",P=this.join==="bevel",L=Ya([c[0],c[1]]),V=Ya([l[0],l[1]]);pv(Ns,a,i);var K=0;if(this.dash&&(K=this.lineSegmentDistance(L,V),this.totalDistance+=K),this.normal||(this.normal=Mr.create(),Mp(this.normal,Ns)),!this.started)if(this.started=!0,I){var le=Mr.create(),xe=Mr.create();Mr.add(le,this.normal,Ns),Mr.add(xe,this.normal,Ns),w.push(xe[0],xe[1],0),w.push(le[0],le[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-K,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-K,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-K);if(b.push(n+0,n+1,n+2),s){sy(a,s)&&Mr.add(s,a,Mr.normalize(s,Mr.subtract(s,a,i))),pv(Rp,s,a);var it=oy(hv,Mr.create(),Ns,Rp,this.thickness),vt=(0,re.Z)(it,2),Lt=vt[0],lr=vt[1],cr=Mr.dot(hv,this.normal)<0?-1:1,Rr=P;if(!Rr&&this.join==="miter"){var fn=Lt;fn>this.miterLimit&&(Rr=!0)}Rr?(w.push(this.normal[0],this.normal[1],0),w.push(lr[0],lr[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Yt.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Mp(U0,Rp),Mr.copy(this.normal,U0),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*cr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(A,w,a,lr,Lt,this.totalDistance),b.push.apply(b,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,Mr.copy(this.normal,lr),y+=2),this.lastFlip=cr}else{if(Mp(this.normal,Ns),I){var ke=Mr.create(),je=Mr.create();Mr.sub(je,Ns,this.normal),Mr.add(ke,Ns,this.normal),w.push(je[0],je[1],0),w.push(ke[0],ke[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"segment",value:function(r,n,i,a,s){var l=0,c=r.indices,p=r.positions,y=r.normals,b=this.cap==="square",A=this.join==="bevel",w=Ya([a[0],a[1]]),I=Ya([i[0],i[1]]);pv(Ns,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Mr.create(),Mp(this.normal,Ns)),!this.started)if(this.started=!0,b){var L=Mr.create(),V=Mr.create();Mr.add(L,this.normal,Ns),Mr.add(V,this.normal,Ns),y.push(V[0],V[1],0),y.push(L[0],L[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),s){var xe=Ya([s[0],s[1]]);sy(w,xe)&&Mr.add(xe,w,Mr.normalize(xe,Mr.subtract(xe,w,I))),pv(Rp,xe,w);var ke=oy(hv,Mr.create(),Ns,Rp,this.thickness),je=(0,re.Z)(ke,2),it=je[0],vt=je[1],Lt=Mr.dot(hv,this.normal)<0?-1:1,lr=A;if(!lr&&this.join==="miter"){var cr=it;cr>this.miterLimit&&(lr=!0)}lr?(y.push(this.normal[0],this.normal[1],0),y.push(vt[0],vt[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,Yt.Z)(this.lastFlip!==-Lt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Mp(U0,Rp),Mr.copy(this.normal,U0),y.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Lt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,y,a,vt,it,this.totalDistance),c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Lt=-1,Mr.copy(this.normal,vt),l+=2),this.lastFlip=Lt}else{if(Mp(this.normal,Ns),b){var K=Mr.create(),le=Mr.create();Mr.sub(le,Ns,this.normal),Mr.add(K,Ns,this.normal),y.push(le[0],le[1],0),y.push(K[0],K[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,Yt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),r.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],a=n[1]-r[1];return Math.sqrt(i*i+a*a)}}]),e}(),wa=Z(77160);function sC(e){var t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Ao().flatten(e),a=i.vertices,s=i.dimensions,l=[],c=[],p=0;p<a.length/s;p++)s===2?l.push(a[p*2],a[p*2+1],1):l.push(a[p*3],a[p*3+1],1);var y=Ao()(i.vertices,i.holes,i.dimensions);c.push.apply(c,(0,Yt.Z)(y));for(var b=function(){var I=i.vertices.slice(A*s,(A+1)*s),P=i.vertices.slice((A+1)*s,(A+2)*s);P.length===0&&(P=i.vertices.slice(0,s));var L=l.length/3;l.push(I[0],I[1],1,P[0],P[1],1,I[0],I[1],0,P[0],P[1],0),c.push.apply(c,(0,Yt.Z)([0,2,1,2,3,1].map(function(V){return V+L})))},A=0;A<n;A++)b();return{positions:l,index:c}}function uC(e){var t=Ao().flatten(e),r=Ao()(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:r}}function Px(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Ao().flatten(e),s=a.vertices,l=a.dimensions,c=[],p=[],y=[],b=0;b<s.length/l;b++)c.push(s[b*l],s[b*l+1],1,-1,-1),y.push(0,0,1);var A=Ao()(a.vertices,a.holes,a.dimensions);p.push.apply(p,(0,Yt.Z)(A));for(var w=function(){var L=a.vertices.slice(I*l,(I+1)*l),V=a.vertices.slice((I+1)*l,(I+2)*l);V.length===0&&(V=a.vertices.slice(0,l));var K=c.length/5;c.push(L[0],L[1],1,0,0,V[0],V[1],1,.1,0,L[0],L[1],0,0,.8,V[0],V[1],0,.1,.8);var le=lC([V[0],V[1],1],[L[0],L[1],0],[L[0],L[1],1],t);y.push.apply(y,(0,Yt.Z)(le).concat((0,Yt.Z)(le),(0,Yt.Z)(le),(0,Yt.Z)(le))),p.push.apply(p,(0,Yt.Z)([1,2,0,3,2,1].map(function(xe){return xe+K})))},I=0;I<i;I++)w();return{positions:c,index:p,normals:y}}function lC(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=wa.create(),a=wa.create(),s=wa.create();n&&(e=bc(e),t=bc(t),r=bc(r));var l=wa.fromValues.apply(wa,(0,Yt.Z)(e)),c=wa.fromValues.apply(wa,(0,Yt.Z)(t)),p=wa.fromValues.apply(wa,(0,Yt.Z)(r));wa.sub(i,p,c),wa.sub(a,l,c),wa.cross(s,i,a);var y=wa.create();return wa.normalize(y,s),y}var Nc,wm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),Cm=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Rm(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(r*i+t*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),c=Math.cos(s+Math.PI/4);return[l,c,0]});return a}function uy(){return Rm(30)}function Ox(){return Rm(4)}function kx(){return Rm(3)}function Dx(){return Rm(6,1)}function Lx(){return Rm(5)}var dv=(Nc={},(0,F.Z)(Nc,Cm.CIRCLE,uy),(0,F.Z)(Nc,Cm.HEXAGON,Dx),(0,F.Z)(Nc,Cm.TRIANGLE,kx),(0,F.Z)(Nc,Cm.SQUARE,Ox),(0,F.Z)(Nc,Cm.PENTAGON,Lx),(0,F.Z)(Nc,wm.CYLINDER,uy),(0,F.Z)(Nc,wm.HEXAGONCOLUMN,Dx),(0,F.Z)(Nc,wm.TRIANGLECOLUMN,kx),(0,F.Z)(Nc,wm.SQUARECOLUMN,Ox),(0,F.Z)(Nc,wm.PENTAGONCOLUMN,Lx),Nc),z0={};function Z0(e){var t=Uu(e.coordinates);return{vertices:[].concat((0,Yt.Z)(t),(0,Yt.Z)(t),(0,Yt.Z)(t),(0,Yt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Bx(e){var t=Uu(e.coordinates),r=Ix(t);return{vertices:[].concat((0,Yt.Z)(r),(0,Yt.Z)(r),(0,Yt.Z)(r),(0,Yt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function ly(e){var t=e.shape,r=gC(t,!1),n=r.positions,i=r.index,a=r.normals;return{vertices:n,indices:i,normals:a,size:5}}function cC(e){var t=Uu(e.coordinates);return{vertices:(0,Yt.Z)(t),indices:[0],size:t.length}}function fC(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new oC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=t;Array.isArray(a[0][0])||(a=[t]);var s=r;Array.isArray(s[0][0])||(s=[r]);for(var l=0;l<a.length;l++){var c=a[l],p=s[l];i.extrude_gaode2(c,p)}}else{var y=t;y[0]&&!Array.isArray(y[0][0])&&(y=[t]),y.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function CN(e){var t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(t),[1,2,-3],_toConsumableArray(t),[1,1,-3],_toConsumableArray(t),[0,1,0],_toConsumableArray(t),[0,0,0],_toConsumableArray(t),[1,0,0],_toConsumableArray(t),[1,2,-3],_toConsumableArray(t),[1,1,-3],_toConsumableArray(t),[0,1,0],_toConsumableArray(t),[0,0,0],_toConsumableArray(t)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function hC(e){var t=e.coordinates,r=e.originCoordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=pC(t,r),a=i.results,s=i.totalDistance;return a.map(function(l){n.push(l[0],l[1],l[2],l[3],0,s)}),{vertices:n,indices:[],normals:[],size:6,count:a.length}}function RN(e){var t=e.coordinates,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],size:4,count:0};var n=dC(t),i=n.results;return i.map(function(a){r.push(a[0],a[1],a[2],a[3])}),{vertices:r,indices:[],size:4,count:i.length}}function Fx(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function vv(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function pC(e,t){var r=e,n=t||e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=t.flat(),n=t.flat());var i=0;if(r.length<2)return{results:r,totalDistance:0};var a=[],s=vv(r[0],i);a.push(s);for(var l=1;l<r.length-1;l++){var c=Fx(Ya(n[l-1]),Ya(n[l]));i+=c;var p=vv(r[l],i);a.push(p),a.push(p)}var y=Fx(Ya(n[n.length-2]),Ya(n[n.length-1]));return i+=y,a.push(vv(r[r.length-1],i)),{results:a,totalDistance:i}}function dC(e){if(e.length<2)return{results:e};var t=[],r=vv(e[0]);t.push(r);for(var n=1;n<e.length-1;n++){var i=vv(e[n]);t.push(i),t.push(i)}return t.push(vv(e[e.length-1])),{results:t}}function cy(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes;return{indices:Ao()(n,a,i),vertices:n,size:i}}function vC(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes;return{indices:Ao()(n,a,i),vertices:mC(n),size:i+4}}function mC(e){for(var t=[],r=Of(e),n=r.center,i=r.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];t.push.apply(t,[s,l,0].concat((0,Yt.Z)(n),[i]))}return t}function fy(e){var t=e.coordinates,r=Px(t,!0),n=r.positions,i=r.index,a=r.normals;return{vertices:n,indices:i,normals:a,size:5}}function Nx(e){var t=e.shape,r=_C(t),n=r.positions,i=r.index;return{vertices:n,indices:i,size:3}}function V0(e){var t=e.coordinates,r=[].concat((0,Yt.Z)(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],(0,Yt.Z)(t[1]),[0,1,0],(0,Yt.Z)(t[0]),[0,0,1],(0,Yt.Z)(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function hy(e,t){for(var r=t.segmentNumber,n=r===void 0?30:r,i=e.coordinates,a=[],s=[],l=function(y){a.push(y,1,y,i[0][0],i[0][1],i[1][0],i[1][1],y,-1,y,i[0][0],i[0][1],i[1][0],i[1][1]),y!==n-1&&s.push.apply(s,(0,Yt.Z)([0,1,2,1,3,2].map(function(b){return y*2+b})))},c=0;c<n;c++)l(c);return{vertices:a,indices:s,size:7}}function Ux(e){var t=e.coordinates;t.length===2&&t.push(0);var r=j0(-1,1),n=j0(1,1),i=j0(-1,-1),a=j0(1,-1),s=[].concat((0,Yt.Z)(t),(0,Yt.Z)(r),(0,Yt.Z)(t),(0,Yt.Z)(i),(0,Yt.Z)(t),(0,Yt.Z)(a),(0,Yt.Z)(t),(0,Yt.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function gC(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(z0&&z0[e])return z0[e];var r=dv[e]?dv[e]():dv.cylinder(),n=Px([r],t);return z0[e]=n,n}function MN(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/r*3),a,s,l,c=vec3.create(),p=vec3.create(),y=vec3.create(),b=0,A=t.length;b<A;b+=3){a=t[b+0]*3,s=t[b+1]*3,l=t[b+2]*3;var w=[e[a],e[a+1]],I=[e[s],e[s+1]],P=[e[l],e[l+1]];n&&(w=lngLatToMeters(w),I=lngLatToMeters(I),P=lngLatToMeters(P));var L=w,V=_slicedToArray(L,2),K=V[0],le=V[1],xe=vec3.fromValues(K,le,e[a+2]),ke=I,je=_slicedToArray(ke,2),it=je[0],vt=je[1],Lt=vec3.fromValues(it,vt,e[s+2]),lr=P,cr=_slicedToArray(lr,2),Rr=cr[0],fn=cr[1],Pn=vec3.fromValues(Rr,fn,e[l+2]);vec3.sub(c,Pn,Lt),vec3.sub(p,xe,Lt),vec3.cross(y,c,p),i[a]+=c[0],i[a+1]+=c[1],i[a+2]+=c[2],i[s]+=c[0],i[s+1]+=c[1],i[s+2]+=c[2],i[l]+=c[0],i[l+1]+=c[1],i[l+2]+=c[2]}return yC(i),i}function yC(e){for(var t=0,r=e.length;t<r;t+=3){var n=vec3.fromValues(e[t],e[t+1],e[t+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,t)}}function IN(e){var t=e[0][0],r=e[0][e[0].length-1];return t[0]===r[0]&&t[1]===r[1]}function _C(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=dv[e]?dv[e]():dv.circle(),n=t.indexOf(e)===-1?uC([r]):sC([r]);return n}function j0(e,t){var r=(e+1)/2,n=(t+1)/2;return[r,n]}function PN(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),t=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:t,indices:r,size:5,normals:n}}function ON(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),t=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:t,indices:r,size:5,normals:n}}function xC(e){var t=bC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,SC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,AC=function(e){(0,Je.Z)(r,e);var t=xC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,c=l===void 0?"rgb(16,16,16)":l,p=i.brightColor,y=p===void 0?"rgb(255,176,38)":p,b=i.windowColor,A=b===void 0?"rgb(30,60,89)":b,w=i.time,I=w===void 0?0:w,P=i.sweep,L=P===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:P,V={u_baseColor:fi(c),u_brightColor:fi(y),u_windowColor:fi(A),u_circleSweepColor:[].concat((0,Yt.Z)(fi(L.sweepColor).slice(0,3)),[1]),u_cityCenter:L.sweepCenter||this.cityCenter,u_circleSweep:L.enable?1:0,u_cityMinSize:this.cityMinSize*L.sweepRadius,u_circleSweepSpeed:L.sweepSpeed,u_opacity:s,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||I},K=this.getUniformsBufferInfo(V);return K}},{key:"calCityGeo",value:function(){var i=(0,re.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],c=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(c+s)/2]);var p=this.mapService.lngLatToCoord([l,c]),y=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(p[0]-y[0],2)+Math.pow(p[1]-y[1],2))/4}else{var b=l-a,A=c-s;this.cityCenter=[(l+a)/2,(c+s)/2],this.cityMinSize=Math.sqrt(Math.pow(b,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:SC,fragmentShader:EC,triangulation:fy,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:Y.BACK}});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Da);function TC(e){var t=wC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=function(e){(0,Je.Z)(r,e);var t=TC(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","CityBuildingLayer"),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new AC(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Cp);function RC(e){var t=MC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IC=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,PC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,OC=function(e){(0,Je.Z)(r,e);var t=RC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:IC,fragmentShader:PC,triangulation:Nx,primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Da);function kC(e){var t=DC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,BC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,FC=function(e){(0,Je.Z)(r,e);var t=kC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:LC,fragmentShader:BC,triangulation:ly,primitive:Y.TRIANGLES,depth:{enable:!0}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{shaderLocation:ni.SIZE,name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Da),kN=Z(83557);function NC(e,t){for(var r=[],n=[],i=[],a=e+1,s=t+1,l=e/2,c=t/2,p=0;p<s;p++)for(var y=p-c,b=0;b<a;b++){var A=b-l;n.push(A/l,-y/c,0),i.push(b/e),i.push(1-p/t)}for(var w=0;w<t;w++)for(var I=0;I<e;I++){var P=I+a*w,L=I+a*(w+1),V=I+1+a*(w+1),K=I+1+a*w;r.push(P,L,K),r.push(L,V,K)}return{vertices:n,indices:r,uvs:i}}var zx,Zx;function UC(e){var t=zC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function zC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,VC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,jC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,HC=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,WC=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in float v_weight;
in vec2 v_extrude;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,GC=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,XC=mi.isEqual,Vx=(zx=(0,pr.b2)(),zx(Zx=function(e){(0,Je.Z)(r,e);var t=UC(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"colorModelUniformBuffer",[]),(0,F.Z)((0,Be.Z)(n),"heat3DModelUniformBuffer",[]),n}return(0,Q.Z)(r,[{key:"prerender",value:function(){var i=this,a=this.rendererService,s=a.clear,l=a.useFramebuffer;l(this.heatmapFramerBuffer,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()})}},{key:"render",value:function(i){var a=this.layer.getLayerConfig(),s=a.rampColors;XC(this.preRampColors,s)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w,I,P;return Ae().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return l=this.rendererService,c=l.createFramebuffer,p=l.getViewportSize,y=l.createTexture2D,b=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(b==null||(s=b.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=A,V.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=V.sent,this.colorModel=A==="heatmap"?this.buildHeatmap():this.build3dHeatMap(),w=p(),I=w.width,P=w.height,this.heatmapTexture=y({width:Math.floor(I/4),height:Math.floor(P/4),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR,usage:bp.RENDER_TARGET}),this.heatmapFramerBuffer=c({color:this.heatmapTexture,depth:!1}),this.updateColorTexture(),V.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return V.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Zn.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=Ux,c.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:GC,fragmentShader:WC,triangulation:Ux,depth:{enable:!1},cull:{enable:!0,face:Ho(this.mapService.version)}});case 4:return s=c.sent,c.abrupt("return",s);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:HC,fs:jC}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,c=this.rendererService,p=c.createAttribute,y=c.createElements,b=c.createBuffer,A=c.createModel;return A({vs:a,fs:s,uniformBuffers:[].concat((0,Yt.Z)(this.colorModelUniformBuffer),(0,Yt.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:p({shaderLocation:ni.POSITION,buffer:b({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Y.FLOAT}),size:3}),a_Uv:p({shaderLocation:ni.UV,buffer:b({data:[0,1,1,1,0,0,1,0],type:Y.FLOAT}),size:2})},uniforms:(0,O.Z)({},l),depth:{enable:!1},elements:y({data:[0,2,1,2,3,1],type:Y.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.intensity,l=s===void 0?10:s,c=a.radius,p=c===void 0?5:c,y={u_radius:p,u_intensity:l};this.uniformBuffers[0].subData({offset:0,data:[p,l]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:y,blend:{enable:!0,func:{srcRGB:Y.ONE,srcAlpha:1,dstRGB:Y.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,c=l===void 0?1:l,p={u_opacity:c,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},y=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[c]}),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:p,textures:y,blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,c=l===void 0?1:l,p=wr();ai(p,this.cameraService.getViewProjectionMatrixUncentered());var y={u_opacity:c,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Yt.Z)(p)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,Yt.Z)(y.u_ViewProjectionMatrixUncentered),(0,Yt.Z)(y.u_InverseViewProjectionMatrix),[c])});var b=[this.heatmapTexture,this.colorTexture];(a=this.colorModel)===null||a===void 0||a.draw({uniforms:y,textures:b,blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,c=NC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:VC,fs:ZC}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];var p=this.shaderModuleService.getModule("heatmap3dColor"),y=p.vs,b=p.fs,A=p.uniforms,w=this.rendererService,I=w.createAttribute,P=w.createElements,L=w.createBuffer,V=w.createModel;return V({vs:y,fs:b,attributes:{a_Position:I({shaderLocation:ni.POSITION,buffer:L({data:c.vertices,type:Y.FLOAT}),size:3}),a_Uv:I({shaderLocation:ni.UV,buffer:L({data:c.uvs,type:Y.FLOAT}),size:2})},primitive:Y.TRIANGLES,uniformBuffers:[].concat((0,Yt.Z)(this.heat3DModelUniformBuffer),(0,Yt.Z)(this.rendererService.uniformBuffers)),uniforms:(0,O.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:P({data:c.indices,type:Y.UNSIGNED_INT,count:c.indices.length})})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=aa(s);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1}),this.preRampColors=s}}]),r}(Da))||Zx);function $C(e){var t=YC();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,KC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,QC=function(e){(0,Je.Z)(r,e);var t=$C(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,c={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},p=this.getUniformsBufferInfo(c);return p}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:KC,fragmentShader:qC,triangulation:Nx,depth:{enable:!1},primitive:Y.TRIANGLES});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Da),JC={heatmap:Vx,heatmap3d:Vx,grid:OC,grid3d:FC,hexagon:QC},eR=JC;function tR(e){var t=rR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function rR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nR=function(e){(0,Je.Z)(r,e);var t=tR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","HeatMapLayer"),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new eR[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"prerender",value:function(){var i=this.getModelType();i==="heatmap"&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,c=this.getSource(),p=c.data.type,y=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return y==="heatmap"||y==="heatmap3d"?"heatmap":p==="hexagon"?(l==null?void 0:l.indexOf(y))===-1?"hexagon":"grid3d":p==="grid"?(l==null?void 0:l.indexOf(y))===-1?"grid":"grid3d":"heatmap"}}]),r}(Cp);function iR(e){var t=aR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function aR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oR=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,sR=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,uR=function(e){(0,Je.Z)(r,e);var t=iR(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.color,s=a===void 0?"rgb(255,255,255)":a,l=i.opacity,c=i.brightness,p=i.contrast,y=i.saturation,b=i.gamma,A=fi(s),w={u_opacity:dl(l,1),u_brightness:dl(c,1),u_contrast:dl(p,1),u_saturation:dl(y,1),u_gamma:dl(b,1)};this.textures=[this.texture];var I=this.getUniformsBufferInfo(w);return I}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"loadTexture",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return s=this.rendererService.createTexture2D,this.texture=s({height:0,width:0}),l=this.layer.getSource(),y.next=5,l.data.images;case 5:c=y.sent,this.texture=s({data:c[0],width:c[0].width,height:c[0].height,mag:Y.LINEAR,min:Y.LINEAR});case 7:case"end":return y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:sR,fragmentShader:oR,triangulation:V0,primitive:Y.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Da),lR={image:uR},cR=lR;function fR(e){var t=hR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function hR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jx=function(e){(0,Je.Z)(r,e);var t=fR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","ImageLayer"),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new cR[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),r}(Cp);function pR(e){var t=dR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function dR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vR=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
in vec2 v_iconMapUV;
in vec4 v_lineData;
in vec4 v_color;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,mR=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,gR={solid:0,dash:1},DN=mi.isNumber,yR=function(e){(0,Je.Z)(r,e);var t=pR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,y=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.forward,I=w===void 0?!0:w,P=i.lineTexture,L=P===void 0?!1:P,V=i.iconStep,K=V===void 0?100:V,le=i.segmentNumber,xe=le===void 0?30:le,ke=this.layer.getLayerConfig(),je=ke.animateOption,it=A;y!=="dash"&&(it=[0,0]),it.length===2&&it.push(0,0);var vt=0,Lt=[0,0,0,0],lr=[0,0,0,0];a&&s&&(Lt=fi(a),lr=fi(s),vt=1),this.rendererService.getDirty()&&this.texture.bind();var cr={u_animate:this.animateOption2Array(je),u_dash_array:it,u_sourceColor:Lt,u_targetColor:lr,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:xe,u_lineDir:I?1:-1,u_icon_step:K,u_line_texture:L?1:0,u_textureBlend:c==="normal"?0:1,u_blur:.9,u_line_type:gR[y||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:vt},Rr=this.getUniformsBufferInfo(cr);return Rr}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:vR,vert:mR,type:""}}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.initUniformsBuffer(),s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),y=p.frag,b=p.vert,A=p.type,P.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:hy,depth:{enable:!1},styleOption:{segmentNumber:c}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da);function _R(e){var t=xR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function xR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,ER=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,SR={solid:0,dash:1},Hx=function(e){(0,Je.Z)(r,e);var t=_R(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,y=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,V=i.segmentNumber,K=V===void 0?30:V,le=i.globalArcHeight,xe=le===void 0?10:le,ke=this.layer.getLayerConfig(),je=ke.animateOption;A.length===2&&A.push(0,0);var it=0,vt=[0,0,0,0],Lt=[0,0,0,0];a&&s&&(vt=fi(a),Lt=fi(s),it=1),this.rendererService.getDirty()&&this.texture.bind();var lr={u_animate:this.animateOption2Array(je),u_dash_array:A,u_sourceColor:vt,u_targetColor:Lt,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Rx,u_global_height:xe,segmentNumber:K,u_line_type:SR[y]||0,u_icon_step:L,u_line_texture:I?1:0,u_textureBlend:c==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:it},cr=this.getUniformsBufferInfo(lr);return cr}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:bR,vert:ER,type:""}}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),y=p.frag,b=p.vert,A=p.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:hy,styleOption:{segmentNumber:c}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da),Wx={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},zl=1/2;function AR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?1:i;return{vertices:[0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e,0,zl*e,1*e*n,-(a+zl)*e,1*e*n,(a-zl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function TR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function wR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function CR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function RR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function MR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?2:i,s=uy(),l=Ao().flatten([s]),c=Ao()(l.vertices,l.holes,l.dimensions),p=s.map(function(y){return[y[0]*n*e,y[1]*a]}).flat();return{vertices:[].concat((0,Yt.Z)(p),(0,Yt.Z)(p)),dimensions:2,indices:c.map(function(y){return y+s.length}),outLineIndices:c,normals:[].concat((0,Yt.Z)(s.map(function(y){return[y[1]*a,y[0]*n*e,1]}).flat()),(0,Yt.Z)(new Array(s.length*3).fill(0)))}}function IR(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=(0,Au.Z)(r.source)==="object"?r.source.type:r.source,i=(0,Au.Z)(r.target)==="object"?r.target.type:r.target,a=(0,Au.Z)(r.source)==="object"?r.source:{},s=a.width,l=s===void 0?n?Wx[n]:0:s,c=a.height,p=c===void 0?2:c,y=(0,Au.Z)(r.target)==="object"?r.target:{},b=y.width,A=b===void 0?i?Wx[i]:0:b,w=y.height,I=w===void 0?2:w;return{vertices:[0,zl,1*l].concat((0,Yt.Z)(e),[1,zl,-1*A],(0,Yt.Z)(e),[1,-zl,-1*A],(0,Yt.Z)(e),[0,-zl,1*l],(0,Yt.Z)(e),[0,zl,1*l],(0,Yt.Z)(e),[1,zl,-1*A],(0,Yt.Z)(e),[1,-zl,-1*A],(0,Yt.Z)(e),[0,-zl,1*l],(0,Yt.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(P){return P+t}),indices:[4,5,6,4,6,7].map(function(P){return P+t}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function Gx(e,t){var r=(0,Au.Z)(e)==="object"?e.type:e,n=t==="source"?1:-1,i=(0,Au.Z)(e)==="object"?e:{};switch(r){case"circle":return MR(n,i);case"triangle":return TR(n,i);case"diamond":return CR(n,i);case"rect":return wR(n,i);case"classic":return RR(n,i);case"halfTriangle":return AR(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function PR(e){var t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,Yt.Z)(t),[1,2,-3],(0,Yt.Z)(t),[1,1,-3],(0,Yt.Z)(t),[0,1,0],(0,Yt.Z)(t),[0,0,0],(0,Yt.Z)(t),[1,0,0],(0,Yt.Z)(t),[1,2,-3],(0,Yt.Z)(t),[1,1,-3],(0,Yt.Z)(t),[0,1,0],(0,Yt.Z)(t),[0,0,0],(0,Yt.Z)(t)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function OR(e,t){return t?kR(e,t):PR(e)}function kR(e,t){var r=e.coordinates.flat(),n=t,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,c=Xx(Gx(l,"source"),r,0,0),p=IR(r,c.vertices.length/7,t),y=Xx(Gx(a,"target"),r,1,c.vertices.length/7+p.vertices.length/7),b={vertices:[].concat((0,Yt.Z)(c.vertices),(0,Yt.Z)(p.vertices),(0,Yt.Z)(y.vertices)),indices:[].concat((0,Yt.Z)(c.outLineIndices),(0,Yt.Z)(p.outLineIndices),(0,Yt.Z)(y.outLineIndices),(0,Yt.Z)(c.indices),(0,Yt.Z)(p.indices),(0,Yt.Z)(y.indices)),normals:[].concat((0,Yt.Z)(c.normals),(0,Yt.Z)(p.normals),(0,Yt.Z)(y.normals)),size:7};return b}function Xx(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,c=e.outLineIndices,p=0;p<a.length;p+=l)i.push.apply(i,[r,a[p+1],a[p]].concat((0,Yt.Z)(t)));return(0,O.Z)((0,O.Z)({},e),{},{vertices:i,indices:s.map(function(y){return y+n}),outLineIndices:c.map(function(y){return y+n})})}function DR(e){var t=LR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function LR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BR=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,FR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,NR=function(e){(0,Je.Z)(r,e);var t=DR(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,c=l===void 0?1:l,p=i.strokeOpacity,y=p===void 0?1:p,b={u_gap_width:s,u_stroke_width:c,u_stroke_opacity:y},A=this.getUniformsBufferInfo(b);return A}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:FR,fragmentShader:BR,inject:this.getInject(),triangulation:OR,styleOption:this.layer.getLayerConfig().symbol,primitive:Y.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}})}}]),r}(Da);function UR(e){var t=zR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function zR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,VR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,jR={solid:0,dash:1},HR=function(e){(0,Je.Z)(r,e);var t=UR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,y=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,V=i.segmentNumber,K=V===void 0?30:V,le=this.layer.getLayerConfig(),xe=le.animateOption;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ke=0,je=[0,0,0,0],it=[0,0,0,0];a&&s&&(je=fi(a),it=fi(s),ke=1);var vt=this.layer.getLayerAnimateTime();isNaN(vt)&&(vt=0);var Lt={u_animate:this.animateOption2Array(xe),u_dash_array:A,u_sourceColor:je,u_targetColor:it,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:K,u_line_type:jR[y]||0,u_icon_step:L,u_line_texture:I?1:0,u_textureBlend:c==="normal"?0:1,u_time:vt,u_linearColor:ke},lr=this.getUniformsBufferInfo(Lt);return lr}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,c=l===void 0?30:l,b.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:VR,fragmentShader:ZR,triangulation:hy,styleOption:{segmentNumber:c},inject:this.getInject(),depth:{enable:!1}});case 3:return p=b.sent,b.abrupt("return",[p]);case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Zn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da),LN=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),$x=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),WR=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),py=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),BN=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function GR(e){var t=XR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function XR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $R=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
in vec2 v_iconMapUV;
in vec4 v_texture_data;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,YR=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;
layout(location = 13) in vec4 a_NormalAndMiter;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};
#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;
  v_d_distance_ratio = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_NormalAndMiter.w * setPickingSize(a_SizeDistanceAndTotalDistance.x) * reverse_offset_normal(a_NormalAndMiter.xyz);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_SizeDistanceAndTotalDistance.b;
  float currentLinePointRatio = lineDistance / a_SizeDistanceAndTotalDistance.a;
 

  float lineOffsetWidth = length(offset + offset * sign(a_NormalAndMiter.w)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_SizeDistanceAndTotalDistance.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_SizeDistanceAndTotalDistance.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_SizeDistanceAndTotalDistance.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,FN={solid:0,dash:1},Yx=function(e){(0,Je.Z)(r,e);var t=GR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"textureEventFlag",!1),(0,F.Z)((0,Be.Z)(n),"texture",n.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.textures.length===0&&(n.textures=[n.texture]),n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,y=p===void 0?"solid":p,b=i.dashArray,A=b===void 0?[10,5,0,0]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,V=i.vertexHeightScale,K=V===void 0?20:V,le=i.strokeWidth,xe=le===void 0?0:le,ke=i.raisingHeight,je=ke===void 0?0:ke,it=i.heightfixed,vt=it===void 0?!1:it,Lt=i.linearDir,lr=Lt===void 0?$x.VERTICAL:Lt,cr=i.blur,Rr=cr===void 0?[1,1,1,0]:cr,fn=A;y!=="dash"&&(fn=[0,0,0,0]),fn.length===2&&fn.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Pn=this.layer.getLayerConfig(),Ri=Pn.animateOption,ya=0,Ha=[0,0,0,0],no=[0,0,0,0];a&&s&&(Ha=fi(a),no=fi(s),ya=1);var us={u_animate:this.animateOption2Array(Ri),u_dash_array:fn,u_blur:Rr,u_sourceColor:Ha,u_targetColor:no,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:L,u_heightfixed:Number(vt),u_vertexScale:K,u_raisingHeight:Number(je),u_strokeWidth:xe,u_textureBlend:c===WR.NORMAL?0:1,u_line_texture:I?1:0,u_linearDir:lr===$x.VERTICAL?1:0,u_linearColor:ya,u_time:this.layer.getLayerAnimateTime()||0},xl=this.getUniformsBufferInfo(us);return xl}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,c=l===void 0?!1:l,p=this.getShaders(),y=p.frag,b=p.vert,A=p.type,this.layer.triangulation=zp,P.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:b,fragmentShader:y,triangulation:zp,inject:this.getInject(),depth:{enable:c}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:$R,vert:YR,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Zn.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:ni.SIZE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c){var p=s.size,y=p===void 0?1:p,b=Array.isArray(y)?[y[0],y[1]]:[y,0];return[b[0],b[1],c[3],c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normalAndMiter",type:Zn.Attribute,descriptor:{name:"a_NormalAndMiter",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(s,l,c,p,y){return[].concat((0,Yt.Z)(y),[c[4]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da);function qR(e){var t=KR();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function KR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QR=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,JR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,NN=mi.isNumber,eM=function(e){(0,Je.Z)(r,e);var t=qR(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType,c=l===void 0?"solid":l,p=i.dashArray,y=p===void 0?[10,5,0,0]:p,b=i.vertexHeightScale,A=b===void 0?20:b,w=y;c!=="dash"&&(w=[0,0,0,0]),w.length===2&&w.push(0,0);var I=0,P=[0,0,0,0],L=[0,0,0,0];a&&s&&(P=fi(a),L=fi(s),I=1);var V={u_sourceColor:P,u_targetColor:L,u_dash_array:w,u_vertexScale:A,u_linearColor:I},K=this.getUniformsBufferInfo(V);return K}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:QR,vert:JR,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.initUniformsBuffer(),s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,triangulation:hC,inject:this.getInject(),primitive:Y.LINES,depth:{enable:!1},pick:!1});case 4:return y=A.sent,A.abrupt("return",[y]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Zn.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:ni.SIZE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){var c=a.size,p=c===void 0?1:c,y=Array.isArray(p)?[p[0],p[1]]:[p,0];return[y[0],y[1],l[3],l[5]]}}})}}]),r}(Da);function tM(e){var t=rM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function rM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nM=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,iM=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,aM=function(e){(0,Je.Z)(r,e);var t=tM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.heightfixed,y=p===void 0?!1:p,b=i.lineTexture,A=b===void 0?!1:b,w=i.iconStep,I=w===void 0?100:w,P=i.iconStepCount,L=P===void 0?1:P,V=this.layer.getLayerConfig(),K=V.animateOption;this.rendererService.getDirty()&&this.texture.bind();var le=0,xe=[0,0,0,0],ke=[0,0,0,0];a&&s&&(xe=fi(a),ke=fi(s),le=1);var je={u_animate:this.animateOption2Array(K),u_sourceColor:xe,u_targetColor:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:I,u_heightfixed:Number(y),u_linearColor:le,u_line_texture:A?1:0,u_textureBlend:c==="normal"?0:1,u_iconStepCount:L,u_time:this.layer.getLayerAnimateTime()||0},it=this.getUniformsBufferInfo(je);return it}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:iM,fragmentShader:nM,triangulation:fC,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=c.sent,c.abrupt("return",[s]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Zn.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Zn.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=s.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Zn.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.texture,p=l[c]||{x:0,y:0},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da),oM={arc:yR,arc3d:Hx,greatcircle:HR,wall:aM,line:Yx,simple:eM,flowline:NR,earthArc3d:Hx},sM=oM;function uM(e){var t=lM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dy=function(e){(0,Je.Z)(r,e);var t=uM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","LineLayer"),(0,F.Z)((0,Be.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,F.Z)((0,Be.Z)(n),"arrowInsertCount",0),(0,F.Z)((0,Be.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new sM[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,O.Z)({},s);s.coordinates.map(function(c){a.push((0,O.Z)((0,O.Z)({},l),{},{coordinates:c}))})}else a.push(s)}),a}}]),r}(Cp);function cM(e){var t=fM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hM=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,pM=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function qx(e){var t=e.coordinates;return{vertices:(0,Yt.Z)(t),indices:[0],size:t.length}}var dM=function(e){(0,Je.Z)(r,e);var t=cM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.strokeOpacity,l=s===void 0?1:s,c=i.strokeWidth,p=c===void 0?0:c,y=i.stroke,b=y===void 0?"#fff":y,A={u_stroke_color:fi(b),u_additive:a==="additive"?1:0,u_stroke_opacity:l,u_stroke_width:p},w=this.getUniformsBufferInfo(A);return w}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=qx,this.initUniformsBuffer(),c.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:pM,fragmentShader:hM,inject:this.getInject(),triangulation:qx,depth:{enable:!1},primitive:Y.POINTS});case 4:return s=c.sent,c.abrupt("return",[s]);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Da);function vM(e){var t=mM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,yM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,_M=mi.isNumber,xM=function(e){(0,Je.Z)(r,e);var t=vM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"raiseCount",0),(0,F.Z)((0,Be.Z)(n),"raiseRepeat",0),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,p=i.sourceColor,y=i.targetColor,b=i.pickLight,A=b===void 0?!1:b,w=i.heightfixed,I=w===void 0?!0:w,P=i.opacityLinear,L=P===void 0?{enable:!1,dir:"up"}:P,V=i.lightEnable,K=V===void 0?!0:V,le=0,xe=[0,0,0,0],ke=[0,0,0,0];if(p&&y&&(xe=fi(p),ke=fi(y),le=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var je=s.speed,it=je===void 0?.01:je;this.raiseCount+=it,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var vt={u_sourceColor:xe,u_targetColor:ke,u_linearColor:le,u_pickLight:Number(A),u_heightfixed:Number(I),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:_M(c)?c:1,u_opacitylinear:Number(L.enable),u_opacitylinear_dir:L.dir==="up"?1:0,u_lightEnable:Number(K)},Lt=this.getUniformsBufferInfo(vt);return Lt}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,c=l===void 0?1:l,this.raiseRepeat=c,b.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:yM,fragmentShader:gM,triangulation:ly,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:Ho(this.mapService.version)},blend:this.getBlend()});case 4:return p=b.sent,b.abrupt("return",[p]);case 6:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Zn.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=Uu(a.coordinates);return Ix([s[0],s[1]])}}})}}]),r}(Da);function bM(e){var t=EM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SM=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,AM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`,TM=function(e){(0,Je.Z)(r,e);var t=bM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,p=i.blend,y=i.blur,b=y===void 0?0:y;this.layer.getLayerConfig();var A={u_additive:p==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:c,u_blur:b},w=this.getUniformsBufferInfo(A);return w}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=Bx,c.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:AM,fragmentShader:SM,triangulation:Bx,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:ni.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var y=(0,re.Z)(c,3),b=y[0],A=y[1],w=y[2],I=wa.fromValues(0,0,1),P=wa.fromValues(b,0,w),L=b>=0?wa.angle(I,P):Math.PI*2-wa.angle(I,P),V=Math.PI*2-Math.asin(A/100),K=wr();Rh(K,K,L),Wu(K,K,V);var le=wa.fromValues(1,1,0);wa.transformMat4(le,le,K),wa.normalize(le,le);var xe=wa.fromValues(-1,1,0);wa.transformMat4(xe,xe,K),wa.normalize(xe,xe);var ke=wa.fromValues(-1,-1,0);wa.transformMat4(ke,ke,K),wa.normalize(ke,ke);var je=wa.fromValues(1,-1,0);wa.transformMat4(je,je,K),wa.normalize(je,je);var it=[].concat((0,Yt.Z)(le),(0,Yt.Z)(xe),(0,Yt.Z)(ke),(0,Yt.Z)(je)),vt=p%4*3;return[it[vt],it[vt+1],it[vt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Zn.Attribute,descriptor:{name:"a_Shape",shaderLocation:ni.SHAPE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.shape,c=l===void 0?2:l,p=i.layer.getLayerConfig().shape2d,y=p.indexOf(c);return[y]}}})}}]),r}(Da);function wM(e){var t=CM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RM=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,MM=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,Kx=function(e){(0,Je.Z)(r,e);var t=wM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"raiseCount",0),(0,F.Z)((0,Be.Z)(n),"raiseRepeat",0),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,c=i.targetColor,p=i.pickLight,y=p===void 0?!1:p,b=i.heightfixed,A=b===void 0?!1:b,w=i.opacityLinear,I=w===void 0?{enable:!1,dir:"up"}:w,P=i.lightEnable,L=P===void 0?!0:P,V=0,K=[0,0,0,0],le=[0,0,0,0];if(l&&c&&(K=fi(l),le=fi(c),V=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var xe=s.speed,ke=xe===void 0?.01:xe;this.raiseCount+=ke,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var je={u_pickLight:Number(y),u_heightfixed:Number(A),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:V,u_sourceColor:K,u_targetColor:le,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(L)},it=this.getUniformsBufferInfo(je);return it}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b;return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,c=l===void 0?!0:l,p=s.animateOption.repeat,y=p===void 0?1:p,this.raiseRepeat=y,this.initUniformsBuffer(),w.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:MM,fragmentShader:RM,triangulation:ly,inject:this.getInject(),cull:{enable:!0,face:Ho(this.mapService.version)},depth:{enable:c}});case 5:return b=w.sent,w.abrupt("return",[b]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:ni.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var s=Uu(a.coordinates);return[s[0],s[1],0]}}})}}]),r}(Da);function IM(e){var t=PM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function PM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OM=`layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};


in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,kM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_SizeAndShape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_SizeAndShape.y;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_SizeAndShape.x);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,Qx=function(e){(0,Je.Z)(r,e);var t=IM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,p=i.blend,y=i.blur,b=y===void 0?0:y,A=i.raisingHeight,w=A===void 0?0:A,I=i.heightfixed,P=I===void 0?!1:I,L=i.unit,V=L===void 0?"pixel":L,K=this.getAnimateUniforms().u_time;isNaN(K)&&(K=-1);var le={u_blur_height_fixed:[b,Number(w),Number(P)],u_stroke_width:c,u_additive:p==="additive"?1:0,u_stroke_opacity:s,u_size_unit:py[V],u_time:K,u_animate:this.getAnimateUniforms().u_animate},xe=this.getUniformsBufferInfo(le);return xe}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),of)}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,c=l===void 0?{enable:!1}:l,p=this.getShaders(c),y=p.frag,b=p.vert,A=p.type,this.layer.triangulation=of,this.initUniformsBuffer(),P.next=6,this.layer.buildLayerModel({moduleName:A,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:of,depth:{enable:!1}});case 6:return w=P.sent,P.abrupt("return",[w]);case 8:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){return{frag:OM,vert:kM,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:ni.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"sizeAndShape",type:Zn.Attribute,descriptor:{name:"a_SizeAndShape",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=s.size,c=l===void 0?5:l,p=s.shape,y=p===void 0?2:p,b=i.indexOf(y),A=Array.isArray(c)?c[0]:c;return[A,b]}}})}}]),r}(Da);function DM(e){var t=LM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BM=`in vec4 v_color;
in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,FM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,NM=function(e){(0,Je.Z)(r,e);var t=DM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"meter2coord",1),(0,F.Z)((0,Be.Z)(n),"isMeter",!1),(0,F.Z)((0,Be.Z)(n),"radian",0),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0}),n.textures=[n.texture]}),n}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,p=i.unit,y=p===void 0?"pixel":p;this.rendererService.getDirty()&&this.texture.bind();var b={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(c),u_raisingHeight:Number(s),u_size_unit:py[y],u_texture:this.texture};this.textures=[this.texture];var A=this.getUniformsBufferInfo(b);return A}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Z0)}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:FM,fragmentShader:BM,triangulation:Z0,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:Ho(this.mapService.version)}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.shape,p=l[c]||{x:-64,y:-64},y=p.x,b=p.y;return[y,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Zn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:ni.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(s,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}})}}]),r}(Da);function UM(e){var t=zM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function zM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,VM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Jx=function(e){(0,Je.Z)(r,e);var t=UM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,p={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(s),u_heightfixed:Number(c),u_texture:this.texture};this.textures=[this.texture];var y=this.getUniformsBufferInfo(p);return y}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:VM,fragmentShader:ZM,triangulation:cC,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(s){var l=s.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),c=s.shape,p=l[c]||{x:-64,y:-64},y=p.x,b=p.y;return[y,b]}}})}}]),r}(Da);function jM(e){var t=HM();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function HM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WM=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,GM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function eb(e){var t=e.coordinates;return{vertices:(0,Yt.Z)(t),indices:[0],size:t.length}}var tb=function(e){(0,Je.Z)(r,e);var t=jM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i={u_size_scale:.5},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=eb,this.initUniformsBuffer(),c.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:GM,fragmentShader:WM,triangulation:eb,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS,pick:!1});case 4:return s=c.sent,c.abrupt("return",[s]);case 6:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Da);function XM(e){var t=$M();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YM=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,qM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 11) in vec4 a_ExtrudeAndSize;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_ExtrudeAndSize.xyz;
  float newSize = setPickingSize(a_ExtrudeAndSize.w);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_ExtrudeAndSize.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_ExtrudeAndSize.w, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,KM=function(e){(0,Je.Z)(r,e);var t=XM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.speed,l=s===void 0?1:s,c=i.unit,p=c===void 0?"pixel":c,y={u_additive:a==="additive"?1:0,u_size_unit:py[p],u_speed:l,u_time:this.layer.getLayerAnimateTime()},b=this.getUniformsBufferInfo(y);return b}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Z0)}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:qM,fragmentShader:YM,triangulation:Z0,inject:this.getInject(),depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrudeAndSize",type:Zn.Attribute,descriptor:{name:"a_ExtrudeAndSize",shaderLocation:ni.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l,c){var p=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],y=c%4*3,b=a.size,A=b===void 0?5:b,w=Array.isArray(A)?A[0]:A;return[p[y],p[y+1],p[y+2],w]}}})}}]),r}(Da);function QM(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=JM(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function JM(e,t){if(!!e){if(typeof e=="string")return rb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rb(e,t)}}function rb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var eI=function(){function e(t,r,n){(0,ye.Z)(this,e),(0,F.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(r/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Q.Z)(e,[{key:"insert",value:function(r,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(r,n,i,a,s){return this.queryHitTest(r,n,i,a,!1,s)}},{key:"hitTest",value:function(r,n,i,a,s){return this.queryHitTest(r,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(r,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(r,n,i,a,s,l){if(i<0||r>this.width||a<0||n>this.height)return s?!1:[];var c=[];if(r<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[p*4],y1:this.bboxes[p*4+1],x2:this.bboxes[p*4+2],y2:this.bboxes[p*4+3]});return l?c.filter(l):c}var y={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,i,a,this.queryCell,c,y,l),s?c.length>0:c}},{key:"queryCell",value:function(r,n,i,a,s,l,c,p){var y=c.seenUids,b=this.boxCells[s];if(b!==null){var A=this.bboxes,w=QM(b),I;try{for(w.s();!(I=w.n()).done;){var P=I.value;if(!y.box[P]){y.box[P]=!0;var L=P*4;if(r<=A[L+2]&&n<=A[L+3]&&i>=A[L+0]&&a>=A[L+1]&&(!p||p(this.boxKeys[P]))){if(c.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[P],x1:A[L],y1:A[L+1],x2:A[L+2],y2:A[L+3]})}}}}catch(V){w.e(V)}finally{w.f()}}return!1}},{key:"forEachCell",value:function(r,n,i,a,s,l,c,p){for(var y=this.convertToXCellCoord(r),b=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),w=this.convertToYCellCoord(a),I=y;I<=A;I++)for(var P=b;P<=w;P++){var L=this.xCellCount*P+I;if(s.call(this,r,n,i,a,L,l,c,p))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),tI=eI,rI=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"viewportPadding",100),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new tI(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Q.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,i=r.y1+r.anchorPointY+this.viewportPadding,a=r.x2+r.anchorPointX+this.viewportPadding,s=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(r,n){var i={featureIndex:n};this.grid.insert(i,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,i){var a=$n(n,i,0,1),s=xi(),l=Dn.apply(ge,(0,Yt.Z)(r));return fu(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,i,a){return i>=0&&r<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function nb(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=nI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function nI(e,t){if(!!e){if(typeof e=="string")return ib(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ib(e,t)}}function ib(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ab(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function ob(e,t,r,n,i){if(!!i){var a=e[n],s=a.glyph;if(s)for(var l=t[s].advance*a.scale,c=(e[n].x+l)*i,p=r;p<=n;p++)e[p].x-=c}}function sb(e,t,r,n,i,a,s){var l=(t-r)*i,c=(-n*s+.5)*a,p=nb(e),y;try{for(p.s();!(y=p.n()).done;){var b=y.value;b.x+=l,b.y+=c}}catch(A){p.e(A)}finally{p.f()}}function iI(e,t,r,n,i,a,s){var l=-8,c=0,p=l,y=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;r.forEach(function(K){if(K.split("").forEach(function(xe){var ke=t[xe],je=0;ke&&(b.push({glyph:xe,x:c,y:p+je,vertical:!1,scale:1,metrics:ke}),c+=ke.advance+s)}),b.length!==w){var le=c-s;y=Math.max(le,y),ob(b,t,w,b.length-1,A)}c=0,p-=n+5});var I=ab(i),P=I.horizontalAlign,L=I.verticalAlign;sb(b,A,P,L,y,n,r.length);var V=p-l;e.top+=-L*V,e.bottom=e.top-V,e.left+=-P*y,e.right=e.left+y}function aI(e,t,r,n,i,a,s){var l=-8,c=0,p=l,y=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;r.forEach(function(K){var le=t[K],xe=0;if(le&&(b.push({glyph:K,x:le.advance/2,y:p+xe,vertical:!1,scale:1,metrics:le}),c+=le.advance+s),b.length!==w){var ke=c-s;y=Math.max(ke,y),ob(b,t,w,b.length-1,A)}c=0,p-=n+5});var I=ab(i),P=I.horizontalAlign,L=I.verticalAlign;sb(b,A,P,L,y,n,r.length);var V=p-l;e.top+=-L*V,e.bottom=e.top-V,e.left+=-P*y,e.right=e.left+y}function oI(e,t,r,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),p=[],y={positionedGlyphs:p,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:c.length,text:e};return l?aI(y,t,c,r,n,i,a):iI(y,t,c,r,n,i,a),p.length?y:!1}function sI(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=nb(i),l;try{for(s.s();!(l=s.n()).done;){var c=l.value,p=c.metrics,y=4,b=p.advance*c.scale/2,A=r?[c.x+b,c.y]:[0,0],w=r?[0,0]:[c.x+b+t[0],c.y+t[1]],I=(0-y)*c.scale-b+w[0],P=(0-y)*c.scale+w[1],L=I+p.width*c.scale,V=P+p.height*c.scale,K={x:I,y:P},le={x:L,y:P},xe={x:I,y:V},ke={x:L,y:V};a.push({tl:K,tr:le,bl:xe,br:ke,tex:p,glyphOffset:A})}}catch(je){s.e(je)}finally{s.f()}return a}function uI(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function lI(e,t){if(!!e){if(typeof e=="string")return ub(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ub(e,t)}}function ub(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function cI(e){var t=fI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function fI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec4 v_color;
in vec4 v_stroke_color;
in vec2 v_uv;
in float v_gamma_scale;
in float v_fontScale;
out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,cb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec4 a_textUvAndOffsets;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_textUvAndOffsets.xy / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textUvAndOffsets.zw,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,Mm=mi.isEqual;function fb(e){var t=this,r=e.id,n=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var a=t.glyphInfoMap[r].centroid,s=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[r].glyphQuads.forEach(function(l,c){n.push.apply(n,(0,Yt.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,Yt.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,Yt.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,Yt.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var hb=function(e){(0,Je.Z)(r,e);var t=cI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"glyphInfoMap",{}),(0,F.Z)((0,Be.Z)(n),"currentZoom",-1),(0,F.Z)((0,Be.Z)(n),"textureHeight",0),(0,F.Z)((0,Be.Z)(n),"textCount",0),(0,F.Z)((0,Be.Z)(n),"preTextStyle",{}),(0,F.Z)((0,Be.Z)(n),"mapping",(0,St.Z)(Ae().mark(function l(){return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.initGlyph(),n.updateTexture(),p.next=4,n.reBuildModel();case 4:case"end":return p.stop()}},l)}))),n}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,c=l===void 0?0:l,p=i.halo,y=p===void 0?.5:p,b=i.gamma,A=b===void 0?2:b,w=i.raisingHeight,I=w===void 0?0:w,P=this.getFontServiceMapping(),L=this.getFontServiceCanvas();P&&Object.keys(P).length!==this.textCount&&L&&(this.updateTexture(),this.textCount=Object.keys(P).length),this.preTextStyle=this.getTextStyle();var V={u_stroke_color:fi(s),u_sdf_map_size:[(L==null?void 0:L.width)||1,(L==null?void 0:L.height)||1],u_raisingHeight:Number(I),u_stroke_width:c,u_gamma_scale:A,u_halo_blur:y},K=this.getUniformsBufferInfo(V);return K}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 6:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,c=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),c||this.filterGlyphs(),b.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cb,fragmentShader:lb,inject:this.getInject(),triangulation:fb.bind(this),depth:{enable:!1}});case 6:return p=b.sent,b.abrupt("return",[p]);case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w,I,P,L,V;return Ae().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,c=l===void 0?!1:l,p=s.textAnchor,y=p===void 0?"center":p,b=s.textOffset,A=s.padding,w=s.fontFamily,I=s.fontWeight,!(!Mm(A,this.preTextStyle.padding)||!Mm(b,this.preTextStyle.textOffset)||!Mm(y,this.preTextStyle.textAnchor)||!Mm(w,this.preTextStyle.fontFamily)||!Mm(I,this.preTextStyle.fontWeight))){le.next=5;break}return le.next=4,this.mapping();case 4:return le.abrupt("return",!0);case 5:if(!c){le.next=7;break}return le.abrupt("return",!1);case 7:if(P=this.mapService.getZoom(),L=this.mapService.getBounds(),V=Sc(this.extent,L),!(Math.abs(this.currentZoom-P)>.5||!V||c!==this.preTextStyle.textAllowOverlap)){le.next=14;break}return le.next=13,this.reBuildModel();case 13:return le.abrupt("return",!0);case 14:return le.abrupt("return",!1);case 15:case"end":return le.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textUvAndOffsets",type:Zn.Attribute,descriptor:{name:"a_textUvAndOffsets",shaderLocation:ni.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return oa(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var y=p.shape,b=y===void 0?"":y;b=b.toString();var A=uI(b),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;c.indexOf(I)===-1&&c.push(I)}}catch(P){A.e(P)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var y=p.shape,b=y===void 0?"":y;b="".concat(b),c.indexOf(b)===-1&&c.push(b)}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=i.textAllowOverlap,y=p===void 0?!1:p,b=i.padding,A=b===void 0?[0,0]:b,w=i.textAnchor,I=w===void 0?"center":w,P=i.textOffset,L=P===void 0?[0,0]:P,V=i.opacity,K=V===void 0?1:V,le=i.strokeOpacity,xe=le===void 0?1:le,ke=i.strokeWidth,je=ke===void 0?0:ke,it=i.stroke,vt=it===void 0?"#000":it;return{fontWeight:s,fontFamily:c,textAllowOverlap:y,padding:A,textAnchor:I,textOffset:L,opacity:K,strokeOpacity:xe,strokeWidth:je,stroke:vt}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),c=l.spacing,p=c===void 0?2:c,y=l.textAnchor,b=y===void 0?"center":y,A=l.textOffset,w=this.rawEncodeData;this.glyphInfo=w.map(function(I){var P=I.shape,L=P===void 0?"":P,V=I.id,K=I.size,le=K===void 0?1:K,xe=I.textOffset?I.textOffset:A||[0,0],ke=I.textAnchor?I.textAnchor:b||"center",je=oI(L.toString(),s,le,ke,"left",p,xe,i),it=sI(je,xe,!1);return I.shaping=je,I.glyphQuads=it,I.centroid=Uu(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?Uu(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[V]={shaping:je,glyphQuads:it,centroid:Uu(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(c,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(c,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,c=a.textAllowOverlap,p=c===void 0?!1:c;if(!p){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),b=y.width,A=y.height,w=new rI(b,A),I=this.glyphInfo.filter(function(P){var L=P.shaping,V=P.id,K=V===void 0?0:V,le=P.version==="GAODE2.x"?P.originCentroid:P.centroid,xe=P.size,ke=xe/16,je=i.mapService.lngLatToContainer(le),it=w.placeCollisionBox({x1:L.left*ke-l[0],x2:L.right*ke+l[0],y1:L.top*ke-l[1],y2:L.bottom*ke+l[1],anchorPointX:je.x,anchorPointY:je.y}),vt=it.box;return vt&&vt.length?(w.insertCollisionBox(vt,K),!0):!1});I.forEach(function(P){i.glyphInfoMap[P.id]=P})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Y.LINEAR,min:Y.LINEAR,width:a.width,height:a.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.filterGlyphs(),c.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:cb,fragmentShader:lb,triangulation:fb.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=c.sent,this.layer.models=[s];case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Da),hI={fillImage:NM,fill:Qx,radar:KM,image:Jx,normal:tb,simplePoint:dM,extrude:Kx,text:hb,earthFill:TM,earthExtrude:xM},pI=hI;function dI(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var p=r.next();return a=p.done,p},e:function(p){s=!0,l=p},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function vI(e,t){if(!!e){if(typeof e=="string")return pb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pb(e,t)}}function pb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mI(e){var t=gI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function gI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H0=function(e){(0,Je.Z)(r,e);var t=mI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","PointLayer"),(0,F.Z)((0,Be.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,F.Z)((0,Be.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,F.Z)((0,Be.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new pI[s](this),c.next=5,this.initLayerModels();case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),c=l.shape2d,p=this.iconService.getIconMap();if(a&&(c==null?void 0:c.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var y=dI(s),b;try{for(y.s();!(b=y.n()).done;){var A=b.value;if(typeof A=="string"&&p.hasOwnProperty(A))return"image"}}catch(w){y.e(w)}finally{y.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,c=a.billboard,p=c===void 0?!0:c,y=this.iconService.getIconMap(),b=i.find(function(w){return w.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||p===!1?"fillImage":(s==null?void 0:s.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":y.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Cp);function yI(e){var t=_I();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function _I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xI=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,bI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,EI=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;


#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  }
  

  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,SI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

out vec2 v_texture_data;
out vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,AI=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,TI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec2 v_texture_data;
out vec3 v_uvs;
out vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,wI=function(e){(0,Je.Z)(r,e);var t=yI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,s=a===void 0?!1:a,l=i.raisingHeight,c=l===void 0?0:l,p=i.topsurface,y=p===void 0?!0:p,b=i.sidesurface,A=b===void 0?!0:b,w=i.sourceColor,I=i.targetColor,P=0,L=[1,1,1,1],V=[1,1,1,1];w&&I&&(L=fi(w),V=fi(I),P=1);var K={u_sourceColor:L,u_targetColor:V,u_linearColor:P,u_topsurface:Number(y),u_sidesurface:Number(A),u_heightfixed:Number(s),u_raisingHeight:Number(c),u_texture:this.texture};this.texture&&(this.textures=[this.texture]);var le=this.getUniformsBufferInfo(K);return le}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,depth:{enable:!0},inject:this.getInject(),triangulation:fy});case 4:return y=A.sent,A.abrupt("return",[y]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:EI,vert:SI,type:"polygonExtrudeTexture"}:a?{frag:AI,vert:TI,type:"polygonExtrudePickLight"}:{frag:xI,vert:bI,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],c=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var p=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),y=(0,re.Z)(p,2),b=y[0],A=y[1],w=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),I=(0,re.Z)(w,2),P=I[0],L=I[1];l=P-b,c=L-A,a=[b,A,P,L]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Zn.Attribute,descriptor:{name:"a_uvs",shaderLocation:ni.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(K,le,xe){var ke=xe[0],je=xe[1];return[(ke-a[0])/l,(je-a[1])/c,xe[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(K,le,xe,ke,je){return je}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(K){var le=K.size,xe=le===void 0?10:le;return Array.isArray(xe)?[xe[0]]:[xe]}}})}},{key:"loadTexture",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s=this,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=this.layer.getLayerConfig(),c=l.mapTexture,p=this.rendererService.createTexture2D,this.texture=p({height:0,width:0}),!c){b.next=5;break}return b.abrupt("return",new Promise(function(A,w){var I=new Image;I.crossOrigin="anonymous",I.src=c,I.onload=function(){return s.texture=p({data:I,width:I.width,height:I.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),A(null)},I.onerror=function(){w(new Error("image load error"))}}));case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Da);function CI(e){var t=RI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function RI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MI=`
in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,II=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,PI=function(e){(0,Je.Z)(r,e);var t=CI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i={},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,c=s.vert,p=s.type,this.initUniformsBuffer(),A.next=4,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:fy,depth:{enable:!0}});case 4:return y=A.sent,A.abrupt("return",[y]);case 6:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:MI,vert:II,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Zn.Attribute,descriptor:{name:"a_Normal",shaderLocation:ni.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,s,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Zn.Attribute,descriptor:{name:"a_Size",shaderLocation:ni.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Da);function OI(e){var t=kI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function kI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DI=`in vec4 v_color;
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,LI=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec3 v_linear;
in vec2 v_pos;
in vec4 v_color;
out vec4 outputColor;
#pragma include "picking"

void main() {
   outputColor = v_color;
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,BI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;


layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};


out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

out vec3 v_linear;
out vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,FI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,NI=function(e){(0,Je.Z)(r,e);var t=OI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l,p={u_raisingHeight:Number(s),u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0},y=this.getUniformsBufferInfo(p);return y}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b;return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.getModelParams(),l=s.frag,c=s.vert,p=s.triangulation,y=s.type,this.initUniformsBuffer(),this.layer.triangulation=p,w.next=5,this.layer.buildLayerModel({moduleName:y,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:p,primitive:Y.TRIANGLES,depth:{enable:!1}});case 5:return b=w.sent,w.abrupt("return",[b]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Zn.Attribute,descriptor:{name:"a_linear",shaderLocation:ni.LINEAR,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(c,p,y){return[y[3],y[4],y[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:LI,vert:BI,type:"polygonLinear",triangulation:vC}:{frag:DI,vert:FI,type:"polygonFill",triangulation:Zp}}}]),r}(Da);function UI(e){var t=zI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function zI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZI=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,VI=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,UN=mi.isNumber,jI=function(e){(0,Je.Z)(r,e);var t=UI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.watercolor,s=a===void 0?"#6D99A8":a,l=i.watercolor2,c=l===void 0?"#0F121C":l,p={u_watercolor:fi(s),u_watercolor2:fi(c),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];var y=this.getUniformsBufferInfo(p);return y}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:VI,fragmentShader:ZI,inject:this.getInject(),triangulation:cy,primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,re.Z)(i,4),s=a[0],l=a[1],c=a[2],p=a[3],y=c-s,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Zn.Attribute,descriptor:{name:"a_uv",shaderLocation:ni.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,L){var V=w.version==="GAODE2.x"?w.originCoordinates[0][L]:P,K=(0,re.Z)(V,2),le=K[0],xe=K[1];return[(le-s)/y,(xe-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(p){i.texture1=c(p[0]),i.texture2=c(p[1]),i.texture3=c(p[2]),i.layerService.reRender()});function l(p){var y=0,b=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(w){var I=new Image;I.crossOrigin="",I.src=w,b.push(I),I.onload=function(){y++,y===3&&p(b)}})}function c(p){return a({data:p,width:p.width,height:p.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR})}}}]),r}(Da);function HI(e){var t=WI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function WI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GI=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,XI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,zN=mi.isNumber,$I=function(e){(0,Je.Z)(r,e);var t=HI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.speed,s=a===void 0?.5:a,l={u_speed:s,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];var c=this.getUniformsBufferInfo(l);return c}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:XI,fragmentShader:GI,triangulation:cy,inject:this.getInject(),primitive:Y.TRIANGLES,depth:{enable:!1}});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,re.Z)(i,4),s=a[0],l=a[1],c=a[2],p=a[3],y=c-s,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Zn.Attribute,descriptor:{name:"a_uv",shaderLocation:ni.UV,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,L){var V=w.version==="GAODE2.x"?w.originCoordinates[0][L]:P,K=(0,re.Z)(V,2),le=K[0],xe=K[1];return[(le-s)/y,(xe-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var c=new Image;c.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),c.src=s):c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR}),i.layerService.reRender()}}}]),r}(Da),YI={fill:NI,line:Yx,extrude:wI,text:hb,point_fill:Qx,point_image:Jx,point_normal:tb,point_extrude:Kx,water:$I,ocean:jI,extrusion:PI},qI=YI;function KI(e){var t=QI();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function QI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Im=function(e){(0,Je.Z)(r,e);var t=KI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","PolygonLayer"),(0,F.Z)((0,Be.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new qI[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,c=this.iconService.getIconMap(),p=i.find(function(b){return b.hasOwnProperty("shape")});if(p){var y=p.shape;return y==="dot"?"point_normal":(s==null?void 0:s.indexOf(y))!==-1?"point_fill":(l==null?void 0:l.indexOf(y))!==-1?"point_extrude":c.hasOwnProperty(y)?"point_image":"text"}else return"fill"}}]),r}(Cp);function JI(e){var t=eP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function eP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tP=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,rP=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,db=function(e){(0,Je.Z)(r,e);var t=JI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,c=l===void 0?!0:l,p=i.clampHigh,y=p===void 0?!0:p,b=i.noDataValue,A=b===void 0?-9999999:b,w=i.domain,I=i.rampColors,P=w||Fa(I);this.colorTexture=this.layer.textureService.getColorTexture(I,P);var L={u_domain:P,u_opacity:s||1,u_noDataValue:A,u_clampLow:c,u_clampHigh:typeof y!="undefined"?y:c,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];var V=this.getUniformsBufferInfo(L);return V}},{key:"getRasterData",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(s.data)){A.next=4;break}return A.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return A.next=6,s.data;case 6:return l=A.sent,c=l.rasterData,p=l.width,y=l.height,A.abrupt("return",{data:Array.from(c),width:p,height:y});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w,I,P;return Ae().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService,c=l.createTexture2D,p=l.queryVerdorInfo,y=s.data.dataArray[0],V.next=6,this.getRasterData(y);case 6:return b=V.sent,A=b.data,w=b.width,I=b.height,this.texture=c({data:new Float32Array(A),width:w,height:I,format:p()==="WebGL1"?Y.LUMINANCE:Y.RED,type:Y.FLOAT,alignment:1}),V.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:rP,fragmentShader:tP,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 13:return P=V.sent,V.abrupt("return",[P]);case 15:case"end":return V.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{shaderLocation:ni.UV,name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Da),nP=["data"],iP=["rasterData"];function aP(e){var t=oP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function oP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sP=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(outputColor.a < 0.01)
    discard;
 
}`,uP=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,lP=function(e){(0,Je.Z)(r,e);var t=aP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"dataOption",{}),n}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,c=l===void 0?0:l,p=this.dataOption,y=p.rMinMax,b=y===void 0?[0,255]:y,A=p.gMinMax,w=A===void 0?[0,255]:A,I=p.bMinMax,P=I===void 0?[0,255]:I,L={u_rminmax:b,u_gminmax:w,u_bminmax:P,u_opacity:s||1,u_noDataValue:c,u_texture:this.texture};this.textures=[this.texture];var V=this.getUniformsBufferInfo(L);return V}},{key:"getRasterData",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l,c,p,y,b;return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!Array.isArray(s.data)){w.next=4;break}return l=s.data,c=(0,gs.Z)(s,nP),this.dataOption=c,w.abrupt("return",(0,O.Z)({data:l},c));case 4:return w.next=6,s.data;case 6:if(p=w.sent,y=p.rasterData,b=(0,gs.Z)(p,iP),this.dataOption=b,!Array.isArray(y)){w.next=14;break}return w.abrupt("return",(0,O.Z)({data:y},b));case 14:return w.abrupt("return",(0,O.Z)({data:Array.from(y)},b));case 15:case"end":return w.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,c=s.data.dataArray[0],P.next=6,this.getRasterData(c);case 6:return p=P.sent,y=p.data,b=p.width,A=p.height,this.texture=l({data:new Float32Array(y),width:b,height:A,format:Y.RGB,type:Y.FLOAT}),P.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:uP,fragmentShader:sP,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 13:return w=P.sent,P.abrupt("return",[w]);case 15:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",shaderLocation:ni.UV,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Da);function cP(e){var t=fP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function fP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hP=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,pP=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,dP=function(e){(0,Je.Z)(r,e);var t=cP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,c=i.clampHigh,p=c===void 0?!0:c,y=i.noDataValue,b=y===void 0?-9999999:y,A=i.domain,w=i.rampColors,I=i.colorTexture,P=i.rScaler,L=P===void 0?6553.6:P,V=i.gScaler,K=V===void 0?25.6:V,le=i.bScaler,xe=le===void 0?.1:le,ke=i.offset,je=ke===void 0?1e4:ke,it=A||Fa(w),vt=I;return I?this.layer.textureService.setColorTexture(I,w,it):vt=this.layer.textureService.getColorTexture(w,it),{u_opacity:a||1,u_texture:this.texture,u_domain:it,u_clampLow:l,u_clampHigh:typeof p!="undefined"?p:l,u_noDataValue:b,u_unpack:[L,K,xe,je],u_colorTexture:vt}}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,b.next=4,s.data.images;case 4:return c=b.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,min:Y.LINEAR,mag:Y.LINEAR}),b.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:pP,fragmentShader:hP,triangulation:V0,primitive:Y.TRIANGLES,depth:{enable:!1}});case 8:return p=b.sent,b.abrupt("return",[p]);case 10:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Zn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Da),vP={raster:db,rasterRgb:lP,raster3d:db,rasterTerrainRgb:dP},mP=vP;function gP(e){var t=yP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function yP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W0=function(e){(0,Je.Z)(r,e);var t=gP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","RasterLayer"),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new mP[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Cp);function _P(e){var t=xP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function xP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bP=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,EP=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,SP=function(e){(0,Je.Z)(r,e);var t=_P(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,O.Z)((0,O.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,c=l===void 0?"#000":l,p={u_color:fi(c),u_opacity:s||1},y=this.getUniformsBufferInfo(p);return y}},{key:"initModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.initUniformsBuffer(),c.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:EP,fragmentShader:bP,triangulation:cy,depth:{enable:!1},pick:!1});case 3:return s=c.sent,c.abrupt("return",[s]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Da),AP={fill:SP},TP=AP;function wP(e){var t=CP();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function CP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vb=function(e){(0,Je.Z)(r,e);var t=wP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"type","MaskLayer"),n}return(0,Q.Z)(r,[{key:"buildModels",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=this.getModelType(),this.layerModel=new TP[s](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Cp),mb,gb,yb,_b,G0,xb,bb,RP=mi.cloneDeep,MP=(mb=(0,pr.b2)(),gb=(0,pr.f3)(xt.IMapService),yb=(0,pr.f3)(xt.IFontService),mb(_b=(G0=function(){function e(){(0,ye.Z)(this,e),Ir(this,"mapService",xb,this),Ir(this,"fontService",bb,this)}return(0,Q.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,St.Z)(Ae().mark(function s(){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r.log(Cs.MappingStart,hr.INIT),i.generateMaping(r,{styleAttributeService:a}),r.log(Cs.MappingEnd,hr.INIT);case 3:case"end":return c.stop()}},s)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,St.Z)(Ae().mark(function l(c){var p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c){b.next=2;break}return b.abrupt("return",c);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(Cs.MappingStart,hr.UPDATE),p=i.generateMaping(r,{styleAttributeService:a}),r.log(Cs.MappingEnd,hr.UPDATE),b.abrupt("return",p);case 7:case"end":return b.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=r.getSource();if(!(r.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],c=a.getLayerStyleAttribute("filter"),p=s.data.dataArray;if(!(Array.isArray(p)&&p.length===0)){var y=l.filter(function(w){return w.needRemapping}),b=p;if(c!=null&&c.needRemapping&&c!==null&&c!==void 0&&c.scale&&(b=p.filter(function(w){return i.applyAttributeMapping(c,w)[0]})),y.length){var A=i.mapping(r,y,b,r.getEncodedData());r.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(r,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),c=r.getSource().data.dataArray,p=c;l!=null&&l.scale&&(p=c.filter(function(b){return i.applyAttributeMapping(l,b)[0]})),p=r.processData(p);var y=this.mapping(r,s,p,void 0);return r.setEncodedData(y),r.emit("dataUpdate",null),!0}},{key:"mapping",value:function(r,n,i,a){var s=this,l=n.filter(function(p){return p.scale!==void 0}).filter(function(p){return p.name!=="filter"}),c=i.map(function(p,y){var b=a?a[y]:{},A=(0,O.Z)({id:p._id,coordinates:p.coordinates},b);return l.forEach(function(w){var I=s.applyAttributeMapping(w,p);(w.name==="color"||w.name==="stroke")&&(I=I.map(function(P){return fi(P)})),A[w.name]=Array.isArray(I)&&I.length===1?I[0]:I,w.name==="shape"&&(A.shape=s.fontService.getIconFontKey(A[w.name]))}),A});return n.forEach(function(p){p.needRemapping=!1}),this.adjustData2Amap2Coordinates(c,r),this.adjustData2SimpleCoordinates(c),c}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var i=this;if(r.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;r.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=RP(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version==="SIMPLE"&&r.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var i=[];return r.map(function(s){var l=[];s.map(function(c){l.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(l)}),i}else{var a=[];return r.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(r,n){var i;if(!r.scale)return[];var a=(r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(c){var p,y=c.field;(n.hasOwnProperty(y)||((p=r.scale)===null||p===void 0?void 0:p.type)==="variable")&&s.push(n[y])});var l=r.mapping?r.mapping(s):[];return l}},{key:"getArrowPoints",value:function(r,n){var i=[n[0]-r[0],n[1]-r[1]],a=Ml(i),s=[r[0]+a[0]*1e-4,r[1]+a[1]*1e-4];return s}}]),e}(),xb=mn(G0.prototype,"mapService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bb=mn(G0.prototype,"fontService",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0))||_b),Eb,Sb,IP=(Eb=(0,pr.b2)(),Eb(Sb=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(xt.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,St.Z)(Ae().mark(function i(){var a,s,l,c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(r.log(Cs.SourceInitStart,hr.INIT),a=r.getSource(),a||(s=r.sourceOption||r.defaultSourceConfig,l=s.data,c=s.options,a=new ix(l,c),r.setSource(a)),!a.inited){y.next=8;break}n.updateClusterData(r),r.log(Cs.SourceInitEnd,hr.INIT),y.next=10;break;case 8:return y.next=10,new Promise(function(b){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(r),r.log(Cs.SourceInitEnd,hr.INIT)),b(null)})});case 10:case"end":return y.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,St.Z)(Ae().mark(function i(){var a,s,l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,l=a||s,p.abrupt("return",l);case 5:case"end":return p.stop()}},i)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,c=r.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(l)),i&&Math.abs(r.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||Sb);function vy(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Ab(e){return e.length===1&&(e=PP(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function PP(e){return function(t,r){return vy(e(t),r)}}var Tb=Ab(vy),OP=Tb.right,ZN=Tb.left,X0=OP;function wb(e,t){var r=e.length,n=-1,i,a,s;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<r;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<r;)(i=t(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var Cb=Array.prototype,VN=Cb.slice,jN=Cb.map,gy=Math.sqrt(50),yy=Math.sqrt(10),_y=Math.sqrt(2);function Rb(e,t,r){var n,i=-1,a,s,l;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(l=$0(e,t,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),t=Math.floor(t/l),s=new Array(a=Math.ceil(t-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),t=Math.ceil(t*l),s=new Array(a=Math.ceil(e-t+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function $0(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=gy?10:a>=yy?5:a>=_y?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=gy?10:a>=yy?5:a>=_y?2:1)}function xy(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=gy?i*=10:a>=yy?i*=5:a>=_y&&(i*=2),t<e?-i:i}function HN(){var e=identity,t=extent,r=sturges;function n(i){var a,s=i.length,l,c=new Array(s);for(a=0;a<s;++a)c[a]=e(i[a],a,i);var p=t(c),y=p[0],b=p[1],A=r(c,y,b);Array.isArray(A)||(A=tickStep(y,b,A),A=range(Math.ceil(y/A)*A,b,A));for(var w=A.length;A[0]<=y;)A.shift(),--w;for(;A[w-1]>b;)A.pop(),--w;var I=new Array(w+1),P;for(a=0;a<=w;++a)P=I[a]=[],P.x0=a>0?A[a-1]:y,P.x1=a<w?A[a]:b;for(a=0;a<s;++a)l=c[a],y<=l&&l<=b&&I[bisect(A,l,0,w)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(t=typeof i=="function"?i:constant([i[0],i[1]]),n):t},n.thresholds=function(i){return arguments.length?(r=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):r},n}function WN(e,t,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-t)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function kP(e){return e===null?NaN:+e}function DP(e,t,r){if(r==null&&(r=kP),!!(n=e.length)){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,a=Math.floor(i),s=+r(e[a],a,e),l=+r(e[a+1],a+1,e);return s+(l-s)*(i-a)}}var LP=Z(87765),Uc="$";function Y0(){}Y0.prototype=Mb.prototype={constructor:Y0,has:function(e){return Uc+e in this},get:function(e){return this[Uc+e]},set:function(e,t){return this[Uc+e]=t,this},remove:function(e){var t=Uc+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Uc&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Uc&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Uc&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Uc&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Uc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Uc)return!1;return!0},each:function(e){for(var t in this)t[0]===Uc&&e(this[t],t.slice(1),this)}};function Mb(e,t){var r=new Y0;if(e instanceof Y0)e.each(function(l,c){r.set(c,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var s in e)r.set(s,e[s]);return r}var by=Mb;function GN(){var e=[],t=[],r,n,i;function a(l,c,p,y){if(c>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var b=-1,A=l.length,w=e[c++],I,P,L=map(),V,K=p();++b<A;)(V=L.get(I=w(P=l[b])+""))?V.push(P):L.set(I,[P]);return L.each(function(le,xe){y(K,xe,a(le,c,p,y))}),K}function s(l,c){if(++c>e.length)return l;var p,y=t[c-1];return n!=null&&c>=e.length?p=l.entries():(p=[],l.each(function(b,A){p.push({key:A,values:s(b,c)})})),y!=null?p.sort(function(b,A){return y(b.key,A.key)}):p}return i={object:function(l){return a(l,0,BP,FP)},map:function(l){return a(l,0,Ib,Pb)},entries:function(l){return s(a(l,0,Ib,Pb),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return t[e.length-1]=l,i},sortValues:function(l){return r=l,i},rollup:function(l){return n=l,i}}}function BP(){return{}}function FP(e,t,r){e[t]=r}function Ib(){return map()}function Pb(e,t,r){e.set(t,r)}function q0(){}var yd=by.prototype;q0.prototype=NP.prototype={constructor:q0,has:yd.has,add:function(e){return e+="",this[Uc+e]=e,this},remove:yd.remove,clear:yd.clear,values:yd.keys,size:yd.size,empty:yd.empty,each:yd.each};function NP(e,t){var r=new q0;if(e instanceof q0)e.each(function(a){r.add(a)});else if(e){var n=-1,i=e.length;if(t==null)for(;++n<i;)r.add(e[n]);else for(;++n<i;)r.add(t(e[n],n,e))}return r}var XN=null,Ob=Array.prototype,kb=Ob.map,_d=Ob.slice;function Ip(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Db(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var Lb={name:"implicit"};function K0(){var e=by(),t=[],r=[],n=Lb;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Lb)return n;e.set(s,l=t.push(a))}return r[(l-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=by();for(var s=-1,l=a.length,c,p;++s<l;)e.has(p=(c=a[s])+"")||e.set(p,t.push(c));return i},i.range=function(a){return arguments.length?(r=_d.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return K0(t,r).unknown(n)},Ip.apply(i,arguments),i}function Bb(){var e=ordinal().unknown(void 0),t=e.domain,r=e.range,n=[0,1],i,a,s=!1,l=0,c=0,p=.5;delete e.unknown;function y(){var b=t().length,A=n[1]<n[0],w=n[A-0],I=n[1-A];i=(I-w)/Math.max(1,b-l+c*2),s&&(i=Math.floor(i)),w+=(I-w-i*(b-l))*p,a=i*(1-l),s&&(w=Math.round(w),a=Math.round(a));var P=sequence(b).map(function(L){return w+i*L});return r(A?P.reverse():P)}return e.domain=function(b){return arguments.length?(t(b),y()):t()},e.range=function(b){return arguments.length?(n=[+b[0],+b[1]],y()):n.slice()},e.rangeRound=function(b){return n=[+b[0],+b[1]],s=!0,y()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(b){return arguments.length?(s=!!b,y()):s},e.padding=function(b){return arguments.length?(l=Math.min(1,c=+b),y()):l},e.paddingInner=function(b){return arguments.length?(l=Math.min(1,b),y()):l},e.paddingOuter=function(b){return arguments.length?(c=+b,y()):c},e.align=function(b){return arguments.length?(p=Math.max(0,Math.min(1,b)),y()):p},e.copy=function(){return Bb(t(),n).round(s).paddingInner(l).paddingOuter(c).align(p)},initRange.apply(y(),arguments)}function Fb(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Fb(t())},e}function $N(){return Fb(Bb.apply(null,arguments).paddingInner(1))}var UP=Z(21775),zP=Z(73626);function ZP(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function VP(e){return function(){return e}}function jP(e){return+e}var Nb=[0,1];function $u(e){return e}function Ey(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:VP(isNaN(t)?NaN:.5)}function Ub(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function HP(e,t,r){var n=e[0],i=e[1],a=t[0],s=t[1];return i<n?(n=Ey(i,n),a=r(s,a)):(n=Ey(n,i),a=r(a,s)),function(l){return a(n(l))}}function WP(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=Ey(e[s],e[s+1]),a[s]=r(t[s],t[s+1]);return function(l){var c=X0(e,l,1,n)-1;return a[c](i[c](l))}}function Q0(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Sy(){var e=Nb,t=Nb,r=UP.Z,n,i,a,s=$u,l,c,p;function y(){return l=Math.min(e.length,t.length)>2?WP:HP,c=p=null,b}function b(A){return isNaN(A=+A)?a:(c||(c=l(e.map(n),t,r)))(n(s(A)))}return b.invert=function(A){return s(i((p||(p=l(t,e.map(n),zP.Z)))(A)))},b.domain=function(A){return arguments.length?(e=kb.call(A,jP),s===$u||(s=Ub(e)),y()):e.slice()},b.range=function(A){return arguments.length?(t=_d.call(A),y()):t.slice()},b.rangeRound=function(A){return t=_d.call(A),r=ZP,y()},b.clamp=function(A){return arguments.length?(s=A?Ub(e):$u,b):s!==$u},b.interpolate=function(A){return arguments.length?(r=A,y()):r},b.unknown=function(A){return arguments.length?(a=A,b):a},function(A,w){return n=A,i=w,y()}}function zb(e,t){return Sy()(e,t)}var GP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function J0(e){if(!(t=GP.exec(e)))throw new Error("invalid format: "+e);var t;return new Ay({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}J0.prototype=Ay.prototype;function Ay(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ay.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function XP(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function eg(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function mv(e){return e=eg(Math.abs(e)),e?e[1]:NaN}function $P(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mv(t)/3)))*3-mv(Math.abs(e)))}function YP(e,t){return function(r,n){for(var i=r.length,a=[],s=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),a.push(r.substring(i-=l,i+l)),!((c+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(t)}}function qP(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}function KP(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var Zb;function QP(e,t){var r=eg(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(Zb=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+eg(e,Math.max(0,t+a-1))[0]}function Vb(e,t){var r=eg(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var jb={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:XP,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Vb(e*100,t)},r:Vb,s:QP,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Hb(e){return e}var Wb=Array.prototype.map,Gb=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function JP(e){var t=e.grouping===void 0||e.thousands===void 0?Hb:YP(Wb.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Hb:qP(Wb.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function p(b){b=J0(b);var A=b.fill,w=b.align,I=b.sign,P=b.symbol,L=b.zero,V=b.width,K=b.comma,le=b.precision,xe=b.trim,ke=b.type;ke==="n"?(K=!0,ke="g"):jb[ke]||(le===void 0&&(le=12),xe=!0,ke="g"),(L||A==="0"&&w==="=")&&(L=!0,A="0",w="=");var je=P==="$"?r:P==="#"&&/[boxX]/.test(ke)?"0"+ke.toLowerCase():"",it=P==="$"?n:/[%p]/.test(ke)?s:"",vt=jb[ke],Lt=/[defgprs%]/.test(ke);le=le===void 0?6:/[gprs]/.test(ke)?Math.max(1,Math.min(21,le)):Math.max(0,Math.min(20,le));function lr(cr){var Rr=je,fn=it,Pn,Ri,ya;if(ke==="c")fn=vt(cr)+fn,cr="";else{cr=+cr;var Ha=cr<0||1/cr<0;if(cr=isNaN(cr)?c:vt(Math.abs(cr),le),xe&&(cr=KP(cr)),Ha&&+cr==0&&I!=="+"&&(Ha=!1),Rr=(Ha?I==="("?I:l:I==="-"||I==="("?"":I)+Rr,fn=(ke==="s"?Gb[8+Zb/3]:"")+fn+(Ha&&I==="("?")":""),Lt){for(Pn=-1,Ri=cr.length;++Pn<Ri;)if(ya=cr.charCodeAt(Pn),48>ya||ya>57){fn=(ya===46?i+cr.slice(Pn+1):cr.slice(Pn))+fn,cr=cr.slice(0,Pn);break}}}K&&!L&&(cr=t(cr,Infinity));var no=Rr.length+cr.length+fn.length,us=no<V?new Array(V-no+1).join(A):"";switch(K&&L&&(cr=t(us+cr,us.length?V-fn.length:Infinity),us=""),w){case"<":cr=Rr+cr+fn+us;break;case"=":cr=Rr+us+cr+fn;break;case"^":cr=us.slice(0,no=us.length>>1)+Rr+cr+fn+us.slice(no);break;default:cr=us+Rr+cr+fn;break}return a(cr)}return lr.toString=function(){return b+""},lr}function y(b,A){var w=p((b=J0(b),b.type="f",b)),I=Math.max(-8,Math.min(8,Math.floor(mv(A)/3)))*3,P=Math.pow(10,-I),L=Gb[8+I/3];return function(V){return w(P*V)+L}}return{format:p,formatPrefix:y}}var tg,Ty,Xb;e4({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function e4(e){return tg=JP(e),Ty=tg.format,Xb=tg.formatPrefix,tg}function t4(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,mv(t)-mv(e))+1}function r4(e){return Math.max(0,-mv(Math.abs(e)))}function n4(e,t,r,n){var i=xy(e,t,r),a;switch(n=J0(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=$P(i,s))&&(n.precision=a),Xb(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=t4(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=r4(i))&&(n.precision=a-(n.type==="%")*2);break}}return Ty(n)}function Pm(e){var t=e.domain;return e.ticks=function(r){var n=t();return Rb(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var i=t();return n4(i[0],i[i.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,s=n[i],l=n[a],c;return l<s&&(c=s,s=l,l=c,c=i,i=a,a=c),c=$0(s,l,r),c>0?(s=Math.floor(s/c)*c,l=Math.ceil(l/c)*c,c=$0(s,l,r)):c<0&&(s=Math.ceil(s*c)/c,l=Math.floor(l*c)/c,c=$0(s,l,r)),c>0?(n[i]=Math.floor(s/c)*c,n[a]=Math.ceil(l/c)*c,t(n)):c<0&&(n[i]=Math.ceil(s*c)/c,n[a]=Math.floor(l*c)/c,t(n)),e},e}function $b(){var e=zb($u,$u);return e.copy=function(){return Q0(e,$b())},Ip.apply(e,arguments),Pm(e)}function i4(e){var t;function r(n){return isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return i4(e).unknown(t)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function Yb(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],a=e[n],s;return a<i&&(s=r,r=n,n=s,s=i,i=a,a=s),e[r]=t.floor(i),e[n]=t.ceil(a),e}function qb(e){return Math.log(e)}function Kb(e){return Math.exp(e)}function a4(e){return-Math.log(-e)}function o4(e){return-Math.exp(-e)}function s4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function u4(e){return e===10?s4:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function l4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function Qb(e){return function(t){return-e(-t)}}function c4(e){var t=e(qb,Kb),r=t.domain,n=10,i,a;function s(){return i=l4(n),a=u4(n),r()[0]<0?(i=Qb(i),a=Qb(a),e(a4,o4)):e(qb,Kb),t}return t.base=function(l){return arguments.length?(n=+l,s()):n},t.domain=function(l){return arguments.length?(r(l),s()):r()},t.ticks=function(l){var c=r(),p=c[0],y=c[c.length-1],b;(b=y<p)&&(A=p,p=y,y=A);var A=i(p),w=i(y),I,P,L,V=l==null?10:+l,K=[];if(!(n%1)&&w-A<V){if(A=Math.round(A)-1,w=Math.round(w)+1,p>0){for(;A<w;++A)for(P=1,I=a(A);P<n;++P)if(L=I*P,!(L<p)){if(L>y)break;K.push(L)}}else for(;A<w;++A)for(P=n-1,I=a(A);P>=1;--P)if(L=I*P,!(L<p)){if(L>y)break;K.push(L)}}else K=Rb(A,w,Math.min(w-A,V)).map(a);return b?K.reverse():K},t.tickFormat=function(l,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=Ty(c)),l===Infinity)return c;l==null&&(l=10);var p=Math.max(1,n*l/t.ticks().length);return function(y){var b=y/a(Math.round(i(y)));return b*n<n-.5&&(b*=n),b<=p?c(y):""}},t.nice=function(){return r(Yb(r(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},t}function Jb(){var e=c4(Sy()).domain([1,10]);return e.copy=function(){return Q0(e,Jb()).base(e.base())},Ip.apply(e,arguments),e}function eE(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function tE(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function f4(e){var t=1,r=e(eE(t),tE(t));return r.constant=function(n){return arguments.length?e(eE(t=+n),tE(t)):t},linearish(r)}function h4(){var e=f4(transformer());return e.copy=function(){return copy(e,h4()).constant(e.constant())},initRange.apply(e,arguments)}function rE(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function p4(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function d4(e){return e<0?-e*e:e*e}function v4(e){var t=e($u,$u),r=1;function n(){return r===1?e($u,$u):r===.5?e(p4,d4):e(rE(r),rE(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},Pm(t)}function wy(){var e=v4(Sy());return e.copy=function(){return Q0(e,wy()).exponent(e.exponent())},Ip.apply(e,arguments),e}function YN(){return wy.apply(null,arguments).exponent(.5)}function nE(){var e=[],t=[],r=[],n;function i(){var s=0,l=Math.max(1,t.length);for(r=new Array(l-1);++s<l;)r[s-1]=DP(e,s/l);return a}function a(s){return isNaN(s=+s)?n:t[X0(r,s)]}return a.invertExtent=function(s){var l=t.indexOf(s);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,c=s.length,p;l<c;++l)p=s[l],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(vy),i()},a.range=function(s){return arguments.length?(t=_d.call(s),i()):t.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return r.slice()},a.copy=function(){return nE().domain(e).range(t).unknown(n)},Ip.apply(a,arguments)}function iE(){var e=0,t=1,r=1,n=[.5],i=[0,1],a;function s(c){return c<=c?i[X0(n,c,0,r)]:a}function l(){var c=-1;for(n=new Array(r);++c<r;)n[c]=((c+1)*t-(c-r)*e)/(r+1);return s}return s.domain=function(c){return arguments.length?(e=+c[0],t=+c[1],l()):[e,t]},s.range=function(c){return arguments.length?(r=(i=_d.call(c)).length-1,l()):i.slice()},s.invertExtent=function(c){var p=i.indexOf(c);return p<0?[NaN,NaN]:p<1?[e,n[0]]:p>=r?[n[r-1],t]:[n[p-1],n[p]]},s.unknown=function(c){return arguments.length&&(a=c),s},s.thresholds=function(){return n.slice()},s.copy=function(){return iE().domain([e,t]).range(i).unknown(a)},Ip.apply(Pm(s),arguments)}function aE(){var e=[.5],t=[0,1],r,n=1;function i(a){return a<=a?t[X0(e,a,0,n)]:r}return i.domain=function(a){return arguments.length?(e=_d.call(a),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=_d.call(a),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var s=t.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return aE().domain(e).range(t).unknown(r)},Ip.apply(i,arguments)}var Cy=new Date,Ry=new Date;function gl(e,t,r,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return t(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var c=[],p;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return c;do c.push(p=new Date(+a)),t(a,l),e(a);while(p<a&&a<s);return c},i.filter=function(a){return gl(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!a(s););else for(;--l>=0;)for(;t(s,1),!a(s););})},r&&(i.count=function(a,s){return Cy.setTime(+a),Ry.setTime(+s),e(Cy),e(Ry),Math.floor(r(Cy,Ry))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a==0}:function(s){return i.count(0,s)%a==0}):i}),i}var My=gl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});My.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gl(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};var gv=My,qN=My.range,oE=gl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),m4=oE,KN=oE.range,rg=1e3,Om=6e4,sE=36e5,uE=864e5,lE=6048e5;function xd(e){return gl(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Om)/lE})}var Iy=xd(0),ng=xd(1),g4=xd(2),y4=xd(3),yv=xd(4),_4=xd(5),x4=xd(6),QN=Iy.range,JN=ng.range,e6=g4.range,t6=y4.range,r6=yv.range,n6=_4.range,i6=x4.range,cE=gl(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Om)/uE},function(e){return e.getDate()-1}),Py=cE,a6=cE.range,fE=gl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rg-e.getMinutes()*Om)},function(e,t){e.setTime(+e+t*sE)},function(e,t){return(t-e)/sE},function(e){return e.getHours()}),b4=fE,o6=fE.range,hE=gl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*rg)},function(e,t){e.setTime(+e+t*Om)},function(e,t){return(t-e)/Om},function(e){return e.getMinutes()}),E4=hE,s6=hE.range,pE=gl(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*rg)},function(e,t){return(t-e)/rg},function(e){return e.getUTCSeconds()}),S4=pE,u6=pE.range,ig=gl(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});ig.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?gl(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):ig};var A4=ig,l6=ig.range;function bd(e){return gl(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/lE})}var dE=bd(0),ag=bd(1),T4=bd(2),w4=bd(3),_v=bd(4),C4=bd(5),R4=bd(6),c6=dE.range,f6=ag.range,h6=T4.range,p6=w4.range,d6=_v.range,v6=C4.range,m6=R4.range,vE=gl(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/uE},function(e){return e.getUTCDate()-1}),mE=vE,g6=vE.range,Oy=gl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Oy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gl(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};var km=Oy,y6=Oy.range;function ky(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Dy(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Dm(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function M4(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,p=Lm(i),y=Bm(i),b=Lm(a),A=Bm(a),w=Lm(s),I=Bm(s),P=Lm(l),L=Bm(l),V=Lm(c),K=Bm(c),le={a:Ha,A:no,b:us,B:xl,c:null,d:EE,e:EE,f:Q4,g:uO,G:cO,H:Y4,I:q4,j:K4,L:SE,m:J4,M:eO,p:YF,q:qF,Q:ME,s:IE,S:tO,u:rO,U:nO,V:iO,w:aO,W:oO,x:null,X:null,y:sO,Y:lO,Z:fO,"%":RE},xe={a:KF,A:QF,b:JF,B:eN,c:null,d:TE,e:TE,f:vO,g:TO,G:CO,H:hO,I:pO,j:dO,L:wE,m:mO,M:gO,p:tN,q:rN,Q:ME,s:IE,S:yO,u:_O,U:xO,V:bO,w:EO,W:SO,x:null,X:null,y:AO,Y:wO,Z:RO,"%":RE},ke={a:lr,A:cr,b:Rr,B:fn,c:Pn,d:xE,e:xE,f:W4,g:_E,G:yE,H:bE,I:bE,j:Z4,L:H4,m:z4,M:V4,p:Lt,q:U4,Q:X4,s:$4,S:j4,u:D4,U:L4,V:B4,w:k4,W:F4,x:Ri,X:ya,y:_E,Y:yE,Z:N4,"%":G4};le.x=je(r,le),le.X=je(n,le),le.c=je(t,le),xe.x=je(r,xe),xe.X=je(n,xe),xe.c=je(t,xe);function je(li,da){return function(Ba){var Sn=[],jl=-1,Io=0,fc=li.length,hc,Id,oA;for(Ba instanceof Date||(Ba=new Date(+Ba));++jl<fc;)li.charCodeAt(jl)===37&&(Sn.push(li.slice(Io,jl)),(Id=gE[hc=li.charAt(++jl)])!=null?hc=li.charAt(++jl):Id=hc==="e"?" ":"0",(oA=da[hc])&&(hc=oA(Ba,Id)),Sn.push(hc),Io=jl+1);return Sn.push(li.slice(Io,jl)),Sn.join("")}}function it(li,da){return function(Ba){var Sn=Dm(1900,void 0,1),jl=vt(Sn,li,Ba+="",0),Io,fc;if(jl!=Ba.length)return null;if("Q"in Sn)return new Date(Sn.Q);if("s"in Sn)return new Date(Sn.s*1e3+("L"in Sn?Sn.L:0));if(da&&!("Z"in Sn)&&(Sn.Z=0),"p"in Sn&&(Sn.H=Sn.H%12+Sn.p*12),Sn.m===void 0&&(Sn.m="q"in Sn?Sn.q:0),"V"in Sn){if(Sn.V<1||Sn.V>53)return null;"w"in Sn||(Sn.w=1),"Z"in Sn?(Io=Dy(Dm(Sn.y,0,1)),fc=Io.getUTCDay(),Io=fc>4||fc===0?ag.ceil(Io):ag(Io),Io=mE.offset(Io,(Sn.V-1)*7),Sn.y=Io.getUTCFullYear(),Sn.m=Io.getUTCMonth(),Sn.d=Io.getUTCDate()+(Sn.w+6)%7):(Io=ky(Dm(Sn.y,0,1)),fc=Io.getDay(),Io=fc>4||fc===0?ng.ceil(Io):ng(Io),Io=Py.offset(Io,(Sn.V-1)*7),Sn.y=Io.getFullYear(),Sn.m=Io.getMonth(),Sn.d=Io.getDate()+(Sn.w+6)%7)}else("W"in Sn||"U"in Sn)&&("w"in Sn||(Sn.w="u"in Sn?Sn.u%7:"W"in Sn?1:0),fc="Z"in Sn?Dy(Dm(Sn.y,0,1)).getUTCDay():ky(Dm(Sn.y,0,1)).getDay(),Sn.m=0,Sn.d="W"in Sn?(Sn.w+6)%7+Sn.W*7-(fc+5)%7:Sn.w+Sn.U*7-(fc+6)%7);return"Z"in Sn?(Sn.H+=Sn.Z/100|0,Sn.M+=Sn.Z%100,Dy(Sn)):ky(Sn)}}function vt(li,da,Ba,Sn){for(var jl=0,Io=da.length,fc=Ba.length,hc,Id;jl<Io;){if(Sn>=fc)return-1;if(hc=da.charCodeAt(jl++),hc===37){if(hc=da.charAt(jl++),Id=ke[hc in gE?da.charAt(jl++):hc],!Id||(Sn=Id(li,Ba,Sn))<0)return-1}else if(hc!=Ba.charCodeAt(Sn++))return-1}return Sn}function Lt(li,da,Ba){var Sn=p.exec(da.slice(Ba));return Sn?(li.p=y[Sn[0].toLowerCase()],Ba+Sn[0].length):-1}function lr(li,da,Ba){var Sn=w.exec(da.slice(Ba));return Sn?(li.w=I[Sn[0].toLowerCase()],Ba+Sn[0].length):-1}function cr(li,da,Ba){var Sn=b.exec(da.slice(Ba));return Sn?(li.w=A[Sn[0].toLowerCase()],Ba+Sn[0].length):-1}function Rr(li,da,Ba){var Sn=V.exec(da.slice(Ba));return Sn?(li.m=K[Sn[0].toLowerCase()],Ba+Sn[0].length):-1}function fn(li,da,Ba){var Sn=P.exec(da.slice(Ba));return Sn?(li.m=L[Sn[0].toLowerCase()],Ba+Sn[0].length):-1}function Pn(li,da,Ba){return vt(li,t,da,Ba)}function Ri(li,da,Ba){return vt(li,r,da,Ba)}function ya(li,da,Ba){return vt(li,n,da,Ba)}function Ha(li){return s[li.getDay()]}function no(li){return a[li.getDay()]}function us(li){return c[li.getMonth()]}function xl(li){return l[li.getMonth()]}function YF(li){return i[+(li.getHours()>=12)]}function qF(li){return 1+~~(li.getMonth()/3)}function KF(li){return s[li.getUTCDay()]}function QF(li){return a[li.getUTCDay()]}function JF(li){return c[li.getUTCMonth()]}function eN(li){return l[li.getUTCMonth()]}function tN(li){return i[+(li.getUTCHours()>=12)]}function rN(li){return 1+~~(li.getUTCMonth()/3)}return{format:function(li){var da=je(li+="",le);return da.toString=function(){return li},da},parse:function(li){var da=it(li+="",!1);return da.toString=function(){return li},da},utcFormat:function(li){var da=je(li+="",xe);return da.toString=function(){return li},da},utcParse:function(li){var da=it(li+="",!0);return da.toString=function(){return li},da}}}var gE={"-":"",_:" ","0":"0"},pu=/^\s*\d+/,I4=/^%/,P4=/[\\^$*+?|[\]().{}]/g;function La(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<r?new Array(r-a+1).join(t)+i:i)}function O4(e){return e.replace(P4,"\\$&")}function Lm(e){return new RegExp("^(?:"+e.map(O4).join("|")+")","i")}function Bm(e){for(var t={},r=-1,n=e.length;++r<n;)t[e[r].toLowerCase()]=r;return t}function k4(e,t,r){var n=pu.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function D4(e,t,r){var n=pu.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function L4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function B4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function F4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function yE(e,t,r){var n=pu.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function _E(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function N4(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function U4(e,t,r){var n=pu.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function z4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function xE(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Z4(e,t,r){var n=pu.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function bE(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function V4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function j4(e,t,r){var n=pu.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function H4(e,t,r){var n=pu.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function W4(e,t,r){var n=pu.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function G4(e,t,r){var n=I4.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function X4(e,t,r){var n=pu.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function $4(e,t,r){var n=pu.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function EE(e,t){return La(e.getDate(),t,2)}function Y4(e,t){return La(e.getHours(),t,2)}function q4(e,t){return La(e.getHours()%12||12,t,2)}function K4(e,t){return La(1+Py.count(gv(e),e),t,3)}function SE(e,t){return La(e.getMilliseconds(),t,3)}function Q4(e,t){return SE(e,t)+"000"}function J4(e,t){return La(e.getMonth()+1,t,2)}function eO(e,t){return La(e.getMinutes(),t,2)}function tO(e,t){return La(e.getSeconds(),t,2)}function rO(e){var t=e.getDay();return t===0?7:t}function nO(e,t){return La(Iy.count(gv(e)-1,e),t,2)}function AE(e){var t=e.getDay();return t>=4||t===0?yv(e):yv.ceil(e)}function iO(e,t){return e=AE(e),La(yv.count(gv(e),e)+(gv(e).getDay()===4),t,2)}function aO(e){return e.getDay()}function oO(e,t){return La(ng.count(gv(e)-1,e),t,2)}function sO(e,t){return La(e.getFullYear()%100,t,2)}function uO(e,t){return e=AE(e),La(e.getFullYear()%100,t,2)}function lO(e,t){return La(e.getFullYear()%1e4,t,4)}function cO(e,t){var r=e.getDay();return e=r>=4||r===0?yv(e):yv.ceil(e),La(e.getFullYear()%1e4,t,4)}function fO(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+La(t/60|0,"0",2)+La(t%60,"0",2)}function TE(e,t){return La(e.getUTCDate(),t,2)}function hO(e,t){return La(e.getUTCHours(),t,2)}function pO(e,t){return La(e.getUTCHours()%12||12,t,2)}function dO(e,t){return La(1+mE.count(km(e),e),t,3)}function wE(e,t){return La(e.getUTCMilliseconds(),t,3)}function vO(e,t){return wE(e,t)+"000"}function mO(e,t){return La(e.getUTCMonth()+1,t,2)}function gO(e,t){return La(e.getUTCMinutes(),t,2)}function yO(e,t){return La(e.getUTCSeconds(),t,2)}function _O(e){var t=e.getUTCDay();return t===0?7:t}function xO(e,t){return La(dE.count(km(e)-1,e),t,2)}function CE(e){var t=e.getUTCDay();return t>=4||t===0?_v(e):_v.ceil(e)}function bO(e,t){return e=CE(e),La(_v.count(km(e),e)+(km(e).getUTCDay()===4),t,2)}function EO(e){return e.getUTCDay()}function SO(e,t){return La(ag.count(km(e)-1,e),t,2)}function AO(e,t){return La(e.getUTCFullYear()%100,t,2)}function TO(e,t){return e=CE(e),La(e.getUTCFullYear()%100,t,2)}function wO(e,t){return La(e.getUTCFullYear()%1e4,t,4)}function CO(e,t){var r=e.getUTCDay();return e=r>=4||r===0?_v(e):_v.ceil(e),La(e.getUTCFullYear()%1e4,t,4)}function RO(){return"+0000"}function RE(){return"%"}function ME(e){return+e}function IE(e){return Math.floor(+e/1e3)}var xv,PE,MO,IO,PO;OO({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function OO(e){return xv=M4(e),PE=xv.format,MO=xv.parse,IO=xv.utcFormat,PO=xv.utcParse,xv}var Fm=1e3,Nm=Fm*60,Um=Nm*60,zm=Um*24,kO=zm*7,OE=zm*30,Ly=zm*365;function DO(e){return new Date(e)}function LO(e){return e instanceof Date?+e:+new Date(+e)}function kE(e,t,r,n,i,a,s,l,c){var p=zb($u,$u),y=p.invert,b=p.domain,A=c(".%L"),w=c(":%S"),I=c("%I:%M"),P=c("%I %p"),L=c("%a %d"),V=c("%b %d"),K=c("%B"),le=c("%Y"),xe=[[s,1,Fm],[s,5,5*Fm],[s,15,15*Fm],[s,30,30*Fm],[a,1,Nm],[a,5,5*Nm],[a,15,15*Nm],[a,30,30*Nm],[i,1,Um],[i,3,3*Um],[i,6,6*Um],[i,12,12*Um],[n,1,zm],[n,2,2*zm],[r,1,kO],[t,1,OE],[t,3,3*OE],[e,1,Ly]];function ke(it){return(s(it)<it?A:a(it)<it?w:i(it)<it?I:n(it)<it?P:t(it)<it?r(it)<it?L:V:e(it)<it?K:le)(it)}function je(it,vt,Lt,lr){if(it==null&&(it=10),typeof it=="number"){var cr=Math.abs(Lt-vt)/it,Rr=Ab(function(fn){return fn[2]}).right(xe,cr);Rr===xe.length?(lr=xy(vt/Ly,Lt/Ly,it),it=e):Rr?(Rr=xe[cr/xe[Rr-1][2]<xe[Rr][2]/cr?Rr-1:Rr],lr=Rr[1],it=Rr[0]):(lr=Math.max(xy(vt,Lt,it),1),it=l)}return lr==null?it:it.every(lr)}return p.invert=function(it){return new Date(y(it))},p.domain=function(it){return arguments.length?b(kb.call(it,LO)):b().map(DO)},p.ticks=function(it,vt){var Lt=b(),lr=Lt[0],cr=Lt[Lt.length-1],Rr=cr<lr,fn;return Rr&&(fn=lr,lr=cr,cr=fn),fn=je(it,lr,cr,vt),fn=fn?fn.range(lr,cr+1):[],Rr?fn.reverse():fn},p.tickFormat=function(it,vt){return vt==null?ke:c(vt)},p.nice=function(it,vt){var Lt=b();return(it=je(it,Lt[0],Lt[Lt.length-1],vt))?b(Yb(Lt,it)):p},p.copy=function(){return Q0(p,kE(e,t,r,n,i,a,s,l,c))},p}function BO(){return Ip.apply(kE(gv,m4,Iy,Py,b4,E4,S4,A4,PE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function _6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function og(){var e=0,t=1,r,n,i,a,s=$u,l=!1,c;function p(y){return isNaN(y=+y)?c:s(i===0?.5:(y=(a(y)-r)*i,l?Math.max(0,Math.min(1,y)):y))}return p.domain=function(y){return arguments.length?(r=a(e=+y[0]),n=a(t=+y[1]),i=r===n?0:1/(n-r),p):[e,t]},p.clamp=function(y){return arguments.length?(l=!!y,p):l},p.interpolator=function(y){return arguments.length?(s=y,p):s},p.unknown=function(y){return arguments.length?(c=y,p):c},function(y){return a=y,r=y(e),n=y(t),i=r===n?0:1/(n-r),p}}function Zm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function DE(){var e=Pm(og()($u));return e.copy=function(){return Zm(e,DE())},Db.apply(e,arguments)}function FO(){var e=loggish(og()).domain([1,10]);return e.copy=function(){return Zm(e,FO()).base(e.base())},initInterpolator.apply(e,arguments)}function NO(){var e=symlogish(og());return e.copy=function(){return Zm(e,NO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function LE(){var e=powish(og());return e.copy=function(){return Zm(e,LE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function x6(){return LE.apply(null,arguments).exponent(.5)}function UO(){var e=[],t=identity;function r(n){if(!isNaN(n=+n))return t((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return UO(t).domain(e)},initInterpolator.apply(r,arguments)}function sg(){var e=0,t=.5,r=1,n,i,a,s,l,c=$u,p,y=!1,b;function A(w){return isNaN(w=+w)?b:(w=.5+((w=+p(w))-i)*(w<i?s:l),c(y?Math.max(0,Math.min(1,w)):w))}return A.domain=function(w){return arguments.length?(n=p(e=+w[0]),i=p(t=+w[1]),a=p(r=+w[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,t,r]},A.clamp=function(w){return arguments.length?(y=!!w,A):y},A.interpolator=function(w){return arguments.length?(c=w,A):c},A.unknown=function(w){return arguments.length?(b=w,A):b},function(w){return p=w,n=w(e),i=w(t),a=w(r),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function BE(){var e=Pm(sg()($u));return e.copy=function(){return Zm(e,BE())},Db.apply(e,arguments)}function zO(){var e=loggish(sg()).domain([.1,1,10]);return e.copy=function(){return copy(e,zO()).base(e.base())},initInterpolator.apply(e,arguments)}function ZO(){var e=symlogish(sg());return e.copy=function(){return copy(e,ZO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function FE(){var e=powish(sg());return e.copy=function(){return copy(e,FE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function b6(){return FE.apply(null,arguments).exponent(.5)}function NE(e){var t,r=[];function n(i){return i==null?t:i}return n.invert=n,n.domain=n.range=function(i){return i?(r=i,i):r},n.unknown=function(i){return i?(t=i,i):t},n.copy=function(){return NE(e).unknown(t)},n}var lc,UE,zE,By=mi.isNil,VO=mi.isString,jO=mi.uniq,HO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,WO=(lc={},(0,F.Z)(lc,ja.LINEAR,$b),(0,F.Z)(lc,ja.POWER,wy),(0,F.Z)(lc,ja.LOG,Jb),(0,F.Z)(lc,ja.IDENTITY,NE),(0,F.Z)(lc,ja.SEQUENTIAL,DE),(0,F.Z)(lc,ja.TIME,BO),(0,F.Z)(lc,ja.QUANTILE,nE),(0,F.Z)(lc,ja.QUANTIZE,iE),(0,F.Z)(lc,ja.THRESHOLD,aE),(0,F.Z)(lc,ja.CAT,K0),(0,F.Z)(lc,ja.DIVERGING,BE),lc),GO=(UE=(0,pr.b2)(),UE(zE=function(){function e(){(0,ye.Z)(this,e),(0,F.Z)(this,"scaleOptions",{})}return(0,Q.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,St.Z)(Ae().mark(function s(){var l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.log(Cs.ScaleInitStart,hr.INIT),i.scaleOptions=r.getScaleOptions(),c=a.getLayerStyleAttributes(),p=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(p)&&p.length===0)){b.next=8;break}return b.abrupt("return");case 8:i.caculateScalesForAttributes(c||[],p);case 9:r.log(Cs.ScaleInitEnd,hr.INIT);case 10:case"end":return b.stop()}},s)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,St.Z)(Ae().mark(function l(c){var p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(c){A.next=2;break}return A.abrupt("return",c);case 2:if(r.log(Cs.ScaleInitStart,hr.UPDATE),i.scaleOptions=r.getScaleOptions(),p=a.getLayerStyleAttributes(),y=r.getSource().data.dataArray,!(Array.isArray(y)&&y.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(p||[],y),r.log(Cs.ScaleInitEnd,hr.UPDATE),r.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){i.scaleOptions=r.getScaleOptions();var s=a.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var c=s.filter(function(p){return p.needRescale});c.length&&i.caculateScalesForAttributes(c,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var i=this;r.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(By(l)?[]:l);var c=[];s.names.forEach(function(p){var y;c.push(i.createScale(p,a.name,(y=a.scale)===null||y===void 0?void 0:y.values,n))}),c.some(function(p){return p.type===cv.VARIABLE})?(s.type=cv.VARIABLE,c.forEach(function(p){if(!s.callback&&s.values!=="text"){var y;switch((y=p.option)===null||y===void 0?void 0:y.type){case ja.LOG:case ja.LINEAR:case ja.POWER:if(s.values&&s.values.length>2){var b=p.scale.ticks(s.values.length);p.scale.domain(b)}s.values?p.scale.range(s.values):p.scale.range(p.option.domain);break;case ja.QUANTILE:case ja.QUANTIZE:case ja.THRESHOLD:p.scale.range(s.values);break;case ja.IDENTITY:break;case ja.CAT:s.values?p.scale.range(s.values):p.scale.range(p.option.domain);break;case ja.DIVERGING:case ja.SEQUENTIAL:p.scale.interpolator(LP.hD(s.values));break}}if(s.values==="text"){var A;p.scale.range((A=p.option)===null||A===void 0?void 0:A.domain)}})):(s.type=cv.CONSTANT,s.defaultValues=c.map(function(p,y){return p.scale(s.names[y])})),s.scalers=c.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:VO(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,i,a){var s,l,c=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===r?this.scaleOptions[n]:this.scaleOptions[r],p={field:r,scale:void 0,type:cv.VARIABLE,option:c};if(!a||!a.length)return c&&c.type?p.scale=this.createDefaultScale(c):(p.scale=K0([r]),p.type=cv.CONSTANT),p;var y=(l=a.find(function(w){return!By(w[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||By(y)&&!c)p.scale=K0([r]),p.type=cv.CONSTANT;else{var b=c&&c.type||this.getDefaultType(y);i==="text"&&(b=ja.CAT),i===void 0&&(b=ja.IDENTITY);var A=this.createScaleConfig(b,r,c,a);p.scale=this.createDefaultScale(A),p.option=A}return p}},{key:"getDefaultType",value:function(r){var n=ja.LINEAR;return typeof r=="string"&&(n=HO.test(r)?ja.TIME:ja.CAT),n}},{key:"createScaleConfig",value:function(r,n,i,a){var s={type:r},l=[];if(r===ja.QUANTILE){var c=new Map;a==null||a.forEach(function(b){c.set(b._id,b[n])}),l=Array.from(c.values())}else l=(a==null?void 0:a.map(function(b){return b[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(r===ja.CAT||r===ja.IDENTITY)s.domain=jO(l);else if(r===ja.QUANTILE)s.domain=l;else if(r===ja.DIVERGING){var p=wb(l),y=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(p[0]+p[1])/2;s.domain=[p[0],y,p[1]]}else s.domain=wb(l);return(0,O.Z)((0,O.Z)({},s),i)}},{key:"createDefaultScale",value:function(r){var n=r.type,i=r.domain,a=r.unknown,s=r.clamp,l=r.nice,c=WO[n]();return i&&c.domain&&c.domain(i),a&&c.unknown(a),s!==void 0&&c.clamp&&c.clamp(s),l!==void 0&&c.nice&&c.nice(l),c}}]),e}())||zE),ZE,VE,XO=(ZE=(0,pr.b2)(),ZE(VE=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(i){i.addUniforms((0,O.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||VE),jE,HE,$O=(jE=(0,pr.b2)(),jE(HE=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!r.tileLayer&&i&&i.length>0){var s;(s=r.masks).push.apply(s,(0,Yt.Z)(i)),r.updateLayerConfig({mask:a})}})}}]),e}())||HE),YO=function(){function e(t){var r=t.rendererService,n=t.layerService,i=t.parent;(0,ye.Z)(this,e),(0,F.Z)(this,"tileResource",new Map),(0,F.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=i}return(0,Q.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(a){return a.key===r}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);if(r.isVisible)if(r.parent){var i=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(r.parent){var a=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,i=r==null?void 0:r.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var t=(0,St.Z)(Ae().mark(function n(){var i=this,a,s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var p=(0,St.Z)(Ae().mark(function y(b){return Ae().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,i.layerService.renderTileLayer(b);case 2:case"end":return w.stop()}},y)}));return function(y){return p.apply(this,arguments)}}()),c.next=4,Promise.all(s);case 4:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,(0,Yt.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,(0,Yt.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),qO=Z(32676);function KO(e,t,r){r===void 0&&(r={});var n=Wi(e),i=Wi(t),a=qO.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?wt(a[0],r.properties):Ci(a,r.properties)}var QO=KO,JO=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,i=r[0];return r.map(function(a){var s=wt(a.coordinates);n===null?n=s:n=QO(n,s)}),i&&(n.properties=(0,O.Z)({},i)),n}}]),e}(),Vm="select",jm="active",e5=function(){function e(t){var r=t.layerService,n=t.tileLayerService,i=t.parent;(0,ye.Z)(this,e),(0,F.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=i,this.tileSourceService=new JO}return(0,Q.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var i=this.parent.getContainer(),a=i.get(xt.IPickingService);if(r.type==="RasterLayer"){var s=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(s&&s.getMainLayer()!==void 0){var l=s.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,re.Z)(r,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Vm,l),this.updateHighLight(i,a,s,Vm)}},{key:"highlightPickedFeature",value:function(r){var n=(0,re.Z)(r,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(jm,l),this.updateHighLight(i,a,s,jm)}},{key:"updateHighLight",value:function(r,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case Vm:l==null||l.hooks.beforeSelect.call([r,n,i]);break;case jm:l==null||l.hooks.beforeHighlight.call([r,n,i]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(Vm),n=this.tilePickID.get(jm);if(r){var i=this.pickId2Color(r),a=(0,re.Z)(i,3),s=a[0],l=a[1],c=a[2];this.updateHighLight(s,l,c,Vm);return}if(n){var p=this.pickId2Color(n),y=(0,re.Z)(p,3),b=y[0],A=y[1],w=y[2];this.updateHighLight(b,A,w,jm);return}}},{key:"color2PickId",value:function(r,n,i){return ia(new Uint8Array([r,n,i]))}},{key:"pickId2Color",value:function(r){return Ma(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,Yt.Z)(a.getFeatureById(r)))}),i}},{key:"pickRasterLayer",value:function(r,n,i){return!1}}]),e}();function t5(e){return e==="PolygonLayer"?Im:e==="LineLayer"?dy:H0}function r5(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function n5(e){var t=i5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function i5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ed=function(e){(0,Je.Z)(r,e);var t=n5(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,F.Z)((0,Be.Z)(a),"visible",!0),(0,F.Z)((0,Be.Z)(a),"layers",[]),(0,F.Z)((0,Be.Z)(a),"isLoaded",!1),(0,F.Z)((0,Be.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,Q.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,re.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],c=a[2],p=a[3],y=i.lng,b=i.lat;return y>=s&&y<=c&&b>=l&&b<=p}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,O.Z)((0,O.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:r5(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(c){if(!c.tileLayer)return l.push(c),c;var p=c.tileLayer,y=p.getTile(i.sourceTile.key),b=y==null?void 0:y.getLayers()[0];b&&l.push(b)}),l}},{key:"addTileMask",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return s=new Im({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=lv(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),y.next=5,s.init();case 5:return this.tileMask=s,c=this.getMainLayer(),c!==void 0&&(c.tileMask=s),y.abrupt("return",s);case 9:case"end":return y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,St.Z)(Ae().mark(function a(s,l){var c;return Ae().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return c=lv(this.parent.sceneContainer),l.setContainer(c,this.parent.sceneContainer),y.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return y.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(s){var l;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s.isTileLayer=!0,l=lv(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),p.next=6,s.init();case 6:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,F.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),r}(ba.EventEmitter);function a5(e){var t=o5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=function(e){(0,Je.Z)(r,e);var t=a5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,c=new dy().source(s.data,s.options).size(1).shape("line").color("red"),p=new H0({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),b.next=6,this.addLayer(c);case 6:return b.next=8,this.addLayer(p);case 8:this.isLoaded=!0;case 9:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),r}(Ed);function u5(e){var t=l5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c5=function(e){(0,Je.Z)(r,e);var t=u5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new jx((0,O.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(Ed);function f5(e){var t=h5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p5=function(e){(0,Je.Z)(r,e);var t=f5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new vb((0,O.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,c=this.getFeatures(s);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),r}(Ed),d5=["rasterData"];function v5(e){var t=m5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function m5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g5=function(e){(0,Je.Z)(r,e);var t=v5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new W0((0,O.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,gs.Z)(a,d5);return{data:s,options:{parser:(0,O.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),r}(Ed);function y5(e){var t=_5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function _5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x5=function(e){(0,Je.Z)(r,e);var t=y5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p;return Ae().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new W0((0,O.Z)({},l)).source(c.data,c.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;p[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(Ed),b5=["rasterData"];function E5(e){var t=S5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function S5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A5={positions:[0,1],colors:["#000","#fff"]},T5=function(e){(0,Je.Z)(r,e);var t=E5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y,b,A;return Ae().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=this.getLayerOptions(),y=p.rampColors,b=p.domain,this.colorTexture=this.parent.textureService.getColorTexture(y,b),A=new W0((0,O.Z)((0,O.Z)({},l),{},{colorTexture:this.colorTexture})).source(c.data,c.options),s&&Object.keys(s).forEach(function(P){var L,V,K=P;A[K]((L=s[K])===null||L===void 0?void 0:L.field,(V=s[K])===null||V===void 0?void 0:V.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,gs.Z)(a,b5);return{data:s,options:{parser:(0,O.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var c=s,p=c.rampColors,y=p===void 0?A5:p,b=c.domain;this.colorTexture=this.parent.textureService.getColorTexture(y,b||Fa(y)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),r}(Ed);function w5(e){var t=C5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function C5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ug=function(e){(0,Je.Z)(r,e);var t=w5(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=t5(this.parent.type),p=this.getSourceOption(),p){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return y=new c((0,O.Z)({},l)).source(p.data,p.options),Object.keys(s).forEach(function(w){var I,P,L=w;y[L]((I=s[L])===null||I===void 0?void 0:I.field,(P=s[L])===null||P===void 0?void 0:P.values)}),A.next=12,this.addLayer(y);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(y),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,c=a.featureId,p=c===void 0?"id":c,y=this.getFeatures(l);return{data:{type:"FeatureCollection",features:y},options:{parser:{type:"geojson",featureId:p},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),r}(Ed);function R5(e){var t=e.type;switch(t){case"PolygonLayer":return ug;case"LineLayer":return ug;case"PointLayer":return ug;case"TileDebugLayer":return s5;case"MaskLayer":return p5;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case wu.RGB:case wu.CUSTOMRGB:return g5;case wu.ARRAYBUFFER:case wu.CUSTOMARRAYBUFFER:return T5;case wu.TERRAINRGB:case wu.CUSTOMTERRAINRGB:return x5;default:return c5}default:return ug}}var M5=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],I5=mi.debounce,WE=function(){function e(t){var r=this;(0,ye.Z)(this,e),(0,F.Z)(this,"initedTileset",!1),(0,F.Z)(this,"mapchange",function(){var i;if(r.parent.isVisible()!==!1){var a=r.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(r.mapService.version==="GAODE1.x"){var c=r.parent.getLayerConfig(),p=c.visible;l<2&&p?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):l>=2&&!p&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===l&&r.lastViewStates.latLonBounds.toString()===s.toString()||(r.lastViewStates={zoom:l,latLonBounds:s},(i=r.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,F.Z)(this,"viewchange",I5(this.mapchange,24)),this.parent=t;var n=this.parent.getContainer();this.rendererService=n.get(xt.IRendererService),this.layerService=n.get(xt.ILayerService),this.mapService=n.get(xt.IMapService),this.pickingService=n.get(xt.IPickingService),this.tileLayerService=new YO({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new e5({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}return(0,Q.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(s,a)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(a,i)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var t=(0,St.Z)(Ae().mark(function n(){var i=this,a,s;return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.tilesetManager){c.next=2;break}return c.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),c.next=6,Promise.all(this.tilesetManager.tiles.filter(function(p){return p.isLoaded}).filter(function(p){return p.isVisibleChange}).filter(function(p){return p.data}).filter(function(p){return p.z>=a&&p.z<s}).map(function(){var p=(0,St.Z)(Ae().mark(function y(b){var A,w;return Ae().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i.tileLayerService.hasTile(b.key)){P.next=9;break}return A=R5(i.parent),w=new A(b,i.parent),P.next=5,w.initTileLayer();case 5:i.tilePickService.setPickState(),w.getLayers().length!==0&&(i.tileLayerService.addTile(w),i.tileLayerService.updateTileVisible(b),i.layerService.reRender()),P.next=12;break;case 9:i.tileLayerService.updateTileVisible(b),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return P.stop()}},y)}));return function(y){return p.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;M5.forEach(function(i){var a=r[i].bind(r);r[i]=function(){for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return a.apply(void 0,l),n.getLayers().map(function(p){p[i].apply(p,l)}),i==="style"&&n.getTiles().forEach(function(p){return p.styleUpdate.apply(p,l)}),r}})}}]),e}(),GE,XE,P5=(GE=(0,pr.b2)(),GE(XE=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"build",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,St.Z)(Ae().mark(function i(){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!r.getSource().isTile){s.next=4;break}return r.prepareBuildModel(),r.tileLayer=new WE(r),s.abrupt("return");case 4:return r.log(Cs.BuildModelStart,hr.INIT),s.next=7,n.initLayerModel(r);case 7:r.log(Cs.BuildModelEnd,hr.INIT);case 8:case"end":return s.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,St.Z)(Ae().mark(function a(s){return Ae().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s){c.next=2;break}return c.abrupt("return",!1);case 2:if(!r.getSource().isTile){c.next=5;break}return r.tileLayer=new WE(r),c.abrupt("return",!1);case 5:return r.log(Cs.BuildModelStart,hr.UPDATE),c.next=8,n.prepareLayerModel(r);case 8:return r.log(Cs.BuildModelEnd,hr.UPDATE),c.abrupt("return",!0);case 10:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||XE),$E,YE,O5=($E=(0,pr.b2)(),$E(YE=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&r.fitBounds(a),r.styleNeedUpdate=!1})}}]),e}())||YE),qE,KE,k5=["type"],QE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},D5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},L5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},B5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function F5(e){var t={u_DirectionalLights:new Array(3).fill((0,O.Z)({},L5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,O.Z)({},B5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[D5]),e.forEach(function(r){var n=r.type,i=n===void 0?"directional":n,a=(0,gs.Z)(r,k5),s=QE[i].lights,l=QE[i].num,c=t[l];t[s][c]=(0,O.Z)((0,O.Z)({},t[s][c]),a),t[l]++}),t}var N5=(qE=(0,pr.b2)(),qE(KE=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),i=n.enableLighting;i&&r.models.forEach(function(a){return a.addUniforms((0,O.Z)({},F5()))})})}}]),e}())||KE),JE,e2,U5=(JE=(0,pr.b2)(),JE(e2=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var c=r.getLayerConfig(),p=c.enableMultiPassRenderer,y=c.passes,b=y===void 0?[]:y;i.enabled=!!p&&r.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(r.multiPassRenderer=mx(r,b,s,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=a.getViewportSize(),p=c.width,y=c.height;r.multiPassRenderer.resize(p,y)}})}}]),e}())||e2),t2,r2,z5=mi.isNumber,bv={NONE:0,ENCODE:1,HIGHLIGHT:2},Z5=(t2=(0,pr.b2)(),t2(r2=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"pickOption2Array",value:function(){var r=[];return this.pickingUniformMap.forEach(function(n,i){z5(n)?r.push(n):r.push.apply(r,(0,Yt.Z)(n))}),r}},{key:"updatePickOption",value:function(r,n){var i=this;Object.keys(r).forEach(function(c){i.pickingUniformMap.set(c,r[c])});var a=n.getLayerConfig().pickingBuffer||0,s=Number(n.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",a),this.pickingUniformMap.set("u_shaderPick",s);var l=n.getPickingUniformBuffer();l.subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(r,n){var i=this,a=n.rendererService,s=n.styleAttributeService,l;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),r.hooks.init.tapPromise("PixelPickingPlugin",function(){var c=r.getLayerConfig(),p=c.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:Zn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:ni.PICKING_COLOR,buffer:{data:[],type:Y.FLOAT},size:3,update:function(b){var A=b.id;return p?Ma(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var c=r.getLayerConfig(),p=c.enablePicking;p&&r.isVisible()&&(i.updatePickOption({u_PickingStage:bv.ENCODE},r),r.models.forEach(function(y){return y.addUniforms({u_PickingStage:bv.ENCODE})}))}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var c=r.getLayerConfig(),p=c.enablePicking;p&&r.isVisible()&&(i.updatePickOption({u_PickingStage:bv.HIGHLIGHT},r),r.models.forEach(function(y){return y.addUniforms({u_PickingStage:bv.HIGHLIGHT})}))}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(c){var p=r.getLayerConfig(),y=p.highlightColor,b=p.activeMix,A=b===void 0?0:b,w=typeof y=="string"?fi(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ia(new Uint8Array(c))});var I={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A};i.updatePickOption(I,r),r.models.forEach(function(P){return P.addUniforms(I)})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(c){var p=r.getLayerConfig(),y=p.selectColor,b=p.selectMix,A=b===void 0?0:b,w=typeof y=="string"?fi(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ia(new Uint8Array(c))});var I={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A,u_CurrentSelectedId:c,u_SelectColor:w.map(function(P){return P*255}),u_EnableSelect:1};i.updatePickOption(I,r),r.models.forEach(function(P){return P.addUniforms(I)})})}}]),e}())||r2),V5=["mvt","geojsonvt","testTile"];function j5(e){var t=e.getSource();return V5.includes(t.parser.type)}function E6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var n2,i2,H5=(n2=(0,pr.b2)(),n2(i2=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){j5(r)||i.registerBuiltinAttributes(a,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:Zn.Attribute,descriptor:{name:"a_Position",shaderLocation:ni.POSITION,buffer:{data:[],type:Y.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:Zn.Attribute,descriptor:{name:"a_Color",shaderLocation:ni.COLOR,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:Zn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:ni.VERTEX_ID,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||i2),a2,o2,s2,u2,l2,c2,f2,Sd,h2,p2,d2,v2,m2,W5=(a2=(0,pr.b2)(),o2=(0,pr.f3)(xt.ICameraService),s2=(0,pr.f3)(xt.ICoordinateSystemService),u2=(0,pr.f3)(xt.IRendererService),l2=(0,pr.f3)(xt.IMapService),c2=(0,pr.f3)(xt.ILayerService),a2(f2=(Sd=function(){function e(){(0,ye.Z)(this,e),Ir(this,"cameraService",h2,this),Ir(this,"coordinateSystemService",p2,this),Ir(this,"rendererService",d2,this),Ir(this,"mapService",v2,this),Ir(this,"layerService",m2,this)}return(0,Q.Z)(e,[{key:"apply",value:function(r){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=r.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(c),i==="GAODE2.x"){n.setLayerCenter(r),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter();var p=r.getLayerUniformBuffer();p.subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Yt.Z)(a),(0,Yt.Z)(s))).buffer)})}var y=n.rendererService.getViewportSize(),b=y.width,A=y.height,w=n.generateUBO(a,s,b,A),I=w.data,P=w.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:I}),r.models.forEach(function(L){L.addUniforms((0,O.Z)((0,O.Z)({},P),{},{u_PickingBuffer:r.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(r.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}},{key:"generateUBO",value:function(r,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),c=this.cameraService.getViewMatrix(),p=this.cameraService.getViewProjectionMatrix(),y=this.cameraService.getModelMatrix(),b=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),w=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),P=this.cameraService.getZoomScale(),L=this.coordinateSystemService.getPixelsPerMeter(),V=this.coordinateSystemService.getCoordinateSystem(),K=this.cameraService.getCameraPosition(),le=window.devicePixelRatio,xe=this.coordinateSystemService.getViewportCenter(),ke=[i,a],je=this.cameraService.getFocalDistance(),it=[].concat((0,Yt.Z)(c),(0,Yt.Z)(l),(0,Yt.Z)(p),(0,Yt.Z)(y),(0,Yt.Z)(b),(0,Yt.Z)(A),[w],(0,Yt.Z)(I),[P],(0,Yt.Z)(L),[V],(0,Yt.Z)(K),[le],(0,Yt.Z)(xe),ke,[je,0,0,0]);return{data:it,uniforms:(s={},(0,F.Z)(s,vd.ProjectionMatrix,l),(0,F.Z)(s,vd.ViewMatrix,c),(0,F.Z)(s,vd.ViewProjectionMatrix,p),(0,F.Z)(s,vd.Zoom,w),(0,F.Z)(s,vd.ZoomScale,P),(0,F.Z)(s,vd.FocalDistance,je),(0,F.Z)(s,vd.CameraPosition,K),(0,F.Z)(s,Fl.CoordinateSystem,V),(0,F.Z)(s,Fl.ViewportCenter,xe),(0,F.Z)(s,Fl.ViewportCenterProjection,b),(0,F.Z)(s,Fl.PixelsPerDegree,A),(0,F.Z)(s,Fl.PixelsPerDegree2,I),(0,F.Z)(s,Fl.PixelsPerMeter,L),(0,F.Z)(s,Fl.Mvp,r),(0,F.Z)(s,"u_sceneCenterMercator",n),(0,F.Z)(s,"u_ViewportSize",ke),(0,F.Z)(s,"u_ModelMatrix",y),(0,F.Z)(s,"u_DevicePixelRatio",le),s)}}}]),e}(),h2=mn(Sd.prototype,"cameraService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p2=mn(Sd.prototype,"coordinateSystemService",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=mn(Sd.prototype,"rendererService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=mn(Sd.prototype,"mapService",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=mn(Sd.prototype,"layerService",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd))||f2),g2,y2,G5=(g2=(0,pr.b2)(),g2(y2=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||y2),_2,x2,X5=(_2=(0,pr.b2)(),_2(x2=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(r,{styleAttributeService:a})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&i.updateStyleAttribute(r,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(r,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){r.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,r.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||x2);Ul.bind(xt.ILayerPlugin).to(IP).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(H5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(GO).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(MP).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(O5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to($O).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(X5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(G5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(U5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(W5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(XO).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(N5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(Z5).inRequestScope(),Ul.bind(xt.ILayerPlugin).to(P5).inRequestScope();function $5(e){var t=Y5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function Y5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S6=function(e){(0,Je.Z)(r,e);var t=$5(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"isMoving",!1),(0,F.Z)((0,Be.Z)(n),"move",function(l){switch(l.stopPropagation(),l.type){case"touchcancel":case"touchend":case"mouseup":{var c;n.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(Lt){document.removeEventListener(Lt,n.move)}),(c=n.scene)===null||c===void 0||c.render();break}case"mousedown":case"touchstart":n.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(function(Lt){document.addEventListener(Lt,n.move)});case"mousemove":case"touchmove":{if(n.isMoving)if(n.controlOption.orientation==="vertical"){var p;if("pageX"in l?p=l.pageX:l.touches&&l.touches.length&&l.touches[0].pageX?p=l.touches[0].pageX:l.changedTouches&&l.changedTouches.length&&(p=l.changedTouches[0].pageX),!p)break;var y=n.getContainerDOMRect(),b=n.getContainerSize(),A=b[0],w=(y==null?void 0:y.left)||0,I=p-w+window.scrollX-document.documentElement.clientLeft,P=A-Math.min(Math.max(0,A-I),A),L=P/A;n.setOptions({ratio:L}),n.emit("moving",{size:[P,b[1]],ratio:[L,0]})}else{var V;if("pageY"in l?V=l.pageY:l.touches&&l.touches.length&&l.touches[0].pageY?V=l.touches[0].pageY:l.changedTouches&&l.changedTouches.length&&(V=l.changedTouches[0].pageY),!V)break;var K=n.getContainerDOMRect(),le=n.getContainerSize(),xe=le[1],ke=(K==null?void 0:K.top)||0,je=V-ke+window.scrollY-document.documentElement.clientTop,it=xe-Math.min(Math.max(0,xe-je),xe),vt=it/xe;n.setOptions({ratio:vt}),n.emit("moving",{size:[le[0],it],ratio:[0,vt]})}break}default:break}}),(0,F.Z)((0,Be.Z)(n),"getMaskLayer",function(){return new Im({visible:!1}).source({type:"FeatureCollection",features:[]}).shape("fill").color("red").style({opacity:.1})}),(0,F.Z)((0,Be.Z)(n),"updateMask",function(){var l;if(!!n.mapsService){var c=n.getMaskGeoData();(l=n.maskLayer)===null||l===void 0||l.setData(c)}}),n}return(0,Q.Z)(r,[{key:"getDefault",value:function(){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this)),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}},{key:"onAdd",value:function(){var i=On("div","l7-control-swipe");On("button","l7-control-swipe__button",i);var a=this.controlOption,s=a.orientation,l=s===void 0?"vertical":s,c=a.ratio,p=c===void 0?.5:c;return l==="horizontal"?(i.style.top=p*100+"%",i.style.left=""):(i.style.left=p*100+"%",i.style.top=""),i.classList.add(l),i}},{key:"addTo",value:function(i){this.mapsService=i.get(xt.IMapService),this.renderService=i.get(xt.IRendererService),this.layerService=i.get(xt.ILayerService),this.controlService=i.get(xt.IControlService),this.configService=i.get(xt.IGlobalConfigService),this.scene=i.get(xt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var a=this.controlOption,s=a.className,l=a.style,c=a.layers,p=a.rightLayers;s&&this.setClassName(s),l&&this.setStyle(l),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.updateMask(),this.registerEvent(),this.addMaskToLayers(c,!1),this.addMaskToLayers(p,!0);var y=lv(i);return this.maskLayer.setContainer(y,i),this.scene.addLayer(this.maskLayer),this.emit("add",this),this}},{key:"onRemove",value:function(){if(this.maskLayer){var i,a=this.controlOption,s=a.layers,l=a.rightLayers;this.removeMaskFromLayers(s),this.removeMaskFromLayers(l),(i=this.layerService)===null||i===void 0||i.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}},{key:"show",value:function(){var i,a=this.container;du(a,"l7-control-swipe_hide");var s=this.controlOption,l=s.layers,c=s.rightLayers;l.forEach(function(p){return p.enableMask()}),c.forEach(function(p){return p.enableMask()}),(i=this.scene)===null||i===void 0||i.render(),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i,a=this.container;cs(a,"l7-control-swipe_hide");var s=this.controlOption,l=s.layers,c=s.rightLayers;l.forEach(function(p){return p.disableMask()}),c.forEach(function(p){return p.disableMask()}),(i=this.scene)===null||i===void 0||i.render(),this.isShow=!1,this.emit("hide",this)}},{key:"setOptions",value:function(i){var a=(0,O.Z)((0,O.Z)({},this.controlOption),i);if(i.className&&this.setClassName(i.className),i.style&&this.setStyle(i.style),(i.orientation||i.ratio!==void 0)&&this.setOrientationAndRatio(a.orientation,a.ratio),i.layers){var s=i.layers,l=this.controlOption.layers;this.setLayers(s,l,!1)}if(i.rightLayers){var c=i.rightLayers,p=this.controlOption.rightLayers;this.setLayers(c,p,!0)}this.controlOption=a,this.updateMask()}},{key:"registerEvent",value:function(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}},{key:"unRegisterEvent",value:function(){var i;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),(i=this.mapsService)===null||i===void 0||i.off("camerachange",this.updateMask)}},{key:"setOrientationAndRatio",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"vertical",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;this.container.classList.remove("horizontal","vertical"),this.container.classList.add(i),i==="horizontal"?(this.container.style.top=a*100+"%",this.container.style.left=""):(this.container.style.left=a*100+"%",this.container.style.top="")}},{key:"setLayers",value:function(i,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=i.filter(function(p){return a.includes(p)===!1}),c=a.filter(function(p){return i.includes(p)===!1});this.addMaskToLayers(l,s),this.removeMaskFromLayers(c)}},{key:"addMaskToLayers",value:function(i,a){var s=this;i.forEach(function(l){l.updateLayerConfig({maskInside:!a}),l.addMask(s.maskLayer)})}},{key:"removeMaskFromLayers",value:function(i){var a=this;i.forEach(function(s){s.updateLayerConfig({maskInside:!0}),s.removeMask(a.maskLayer)})}},{key:"getMaskGeoData",value:function(){var i=this.controlOption,a=i.ratio,s=a===void 0?.5:a,l=i.orientation,c=l===void 0?"vertical":l,p=c==="vertical",y=this.getBounds(),b=(0,re.Z)(y,2),A=b[0],w=b[1],I=(0,re.Z)(A,2),P=I[0],L=I[1],V=(0,re.Z)(w,2),K=V[0],le=V[1],xe;if(p){var ke=P+(K-P)*s;xe=[[P,le],[ke,le],[ke,L],A,[P,le]]}else{var je=this.getContainerSize(),it=this.mapsService.containerToLngLat([je[0],je[1]*s]),vt=it.lat;xe=[[P,le],w,[K,vt],[P,vt],[P,le]]}var Lt={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[xe]}}]};return Lt}},{key:"getContainerDOMRect",value:function(){var i,a=(i=this.mapsService.getContainer())===null||i===void 0?void 0:i.getBoundingClientRect();return a}},{key:"getContainerSize",value:function(){var i=this.mapsService.getSize();return i}},{key:"getBounds",value:function(){var i=this.mapsService.getBounds();return i}},{key:"addLayer",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=Array.isArray(i)?i:[i];if(a){var l,c=(l=this.controlOption.rightLayers).concat.apply(l,(0,Yt.Z)(s));this.setOptions({rightLayers:c})}else{var p,y=(p=this.controlOption.layers).concat.apply(p,(0,Yt.Z)(s));this.setOptions({layers:y})}}},{key:"removeLayer",value:function(i){var a=Array.isArray(i)?i:[i],s=this.controlOption.layers.filter(function(c){return a.includes(c)}),l=this.controlOption.rightLayers.filter(function(c){return a.includes(c)});this.setOptions({layers:s,rightLayers:l})}},{key:"removeLayers",value:function(){this.setOptions({layers:[],rightLayers:[]})}}]),r}(md);function q5(e){var t=K5();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function K5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q5=function(e){(0,Je.Z)(r,e);var t=q5(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,F.Z)((0,Be.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,F.Z)((0,Be.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,Q.Z)(r,[{key:"getDefault",value:function(i){return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{position:E.BOTTOMRIGHT,name:"zoom",zoomInText:Nh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Nh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=On("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){Gc(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,c){var p=On("button",s,l);return typeof i=="string"?p.innerHTML=i:p.append(i),p.title=a,c&&p.addEventListener("click",c),p}}]),r}(md);function J5(e){var t=ek();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function ek(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fy=function(e){(0,Je.Z)(r,e);var t=J5(r);function r(n){var i;(0,ye.Z)(this,r),i=t.call(this),(0,F.Z)((0,Be.Z)(i),"isShow",!0),(0,F.Z)((0,Be.Z)(i),"onMouseMove",function(s){var l,c=i.mapsService.getMapContainer(),p=(l=c==null?void 0:c.getBoundingClientRect())!==null&&l!==void 0?l:{},y=p.left,b=y===void 0?0:y,A=p.top,w=A===void 0?0:A;i.setPopupPosition(s.clientX-b,s.clientY-w)}),(0,F.Z)((0,Be.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,c=s.lat,p=i.mapsService.lngLatToContainer([l,c]),y=p.x,b=p.y;i.setPopupPosition(y,b)}}),(0,F.Z)((0,Be.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,F.Z)((0,Be.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,F.Z)((0,Be.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,c=l.className,p=l.style,y=l.maxWidth,b=l.anchor,A=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var w=i.mapsService.getMarkerContainer();if(!i.container&&w&&(i.container=On("div","l7-popup ".concat(c!=null?c:""," ").concat(i.isShow?"":"l7-popup-hide"),w),p&&i.container.setAttribute("style",p),i.tip=On("div","l7-popup-tip",i.container),i.container.appendChild(i.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(L){i.container.addEventListener(L,function(V){V.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),el(i.container,"".concat(qu[b])),tu(i.container,b,"popup"),y){var I=i.container.getBoundingClientRect(),P=I.width;P>parseFloat(y)&&(i.container.style.width=y)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,O.Z)((0,O.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,Q.Z)(r,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(xt.IMapService),this.sceneService=i.get(xt.ISceneService),this.layerService=i.get(xt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,c=a.title;return s?this.setHTML(s):l&&this.setText(l),c&&this.setTitle(c),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&Ws(this.content),this.container&&(Ws(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,O.Z)((0,O.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ws(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&du(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&cs(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=On("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Gc(this.contentTitle),mu(this.contentTitle,i)):this.contentTitle&&(Ws(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ra.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),mu(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Ws(this.content),this.contentTitle=void 0,this.content=On("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Nh("l7-icon-guanbi");cs(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=On("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=a-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),r}(ba.EventEmitter);function tk(e){var t=rk();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function rk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nk=mi.get,A6=function(e){(0,Je.Z)(r,e);var t=tk(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"layerClickCountByFrame",0),(0,F.Z)((0,Be.Z)(n),"layerConfigMap",new WeakMap),(0,F.Z)((0,Be.Z)(n),"onLayerClick",function(l,c){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,c.featureId))n.hide();else{var p=n.getLayerInfoFrag(l,c),y=p.title,b=p.content;n.setDOMContent(b),n.setLnglat(c.lngLat),n.setTitle(y),n.displayFeatureInfo={layer:l,featureId:c.featureId},n.show()}})}),(0,F.Z)((0,Be.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,F.Z)((0,Be.Z)(n),"updateCloseOnClick",function(){}),n}return(0,Q.Z)(r,[{key:"layerConfigItems",get:function(){var i,a=this.popupOption,s=a.config,l=a.items;return(i=s!=null?s:l)!==null&&i!==void 0?i:[]}},{key:"addTo",value:function(i){return(0,ha.Z)((0,pe.Z)(r.prototype),"addTo",this).call(this,i),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,ha.Z)((0,pe.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(i){this.unbindLayerEvent();var a=(0,O.Z)({},i),s=a.trigger||this.popupOption.trigger,l=a.items||this.popupOption.items,c=(l==null?void 0:l.length)===0;return a.followCursor=s==="hover"&&!c,(0,ha.Z)((0,pe.Z)(r.prototype),"setOptions",this).call(this,a),this.bindLayerEvent(),c&&this.hide(),this}},{key:"getDefault",value:function(i){var a=i.trigger==="hover";return(0,O.Z)((0,O.Z)({},(0,ha.Z)((0,pe.Z)(r.prototype),"getDefault",this).call(this,i)),{},{trigger:"hover",followCursor:a,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var i=this,a=this.popupOption,s=a.trigger,l=a.closeOnClick;this.layerConfigItems.forEach(function(c){var p,y=i.getLayerByConfig(c);if(!!y){var b=(0,O.Z)({},c);if(s==="hover"){var A=i.onLayerMouseMove.bind(i,y),w=i.onLayerMouseOut.bind(i,y);b.onMouseMove=A,b.onMouseOut=w,y==null||y.on("mousemove",A),y==null||y.on("mouseout",w)}else{var I,P=i.onLayerClick.bind(i,y);b.onClick=P,y==null||y.on("click",P);var L=(I=i.mapsService)===null||I===void 0?void 0:I.getMapContainer();L&&l&&L.addEventListener("click",i.onSceneClick)}var V=y==null||(p=y.getSource)===null||p===void 0?void 0:p.call(y),K=i.onSourceUpdate.bind(i);V==null||V.on("update",K),b.onSourceUpdate=K,i.layerConfigMap.set(y,b)}})}},{key:"unbindLayerEvent",value:function(){var i=this;this.layerConfigItems.forEach(function(a){var s,l=i.getLayerByConfig(a),c=l&&i.layerConfigMap.get(l);if(!!c){var p=c.onMouseMove,y=c.onMouseOut,b=c.onClick,A=c.onSourceUpdate;if(p&&l.off("mousemove",p),y&&l.off("mouseout",y),b&&l.off("click",b),A){var w;l==null||(w=l.getSource())===null||w===void 0||w.off("update",A)}var I=(s=i.mapsService)===null||s===void 0?void 0:s.getMapContainer();I&&I.removeEventListener("click",i.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(i,a){if(!this.isSameFeature(i,a.featureId)){var s=this.getLayerInfoFrag(i,a),l=s.title,c=s.content;this.setDOMContent(c),this.setTitle(l),this.displayFeatureInfo={layer:i,featureId:a.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(i,a){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(i,a){var s=this.layerConfigMap.get(i),l,c=document.createDocumentFragment();if(s){var p=a.feature;p.type==="Feature"&&"properties"in p&&"geometry"in p&&(p=p.properties);var y=s.title,b=s.fields,A=s.customContent;if(y){l=document.createDocumentFragment();var w=y instanceof Function?y(p):y;mu(l,w)}if(A){var I=A instanceof Function?A(p):A;mu(c,I)}else b!=null&&b.length&&(b==null||b.forEach(function(P){var L,V,K=typeof P=="string"?{field:P}:P,le=K.field,xe=K.formatField,ke=K.formatValue,je=K.getValue,it=On("div","l7-layer-popup__row"),vt=je?je(a.feature):nk(p,le),Lt=(L=xe instanceof Function?xe(le,p):xe)!==null&&L!==void 0?L:le,lr=(V=ke instanceof Function?ke(vt,p):ke)!==null&&V!==void 0?V:vt,cr=On("span","l7-layer-popup__key",it);mu(cr,Lt),mu(cr,document.createTextNode("\uFF1A"));var Rr=On("span","l7-layer-popup__value",it);Array.isArray(lr)&&lr.every(function(fn){return!(fn instanceof Object)})&&(lr=lr.map(function(fn){return String(fn)}).join(",")),mu(Rr,lr),c.appendChild(it)}))}return{title:l,content:c}}},{key:"getLayerByConfig",value:function(i){var a=i.layer;if(a instanceof Object)return a;if(typeof a=="string")return this.layerService.getLayer(a)||this.layerService.getLayerByName(a)}},{key:"isSameFeature",value:function(i,a){var s=this.displayFeatureInfo;return s&&i===s.layer&&a===s.featureId}}]),r}(Fy);function ik(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}ik(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item input[type='radio'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -ms-touch-action: none;
      touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var ak=Z(81550),ok=Z.n(ak),sk=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.buffer,i=r.offset,a=r.stride,s=r.normalized,l=r.size,c=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:c||0},l&&(this.attribute.size=l)}return(0,Q.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),zh,Hm,Pp,zc,Wm,Op,Gm,lg,rh,Ad,Ru,nh,ih,cg,uk=(zh={},(0,F.Z)(zh,Y.POINTS,"points"),(0,F.Z)(zh,Y.LINES,"lines"),(0,F.Z)(zh,Y.LINE_LOOP,"line loop"),(0,F.Z)(zh,Y.LINE_STRIP,"line strip"),(0,F.Z)(zh,Y.TRIANGLES,"triangles"),(0,F.Z)(zh,Y.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(zh,Y.TRIANGLE_STRIP,"triangle strip"),zh),b2=(Hm={},(0,F.Z)(Hm,Y.STATIC_DRAW,"static"),(0,F.Z)(Hm,Y.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Hm,Y.STREAM_DRAW,"stream"),Hm),Ny=(Pp={},(0,F.Z)(Pp,Y.BYTE,"int8"),(0,F.Z)(Pp,Y.INT,"int32"),(0,F.Z)(Pp,Y.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Pp,Y.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Pp,Y.UNSIGNED_INT,"uint32"),(0,F.Z)(Pp,Y.FLOAT,"float"),Pp),lk=(zc={},(0,F.Z)(zc,Y.ALPHA,"alpha"),(0,F.Z)(zc,Y.LUMINANCE,"luminance"),(0,F.Z)(zc,Y.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(zc,Y.RGB,"rgb"),(0,F.Z)(zc,Y.RGBA,"rgba"),(0,F.Z)(zc,Y.RGBA4,"rgba4"),(0,F.Z)(zc,Y.RGB5_A1,"rgb5 a1"),(0,F.Z)(zc,Y.RGB565,"rgb565"),(0,F.Z)(zc,Y.DEPTH_COMPONENT,"depth"),(0,F.Z)(zc,Y.DEPTH_STENCIL,"depth stencil"),zc),ck=(Wm={},(0,F.Z)(Wm,Y.DONT_CARE,"dont care"),(0,F.Z)(Wm,Y.NICEST,"nice"),(0,F.Z)(Wm,Y.FASTEST,"fast"),Wm),E2=(Op={},(0,F.Z)(Op,Y.NEAREST,"nearest"),(0,F.Z)(Op,Y.LINEAR,"linear"),(0,F.Z)(Op,Y.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(Op,Y.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(Op,Y.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(Op,Y.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Op),S2=(Gm={},(0,F.Z)(Gm,Y.REPEAT,"repeat"),(0,F.Z)(Gm,Y.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(Gm,Y.MIRRORED_REPEAT,"mirror"),Gm),fk=(lg={},(0,F.Z)(lg,Y.NONE,"none"),(0,F.Z)(lg,Y.BROWSER_DEFAULT_WEBGL,"browser"),lg),hk=(rh={},(0,F.Z)(rh,Y.NEVER,"never"),(0,F.Z)(rh,Y.ALWAYS,"always"),(0,F.Z)(rh,Y.LESS,"less"),(0,F.Z)(rh,Y.LEQUAL,"lequal"),(0,F.Z)(rh,Y.GREATER,"greater"),(0,F.Z)(rh,Y.GEQUAL,"gequal"),(0,F.Z)(rh,Y.EQUAL,"equal"),(0,F.Z)(rh,Y.NOTEQUAL,"notequal"),rh),A2=(Ad={},(0,F.Z)(Ad,Y.FUNC_ADD,"add"),(0,F.Z)(Ad,Y.MIN_EXT,"min"),(0,F.Z)(Ad,Y.MAX_EXT,"max"),(0,F.Z)(Ad,Y.FUNC_SUBTRACT,"subtract"),(0,F.Z)(Ad,Y.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ad),fg=(Ru={},(0,F.Z)(Ru,Y.ZERO,"zero"),(0,F.Z)(Ru,Y.ONE,"one"),(0,F.Z)(Ru,Y.SRC_COLOR,"src color"),(0,F.Z)(Ru,Y.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(Ru,Y.SRC_ALPHA,"src alpha"),(0,F.Z)(Ru,Y.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(Ru,Y.DST_COLOR,"dst color"),(0,F.Z)(Ru,Y.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(Ru,Y.DST_ALPHA,"dst alpha"),(0,F.Z)(Ru,Y.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(Ru,Y.CONSTANT_COLOR,"constant color"),(0,F.Z)(Ru,Y.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(Ru,Y.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(Ru,Y.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(Ru,Y.SRC_ALPHA_SATURATE,"src alpha saturate"),Ru),pk=(nh={},(0,F.Z)(nh,Y.NEVER,"never"),(0,F.Z)(nh,Y.ALWAYS,"always"),(0,F.Z)(nh,Y.LESS,"less"),(0,F.Z)(nh,Y.LEQUAL,"lequal"),(0,F.Z)(nh,Y.GREATER,"greater"),(0,F.Z)(nh,Y.GEQUAL,"gequal"),(0,F.Z)(nh,Y.EQUAL,"equal"),(0,F.Z)(nh,Y.NOTEQUAL,"notequal"),nh),Ev=(ih={},(0,F.Z)(ih,Y.ZERO,"zero"),(0,F.Z)(ih,Y.KEEP,"keep"),(0,F.Z)(ih,Y.REPLACE,"replace"),(0,F.Z)(ih,Y.INVERT,"invert"),(0,F.Z)(ih,Y.INCR,"increment"),(0,F.Z)(ih,Y.DECR,"decrement"),(0,F.Z)(ih,Y.INCR_WRAP,"increment wrap"),(0,F.Z)(ih,Y.DECR_WRAP,"decrement wrap"),ih),dk=(cg={},(0,F.Z)(cg,Y.FRONT,"front"),(0,F.Z)(cg,Y.BACK,"back"),cg),vk=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=r.data,i=r.usage,a=r.type;this.buffer=t.buffer({data:n,usage:b2[i||Y.STATIC_DRAW],type:Ny[a||Y.UNSIGNED_BYTE]})}return(0,Q.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}(),mk=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.data,i=r.usage,a=r.type,s=r.count;this.elements=t.elements({data:n,usage:b2[i||Y.STATIC_DRAW],type:Ny[a||Y.UNSIGNED_BYTE],count:s})}return(0,Q.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),gk=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.width,i=r.height,a=r.color,s=r.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(c){return c.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=t.framebuffer(l)}return(0,Q.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}(),yk={}.toString,_k=function(e,t){return yk.call(e)==="[object "+t+"]"},xk=_k,bk=function(e){return xk(e,"Number")},Sv=bk,Ek=function(e){return e==null},kp=Ek,Sk=function(e,t,r){return e<t?t:e>r?r:e},Ak=Sk,kn=Z(65353),Tk=Z(90857),T2=Tk,qe;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(qe||(qe={}));var pa;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(pa||(pa={}));var Fi;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Fi||(Fi={}));var Xm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Xm||(Xm={}));var Zl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Zl||(Zl={}));var $i;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})($i||($i={}));var Js;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Js||(Js={}));var yl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(yl||(yl={}));var Qo;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Qo||(Qo={}));var Us;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Us||(Us={}));var ys;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ys||(ys={}));var eo;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(eo||(eo={}));var _f;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(_f||(_f={}));var Td;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Td||(Td={}));var w2;(function(e){e.LOADED="loaded"})(w2||(w2={}));var ji;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(ji||(ji={}));var Mu;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(Mu||(Mu={}));var eu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(eu||(eu={}));var zo;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(zo||(zo={}));function T6(e,t,r,n){var i=ji.TEXTURE_2D,a=1,s=Mu.SAMPLED;return{dimension:i,format:e,width:t,height:r,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var Zo;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(Zo||(Zo={}));var Av;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(Av||(Av={}));var Tv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Tv||(Tv={}));var hg;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(hg||(hg={}));var Pr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Pr||(Pr={}));var Yn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Yn||(Yn={}));function C2(e){return e}var In;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(In||(In={}));function pi(e,t,r){return e<<16|t<<8|r}var Dt;(function(e){e[e.ALPHA=pi(Pr.U8,Yn.A,In.None)]="ALPHA",e[e.U8_LUMINANCE=pi(Pr.U8,Yn.A,In.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=pi(Pr.F16,Yn.A,In.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=pi(Pr.F32,Yn.A,In.Luminance)]="F32_LUMINANCE",e[e.F16_R=pi(Pr.F16,Yn.R,In.None)]="F16_R",e[e.F16_RG=pi(Pr.F16,Yn.RG,In.None)]="F16_RG",e[e.F16_RGB=pi(Pr.F16,Yn.RGB,In.None)]="F16_RGB",e[e.F16_RGBA=pi(Pr.F16,Yn.RGBA,In.None)]="F16_RGBA",e[e.F32_R=pi(Pr.F32,Yn.R,In.None)]="F32_R",e[e.F32_RG=pi(Pr.F32,Yn.RG,In.None)]="F32_RG",e[e.F32_RGB=pi(Pr.F32,Yn.RGB,In.None)]="F32_RGB",e[e.F32_RGBA=pi(Pr.F32,Yn.RGBA,In.None)]="F32_RGBA",e[e.U8_R=pi(Pr.U8,Yn.R,In.None)]="U8_R",e[e.U8_R_NORM=pi(Pr.U8,Yn.R,In.Normalized)]="U8_R_NORM",e[e.U8_RG=pi(Pr.U8,Yn.RG,In.None)]="U8_RG",e[e.U8_RG_NORM=pi(Pr.U8,Yn.RG,In.Normalized)]="U8_RG_NORM",e[e.U8_RGB=pi(Pr.U8,Yn.RGB,In.None)]="U8_RGB",e[e.U8_RGB_NORM=pi(Pr.U8,Yn.RGB,In.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=pi(Pr.U8,Yn.RGB,In.sRGB|In.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=pi(Pr.U8,Yn.RGBA,In.None)]="U8_RGBA",e[e.U8_RGBA_NORM=pi(Pr.U8,Yn.RGBA,In.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=pi(Pr.U8,Yn.RGBA,In.sRGB|In.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=pi(Pr.U16,Yn.R,In.None)]="U16_R",e[e.U16_R_NORM=pi(Pr.U16,Yn.R,In.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=pi(Pr.U16,Yn.RG,In.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=pi(Pr.U16,Yn.RGBA,In.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=pi(Pr.U16,Yn.RGB,In.None)]="U16_RGB",e[e.U32_R=pi(Pr.U32,Yn.R,In.None)]="U32_R",e[e.U32_RG=pi(Pr.U32,Yn.RG,In.None)]="U32_RG",e[e.S8_R=pi(Pr.S8,Yn.R,In.None)]="S8_R",e[e.S8_R_NORM=pi(Pr.S8,Yn.R,In.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=pi(Pr.S8,Yn.RG,In.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=pi(Pr.S8,Yn.RGB,In.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=pi(Pr.S8,Yn.RGBA,In.Normalized)]="S8_RGBA_NORM",e[e.S16_R=pi(Pr.S16,Yn.R,In.None)]="S16_R",e[e.S16_RG=pi(Pr.S16,Yn.RG,In.None)]="S16_RG",e[e.S16_RG_NORM=pi(Pr.S16,Yn.RG,In.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=pi(Pr.S16,Yn.RGB,In.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=pi(Pr.S16,Yn.RGBA,In.None)]="S16_RGBA",e[e.S16_RGBA_NORM=pi(Pr.S16,Yn.RGBA,In.Normalized)]="S16_RGBA_NORM",e[e.S32_R=pi(Pr.S32,Yn.R,In.None)]="S32_R",e[e.U16_RGBA_5551=pi(Pr.U16_PACKED_5551,Yn.RGBA,In.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=pi(Pr.U16_PACKED_565,Yn.RGB,In.Normalized)]="U16_RGB_565",e[e.BC1=pi(Pr.BC1,Yn.RGBA,In.Normalized)]="BC1",e[e.BC1_SRGB=pi(Pr.BC1,Yn.RGBA,In.Normalized|In.sRGB)]="BC1_SRGB",e[e.BC2=pi(Pr.BC2,Yn.RGBA,In.Normalized)]="BC2",e[e.BC2_SRGB=pi(Pr.BC2,Yn.RGBA,In.Normalized|In.sRGB)]="BC2_SRGB",e[e.BC3=pi(Pr.BC3,Yn.RGBA,In.Normalized)]="BC3",e[e.BC3_SRGB=pi(Pr.BC3,Yn.RGBA,In.Normalized|In.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=pi(Pr.BC4_UNORM,Yn.R,In.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=pi(Pr.BC4_SNORM,Yn.R,In.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=pi(Pr.BC5_UNORM,Yn.RG,In.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=pi(Pr.BC5_SNORM,Yn.RG,In.Normalized)]="BC5_SNORM",e[e.D24=pi(Pr.D24,Yn.R,In.Depth)]="D24",e[e.D24_S8=pi(Pr.D24S8,Yn.RG,In.Depth|In.Stencil)]="D24_S8",e[e.D32F=pi(Pr.D32F,Yn.R,In.Depth)]="D32F",e[e.D32F_S8=pi(Pr.D32FS8,Yn.RG,In.Depth|In.Stencil)]="D32F_S8",e[e.U8_RGB_RT=pi(Pr.U8,Yn.RGB,In.RenderTarget|In.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=pi(Pr.U8,Yn.RGBA,In.RenderTarget|In.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=pi(Pr.U8,Yn.RGBA,In.RenderTarget|In.Normalized|In.sRGB)]="U8_RGBA_RT_SRGB"})(Dt||(Dt={}));function pg(e){return e>>>8&255}function ah(e){return e>>>16&255}function wv(e){return e&255}function R2(e){switch(e){case Pr.F32:case Pr.U32:case Pr.S32:return 4;case Pr.U16:case Pr.S16:case Pr.F16:return 2;case Pr.U8:case Pr.S8:return 1;default:throw new Error("whoops")}}function M2(e){return R2(ah(e))}function w6(e){return C2(pg(e))}function wk(e){var t=R2(ah(e)),r=C2(pg(e));return t*r}function C6(e,t){return e&4294967040|t}function R6(e,t){return e&4294902015|t<<8}function I2(e){var t=wv(e);if(t&In.Depth)return Zo.Depth;if(t&In.Normalized)return Zo.Float;var r=ah(e);if(r===Pr.F16||r===Pr.F32)return Zo.Float;if(r===Pr.U8||r===Pr.U16||r===Pr.U32)return Zo.Uint;if(r===Pr.S8||r===Pr.S16||r===Pr.S32)return Zo.Sint;throw new Error("whoops")}function ki(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function wd(e){if(e!=null)return e;throw new Error("Missing object")}function P2(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function O2(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function k2(e){var t=e.r,r=e.g,n=e.b,i=e.a;return{r:t,g:r,b:n,a:i}}function $m(e,t,r,n){return n===void 0&&(n=1),{r:e,g:t,b:r,a:n}}var Uy=$m(0,0,0,0),M6=$m(0,0,0,1),Ck=$m(1,1,1,0),I6=$m(1,1,1,1),Cv=!0;function P6(e,t){t===void 0&&(t=Cv),t&&(e[10]=-e[10],e[14]=-e[14])}function O6(e,t){t===void 0&&(t=Cv),t&&(e[10]=-e[10],e[14]=-e[14]+1)}function Rk(e,t){if(t===void 0&&(t=Cv),t)switch(e){case Fi.LESS:return Fi.GREATER;case Fi.LEQUAL:return Fi.GEQUAL;case Fi.GEQUAL:return Fi.LEQUAL;case Fi.GREATER:return Fi.LESS;default:return e}else return e}function k6(e,t){return t===void 0&&(t=Cv),t?1-e:e}function D6(e,t){return t===void 0&&(t=Cv),t?-e:e}function L6(e,t,r,n){if(n===void 0&&(n=Cv),r=Rk(r,n),r===Fi.LESS)return e<t;if(r===Fi.LEQUAL)return e<=t;if(r===Fi.GREATER)return e>t;if(r===Fi.GEQUAL)return e>=t;throw new Error("whoops")}function dg(e){return!!(e&&(e&e-1)==0)}function Rv(e,t){return e!=null?e:t}function Mk(e){return e===void 0?null:e}function B6(e,t,r){e.length=t,e.fill(r)}function vg(e,t){var r=t-1;return e+r&~r}function F6(e,t){return((e+t-1)/t|0)*t}function Ik(e,t,r){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=r(t,e[a]);s<0?i=a:n=a+1}return n}function N6(e,t,r){var n=Ik(e,t,r);e.splice(n,0,t)}function U6(e,t,r){return r?e|=t:e&=~t,e}function Pk(e,t){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}function Ok(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(n,i){return"".concat(kk(""+(t+i),4," "),"  ").concat(n)}).join(`
`)}function kk(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function z6(e,t){for(var r=[],n=e;n<e+t;n++)r.push(n);return r}function D2(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function mg(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e}function L2(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),D2(e.rgbBlendState,t.rgbBlendState),D2(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function zy(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=L2(e[r],t[r])}function Dk(e,t){t.attachmentsState!==void 0&&zy(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&O2(e.blendConstant,t.blendConstant),e.depthCompare=Rv(t.depthCompare,e.depthCompare),e.depthWrite=Rv(t.depthWrite,e.depthWrite),e.stencilWrite=Rv(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&mg(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&mg(e.stencilBack,t.stencilBack),e.cullMode=Rv(t.cullMode,e.cullMode),e.frontFace=Rv(t.frontFace,e.frontFace),e.polygonOffset=Rv(t.polygonOffset,e.polygonOffset)}function Mv(e){var t=Object.assign({},e);return t.attachmentsState=[],zy(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&k2(t.blendConstant),t.stencilFront=mg(void 0,e.stencilFront),t.stencilBack=mg(void 0,e.stencilBack),t}function Lk(e,t){t.channelWriteMask!==void 0&&(e.channelWriteMask=t.channelWriteMask),t.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=t.rgbBlendMode),t.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=t.alphaBlendMode),t.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),t.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),t.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),t.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}var B2={blendMode:Js.ADD,blendSrcFactor:$i.ONE,blendDstFactor:$i.ZERO},Cd={attachmentsState:[{channelWriteMask:eu.ALL,rgbBlendState:B2,alphaBlendState:B2}],blendConstant:k2(Uy),depthWrite:!0,depthCompare:Fi.LEQUAL,stencilWrite:!1,stencilFront:{compare:Fi.ALWAYS,passOp:zo.KEEP,depthFailOp:zo.KEEP,failOp:zo.KEEP},stencilBack:{compare:Fi.ALWAYS,passOp:zo.KEEP,depthFailOp:zo.KEEP,failOp:zo.KEEP},cullMode:Zl.NONE,frontFace:Xm.CCW,polygonOffset:!1};function Bk(e,t){e===void 0&&(e=null),t===void 0&&(t=Cd);var r=Mv(t);return e!==null&&Dk(r,e),r}var Z6=Bk({depthCompare:Fi.ALWAYS,depthWrite:!1},Cd);function V6(e,t){return e.attachmentsState===void 0&&(e.attachmentsState=[],zy(e.attachmentsState,Cd.attachmentsState)),Lk(e.attachmentsState[0],t),e}var F2={texture:null,sampler:null,formatKind:Zo.Float,dimension:ji.TEXTURE_2D};function Iv(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function Pv(e,t){for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=t(e[n]);return r}function Fk(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function Nk(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function j6(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!Iv(e.samplerBindings,t.samplerBindings,Nk)||!Iv(e.uniformBufferBindings,t.uniformBufferBindings,Fk))}function N2(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function Uk(e,t){return!(!N2(e.rgbBlendState,t.rgbBlendState)||!N2(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function gg(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp}function zk(e,t){return!Iv(e.attachmentsState,t.attachmentsState,Uk)||e.blendConstant&&t.blendConstant&&!P2(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!gg(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!gg(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset}function U2(e,t){return e.id===t.id}function Zk(e,t){return e===t}function H6(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!zk(e.megaStateDescriptor,t.megaStateDescriptor)||!U2(e.program,t.program)||!Iv(e.colorAttachmentFormats,t.colorAttachmentFormats,Zk)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function Vk(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function jk(e,t){return isNil(e)?isNil(t):isNil(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&Iv(e.attributes,t.attributes,Vk)}function W6(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!Iv(e.vertexBufferDescriptors,t.vertexBufferDescriptors,jk)||!U2(e.program,t.program))}function G6(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function Hk(e){var t=e.sampler,r=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:t,texture:r,dimension:n,formatKind:i,comparison:a}}function z2(e){var t=e.buffer,r=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:t,offset:i,size:r}}function Wk(e){var t=e.binding,r=e.texture;return{binding:t,texture:r}}function X6(e){var t=e.samplerBindings&&Pv(e.samplerBindings,Hk),r=e.uniformBufferBindings&&Pv(e.uniformBufferBindings,z2),n=e.storageBufferBindings&&Pv(e.storageBufferBindings,z2),i=e.storageTextureBindings&&Pv(e.storageTextureBindings,Wk);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function $6(e){var t=e.inputLayout,r=e.program,n=e.topology,i=e.megaStateDescriptor&&Mv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:t,megaStateDescriptor:i,program:r,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function Gk(e){var t=e.shaderLocation,r=e.format,n=e.offset,i=e.divisor;return{shaderLocation:t,format:r,offset:n,divisor:i}}function Xk(e){if(isNil(e))return e;var t=e.arrayStride,r=e.stepMode,n=Pv(e.attributes,Gk);return{arrayStride:t,stepMode:r,attributes:n}}function Y6(e){var t=Pv(e.vertexBufferDescriptors,Xk),r=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:n}}var Ki,$k=/([^[]*)(\[[0-9]+\])?/;function Yk(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match($k);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function _l(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function Vo(e,t,r,n){var i=null,a=null;return function(s,l,c){var p=t(c,r),y=p.length,b=!1;if(i===null)i=new Float32Array(y),a=y,b=!0;else{ki(a===y,"Uniform length cannot change.");for(var A=0;A<y;++A)if(p[A]!==i[A]){b=!0;break}}return b&&(n(s,e,l,p),i.set(p)),b}}function Yu(e,t,r,n){e[t](r,n)}function Zh(e,t,r,n){e[t](r,!1,n)}var qk={},Kk={},Qk={},Z2=[0];function Zy(e,t,r,n){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(Z2[0]=e,e=Z2);var i=e.length;if(e instanceof r)return e;var a=n[i];a||(a=new r(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function cc(e,t){return Zy(e,t,Float32Array,qk)}function Dp(e,t){return Zy(e,t,Int32Array,Kk)}function yg(e,t){return Zy(e,t,Uint32Array,Qk)}var Jk=(Ki={},Ki[qe.FLOAT]=Vo.bind(null,"uniform1fv",cc,1,Yu),Ki[qe.FLOAT_VEC2]=Vo.bind(null,"uniform2fv",cc,2,Yu),Ki[qe.FLOAT_VEC3]=Vo.bind(null,"uniform3fv",cc,3,Yu),Ki[qe.FLOAT_VEC4]=Vo.bind(null,"uniform4fv",cc,4,Yu),Ki[qe.INT]=Vo.bind(null,"uniform1iv",Dp,1,Yu),Ki[qe.INT_VEC2]=Vo.bind(null,"uniform2iv",Dp,2,Yu),Ki[qe.INT_VEC3]=Vo.bind(null,"uniform3iv",Dp,3,Yu),Ki[qe.INT_VEC4]=Vo.bind(null,"uniform4iv",Dp,4,Yu),Ki[qe.BOOL]=Vo.bind(null,"uniform1iv",Dp,1,Yu),Ki[qe.BOOL_VEC2]=Vo.bind(null,"uniform2iv",Dp,2,Yu),Ki[qe.BOOL_VEC3]=Vo.bind(null,"uniform3iv",Dp,3,Yu),Ki[qe.BOOL_VEC4]=Vo.bind(null,"uniform4iv",Dp,4,Yu),Ki[qe.FLOAT_MAT2]=Vo.bind(null,"uniformMatrix2fv",cc,4,Zh),Ki[qe.FLOAT_MAT3]=Vo.bind(null,"uniformMatrix3fv",cc,9,Zh),Ki[qe.FLOAT_MAT4]=Vo.bind(null,"uniformMatrix4fv",cc,16,Zh),Ki[qe.UNSIGNED_INT]=Vo.bind(null,"uniform1uiv",yg,1,Yu),Ki[qe.UNSIGNED_INT_VEC2]=Vo.bind(null,"uniform2uiv",yg,2,Yu),Ki[qe.UNSIGNED_INT_VEC3]=Vo.bind(null,"uniform3uiv",yg,3,Yu),Ki[qe.UNSIGNED_INT_VEC4]=Vo.bind(null,"uniform4uiv",yg,4,Yu),Ki[qe.FLOAT_MAT2x3]=Vo.bind(null,"uniformMatrix2x3fv",cc,6,Zh),Ki[qe.FLOAT_MAT2x4]=Vo.bind(null,"uniformMatrix2x4fv",cc,8,Zh),Ki[qe.FLOAT_MAT3x2]=Vo.bind(null,"uniformMatrix3x2fv",cc,6,Zh),Ki[qe.FLOAT_MAT3x4]=Vo.bind(null,"uniformMatrix3x4fv",cc,12,Zh),Ki[qe.FLOAT_MAT4x2]=Vo.bind(null,"uniformMatrix4x2fv",cc,8,Zh),Ki[qe.FLOAT_MAT4x3]=Vo.bind(null,"uniformMatrix4x3fv",cc,12,Zh),Ki[qe.SAMPLER_2D]=_l,Ki[qe.SAMPLER_CUBE]=_l,Ki[qe.SAMPLER_3D]=_l,Ki[qe.SAMPLER_2D_SHADOW]=_l,Ki[qe.SAMPLER_2D_ARRAY]=_l,Ki[qe.SAMPLER_2D_ARRAY_SHADOW]=_l,Ki[qe.SAMPLER_CUBE_SHADOW]=_l,Ki[qe.INT_SAMPLER_2D]=_l,Ki[qe.INT_SAMPLER_3D]=_l,Ki[qe.INT_SAMPLER_CUBE]=_l,Ki[qe.INT_SAMPLER_2D_ARRAY]=_l,Ki[qe.UNSIGNED_INT_SAMPLER_2D]=_l,Ki[qe.UNSIGNED_INT_SAMPLER_3D]=_l,Ki[qe.UNSIGNED_INT_SAMPLER_CUBE]=_l,Ki[qe.UNSIGNED_INT_SAMPLER_2D_ARRAY]=_l,Ki);function V2(e,t,r){var n=Jk[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)}var eD={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function tD(e){return Object.prototype.toString.call(e)in eD}function Ym(e,t){return"#define ".concat(e," ").concat(t)}function rD(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,n,i){var a=Number(i);return t[n]=isNaN(a)?i:a,""}),t}function nD(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return r.push({location:isNaN(s)?t[i]:s,name:a}),""}),r}function q6(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var c=__read(l.trim().split(/\s+/),2),p=c[0],y=c[1];s.push({type:p.trim(),name:y.replace(";","").trim()})}),r.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",c=s[1]||"",p=c.indexOf("[")>-1;if(c=c.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var y=r.find(function(w){return l===w.type});if(y)if(p)for(var b=function(w){y.uniforms.forEach(function(I){t.push("".concat(c,"[").concat(w,"].").concat(I.name))})},A=0;A<5;A++)b(A);else y.uniforms.forEach(function(w){t.push("".concat(c,".").concat(w.name))})}c&&t.push(c)}}),""}),t}function j2(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function iD(e){var t="",r=e;return[r,t]}function Lp(e,t,r,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=t==="frag"&&((a=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,c=r.replace(`\r
`,`
`).split(`
`).map(function(je){return je.replace(/[/][/].*$/,"")}).filter(function(je){var it=!je||/^\s+$/.test(je);return!it}),p="";n!==null&&(p=Object.keys(n).map(function(je){return Ym(je,n[je])}).join(`
`));var y=c.find(function(je){return je.startsWith("precision")})||"precision mediump float;",b=i?c.filter(function(je){return!je.startsWith("precision")}).join(`
`):c.join(`
`),A="";if(e.viewportOrigin===Av.UPPER_LEFT&&(A+="".concat(Ym("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Tv.ZERO&&(A+="".concat(Ym("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var w=0,I=0,P=0;b=b.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(je,it,vt,Lt){var lr=vt?"".concat(vt,", "):"";return"layout(".concat(lr,"set = ").concat(w,", binding = ").concat(I++,") uniform ").concat(Lt)}),w++,I=0,ki(e.separateSamplerTextures),b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(je,it,vt,Lt,lr){var cr=j2(vt);cr===null&&(cr=I++);var Rr=(0,kn.__read)(iD(Lt),2),fn=Rr[0],Pn=Rr[1];return t==="frag"?`
layout(set = `.concat(w,", binding = ").concat(cr*2+0,") uniform texture").concat(fn," T_").concat(lr,`;
layout(set = `).concat(w,", binding = ").concat(cr*2+1,") uniform sampler").concat(Pn," S_").concat(lr,";").trim():""}),b=b.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(je,it){return"layout(location = ".concat(P++,") ").concat(it)}),A+="".concat(Ym("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Ym("gl_InstanceID","gl_InstanceIndex"),`
`),y=y.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var L=0;b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(je,it,vt,Lt,lr){var cr=j2(vt);return cr===null&&(cr=L++),"uniform sampler".concat(Lt," ").concat(lr,"; // BINDING=").concat(cr)})}if(e.separateSamplerTextures)b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(je,it,vt){return"sampler".concat(it,"(T_").concat(vt,", S_").concat(vt,")")}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(je,it){return"T_".concat(it)});else{var V=[];b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(je,it,vt){return V.push([vt,it]),vt}),s&&V.forEach(function(je){var it=(0,kn.__read)(je,2),vt=it[0],Lt=it[1];b=b.replace(new RegExp("texture\\(".concat(vt),"g"),function(){return"texture".concat(Lt,"(").concat(vt)})}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(je,it){return it})}var K="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?y:"",`
`).concat(A||"").concat(p?p+`
`:"",`
`).concat(b,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(K=K.replace(/^\b(out)\b/g,function(je,it){return"layout(location = 0) ".concat(it)})),s){if(t==="frag"&&(K=K.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(je,it,vt){return"varying ".concat(it," ").concat(vt,`;
`)})),t==="vert"&&(K=K.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(je,it,vt){return"varying ".concat(it," ").concat(vt,`;
`)}),K=K.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(je,it,vt){return"attribute ".concat(it," ").concat(vt,`;
`)})),K=K.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(je,it){return it.trim().replace(/^.*$/gm,function(vt){var Lt=vt.trim();return Lt.startsWith("#")?Lt:vt?"uniform ".concat(Lt):""})}),t==="frag")if(l){var le=[];K=K.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(je,it){return le.push(it),"vec4 ".concat(it,`;
`)});var xe=K.lastIndexOf("}");K=K.substring(0,xe)+`
    `.concat(le.map(function(je,it){return"gl_FragData[".concat(it,"] = ").concat(je,`;
    `)}).join(`
`))+K.substring(xe)}else{var ke;if(K=K.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(je,it,vt){return ke=vt,"".concat(it," ").concat(vt,`;
`)}),ke){var xe=K.lastIndexOf("}");K=K.substring(0,xe)+`
  gl_FragColor = vec4(`.concat(ke,`);
`)+K.substring(xe)}}K=K.replace(/^\s*layout\((.*)\)/gm,"")}return K}function K6(e,t,r,n){n===void 0&&(n=null);var i=Lp(e,"vert",t,n),a=Lp(e,"frag",r,n);return{vert:t,frag:r,preprocessedVert:i,preprocessedFrag:a}}var xf=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(T2),aD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.Bindings;var l=a.uniformBufferBindings,c=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=c||[],s.bindingLayouts=s.createBindingLayouts(),s}return t.prototype.createBindingLayouts=function(){var r=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:r,numUniformBuffers:a,firstSampler:n,numSamplers:s}),r+=a,n+=s,{numUniformBuffers:r,numSamplers:n,bindingLayoutTables:i}},t}(xf);function jn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function H2(e){var t=ah(e);switch(t){case Pr.BC1:case Pr.BC2:case Pr.BC3:case Pr.BC4_UNORM:case Pr.BC4_SNORM:case Pr.BC5_UNORM:case Pr.BC5_SNORM:return!0;default:return!1}}function W2(e){var t=wv(e);if(t&In.Normalized)return!1;var r=ah(e);return r===Pr.S8||r===Pr.S16||r===Pr.S32||r===Pr.U8||r===Pr.U16||r===Pr.U32}function oD(e){switch(e){case _f.STATIC:return qe.STATIC_DRAW;case _f.DYNAMIC:return qe.DYNAMIC_DRAW}}function G2(e){if(e&eo.INDEX)return qe.ELEMENT_ARRAY_BUFFER;if(e&eo.VERTEX)return qe.ARRAY_BUFFER;if(e&eo.UNIFORM)return qe.UNIFORM_BUFFER}function sD(e){switch(e){case ys.TRIANGLES:return qe.TRIANGLES;case ys.POINTS:return qe.POINTS;case ys.TRIANGLE_STRIP:return qe.TRIANGLE_STRIP;case ys.LINES:return qe.LINES;case ys.LINE_STRIP:return qe.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function uD(e){switch(e){case Pr.U8:return qe.UNSIGNED_BYTE;case Pr.U16:return qe.UNSIGNED_SHORT;case Pr.U32:return qe.UNSIGNED_INT;case Pr.S8:return qe.BYTE;case Pr.S16:return qe.SHORT;case Pr.S32:return qe.INT;case Pr.F16:return qe.HALF_FLOAT;case Pr.F32:return qe.FLOAT;default:throw new Error("whoops")}}function lD(e){switch(e){case Yn.R:return 1;case Yn.RG:return 2;case Yn.RGB:return 3;case Yn.RGBA:return 4;default:return 1}}function cD(e){var t=ah(e),r=pg(e),n=wv(e),i=uD(t),a=lD(r),s=!!(n&In.Normalized);return{size:a,type:i,normalized:s}}function fD(e){switch(e){case Dt.U8_R:return qe.UNSIGNED_BYTE;case Dt.U16_R:return qe.UNSIGNED_SHORT;case Dt.U32_R:return qe.UNSIGNED_INT;default:throw new Error("whoops")}}function qm(e){switch(e){case yl.CLAMP_TO_EDGE:return qe.CLAMP_TO_EDGE;case yl.REPEAT:return qe.REPEAT;case yl.MIRRORED_REPEAT:return qe.MIRRORED_REPEAT;default:throw new Error("whoops")}}function _g(e,t){if(t===Us.LINEAR&&e===Qo.BILINEAR)return qe.LINEAR_MIPMAP_LINEAR;if(t===Us.LINEAR&&e===Qo.POINT)return qe.NEAREST_MIPMAP_LINEAR;if(t===Us.NEAREST&&e===Qo.BILINEAR)return qe.LINEAR_MIPMAP_NEAREST;if(t===Us.NEAREST&&e===Qo.POINT)return qe.NEAREST_MIPMAP_NEAREST;if(t===Us.NO_MIP&&e===Qo.BILINEAR)return qe.LINEAR;if(t===Us.NO_MIP&&e===Qo.POINT)return qe.NEAREST;throw new Error("Unknown texture filter mode")}function Ov(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function kv(e){var t=e;return t.gl_texture}function Vy(e){var t=e;return t.gl_sampler}function Km(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function X2(e,t){for(var r=[];;){var n=t.exec(e);if(!n)break;r.push(n)}return r}function Bp(e){return e.blendMode==Js.ADD&&e.blendSrcFactor==$i.ONE&&e.blendDstFactor===$i.ZERO}function hD(e){switch(e){case hg.OcclusionConservative:return qe.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function pD(e){if(e===ji.TEXTURE_2D)return qe.TEXTURE_2D;if(e===ji.TEXTURE_2D_ARRAY)return qe.TEXTURE_2D_ARRAY;if(e===ji.TEXTURE_CUBE_MAP)return qe.TEXTURE_CUBE_MAP;if(e===ji.TEXTURE_3D)return qe.TEXTURE_3D;throw new Error("whoops")}function jy(e,t,r,n){return!(e%r!=0||t%n!=0)}var dD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.Buffer;var l=a.viewOrSize,c=a.usage,p=a.hint,y=p===void 0?_f.STATIC:p,b=i.uniformBufferMaxPageByteSize,A=i.gl,w=c&eo.UNIFORM;w||(jn(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=Sv(l)?vg(l,4):vg(l.byteLength,4);s.gl_buffer_pages=[];var P;if(w){for(var L=I;L>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(L,b),c,y)),L-=b;P=b}else s.gl_buffer_pages.push(s.createBufferPage(I,c,y)),P=I;return s.pageByteSize=P,s.byteSize=I,s.usage=c,s.gl_target=G2(c),Sv(l)||s.setSubData(0,new Uint8Array(l.buffer)),w||(jn(A)?A.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,c=r+a,p=r,y=r%l;p<c;){var b=jn(s)?s.COPY_WRITE_BUFFER:this.gl_target,A=Ov(this,p);if(A.ubo)return;s.bindBuffer(b,A),jn(s)?s.bufferSubData(b,y,n,i,Math.min(c-p,l)):s.bufferSubData(b,y,n),p+=l,y=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,n,i){var a=this.device.gl,s=n&eo.UNIFORM;if(!jn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),c=G2(n),p=oD(i);return a.bindBuffer(c,l),a.bufferData(c,r,p),l},t}(xf),vD=function(e){(0,kn.__extends)(t,e);function t(r){var n,i,a,s,l=r.id,c=r.device,p=r.descriptor,y,b=e.call(this,{id:l,device:c})||this;b.type=pa.InputLayout;var A=p.vertexBufferDescriptors,w=p.indexBufferFormat,I=p.program;ki(w===Dt.U16_R||w===Dt.U32_R||w===null);var P=w!==null?fD(w):null,L=w!==null?M2(w):null,V=b.device.gl,K=b.device.ensureResourceExists(jn(V)?V.createVertexArray():c.OES_vertex_array_object.createVertexArrayOES());jn(V)?V.bindVertexArray(K):c.OES_vertex_array_object.bindVertexArrayOES(K),V.bindBuffer(V.ARRAY_BUFFER,Ov(b.device.fallbackVertexBuffer));try{for(var le=(0,kn.__values)(p.vertexBufferDescriptors),xe=le.next();!xe.done;xe=le.next()){var ke=xe.value,je=ke.stepMode,it=ke.attributes;try{for(var vt=(a=void 0,(0,kn.__values)(it)),Lt=vt.next();!Lt.done;Lt=vt.next()){var lr=Lt.value,cr=lr.shaderLocation,Rr=lr.format,fn=lr.divisor,Pn=fn===void 0?1:fn,Ri=jn(V)?cr:(y=I.attributes[cr])===null||y===void 0?void 0:y.location,ya=cD(Rr);if(lr.vertexFormat=ya,!kp(Ri)){W2(Rr);var Ha=ya.size,no=ya.type,us=ya.normalized;V.vertexAttribPointer(Ri,Ha,no,us,0,0),je===Td.INSTANCE&&(jn(V)?V.vertexAttribDivisor(Ri,Pn):c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Ri,Pn)),V.enableVertexAttribArray(Ri)}}}catch(xl){a={error:xl}}finally{try{Lt&&!Lt.done&&(s=vt.return)&&s.call(vt)}finally{if(a)throw a.error}}}}catch(xl){n={error:xl}}finally{try{xe&&!xe.done&&(i=le.return)&&i.call(le)}finally{if(n)throw n.error}}return jn(V)?V.bindVertexArray(null):c.OES_vertex_array_object.bindVertexArrayOES(null),b.vertexBufferDescriptors=A,b.vao=K,b.indexBufferFormat=w,b.indexBufferType=P,b.indexBufferCompByteSize=L,b.program=I,b}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(jn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(xf),Hy=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=r.fake,l=e.call(this,{id:n,device:i})||this;l.type=pa.Texture,a=(0,kn.__assign)({dimension:ji.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var c=l.device.gl,p,y,b=l.clampmipLevelCount(a);if(l.immutable=a.usage===Mu.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=I2(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=b>=1,!s){y=l.device.ensureResourceExists(c.createTexture());var A=l.device.translateTextureType(a.format),w=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(c.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===ji.TEXTURE_2D){if(p=qe.TEXTURE_2D,c.bindTexture(p,y),l.immutable)if(jn(c))c.texStorage2D(p,b,w,a.width,a.height);else{var I=(w===qe.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Dt.D32F||l.format===Dt.D24_S8)&&!jn(c)&&!i.WEBGL_depth_texture||(c.texImage2D(p,I,w,a.width,a.height,0,w,A,null),l.mipmaps&&(l.mipmaps=!1,c.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_MIN_FILTER,qe.LINEAR),c.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_WRAP_S,qe.CLAMP_TO_EDGE),c.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_WRAP_T,qe.CLAMP_TO_EDGE)))}ki(a.depthOrArrayLayers===1)}else if(a.dimension===ji.TEXTURE_2D_ARRAY)p=qe.TEXTURE_2D_ARRAY,c.bindTexture(p,y),l.immutable&&jn(c)&&c.texStorage3D(p,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===ji.TEXTURE_3D)p=qe.TEXTURE_3D,c.bindTexture(p,y),l.immutable&&jn(c)&&c.texStorage3D(p,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===ji.TEXTURE_CUBE_MAP)p=qe.TEXTURE_CUBE_MAP,c.bindTexture(p,y),l.immutable&&jn(c)&&c.texStorage2D(p,b,w,a.width,a.height),ki(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=y,l.gl_target=p,l.mipLevelCount=b,l}return t.prototype.setImageData=function(r,n){n===void 0&&(n=0);var i=this.device.gl;H2(this.format);var a=this.gl_target===qe.TEXTURE_3D||this.gl_target===qe.TEXTURE_2D_ARRAY,s=this.gl_target===qe.TEXTURE_CUBE_MAP,l=tD(r[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var c=r[0],p,y;l?(p=this.width,y=this.height):(p=c.width,y=c.height,this.width=p,this.height=y),i.bindTexture(this.gl_target,this.gl_texture);var b=this.device.translateTextureFormat(this.format),A=jn(i)?this.device.translateInternalTextureFormat(this.format):b,w=this.device.translateTextureType(this.format);this.preprocessImage();for(var I=0;I<this.depthOrArrayLayers;I++){var P=r[I],L=this.gl_target;s&&(L=qe.TEXTURE_CUBE_MAP_POSITIVE_X+I%6),this.immutable?i.texSubImage2D(L,n,0,0,p,y,b,w,P):jn(i)?a?i.texImage3D(L,n,A,p,y,this.depthOrArrayLayers,0,b,w,P):i.texImage2D(L,n,A,p,y,0,b,w,P):l?i.texImage2D(L,n,b,p,y,0,b,w,P):i.texImage2D(L,n,b,b,w,P)}this.mipmaps&&this.generateMipmap(a)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(kv(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===ji.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var n=ah(r.format);if(n===Pr.BC1)for(var i=r.width,a=r.height,s=0;s<r.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(qe.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(qe.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(qe.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var n=this.device.gl;return!jn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),r?(n.texParameteri(this.gl_target,qe.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,qe.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,qe.TEXTURE_MIN_FILTER,qe.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,qe.TEXTURE_MAG_FILTER,qe.LINEAR)):n.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_MIN_FILTER,qe.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return jn(r)?!1:!dg(this.width)||!dg(this.height)},t}(xf),mD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,c=a.format,p=a.width,y=a.height,b=a.sampleCount,A=b===void 0?1:b,w=a.texture,I=!1;if((c===Dt.D32F||c===Dt.D24_S8)&&w&&!jn(l)&&!i.WEBGL_depth_texture&&(w.destroy(),s.texture=null,I=!0),!I&&w)s.texture=w;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var P=s.device.translateTextureInternalFormat(c,!0);jn(l)&&A>1?l.renderbufferStorageMultisample(qe.RENDERBUFFER,A,P,p,y):l.renderbufferStorage(qe.RENDERBUFFER,P,p,y)}return s.format=c,s.width=p,s.height=y,s.sampleCount=A,s}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(xf),Vl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Vl||(Vl={}));var gD=function(e){(0,kn.__extends)(t,e);function t(r,n){var i=r.id,a=r.device,s=r.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=pa.Program,l.uniformSetters={},l.attributes=[];var c=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(c.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Vl.NeedsCompile,l.tryCompileProgram(),l}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){var r,n;ki(this.compileState===Vl.NeedsCompile);var i=this.descriptor,a=this.device.gl;((r=i.vertex)===null||r===void 0?void 0:r.glsl)&&((n=i.fragment)===null||n===void 0?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Vl.Compiling,jn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=rD(this.descriptor.vertex.glsl),s=nD(this.rawVertexGLSL,a),l=function(y){var b=n.getActiveAttrib(c.gl_program,y),A=b.name,w=b.type,I=b.size,P=n.getAttribLocation(c.gl_program,A),L=(r=s.find(function(V){return V.name===A}))===null||r===void 0?void 0:r.location;P>=0&&!kp(L)&&(c.attributes[L]={name:A,location:P,type:w,size:I})},c=this,p=0;p<i;p++)l(p)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,n=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=r.getActiveUniform(this.gl_program,i),s=Yk(a.name).name,l=r.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=V2(r,l,a),a&&a.size>1)for(var c=0;c<a.size;c++)l=r.getUniformLocation(this.gl_program,"".concat(s,"[").concat(c,"]")),this.uniformSetters["".concat(s,"[").concat(c,"]")]=V2(r,l,a)}},t.prototype.compileShader=function(r,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,r),i.compileShader(a),a},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var n=this.device.gl;if(!jn(n)){var i=!1;for(var a in r){i||(n.useProgram(this.gl_program),i=!0);var s=r[a],l=this.uniformSetters[a];if(l){var c=s;c instanceof Hy&&(c=c.textureIndex),l(c)}}}return this},t}(xf),yD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.QueryPool;var l=s.device.gl;if(jn(l)){var c=a.elemCount,p=a.type;s.gl_query=Pk(c,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=hD(p)}return s}return t.prototype.queryResultOcclusion=function(r){var n=this.device.gl;if(jn(n)){var i=this.gl_query[r];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(jn(r))for(var n=0;n<this.gl_query.length;n++)r.deleteQuery(this.gl_query[n])},t}(xf),_D=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=pa.Readback,a.gl_pbo=null,a.gl_sync=null,a}return t.prototype.clientWaitAsync=function(r,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function c(){var p=a.clientWaitSync(r,n,0);if(p==a.WAIT_FAILED){l();return}if(p==a.TIMEOUT_EXPIRED){setTimeout(c,Ak(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}c()})},t.prototype.getBufferSubDataAsync=function(r,n,i,a,s,l){return(0,kn.__awaiter)(this,void 0,void 0,function(){var c;return(0,kn.__generator)(this,function(p){switch(p.label){case 0:return c=this.device.gl,jn(c)?(this.gl_sync=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0),c.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return p.sent(),c.bindBuffer(r,n),c.getBufferSubData(r,i,a,s,l),c.bindBuffer(r,null),[2,a];case 2:return[2]}})})},t.prototype.readTexture=function(r,n,i,a,s,l,c,p){return c===void 0&&(c=0),p===void 0&&(p=l.byteLength||0),(0,kn.__awaiter)(this,void 0,void 0,function(){var y,b,A,w,I;return(0,kn.__generator)(this,function(P){return y=this.device.gl,b=r,A=this.device.translateTextureFormat(b.format),w=this.device.translateTextureType(b.format),I=wk(b.format),jn(y)?(this.gl_pbo=this.device.ensureResourceExists(y.createBuffer()),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.bufferData(y.PIXEL_PACK_BUFFER,p,y.STREAM_READ),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),y.bindFramebuffer(qe.READ_FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(qe.READ_FRAMEBUFFER,qe.COLOR_ATTACHMENT0,qe.TEXTURE_2D,b.gl_texture,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.readPixels(n,i,a,s,A,w,c*I),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(y.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,c,0)]):[2,this.readTextureSync(r,n,i,a,s,l,c,p)]})})},t.prototype.readTextureSync=function(r,n,i,a,s,l,c,p){p===void 0&&(p=l.byteLength||0);var y=this.device.gl,b=r,A=this.device.translateTextureType(b.format);return y.bindFramebuffer(qe.FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(qe.FRAMEBUFFER,qe.COLOR_ATTACHMENT0,qe.TEXTURE_2D,b.gl_texture,0),y.pixelStorei(y.PACK_ALIGNMENT,4),y.readPixels(n,i,a,s,y.RGBA,A,l),l},t.prototype.readBuffer=function(r,n,i,a,s){return(0,kn.__awaiter)(this,void 0,void 0,function(){var l;return(0,kn.__generator)(this,function(c){return l=this.device.gl,jn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Ov(r,n),n,i,a,s)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),jn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(xf),xD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;return c.type=pa.RenderPipeline,c.drawMode=sD((s=a.topology)!==null&&s!==void 0?s:ys.TRIANGLES),c.program=a.program,c.inputLayout=a.inputLayout,c.megaState=(0,kn.__assign)((0,kn.__assign)({},Mv(Cd)),a.megaStateDescriptor),c.colorAttachmentFormats=a.colorAttachmentFormats.slice(),c.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,c.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,c}return t}(xf),bD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=pa.ComputePipeline,s.descriptor=a,s}return t}(xf),ED=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var n=(0,kn.__values)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),SD=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=pa.Sampler;var p=c.device.gl;if(jn(p)){var y=c.device.ensureResourceExists(p.createSampler());p.samplerParameteri(y,qe.TEXTURE_WRAP_S,qm(a.addressModeU)),p.samplerParameteri(y,qe.TEXTURE_WRAP_T,qm(a.addressModeV)),p.samplerParameteri(y,qe.TEXTURE_WRAP_R,qm((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),p.samplerParameteri(y,qe.TEXTURE_MIN_FILTER,_g(a.minFilter,a.mipmapFilter)),p.samplerParameteri(y,qe.TEXTURE_MAG_FILTER,_g(a.magFilter,Us.NO_MIP)),a.lodMinClamp!==void 0&&p.samplerParameterf(y,qe.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&p.samplerParameterf(y,qe.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(p.samplerParameteri(y,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.samplerParameteri(y,p.TEXTURE_COMPARE_FUNC,a.compareFunction));var b=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;b>1&&c.device.EXT_texture_filter_anisotropic!==null&&(ki(a.minFilter===Qo.BILINEAR&&a.magFilter===Qo.BILINEAR&&a.mipmapFilter===Us.LINEAR),p.samplerParameterf(y,c.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b)),c.gl_sampler=y}else c.descriptor=a;return c}return t.prototype.setTextureParameters=function(r,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_MIN_FILTER,qe.LINEAR):s.texParameteri(r,qe.TEXTURE_MIN_FILTER,_g(l.minFilter,l.mipmapFilter)),s.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_WRAP_S,qm(l.addressModeU)),s.texParameteri(qe.TEXTURE_2D,qe.TEXTURE_WRAP_T,qm(l.addressModeV)),s.texParameteri(r,qe.TEXTURE_MAG_FILTER,_g(l.magFilter,Us.NO_MIP));var c=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;c>1&&this.device.EXT_texture_filter_anisotropic!==null&&(ki(l.minFilter===Qo.BILINEAR&&l.magFilter===Qo.BILINEAR&&l.mipmapFilter===Us.LINEAR),s.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c))},t.prototype.destroy=function(){e.prototype.destroy.call(this),jn(this.device.gl)&&this.device.gl.deleteSampler(Vy(this))},t.prototype.isNPOT=function(r,n){return!dg(r)||!dg(n)},t}(xf),AD=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,n){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),$2=65536,TD=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,wD=function(){function e(t,r){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Mv(Cd),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Av.LOWER_LEFT,this.clipSpaceNearZ=Tv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=wd(t.getContextAttributes()),jn(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),jn(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Hy({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:ji.TEXTURE_2D,mipLevelCount:1,usage:Mu.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Dt.U8_RGB_RT:Dt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Zo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(ji.TEXTURE_2D,Zo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(ji.TEXTURE_2D,Zo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:eo.VERTEX,hint:_f.STATIC}),jn(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(ji.TEXTURE_2D_ARRAY,Zo.Float),this.fallbackTexture3D=this.createFallbackTexture(ji.TEXTURE_3D,Zo.Float),this.fallbackTextureCube=this.createFallbackTexture(ji.TEXTURE_CUBE_MAP,Zo.Float)),this.currentMegaState.depthCompare=Fi.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=eu.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new ED)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var n=t===ji.TEXTURE_CUBE_MAP?6:1,i=r===Zo.Depth?Dt.D32F:Dt.U8_RGBA_NORM,a=this.createTexture({dimension:t,format:i,usage:Mu.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return r===Zo.Float&&a.setImageData([new Uint8Array(4*n)]),kv(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(qe.MAX_VERTEX_ATTRIBS),jn(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(qe.MAX_UNIFORM_BLOCK_SIZE),$2),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?(0,kn.__spreadArray)([],(0,kn.__read)(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=$2;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(t,r,n){var i=this.scTexture;i.width=t,i.height=r,this.scPlatformFramebuffer=Mk(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case Dt.ALPHA:return qe.ALPHA;case Dt.U8_LUMINANCE:case Dt.F16_LUMINANCE:case Dt.F32_LUMINANCE:return qe.LUMINANCE;case Dt.F16_R:return qe.R16F;case Dt.F16_RG:return qe.RG16F;case Dt.F16_RGB:return qe.RGB16F;case Dt.F16_RGBA:return qe.RGBA16F;case Dt.F32_R:return qe.R32F;case Dt.F32_RG:return qe.RG32F;case Dt.F32_RGB:return qe.RGB32F;case Dt.F32_RGBA:return jn(this.gl)?qe.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:qe.RGBA;case Dt.U8_R_NORM:return qe.R8;case Dt.U8_RG_NORM:return qe.RG8;case Dt.U8_RGB_NORM:case Dt.U8_RGB_RT:return qe.RGB8;case Dt.U8_RGB_SRGB:return qe.SRGB8;case Dt.U8_RGBA_NORM:case Dt.U8_RGBA_RT:return jn(this.gl)?qe.RGBA8:r?qe.RGBA4:qe.RGBA;case Dt.U8_RGBA:return qe.RGBA;case Dt.U8_RGBA_SRGB:case Dt.U8_RGBA_RT_SRGB:return qe.SRGB8_ALPHA8;case Dt.U16_R:return qe.R16UI;case Dt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Dt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Dt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Dt.U16_RGBA_5551:return qe.RGB5_A1;case Dt.U16_RGB_565:return qe.RGB565;case Dt.U32_R:return qe.R32UI;case Dt.S8_RGBA_NORM:return qe.RGBA8_SNORM;case Dt.S8_RG_NORM:return qe.RG8_SNORM;case Dt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Dt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Dt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Dt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Dt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Dt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Dt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Dt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Dt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Dt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Dt.D32F_S8:return jn(this.gl)?qe.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?qe.DEPTH_STENCIL:qe.DEPTH_COMPONENT16;case Dt.D24_S8:return jn(this.gl)?qe.DEPTH24_STENCIL8:this.WEBGL_depth_texture?qe.DEPTH_STENCIL:qe.DEPTH_COMPONENT16;case Dt.D32F:return jn(this.gl)?qe.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?qe.DEPTH_COMPONENT:qe.DEPTH_COMPONENT16;case Dt.D24:return jn(this.gl)?qe.DEPTH_COMPONENT24:this.WEBGL_depth_texture?qe.DEPTH_COMPONENT:qe.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=ah(t);switch(r){case Pr.U8:return qe.UNSIGNED_BYTE;case Pr.U16:return qe.UNSIGNED_SHORT;case Pr.U32:return qe.UNSIGNED_INT;case Pr.S8:return qe.BYTE;case Pr.F16:return qe.HALF_FLOAT;case Pr.F32:return qe.FLOAT;case Pr.U16_PACKED_5551:return qe.UNSIGNED_SHORT_5_5_5_1;case Pr.D32F:return jn(this.gl)?qe.FLOAT:this.WEBGL_depth_texture?qe.UNSIGNED_INT:qe.UNSIGNED_BYTE;case Pr.D24:return jn(this.gl)?qe.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?qe.UNSIGNED_SHORT:qe.UNSIGNED_BYTE;case Pr.D24S8:return jn(this.gl)?qe.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?qe.UNSIGNED_INT_24_8_WEBGL:qe.UNSIGNED_BYTE;case Pr.D32FS8:return qe.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(t){switch(t){case Dt.F32_R:return qe.R32F;case Dt.F32_RG:return qe.RG32F;case Dt.F32_RGB:return qe.RGB32F;case Dt.F32_RGBA:return qe.RGBA32F;case Dt.F16_R:return qe.R16F;case Dt.F16_RG:return qe.RG16F;case Dt.F16_RGB:return qe.RGB16F;case Dt.F16_RGBA:return qe.RGBA16F}return this.translateTextureFormat(t)},e.prototype.translateTextureFormat=function(t){if(H2(t)||t===Dt.F32_LUMINANCE||t===Dt.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=jn(this.gl)||!jn(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case Dt.D24_S8:case Dt.D32F_S8:return r?qe.DEPTH_STENCIL:qe.RGBA;case Dt.D24:case Dt.D32F:return r?qe.DEPTH_COMPONENT:qe.RGBA}var n=W2(t),i=pg(t);switch(i){case Yn.A:return qe.ALPHA;case Yn.R:return n?qe.RED_INTEGER:qe.RED;case Yn.RG:return n?qe.RG_INTEGER:qe.RG;case Yn.RGB:return n?qe.RGB_INTEGER:qe.RGB;case Yn.RGBA:return qe.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(jn(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){ki(t.compileState!==Vl.NeedsCompile),t.compileState===Vl.Compiling&&(t.compileState=Vl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new dD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new Hy({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new SD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new mD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,s=r.mipLevelCount;return ki(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,n,i,a=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return((n=t.vertex)===null||n===void 0?void 0:n.glsl)&&(t.vertex.glsl=Lp(this.queryVendorInfo(),"vert",t.vertex.glsl)),((i=t.fragment)===null||i===void 0?void 0:i.glsl)&&(t.fragment.glsl=Lp(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,a)},e.prototype.createProgramSimple=function(t,r){var n=new gD({id:this.getNextUniqueId(),device:this,descriptor:t},r);return n},e.prototype.createBindings=function(t){return new aD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new vD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new xD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new AD},e.prototype.createComputePipeline=function(t){return new bD({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new _D({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new yD({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,n,i,a,s,l,c=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(n=t.stencilClearValue)!==null&&n!==void 0?n:"load";for(var p=0;p<c.length;p++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[p]=(i=t.colorAttachmentLevel[p])!==null&&i!==void 0?i:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[p]=(a=t.colorResolveToLevel[p])!==null&&a!==void 0?a:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[p]=(s=t.colorClearColor[p])!==null&&s!==void 0?s:"load",t.colorStore||(t.colorStore=[]),t.colorStore[p]=(l=t.colorStore[p])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,n=t.colorAttachmentLevel,i=t.colorClearColor,a=t.colorResolveTo,s=t.colorResolveToLevel,l=t.depthStencilAttachment,c=t.depthClearValue,p=t.stencilClearValue,y=t.depthStencilResolveTo;this.setRenderPassParametersBegin(r.length);for(var b=0;b<r.length;b++)this.setRenderPassParametersColor(b,r[b],n[b],a[b],s[b]);this.setRenderPassParametersDepthStencil(l,y),this.validateCurrentAttachments();for(var b=0;b<r.length;b++){var A=i[b];A!=="load"&&this.setRenderPassParametersClearColor(b,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(c,p),this},e.prototype.submitPass=function(t){ki(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,n,i,a,s){var l=this.gl,c=t,p=i;if(ki(p.mipLevelCount===1),ki(c.mipLevelCount===1),jn(l))c===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,c,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,p,0),l.blitFramebuffer(a,s,a+p.width,s+p.height,r,n,r+p.width,n+p.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(c===this.scTexture){var y=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(y,c)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,n){switch(t){case Dt.BC1_SRGB:case Dt.BC2_SRGB:case Dt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?jy(r,n,4,4):!1;case Dt.BC1:case Dt.BC2:case Dt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?jy(r,n,4,4):!1;case Dt.BC4_UNORM:case Dt.BC4_SNORM:case Dt.BC5_UNORM:case Dt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?jy(r,n,4,4):!1;case Dt.U16_R_NORM:case Dt.U16_RG_NORM:case Dt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Dt.F32_R:case Dt.F32_RG:case Dt.F32_RGB:case Dt.F32_RGBA:return this.OES_texture_float_linear!==null;case Dt.F16_R:case Dt.F16_RG:case Dt.F16_RGB:case Dt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===Vl.NeedsCompile)throw new Error("whoops");if(t.compileState===Vl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(t),n}return t.compileState===Vl.NeedsBind||t.compileState===Vl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===pa.Buffer)for(var n=t.gl_buffer_pages,i=0;i<n.length;i++)Km(n[i],"".concat(r," Page ").concat(i));else if(t.type===pa.Texture)Km(kv(t),r);else if(t.type===pa.Sampler)Km(Vy(t),r);else if(t.type===pa.RenderTarget){var a=t.gl_renderbuffer;a!==null&&Km(a,r)}else t.type===pa.InputLayout&&Km(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){ki(this.shaderDebug)},e.prototype.getBufferData=function(t,r,n){n===void 0&&(n=0);var i=this.gl;jn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Ov(t,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var n=this.gl,i=n.getShaderParameter(t,n.COMPILE_STATUS);if(!i){console.error(Ok(r));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return i},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,n=t.gl_program;if(!r.getProgramParameter(n,r.LINK_STATUS)){var i=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,i.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,n,i){var a=this.gl;if(kp(n))a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,null);else if(n.type===pa.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(t,r,qe.TEXTURE_2D,kv(n.texture),i);else if(n.type===pa.Texture){var s=kv(n);n.dimension===ji.TEXTURE_2D?a.framebufferTexture2D(t,r,qe.TEXTURE_2D,s,i):jn(a)&&n.dimension===ji.TEXTURE_2D_ARRAY}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var n=this.gl,i=kp(r)?In.Depth|In.Stencil:wv(r.format),a=!!(i&In.Depth),s=!!(i&In.Stencil);if(a&&s){var l=jn(this.gl)||!jn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0)}else a?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(t===-1?(t=a.sampleCount,r=a.width,n=a.height):(ki(t===a.sampleCount),ki(r===a.width),ki(n===a.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(ki(t===this.currentDepthStencilAttachment.sampleCount),ki(r===this.currentDepthStencilAttachment.width),ki(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t){var r=this.gl;if(jn(r)?r.bindFramebuffer(qe.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer(qe.FRAMEBUFFER,this.renderPassDrawFramebuffer),jn(r)?r.drawBuffers([qe.COLOR_ATTACHMENT0,qe.COLOR_ATTACHMENT1,qe.COLOR_ATTACHMENT2,qe.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([qe.COLOR_ATTACHMENT0_WEBGL,qe.COLOR_ATTACHMENT1_WEBGL,qe.COLOR_ATTACHMENT2_WEBGL,qe.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var i=jn(r)?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,a=jn(r)?qe.COLOR_ATTACHMENT0:qe.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(i,a+n,qe.RENDERBUFFER,null),r.framebufferTexture2D(i,a+n,qe.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,n,i,a){var s=this.gl,l=jn(s);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==n)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,(l?qe.COLOR_ATTACHMENT0:qe.COLOR_ATTACHMENT0_WEBGL)+t,r,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==i||this.currentColorResolveToLevels[t]!==a)&&(this.currentColorResolveTos[t]=i,this.currentColorResolveToLevels[t]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r){var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(jn(n)?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[t];l&&l.channelWriteMask!==eu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),l.channelWriteMask=eu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==eu.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=eu.ALL)}this.setScissorRectEnabled(!1),jn(s)?s.clearBufferfv(s.COLOR,t,[r,n,i,a]):(s.clearColor(r,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var n=this.gl;t!=="load"&&(ki(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),jn(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),r!=="load"&&(ki(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),jn(n)?n.clearBufferiv(n.STENCIL,0,[r]):(n.clearStencil(r),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r,n=this.gl,i=t,a=i.uniformBufferBindings,s=i.samplerBindings,l=i.bindingLayouts;ki(0<l.bindingLayoutTables.length);var c=l.bindingLayoutTables[0];ki(a.length>=c.numUniformBuffers),ki(s.length>=c.numSamplers);for(var p=0;p<a.length;p++){var y=a[p];if(y.size!==0){var b=c.firstUniformBuffer+p,A=y.buffer,w=y.offset||0,I=y.size||A.byteSize;if(A!==this.currentUniformBuffers[b]||w!==this.currentUniformBufferByteOffsets[b]||I!==this.currentUniformBufferByteSizes[b]){var P=w%A.pageByteSize,L=A.gl_buffer_pages[w/A.pageByteSize|0];ki(P+I<=A.pageByteSize),jn(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,b,L,P,I),this.currentUniformBuffers[b]=A,this.currentUniformBufferByteOffsets[b]=w,this.currentUniformBufferByteSizes[b]=I}}}for(var p=0;p<c.numSamplers;p++){var y=s[p],V=c.firstSampler+p,K=y!==null&&y.sampler!==null?Vy(y.sampler):null,le=y!==null&&y.texture!==null?kv(y.texture):null;if(this.currentSamplers[V]!==K&&(jn(n)&&n.bindSampler(V,K),this.currentSamplers[V]=K),this.currentTextures[V]!==le){if(this.setActiveTexture(n.TEXTURE0+V),le!==null){var xe=wd(y).texture,ke=xe.gl_target,je=xe.width,it=xe.height;y.texture.textureIndex=V,n.bindTexture(ke,le),jn(n)||(r=y.sampler)===null||r===void 0||r.setTextureParameters(ke,je,it),this.debugGroupStatisticsTextureBind()}else{var vt=(0,kn.__assign)((0,kn.__assign)({},y),F2),Lt=vt.dimension,lr=vt.formatKind,ke=pD(Lt);n.bindTexture(ke,this.getFallbackTexture((0,kn.__assign)({gl_target:ke,formatKind:lr},vt)))}this.currentTextures[V]=le}}},e.prototype.setViewport=function(t,r,n,i){var a=this.gl;a.viewport(t,r,n,i)},e.prototype.setScissorRect=function(t,r,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(t,r,n,i)},e.prototype.applyAttachmentStateIndexed=function(t,r,n){var i=this.gl,a=this.OES_draw_buffers_indexed;r.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(t,!!(n.channelWriteMask&eu.RED),!!(n.channelWriteMask&eu.GREEN),!!(n.channelWriteMask&eu.BLUE),!!(n.channelWriteMask&eu.ALPHA)),r.channelWriteMask=n.channelWriteMask);var s=r.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=r.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Bp(r.rgbBlendState)&&Bp(r.alphaBlendState)?a.enableiOES(t,i.BLEND):Bp(n.rgbBlendState)&&Bp(n.alphaBlendState)&&a.disableiOES(t,i.BLEND)),s&&(a.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),r.rgbBlendState.blendMode=n.rgbBlendState.blendMode,r.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var n=this.gl;t.channelWriteMask!==r.channelWriteMask&&(n.colorMask(!!(r.channelWriteMask&eu.RED),!!(r.channelWriteMask&eu.GREEN),!!(r.channelWriteMask&eu.BLUE),!!(r.channelWriteMask&eu.ALPHA)),t.channelWriteMask=r.channelWriteMask);var i=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(a||i)&&(Bp(t.rgbBlendState)&&Bp(t.alphaBlendState)?n.enable(n.BLEND):Bp(r.rgbBlendState)&&Bp(r.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<t.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],t.attachmentsState[0]);else ki(t.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);if(P2(n.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),O2(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),!!n.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),!!n.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite),!gg(n.stencilFront,t.stencilFront)){var a=t.stencilFront,s=a.passOp,l=a.failOp,c=a.depthFailOp,p=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==c)&&(r.stencilOpSeparate(r.FRONT,l,c,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=c),n.stencilFront.compare!==p&&(this.setStencilReference(0),n.stencilFront.compare=p)}if(!gg(n.stencilBack,t.stencilBack)){var y=t.stencilBack,s=y.passOp,l=y.failOp,c=y.depthFailOp,p=y.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==c)&&(r.stencilOpSeparate(r.BACK,l,c,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=c),n.stencilBack.compare!==p&&(this.setStencilReference(0),n.stencilBack.compare=p)}n.cullMode!==t.cullMode&&(n.cullMode===Zl.NONE?r.enable(r.CULL_FACE):t.cullMode===Zl.NONE&&r.disable(r.CULL_FACE),t.cullMode===Zl.BACK?r.cullFace(r.BACK):t.cullMode===Zl.FRONT?r.cullFace(r.FRONT):t.cullMode===Zl.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?(r.polygonOffset(1,1),r.enable(r.POLYGON_OFFSET_FILL)):r.disable(r.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var n=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&ki(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&ki(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var r=this.currentPipeline.program;if(this.useProgram(r),r.compileState===Vl.NeedsBind){var n=this.gl,i=r.gl_program,a=r.descriptor,s=X2(a.vertex.glsl,TD);if(jn(n))for(var l=0;l<s.length;l++){var c=(0,kn.__read)(s[l],2),p=c[1],y=n.getUniformBlockIndex(i,p);y!==-1&&y!==4294967295&&n.uniformBlockBinding(i,y,l)}for(var b=X2(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<b.length;l++){var A=(0,kn.__read)(b[l],3),w=A[1],I=A[2],P=n.getUniformLocation(i,w);n.uniform1i(P,parseInt(I))}r.compileState=Vl.ReadyToUse}},e.prototype.setVertexInput=function(t,r,n){var i,a,s;if(t!==null){ki(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var c=this.gl,p=0;p<l.vertexBufferDescriptors.length;p++){var y=l.vertexBufferDescriptors[p],b=y.arrayStride,A=y.attributes;try{for(var w=(i=void 0,(0,kn.__values)(A)),I=w.next();!I.done;I=w.next()){var P=I.value,L=P.shaderLocation,V=P.offset,K=jn(c)?L:(s=l.program.attributes[L])===null||s===void 0?void 0:s.location;if(!kp(K)){var le=r[p];if(le===null)continue;var xe=P.vertexFormat;c.bindBuffer(c.ARRAY_BUFFER,Ov(le.buffer));var ke=(le.offset||0)+V;c.vertexAttribPointer(K,xe.size,xe.type,xe.normalized,b,ke)}}}catch(it){i={error:it}}finally{try{I&&!I.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}}if(ki(n!==null==(l.indexBufferFormat!==null)),n!==null){var je=n.buffer;ki(je.usage===eo.INDEX),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,Ov(je)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else ki(this.currentPipeline.inputLayout===null),ki(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,n,i){var a,s=this.gl,l=this.currentPipeline;if(r){var c=[l.drawMode,n||0,t,r];jn(s)?s.drawArraysInstanced.apply(s,(0,kn.__spreadArray)([],(0,kn.__read)(c),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,kn.__spreadArray)([],(0,kn.__read)(c),!1))}else s.drawArrays(l.drawMode,n,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,n,i,a){var s,l=this.gl,c=this.currentPipeline,p=wd(c.inputLayout),y=wd(this.currentIndexBufferByteOffset)+n*p.indexBufferCompByteSize;if(r){var b=[c.drawMode,t,p.indexBufferType,y,r];jn(l)?l.drawElementsInstanced.apply(l,(0,kn.__spreadArray)([],(0,kn.__read)(b),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,kn.__spreadArray)([],(0,kn.__read)(b),!1))}else l.drawElements(c.drawMode,t,p.indexBufferType,y);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(jn(r)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(n.gl_query_type,n.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(jn(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=jn(t),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(ki(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?t.bindFramebuffer(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),r?(t.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(t.bindFramebuffer(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,t.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),t.bindFramebuffer(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var c=this.currentDepthStencilAttachment;if(c){var p=this.currentDepthStencilResolveTo,l=!1;p&&(ki(c.width===p.width&&c.height===p.height),this.setScissorRectEnabled(!1),t.bindFramebuffer(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,c),this.bindFramebufferDepthStencilAttachment(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,p)),l=!0,r&&t.blitFramebuffer(0,0,c.width,c.height,0,0,p.width,p.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(t.bindFramebuffer(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,c),l=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),l&&t.bindFramebuffer(r?qe.READ_FRAMEBUFFER:qe.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||t.bindFramebuffer(r?qe.DRAW_FRAMEBUFFER:qe.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){kp(this.currentStencilRef)||(this.gl.stencilFuncSeparate(qe.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(qe.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,n=t.formatKind;if(r===qe.TEXTURE_2D)return n===Zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===qe.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===qe.TEXTURE_3D)return this.fallbackTexture3D;if(r===qe.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:eo.VERTEX|eo.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Td.VERTEX,attributes:[{format:Dt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ys.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Dt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Mv(Cd)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[Ck]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),CD=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,kn.__awaiter)(this,void 0,void 0,function(){var r,n,i,a,s,l,c,p,y,b,A;return(0,kn.__generator)(this,function(w){return r=this.pluginOptions,n=r.targets,i=r.xrCompatible,a=r.antialias,s=a===void 0?!1:a,l=r.preserveDrawingBuffer,c=l===void 0?!1:l,p=r.premultipliedAlpha,y=p===void 0?!0:p,b={antialias:s,preserveDrawingBuffer:c,stencil:!0,premultipliedAlpha:y,xrCompatible:i},this.handleContextEvents(t),n.includes("webgl2")&&(A=t.getContext("webgl2",b)||t.getContext("experimental-webgl2",b)),!A&&n.includes("webgl1")&&(A=t.getContext("webgl",b)||t.getContext("experimental-webgl",b)),[2,new wD(A,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,n=r.onContextLost,i=r.onContextRestored,a=r.onContextCreationError;a&&t.addEventListener("webglcontextcreationerror",a,!1),n&&t.addEventListener("webglcontextlost",n,!1),i&&t.addEventListener("webglcontextrestored",i,!1)},e}();let _s;const Y2=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&Y2.decode();let Qm=null;function xg(){return(Qm===null||Qm.byteLength===0)&&(Qm=new Uint8Array(_s.memory.buffer)),Qm}function bg(e,t){return e=e>>>0,Y2.decode(xg().subarray(e,e+t))}const Vh=new Array(128).fill(void 0);Vh.push(void 0,null,!0,!1);let Jm=Vh.length;function RD(e){Jm===Vh.length&&Vh.push(Vh.length+1);const t=Jm;return Jm=Vh[t],Vh[t]=e,t}function Eg(e){return Vh[e]}function MD(e){e<132||(Vh[e]=Jm,Jm=e)}function ID(e){const t=Eg(e);return MD(e),t}let e0=0;const Sg=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},PD=typeof Sg.encodeInto=="function"?function(e,t){return Sg.encodeInto(e,t)}:function(e,t){const r=Sg.encode(e);return t.set(r),{read:e.length,written:r.length}};function Wy(e,t,r){if(r===void 0){const l=Sg.encode(e),c=t(l.length,1)>>>0;return xg().subarray(c,c+l.length).set(l),e0=l.length,c}let n=e.length,i=t(n,1)>>>0;const a=xg();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=r(i,n,n=s+e.length*3,1)>>>0;const l=xg().subarray(i+s,i+n);s+=PD(e,l).written}return e0=s,i}let t0=null;function Ag(){return(t0===null||t0.byteLength===0)&&(t0=new Int32Array(_s.memory.buffer)),t0}function OD(e,t,r){let n,i;try{const l=_s.__wbindgen_add_to_stack_pointer(-16),c=Wy(e,_s.__wbindgen_malloc,_s.__wbindgen_realloc),p=e0,y=Wy(t,_s.__wbindgen_malloc,_s.__wbindgen_realloc),b=e0;_s.glsl_compile(l,c,p,y,b,r);var a=Ag()[l/4+0],s=Ag()[l/4+1];return n=a,i=s,bg(a,s)}finally{_s.__wbindgen_add_to_stack_pointer(16),_s.__wbindgen_free(n,i,1)}}class r0{static __wrap(t){t=t>>>0;const r=Object.create(r0.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_s.__wbg_wgslcomposer_free(t)}constructor(){const t=_s.wgslcomposer_new();return r0.__wrap(t)}wgsl_compile(t){let r,n;try{const s=_s.__wbindgen_add_to_stack_pointer(-16),l=Wy(t,_s.__wbindgen_malloc,_s.__wbindgen_realloc),c=e0;_s.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,c);var i=Ag()[s/4+0],a=Ag()[s/4+1];return r=i,n=a,bg(i,a)}finally{_s.__wbindgen_add_to_stack_pointer(16),_s.__wbindgen_free(r,n,1)}}}function kD(e,t){return r_(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=yield e.arrayBuffer();return yield WebAssembly.instantiate(r,t)}else{const r=yield WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}})}function DD(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const n=bg(t,r);return RD(n)},e.wbg.__wbindgen_object_drop_ref=function(t){ID(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Eg(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(Eg(t),Eg(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(bg(t,r))},e}function LD(e,t){return _s=e.exports,q2.__wbindgen_wasm_module=t,t0=null,Qm=null,_s}function q2(e){return r_(this,null,function*(){if(_s!==void 0)return _s;const t=DD();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=yield kD(yield e,t);return LD(r,n)})}var zs;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(zs||(zs={}));var Gy;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(Gy||(Gy={}));function BD(e){var t=0;return e&Mu.SAMPLED&&(t|=zs.TEXTURE_BINDING|zs.COPY_DST|zs.COPY_SRC),e&Mu.STORAGE&&(t|=zs.TEXTURE_BINDING|zs.STORAGE_BINDING|zs.COPY_SRC|zs.COPY_DST),e&Mu.RENDER_TARGET&&(t|=zs.RENDER_ATTACHMENT|zs.TEXTURE_BINDING|zs.COPY_SRC|zs.COPY_DST),t}function Xy(e){if(e===Dt.U8_R_NORM)return"r8unorm";if(e===Dt.U8_RG_NORM)return"rg8unorm";if(e===Dt.U8_RGBA_RT)return"bgra8unorm";if(e===Dt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Dt.U8_RGBA_NORM)return"rgba8unorm";if(e===Dt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Dt.S8_R_NORM)return"r8snorm";if(e===Dt.S8_RG_NORM)return"rg8snorm";if(e===Dt.S8_RGBA_NORM)return"rgba8snorm";if(e===Dt.U32_R)return"r32uint";if(e===Dt.F16_RGBA)return"rgba16float";if(e===Dt.F32_RGBA)return"rgba32float";if(e===Dt.D24)return"depth24plus";if(e===Dt.D24_S8)return"depth24plus-stencil8";if(e===Dt.D32F)return"depth32float";if(e===Dt.D32F_S8)return"depth32float-stencil8";if(e===Dt.BC1)return"bc1-rgba-unorm";if(e===Dt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Dt.BC2)return"bc2-rgba-unorm";if(e===Dt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Dt.BC3)return"bc3-rgba-unorm";if(e===Dt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Dt.BC4_SNORM)return"bc4-r-snorm";if(e===Dt.BC4_UNORM)return"bc4-r-unorm";if(e===Dt.BC5_SNORM)return"bc5-rg-snorm";if(e===Dt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function FD(e){if(e===ji.TEXTURE_2D)return"2d";if(e===ji.TEXTURE_CUBE_MAP)return"2d";if(e===ji.TEXTURE_2D_ARRAY)return"2d";if(e===ji.TEXTURE_3D)return"3d";throw new Error("whoops")}function ND(e){if(e===ji.TEXTURE_2D)return"2d";if(e===ji.TEXTURE_CUBE_MAP)return"cube";if(e===ji.TEXTURE_2D_ARRAY)return"2d-array";if(e===ji.TEXTURE_3D)return"3d";throw new Error("whoops")}function UD(e){var t=0;return e&eo.INDEX&&(t|=GPUBufferUsage.INDEX),e&eo.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&eo.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&eo.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&eo.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),t|=GPUBufferUsage.COPY_DST,t}function $y(e){if(e===yl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===yl.REPEAT)return"repeat";if(e===yl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function K2(e){if(e===Qo.BILINEAR)return"linear";if(e===Qo.POINT)return"nearest";throw new Error("whoops")}function zD(e){if(e===Us.LINEAR)return"linear";if(e===Us.NEAREST)return"nearest";if(e===Us.NO_MIP)return"nearest";throw new Error("whoops")}function Dv(e){var t=e;return t.gpuBuffer}function ZD(e){var t=e;return t.gpuSampler}function VD(e){var t=e;return t.querySet}function jD(e){if(e===hg.OcclusionConservative)return"occlusion";throw new Error("whoops")}function HD(e){switch(e){case ys.TRIANGLES:return"triangle-list";case ys.POINTS:return"point-list";case ys.TRIANGLE_STRIP:return"triangle-strip";case ys.LINES:return"line-list";case ys.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function WD(e){if(e===Zl.NONE)return"none";if(e===Zl.FRONT)return"front";if(e===Zl.BACK)return"back";throw new Error("whoops")}function GD(e){if(e===Xm.CCW)return"ccw";if(e===Xm.CW)return"cw";throw new Error("whoops")}function XD(e,t){return{topology:HD(e),cullMode:WD(t.cullMode),frontFace:GD(t.frontFace)}}function Q2(e){if(e===$i.ZERO)return"zero";if(e===$i.ONE)return"one";if(e===$i.SRC)return"src";if(e===$i.ONE_MINUS_SRC)return"one-minus-src";if(e===$i.DST)return"dst";if(e===$i.ONE_MINUS_DST)return"one-minus-dst";if(e===$i.SRC_ALPHA)return"src-alpha";if(e===$i.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===$i.DST_ALPHA)return"dst-alpha";if(e===$i.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===$i.CONST)return"constant";if(e===$i.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===$i.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function $D(e){if(e===Js.ADD)return"add";if(e===Js.SUBSTRACT)return"subtract";if(e===Js.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Js.MIN)return"min";if(e===Js.MAX)return"max";throw new Error("whoops")}function J2(e){return{operation:$D(e.blendMode),srcFactor:Q2(e.blendSrcFactor),dstFactor:Q2(e.blendDstFactor)}}function eS(e){return e.blendMode===Js.ADD&&e.blendSrcFactor===$i.ONE&&e.blendDstFactor===$i.ZERO}function YD(e){if(!(eS(e.rgbBlendState)&&eS(e.alphaBlendState)))return{color:J2(e.rgbBlendState),alpha:J2(e.alphaBlendState)}}function qD(e,t){return{format:Xy(t),blend:YD(e),writeMask:e.channelWriteMask}}function KD(e,t){return t.attachmentsState.map(function(r,n){return qD(r,e[n])})}function Tg(e){if(e===Fi.NEVER)return"never";if(e===Fi.LESS)return"less";if(e===Fi.EQUAL)return"equal";if(e===Fi.LEQUAL)return"less-equal";if(e===Fi.GREATER)return"greater";if(e===Fi.NOTEQUAL)return"not-equal";if(e===Fi.GEQUAL)return"greater-equal";if(e===Fi.ALWAYS)return"always";throw new Error("whoops")}function Lv(e){if(e===zo.KEEP)return"keep";if(e===zo.REPLACE)return"replace";if(e===zo.ZERO)return"zero";if(e===zo.DECREMENT_CLAMP)return"decrement-clamp";if(e===zo.DECREMENT_WRAP)return"decrement-wrap";if(e===zo.INCREMENT_CLAMP)return"increment-clamp";if(e===zo.INCREMENT_WRAP)return"increment-wrap";if(e===zo.INVERT)return"invert";throw new Error("whoops")}function QD(e,t){if(!kp(e))return{format:Xy(e),depthWriteEnabled:!!t.depthWrite,depthCompare:Tg(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0,stencilFront:{compare:Tg(t.stencilFront.compare),passOp:Lv(t.stencilFront.passOp),failOp:Lv(t.stencilFront.failOp),depthFailOp:Lv(t.stencilFront.depthFailOp)},stencilBack:{compare:Tg(t.stencilBack.compare),passOp:Lv(t.stencilBack.passOp),failOp:Lv(t.stencilBack.failOp),depthFailOp:Lv(t.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function JD(e){if(e!==null){if(e===Dt.U16_R)return"uint16";if(e===Dt.U32_R)return"uint32";throw new Error("whoops")}}function eL(e){if(e===Td.VERTEX)return"vertex";if(e===Td.INSTANCE)return"instance";throw new Error("whoops")}function tL(e){if(e===Dt.U8_R)return"uint8x2";if(e===Dt.U8_RG)return"uint8x2";if(e===Dt.U8_RGB)return"uint8x4";if(e===Dt.U8_RGBA)return"uint8x4";if(e===Dt.U8_RG_NORM)return"unorm8x2";if(e===Dt.U8_RGBA_NORM)return"unorm8x4";if(e===Dt.S8_RGB_NORM)return"snorm8x4";if(e===Dt.S8_RGBA_NORM)return"snorm8x4";if(e===Dt.U16_RG_NORM)return"unorm16x2";if(e===Dt.U16_RGBA_NORM)return"unorm16x4";if(e===Dt.S16_RG_NORM)return"snorm16x2";if(e===Dt.S16_RGBA_NORM)return"snorm16x4";if(e===Dt.S16_RG)return"uint16x2";if(e===Dt.F16_RG)return"float16x2";if(e===Dt.F16_RGBA)return"float16x4";if(e===Dt.F32_R)return"float32";if(e===Dt.F32_RG)return"float32x2";if(e===Dt.F32_RGB)return"float32x3";if(e===Dt.F32_RGBA)return"float32x4";throw"whoops"}function rL(e){var t=ah(e);switch(t){case Pr.BC1:case Pr.BC2:case Pr.BC3:case Pr.BC4_SNORM:case Pr.BC4_UNORM:case Pr.BC5_SNORM:case Pr.BC5_UNORM:return!0;default:return!1}}function nL(e){var t=ah(e);switch(t){case Pr.BC1:case Pr.BC2:case Pr.BC3:case Pr.BC4_SNORM:case Pr.BC4_UNORM:case Pr.BC5_SNORM:case Pr.BC5_UNORM:return 4;default:return 1}}function tS(e,t,r,n){switch(r===void 0&&(r=!1),e){case Dt.S8_R:case Dt.S8_R_NORM:case Dt.S8_RG_NORM:case Dt.S8_RGB_NORM:case Dt.S8_RGBA_NORM:{var i=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return n&&i.set(new Int8Array(n)),i}case Dt.U8_R:case Dt.U8_R_NORM:case Dt.U8_RG:case Dt.U8_RG_NORM:case Dt.U8_RGB:case Dt.U8_RGB_NORM:case Dt.U8_RGB_SRGB:case Dt.U8_RGBA:case Dt.U8_RGBA_NORM:case Dt.U8_RGBA_SRGB:{var a=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&a.set(new Uint8Array(n)),a}case Dt.S16_R:case Dt.S16_RG:case Dt.S16_RG_NORM:case Dt.S16_RGB_NORM:case Dt.S16_RGBA:case Dt.S16_RGBA_NORM:{var s=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&s.set(new Int16Array(n)),s}case Dt.U16_R:case Dt.U16_RGB:case Dt.U16_RGBA_5551:case Dt.U16_RGBA_NORM:case Dt.U16_RG_NORM:case Dt.U16_R_NORM:{var l=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&l.set(new Uint16Array(n)),l}case Dt.S32_R:{var c=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&c.set(new Int32Array(n)),c}case Dt.U32_R:case Dt.U32_RG:{var p=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&p.set(new Uint32Array(n)),p}case Dt.F32_R:case Dt.F32_RG:case Dt.F32_RGB:case Dt.F32_RGBA:{var y=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&y.set(new Float32Array(n)),y}}var b=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&b.set(new Uint8Array(n)),b}function iL(e){var t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:(t?-1:1)*Infinity:(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}var oh=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return t.prototype.destroy=function(){},t}(T2),aL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=pa.Bindings;var p=a.pipeline;ki(!!p);var y=a.uniformBufferBindings,b=a.storageBufferBindings,A=a.samplerBindings,w=a.storageTextureBindings;c.numUniformBuffers=(y==null?void 0:y.length)||0;var I=[[],[],[],[]],P=0;if(y&&y.length)for(var L=0;L<y.length;L++){var V=a.uniformBufferBindings[L],K=V.binding,le=V.size,xe=V.offset,ke=V.buffer,je={buffer:Dv(ke),offset:xe!=null?xe:0,size:le};I[0].push({binding:K!=null?K:P++,resource:je})}if(A&&A.length){P=0;for(var L=0;L<A.length;L++){var it=(0,kn.__assign)((0,kn.__assign)({},A[L]),F2),K=a.samplerBindings[L],vt=K.texture!==null?K.texture:c.device.getFallbackTexture(it);it.dimension=vt.dimension,it.formatKind=I2(vt.format);var Lt=vt.gpuTextureView;if(I[1].push({binding:(s=K.textureBinding)!==null&&s!==void 0?s:P++,resource:Lt}),K.samplerBinding!==-1){var lr=K.sampler!==null?K.sampler:c.device.getFallbackSampler(it),cr=ZD(lr);I[1].push({binding:(l=K.samplerBinding)!==null&&l!==void 0?l:P++,resource:cr})}}}if(b&&b.length){P=0;for(var L=0;L<b.length;L++){var Rr=a.storageBufferBindings[L],K=Rr.binding,le=Rr.size,xe=Rr.offset,ke=Rr.buffer,je={buffer:Dv(ke),offset:xe!=null?xe:0,size:le};I[2].push({binding:K!=null?K:P++,resource:je})}}if(w&&w.length){P=0;for(var L=0;L<w.length;L++){var fn=a.storageTextureBindings[L],K=fn.binding,vt=fn.texture,Lt=vt.gpuTextureView;I[3].push({binding:K!=null?K:P++,resource:Lt})}}var Pn=I.findLastIndex(function(Ri){return!!Ri.length});return c.gpuBindGroup=I.map(function(Ri,ya){return ya<=Pn&&c.device.device.createBindGroup({layout:p.getBindGroupLayout(ya),entries:Ri})}),c}return t}(oh),oL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.Buffer;var l=a.usage,c=a.viewOrSize,p=!!(l&eo.MAP_READ);s.usage=UD(l),p&&(s.usage=eo.MAP_READ|eo.COPY_DST);var y=!Sv(c);if(s.view=Sv(c)?null:c,s.size=Sv(c)?vg(c,4):vg(c.byteLength,4),Sv(c))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:p?y:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var b=c&&c.constructor||Float32Array;new b(s.gpuBuffer.getMappedRange()).set(c),s.gpuBuffer.unmap()}return s}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-r);var l=n.byteOffset+i,c=l+a,p=a+3&~3;if(p!==a){var y=new Uint8Array(n.buffer.slice(l,c));n=new Uint8Array(p),n.set(y),i=0,l=0,c=p,a=p}for(var b=1024*1024*15,A=0;c-(l+A)>b;)this.device.device.queue.writeBuffer(s,r+A,n.buffer,l+A,b),A+=b;this.device.device.queue.writeBuffer(s,r+A,n.buffer,l+A,a-A)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(oh),sL=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,n){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,n)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){ki(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,n=wd(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(t){var r=this,n=t;n.gpuBindGroup.forEach(function(i,a){i&&r.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),uL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,c=l.computeStage;if(c===null)return s;var p={layout:"auto",compute:(0,kn.__assign)({},c)};return s.gpuComputePipeline=s.device.device.createComputePipeline(p),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(oh),lL=function(e){(0,kn.__extends)(t,e);function t(r){var n,i,a,s,l=r.id,c=r.device,p=r.descriptor,y=e.call(this,{id:l,device:c})||this;y.type=pa.InputLayout;var b=[];try{for(var A=(0,kn.__values)(p.vertexBufferDescriptors),w=A.next();!w.done;w=A.next()){var I=w.value,P=I.arrayStride,L=I.stepMode,V=I.attributes;b.push({arrayStride:P,stepMode:eL(L),attributes:[]});try{for(var K=(a=void 0,(0,kn.__values)(V)),le=K.next();!le.done;le=K.next()){var xe=le.value,ke=xe.shaderLocation,je=xe.format,it=xe.offset;b[b.length-1].attributes.push({shaderLocation:ke,format:tL(je),offset:it})}}catch(vt){a={error:vt}}finally{try{le&&!le.done&&(s=K.return)&&s.call(K)}finally{if(a)throw a.error}}}}catch(vt){n={error:vt}}finally{try{w&&!w.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return y.indexFormat=JD(p.indexBufferFormat),y.buffers=b,y}return t}(oh),rS=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=pa.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,n){var i,a,s=r.glsl,l=r.wgsl,c=r.entryPoint,p=!1,y=l;if(!y)try{y=this.device.glsl_compile(s,n,p)}catch(L){throw console.error(L,s),new Error("whoops")}var b=function(L){if(!y.includes(L))return"continue";y=y.replace("var T_".concat(L,": texture_2d<f32>;"),"var T_".concat(L,": texture_depth_2d;")),y=y.replace(new RegExp("textureSample\\(T_".concat(L,"(.*)\\);$"),"gm"),function(V,K){return"vec4<f32>(textureSample(T_".concat(L).concat(K,"), 0.0, 0.0, 0.0);")})};try{for(var A=(0,kn.__values)(["u_TextureFramebufferDepth"]),w=A.next();!w.done;w=A.next()){var I=w.value;b(I)}}catch(L){i={error:L}}finally{try{w&&!w.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}var P=this.device.device.createShaderModule({code:y});return{module:P,entryPoint:c||"main"}},t}(oh),cL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=pa.QueryPool;var l=a.elemCount,c=a.type;return s.querySet=s.device.device.createQuerySet({type:jD(c),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(oh),fL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=pa.Readback,a}return t.prototype.readTexture=function(r,n,i,a,s,l,c,p){return c===void 0&&(c=0),(0,kn.__awaiter)(this,void 0,void 0,function(){var y,b,A,w,I,P,L,V;return(0,kn.__generator)(this,function(K){return y=r,b=0,A=this.getBlockInformationFromFormat(y.gpuTextureformat),w=Math.ceil(a/A.width)*A.length,I=Math.ceil(w/256)*256,P=I*s,L=this.device.createBuffer({usage:eo.STORAGE|eo.MAP_READ|eo.COPY_DST,hint:_f.STATIC,viewOrSize:P}),V=this.device.device.createCommandEncoder(),V.copyTextureToBuffer({texture:y.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(b,0)}},{buffer:L.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([V.finish()]),[2,this.readBuffer(L,0,l.byteLength===P?l:null,c,P,y.format)]})})},t.prototype.readTextureSync=function(r,n,i,a,s,l,c,p){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,n,i,a,s,l,c,p){var y=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=Dt.U8_RGB),c===void 0&&(c=!1);var b=r,A=s||b.size,w=i||b.view,I=w&&w.constructor&&w.constructor.BYTES_PER_ELEMENT||M2(l),P=b;if(!(b.usage&eo.MAP_READ&&b.usage&eo.COPY_DST)){var L=this.device.device.createCommandEncoder();P=this.device.createBuffer({usage:eo.STORAGE|eo.MAP_READ|eo.COPY_DST,hint:_f.STATIC,viewOrSize:A}),L.copyBufferToBuffer(b.gpuBuffer,n,P.gpuBuffer,0,A),this.device.device.queue.submit([L.finish()])}return new Promise(function(V,K){P.gpuBuffer.mapAsync(Gy.READ,n,A).then(function(){var le=P.gpuBuffer.getMappedRange(n,A),xe=w;if(c)xe===null?xe=tS(l,A,!0,le):xe=tS(l,xe.buffer,void 0,le);else if(xe===null)switch(I){case 1:xe=new Uint8Array(A),xe.set(new Uint8Array(le));break;case 2:xe=y.getHalfFloatAsFloatRGBAArrayBuffer(A/2,le);break;case 4:xe=new Float32Array(A/4),xe.set(new Float32Array(le));break}else switch(I){case 1:xe=new Uint8Array(xe.buffer),xe.set(new Uint8Array(le));break;case 2:xe=y.getHalfFloatAsFloatRGBAArrayBuffer(A/2,le,w);break;case 4:var ke=w&&w.constructor||Float32Array;xe=new ke(xe.buffer),xe.set(new ke(le));break}P.gpuBuffer.unmap(),V(xe)},function(le){return K(le)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,n,i){i||(i=new Float32Array(r));for(var a=new Uint16Array(n);r--;)i[r]=iL(a[r]);return i},t.prototype.getBlockInformationFromFormat=function(r){switch(r){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},t}(oh),hL=function(){function e(t){this.device=t,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(t,r){return ki(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,n,i,a,s,l;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var c=t.colorAttachment.length;this.gfxColorAttachment.length=c,this.gfxColorResolveTo.length=c;for(var p=0;p<t.colorAttachment.length;p++){var y=t.colorAttachment[p],b=t.colorResolveTo[p];if(y===null&&b!==null&&(y=b,b=null),this.gfxColorAttachment[p]=y,this.gfxColorResolveTo[p]=b,this.gfxColorAttachmentLevel[p]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[p])||0,this.gfxColorResolveToLevel[p]=((n=t.colorResolveToLevel)===null||n===void 0?void 0:n[p])||0,y!==null){this.gpuColorAttachments[p]===void 0&&(this.gpuColorAttachments[p]={});var A=this.gpuColorAttachments[p];A.view=this.getTextureView(y,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[p])||0);var w=(s=(a=t.colorClearColor)===null||a===void 0?void 0:a[p])!==null&&s!==void 0?s:"load";w==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=w),A.storeOp=((l=t.colorStore)===null||l===void 0?void 0:l[p])?"store":"discard",A.resolveTarget=void 0,b!==null&&(y.sampleCount>1?A.resolveTarget=this.getTextureView(b,this.gfxColorResolveToLevel[p]):A.storeOp="store")}else{this.gpuColorAttachments.length=p,this.gfxColorAttachment.length=p,this.gfxColorResolveTo.length=p;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var I=t.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var P=!!(wv(I.format)&In.Depth);P?(t.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var L=!!(wv(I.format)&In.Stencil);L?(t.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=kp(t.occlusionQueryPool)?void 0:VD(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t){ki(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(t),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var n=this.device.swapChainHeight;return n-t-r},e.prototype.setViewport=function(t,r,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,i),n,i,a,s)},e.prototype.setScissorRect=function(t,r,n,i){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,i),n,i)},e.prototype.setPipeline=function(t){var r=t,n=wd(r.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(t,r,n){if(t!==null){var i=t;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(Dv(n.buffer),wd(i.indexFormat),n.offset);for(var a=0;a<r.length;a++){var s=r[a];s!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,Dv(s.buffer),s.offset)}}},e.prototype.setBindings=function(t){var r=this,n=t;n.gpuBindGroup.forEach(function(i,a){i&&r.gpuRenderPassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,n,i){this.gpuRenderPassEncoder.draw(t,r,n,i)},e.prototype.drawIndexed=function(t,r,n,i,a){this.gpuRenderPassEncoder.drawIndexed(t,r,n,i,a)},e.prototype.drawIndirect=function(t,r){this.gpuRenderPassEncoder.drawIndirect(Dv(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.gpuRenderPassEncoder.drawIndexedIndirect(Dv(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var r=this.gfxColorAttachment[t],n=this.gfxColorResolveTo[t];r!==null&&n!==null&&r.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[t],r,this.gfxColorResolveToLevel[t])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(t,r,n,i){ki(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:t.gpuTexture,mipLevel:r};ki(n.width>>>i==t.width>>>r),ki(n.height>>>i==t.height>>>r),ki(!!(n.usage&zs.COPY_SRC)),ki(!!(t.usage&zs.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,s,[t.width,t.height,1])},e}(),pL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=pa.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(oh),dL=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,c=e.call(this,{id:n,device:i})||this;c.type=pa.Sampler;var p=a.lodMinClamp,y=a.mipmapFilter===Us.NO_MIP?a.lodMinClamp:a.lodMaxClamp,b=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return b>1&&ki(a.minFilter===Qo.BILINEAR&&a.magFilter===Qo.BILINEAR&&a.mipmapFilter===Us.LINEAR),c.gpuSampler=c.device.device.createSampler({addressModeU:$y(a.addressModeU),addressModeV:$y(a.addressModeV),addressModeW:$y((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:p,lodMaxClamp:y,minFilter:K2(a.minFilter),magFilter:K2(a.magFilter),mipmapFilter:zD(a.mipmapFilter),compare:a.compareFunction!==void 0?Tg(a.compareFunction):void 0,maxAnisotropy:b}),c}return t}(oh),wg=function(e){(0,kn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=r.skipCreate,l=r.sampleCount,c=e.call(this,{id:n,device:i})||this;c.type=pa.Texture,c.flipY=!1;var p=a.format,y=a.dimension,b=a.width,A=a.height,w=a.depthOrArrayLayers,I=a.mipLevelCount,P=a.usage,L=a.pixelStore;return c.flipY=!!(L==null?void 0:L.unpackFlipY),c.device.createTextureShared({format:p,dimension:y!=null?y:ji.TEXTURE_2D,width:b,height:A,depthOrArrayLayers:w!=null?w:1,mipLevelCount:I!=null?I:1,usage:P,sampleCount:l!=null?l:1},c,s),c}return t.prototype.textureFromImageBitmapOrCanvas=function(r,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},c=r.createTexture(l),p=0;p<n.length;p++)r.queue.copyExternalImageToTexture({source:n[p],flipY:this.flipY},{texture:c,origin:[0,0,p]},[a,s]);return[c,a,s]},t.prototype.isImageBitmapOrCanvases=function(r){var n=r[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var n=r[0];return n instanceof HTMLVideoElement},t.prototype.setImageData=function(r,n){var i,a=this,s=this.device.device,l,c,p;this.isImageBitmapOrCanvases(r)?(i=(0,kn.__read)(this.textureFromImageBitmapOrCanvas(s,r,this.depthOrArrayLayers),3),l=i[0],c=i[1],p=i[2]):this.isVideo(r)?l=s.importExternalTexture({source:r[0]}):r.forEach(function(y){s.queue.writeTexture({texture:a.gpuTexture},y,{},{width:a.width,height:a.height})}),this.width=c,this.height=p,this.gpuTexture=l,this.gpuTextureView=l.createView({dimension:ND(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(oh),vL=function(){function e(t,r,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=zs.RENDER_ATTACHMENT|zs.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Av.UPPER_LEFT,this.clipSpaceNearZ=Tv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(ji.TEXTURE_2D,Zo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(ji.TEXTURE_2D,Zo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(ji.TEXTURE_2D_ARRAY,Zo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(ji.TEXTURE_3D,Zo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(ji.TEXTURE_CUBE_MAP,Zo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:Qo.POINT,magFilter:Qo.POINT,mipmapFilter:Us.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:Qo.POINT,magFilter:Qo.POINT,mipmapFilter:Us.NEAREST,compareFunction:Fi.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),n=new wg({id:0,device:this,descriptor:{format:Dt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:ji.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=t,n.gpuTextureView=r,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new oL({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new wg({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new dL({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new wg({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.__assign)((0,kn.__assign)({},t),{dimension:ji.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Mu.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=pa.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,s=r.depthOrArrayLayers,l=r.sampleCount,c=r.mipLevelCount,p=r.gpuTexture,y=r.gpuTextureView,b=r.usage;ki(!!(b&zs.RENDER_ATTACHMENT));var A=new wg({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:ji.TEXTURE_2D,mipLevelCount:c,usage:b},skipCreate:!0});return A.depthOrArrayLayers=s,A.sampleCount=l,A.gpuTexture=p,A.gpuTextureView=y,A},e.prototype.createProgram=function(t){var r,n;return((r=t.vertex)===null||r===void 0?void 0:r.glsl)&&(t.vertex.glsl=Lp(this.queryVendorInfo(),"vert",t.vertex.glsl)),((n=t.fragment)===null||n===void 0?void 0:n.glsl)&&(t.fragment.glsl=Lp(this.queryVendorInfo(),"frag",t.fragment.glsl)),new rS({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new rS({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,n){var i={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},a=t.mipLevelCount,s=Xy(t.format),l=FD(t.dimension),c=BD(t.usage);if(r.gpuTextureformat=s,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=a,r.usage=c,r.sampleCount=t.sampleCount,!n){var p=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:t.sampleCount,usage:c}),y=p.createView();r.gpuTexture=p,r.gpuTextureView=y}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===Zo.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,n=t.formatKind;if(r===ji.TEXTURE_2D)return n===Zo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===ji.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===ji.TEXTURE_3D)return this.fallbackTexture3D;if(r===ji.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var n=t===ji.TEXTURE_CUBE_MAP?6:1,i=r===Zo.Float?Dt.U8_RGBA_NORM:Dt.D24;return this.createTexture({dimension:t,format:i,usage:Mu.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(t){return new aL({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new lL({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new uL({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new pL({id:this.getNextUniqueId(),device:this,descriptor:(0,kn.__assign)({},t)})},e.prototype.createQueryPool=function(t,r){return new cL({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var n;if(t.gpuRenderPipeline===null){var i=t.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var c=i.megaStateDescriptor||{},p=c.stencilBack,y=c.stencilFront,b=(0,kn.__rest)(c,["stencilBack","stencilFront"]),A=Mv(Cd);i.megaStateDescriptor=(0,kn.__assign)((0,kn.__assign)((0,kn.__assign)({},A),{stencilBack:(0,kn.__assign)((0,kn.__assign)({},A.stencilBack),p),stencilFront:(0,kn.__assign)((0,kn.__assign)({},A.stencilFront),y)}),b);var w=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(xe,ke){i.megaStateDescriptor.attachmentsState[ke]||(i.megaStateDescriptor.attachmentsState[ke]=L2(void 0,w))});var I=XD((n=i.topology)!==null&&n!==void 0?n:ys.TRIANGLES,i.megaStateDescriptor),P=KD(i.colorAttachmentFormats,i.megaStateDescriptor),L=QD(i.depthStencilAttachmentFormat,i.megaStateDescriptor),V=void 0;i.inputLayout!==null&&(V=i.inputLayout.buffers);var K=i.sampleCount,le={layout:"auto",vertex:(0,kn.__assign)((0,kn.__assign)({},s),{buffers:V}),primitive:I,depthStencil:L,multisample:{count:K},fragment:(0,kn.__assign)((0,kn.__assign)({},l),{targets:P})};t.gpuRenderPipeline=this.device.createRenderPipeline(le)}}},e.prototype.createReadback=function(){return new fL({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();return r===void 0&&(r=new hL(this)),r.commandEncoder=this.device.createCommandEncoder(),r.beginRenderPass(t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();return t===void 0&&(t=new sL),t.commandEncoder=this.device.createCommandEncoder(),t.beginComputePass(),t},e.prototype.submitPass=function(t){var r=this.device.queue,n=t,i=n.finish();r.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(t,r,n,i,a,s,l){var c=this.device.createCommandEncoder(),p=t,y=i,b={texture:y.gpuTexture,origin:[a,s,0],mipLevel:0,aspect:"all"},A={texture:p.gpuTexture,origin:[r,n,0],mipLevel:0,aspect:"all"};ki(!!(y.usage&zs.COPY_SRC)),ki(!!(p.usage&zs.COPY_DST)),c.copyTextureToTexture(b,A,[y.width,y.height,l||1]),this.device.queue.submit([c.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,n){if(rL(t)){if(!this.featureTextureCompressionBC)return!1;var i=nL(t);return r%i!=0||n%i!=0?!1:this.featureTextureCompressionBC}switch(t){case Dt.U16_RGBA_NORM:return!1;case Dt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===pa.Buffer){var n=t;n.gpuBuffer.label=r}else if(t.type===pa.Texture){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===pa.RenderTarget){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===pa.Sampler){var n=t;n.gpuSampler.label=r}else if(t.type===pa.RenderPipeline){var n=t;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),mL=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,kn.__awaiter)(this,void 0,void 0,function(){var r,n,i,a,s,l,c,p;return(0,kn.__generator)(this,function(y){switch(y.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,y.label=1;case 1:return y.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return r=y.sent(),[3,4];case 3:return i=y.sent(),console.log(i),[3,4];case 4:return r===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],s=a.filter(function(b){return r.features.has(b)}),[4,r.requestDevice({requiredFeatures:s})]);case 5:if(l=y.sent(),l&&(c=this.pluginOptions.onContextLost,l.lost.then(function(){c&&c()})),l===null)return[2,null];if(p=t.getContext("webgpu"),!p)return[2,null];y.label=6;case 6:return y.trys.push([6,8,,9]),[4,q2(this.pluginOptions.shaderCompilerPath)];case 7:return y.sent(),[3,9];case 8:return y.sent(),[3,9];case 9:return[2,new vL(r,l,t,p,OD,r0&&new r0)]}})})},e}(),gL=mi.isPlainObject,yL=mi.isTypedArray,_L=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),this.reGl=t;var n=r.vs,i=r.fs,a=r.attributes,s=r.uniforms,l=r.primitive,c=r.count,p=r.elements,y=r.depth,b=r.cull,A=r.instances,w={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Av.LOWER_LEFT,clipSpaceNearZ:Tv.NEGATIVE_ONE,supportMRT:!1},I={};this.options=r,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(le){I[le]=t.prop(le)}));var P={};Object.keys(a).forEach(function(le){P[le]=a[le].get()});var L=W_(Lp(w,"frag",i,null,!1)),V=W_(Lp(w,"vert",n,null,!1)),K={attributes:P,frag:L,uniforms:I,vert:V,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:uk[l===void 0?Y.TRIANGLES:l]};A&&(K.instances=A),c?K.count=c:p&&(K.elements=p.get()),this.initDepthDrawParams({depth:y},K),this.initCullDrawParams({cull:b},K),this.drawCommand=t(K),this.drawParams=K}return(0,Q.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var i={};Object.keys(r).forEach(function(a){i[a]=r[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(i){n[i]=r[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,Au.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),a.stencil=this.getStencilDrawParams(r),a.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var r;(r=this.drawParams)===null||r===void 0||(r=r.elements)===null||r===void 0||r.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:hk[i.func||Y.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:fg[s&&s.srcRGB||Y.SRC_ALPHA],srcAlpha:fg[s&&s.srcAlpha||Y.SRC_ALPHA],dstRGB:fg[s&&s.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:fg[s&&s.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:A2[l&&l.rgb||Y.FUNC_ADD],alpha:A2[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,c=i.func,p=c===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:c,y=i.opFront,b=y===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:y,A=i.opBack,w=A===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:A;return{enable:!!a,mask:l,func:(0,O.Z)((0,O.Z)({},p),{},{cmp:pk[p.cmp]}),opFront:{fail:Ev[b.fail],zfail:Ev[b.zfail],zpass:Ev[b.zpass]},opBack:{fail:Ev[w.fail],zfail:Ev[w.zfail],zpass:Ev[w.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var i=r.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?Y.BACK:s;n.cull={enable:!!a,face:dk[l]}}}},{key:"extractUniforms",value:function(r){var n=this,i={};return Object.keys(r).forEach(function(a){n.extractUniformsRecursively(a,r[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(r,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||yL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(r)]=n;return}gL(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){s.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(r,"[").concat(c,"]"))})})}}]),e}(),xL=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=r.data,i=r.type,a=i===void 0?Y.UNSIGNED_BYTE:i,s=r.width,l=r.height,c=r.flipY,p=c===void 0?!1:c,y=r.format,b=y===void 0?Y.RGBA:y,A=r.mipmap,w=A===void 0?!1:A,I=r.wrapS,P=I===void 0?Y.CLAMP_TO_EDGE:I,L=r.wrapT,V=L===void 0?Y.CLAMP_TO_EDGE:L,K=r.aniso,le=K===void 0?0:K,xe=r.alignment,ke=xe===void 0?1:xe,je=r.premultiplyAlpha,it=je===void 0?!1:je,vt=r.mag,Lt=vt===void 0?Y.NEAREST:vt,lr=r.min,cr=lr===void 0?Y.NEAREST:lr,Rr=r.colorSpace,fn=Rr===void 0?Y.BROWSER_DEFAULT_WEBGL:Rr,Pn=r.x,Ri=Pn===void 0?0:Pn,ya=r.y,Ha=ya===void 0?0:ya,no=r.copy,us=no===void 0?!1:no;this.width=s,this.height=l;var xl={width:s,height:l,type:Ny[a],format:lk[b],wrapS:S2[P],wrapT:S2[V],mag:E2[Lt],min:E2[cr],alignment:ke,flipY:p,colorSpace:fk[fn],premultiplyAlpha:it,aniso:le,x:Ri,y:Ha,copy:us};n&&(xl.data=n),typeof w=="number"?xl.mipmap=ck[w]:typeof w=="boolean"&&(xl.mipmap=w),this.texture=t.texture(xl)}return(0,Q.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),nS,iS,bL=(nS=(0,pr.b2)(),nS(iS=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return"WebGL1"}),(0,F.Z)(this,"createModel",function(r){return new _L(t.gl,r)}),(0,F.Z)(this,"createAttribute",function(r){return new sk(t.gl,r)}),(0,F.Z)(this,"createBuffer",function(r){return new vk(t.gl,r)}),(0,F.Z)(this,"createElements",function(r){return new mk(t.gl,r)}),(0,F.Z)(this,"createTexture2D",function(r){return new xL(t.gl,r)}),(0,F.Z)(this,"createFramebuffer",function(r){return new gk(t.gl,r)}),(0,F.Z)(this,"useFramebuffer",function(r,n){t.gl({framebuffer:r?r.get():null})(n)}),(0,F.Z)(this,"clear",function(r){var n,i=r.color,a=r.depth,s=r.stencil,l=r.framebuffer,c=l===void 0?null:l,p={color:i,depth:a,stencil:s};p.framebuffer=c===null?c:c.get(),(n=t.gl)===null||n===void 0||n.clear(p)}),(0,F.Z)(this,"viewport",function(r){var n=r.x,i=r.y,a=r.width,s=r.height;t.gl._gl.viewport(n,i,a,s),t.width=a,t.height=s,t.gl._refresh()}),(0,F.Z)(this,"readPixels",function(r){var n=r.framebuffer,i=r.x,a=r.y,s=r.width,l=r.height,c={x:i,y:a,width:s,height:l};return n&&(c.framebuffer=n.get()),t.gl.read(c)}),(0,F.Z)(this,"getViewportSize",function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}}),(0,F.Z)(this,"getContainer",function(){var r;return(r=t.canvas)===null||r===void 0?void 0:r.parentElement}),(0,F.Z)(this,"getCanvas",function(){return t.canvas}),(0,F.Z)(this,"getGLContext",function(){return t.gl._gl}),(0,F.Z)(this,"destroy",function(){var r;t.canvas=null,(r=t.gl)===null||r===void 0||(r=r._gl)===null||r===void 0||(r=r.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),t.gl.destroy(),t.gl=null})}return(0,Q.Z)(e,[{key:"init",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a,s){var l=this;return Ae().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.canvas=i,!s){p.next=5;break}this.gl=s,p.next=8;break;case 5:return p.next=7,new Promise(function(y,b){ok()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(w,I){(w||!I)&&b(w),y(I)}})});case 7:this.gl=p.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return p.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||iS),EL=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.buffer,i=r.offset,a=r.stride,s=r.normalized,l=r.size,c=r.divisor,p=r.shaderLocation;this.buffer=n,this.attribute={shaderLocation:p,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:c||0},l&&(this.attribute.size=l)}return(0,Q.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Fp,jh,Bv,n0,i0,sh,Cg,Rd,Iu,uh,lh,Rg=(Fp={},(0,F.Z)(Fp,Y.FLOAT,Float32Array),(0,F.Z)(Fp,Y.UNSIGNED_BYTE,Uint8Array),(0,F.Z)(Fp,Y.SHORT,Int16Array),(0,F.Z)(Fp,Y.UNSIGNED_SHORT,Uint16Array),(0,F.Z)(Fp,Y.INT,Int32Array),(0,F.Z)(Fp,Y.UNSIGNED_INT,Uint32Array),Fp),SL=(jh={},(0,F.Z)(jh,Y.POINTS,ys.POINTS),(0,F.Z)(jh,Y.LINES,ys.LINES),(0,F.Z)(jh,Y.LINE_LOOP,ys.LINES),(0,F.Z)(jh,Y.LINE_STRIP,ys.LINE_STRIP),(0,F.Z)(jh,Y.TRIANGLES,ys.TRIANGLES),(0,F.Z)(jh,Y.TRIANGLE_FAN,ys.TRIANGLES),(0,F.Z)(jh,Y.TRIANGLE_STRIP,ys.TRIANGLE_STRIP),jh),AL=(Bv={},(0,F.Z)(Bv,1,Dt.F32_R),(0,F.Z)(Bv,2,Dt.F32_RG),(0,F.Z)(Bv,3,Dt.F32_RGB),(0,F.Z)(Bv,4,Dt.F32_RGBA),Bv),TL=(n0={},(0,F.Z)(n0,Y.STATIC_DRAW,_f.STATIC),(0,F.Z)(n0,Y.DYNAMIC_DRAW,_f.DYNAMIC),(0,F.Z)(n0,Y.STREAM_DRAW,_f.DYNAMIC),n0),aS=(i0={},(0,F.Z)(i0,Y.REPEAT,yl.REPEAT),(0,F.Z)(i0,Y.CLAMP_TO_EDGE,yl.CLAMP_TO_EDGE),(0,F.Z)(i0,Y.MIRRORED_REPEAT,yl.MIRRORED_REPEAT),i0),wL=(sh={},(0,F.Z)(sh,Y.NEVER,Fi.NEVER),(0,F.Z)(sh,Y.ALWAYS,Fi.ALWAYS),(0,F.Z)(sh,Y.LESS,Fi.LESS),(0,F.Z)(sh,Y.LEQUAL,Fi.LEQUAL),(0,F.Z)(sh,Y.GREATER,Fi.GREATER),(0,F.Z)(sh,Y.GEQUAL,Fi.GEQUAL),(0,F.Z)(sh,Y.EQUAL,Fi.EQUAL),(0,F.Z)(sh,Y.NOTEQUAL,Fi.NOTEQUAL),sh),CL=(Cg={},(0,F.Z)(Cg,Y.FRONT,Zl.FRONT),(0,F.Z)(Cg,Y.BACK,Zl.BACK),Cg),oS=(Rd={},(0,F.Z)(Rd,Y.FUNC_ADD,Js.ADD),(0,F.Z)(Rd,Y.MIN_EXT,Js.MIN),(0,F.Z)(Rd,Y.MAX_EXT,Js.MAX),(0,F.Z)(Rd,Y.FUNC_SUBTRACT,Js.SUBSTRACT),(0,F.Z)(Rd,Y.FUNC_REVERSE_SUBTRACT,Js.REVERSE_SUBSTRACT),Rd),Mg=(Iu={},(0,F.Z)(Iu,Y.ZERO,$i.ZERO),(0,F.Z)(Iu,Y.ONE,$i.ONE),(0,F.Z)(Iu,Y.SRC_COLOR,$i.SRC),(0,F.Z)(Iu,Y.ONE_MINUS_SRC_COLOR,$i.ONE_MINUS_SRC),(0,F.Z)(Iu,Y.SRC_ALPHA,$i.SRC_ALPHA),(0,F.Z)(Iu,Y.ONE_MINUS_SRC_ALPHA,$i.ONE_MINUS_SRC_ALPHA),(0,F.Z)(Iu,Y.DST_COLOR,$i.DST),(0,F.Z)(Iu,Y.ONE_MINUS_DST_COLOR,$i.ONE_MINUS_DST),(0,F.Z)(Iu,Y.DST_ALPHA,$i.DST_ALPHA),(0,F.Z)(Iu,Y.ONE_MINUS_DST_ALPHA,$i.ONE_MINUS_DST_ALPHA),(0,F.Z)(Iu,Y.CONSTANT_COLOR,$i.CONST),(0,F.Z)(Iu,Y.ONE_MINUS_CONSTANT_COLOR,$i.ONE_MINUS_CONSTANT),(0,F.Z)(Iu,Y.CONSTANT_ALPHA,$i.CONST),(0,F.Z)(Iu,Y.ONE_MINUS_CONSTANT_ALPHA,$i.ONE_MINUS_CONSTANT),(0,F.Z)(Iu,Y.SRC_ALPHA_SATURATE,$i.SRC_ALPHA_SATURATE),Iu),Fv=(uh={},(0,F.Z)(uh,Y.REPLACE,zo.REPLACE),(0,F.Z)(uh,Y.KEEP,zo.KEEP),(0,F.Z)(uh,Y.ZERO,zo.ZERO),(0,F.Z)(uh,Y.INVERT,zo.INVERT),(0,F.Z)(uh,Y.INCR,zo.INCREMENT_CLAMP),(0,F.Z)(uh,Y.DECR,zo.DECREMENT_CLAMP),(0,F.Z)(uh,Y.INCR_WRAP,zo.INCREMENT_WRAP),(0,F.Z)(uh,Y.DECR_WRAP,zo.DECREMENT_WRAP),uh),RL=(lh={},(0,F.Z)(lh,Y.ALWAYS,Fi.ALWAYS),(0,F.Z)(lh,Y.EQUAL,Fi.EQUAL),(0,F.Z)(lh,Y.GEQUAL,Fi.GEQUAL),(0,F.Z)(lh,Y.GREATER,Fi.GREATER),(0,F.Z)(lh,Y.LEQUAL,Fi.LEQUAL),(0,F.Z)(lh,Y.LESS,Fi.LESS),(0,F.Z)(lh,Y.NEVER,Fi.NEVER),(0,F.Z)(lh,Y.NOTEQUAL,Fi.NOTEQUAL),lh),ML={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Ig(e){return Object.prototype.toString.call(e)in ML}var IL=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=r.data,i=r.usage,a=r.type,s=r.isUBO,l=r.label,c;Ig(n)?c=n:c=new Rg[this.type||Y.FLOAT](n),this.type=a,this.size=c.byteLength,this.buffer=t.createBuffer({viewOrSize:c,usage:s?eo.UNIFORM:eo.VERTEX,hint:TL[i||Y.STATIC_DRAW]}),l&&t.setResourceName(this.buffer,l)}return(0,Q.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,i=r.offset,a;Ig(n)?a=n:a=new Rg[this.type||Y.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),PL=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.data,i=r.type,a=r.count,s=a===void 0?0:a,l;Ig(n)?l=n:l=new Rg[this.type||Y.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=t.createBuffer({viewOrSize:l,usage:eo.INDEX})}return(0,Q.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(r){var n=r.data,i;Ig(n)?i=n:i=new Rg[this.type||Y.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function sS(e){return!!(e&&e.texture)}var uS=function(){function e(t,r){(0,ye.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=r.data,i=r.type,a=i===void 0?Y.UNSIGNED_BYTE:i,s=r.width,l=r.height,c=r.flipY,p=c===void 0?!1:c,y=r.format,b=y===void 0?Y.RGBA:y,A=r.wrapS,w=A===void 0?Y.CLAMP_TO_EDGE:A,I=r.wrapT,P=I===void 0?Y.CLAMP_TO_EDGE:I,L=r.aniso,V=L===void 0?0:L,K=r.alignment,le=K===void 0?1:K,xe=r.usage,ke=xe===void 0?bp.SAMPLED:xe,je=r.mipmap,it=je===void 0?!1:je,vt=r.mag,Lt=vt===void 0?Y.NEAREST:vt,lr=r.min,cr=lr===void 0?Y.NEAREST:lr;this.width=s,this.height=l;var Rr=Dt.U8_RGBA_RT;if(a===Y.UNSIGNED_BYTE&&b===Y.RGBA)Rr=Dt.U8_RGBA_RT;else if(a===Y.UNSIGNED_BYTE&&b===Y.LUMINANCE)Rr=Dt.U8_LUMINANCE;else if(a===Y.FLOAT&&b===Y.RGB)Rr=Dt.F32_RGB;else if(a===Y.FLOAT&&b===Y.RGBA)Rr=Dt.F32_RGBA;else if(a===Y.FLOAT&&b===Y.RED)Rr=Dt.F32_R;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(b));this.texture=t.createTexture({format:Rr,width:s,height:l,usage:ke===bp.SAMPLED?Mu.SAMPLED:Mu.RENDER_TARGET,pixelStore:{unpackFlipY:p,packAlignment:le},mipLevelCount:ke===bp.RENDER_TARGET||it?1:0}),n&&this.texture.setImageData([n]),this.sampler=t.createSampler({addressModeU:aS[w],addressModeV:aS[P],minFilter:cr===Y.NEAREST?Qo.POINT:Qo.BILINEAR,magFilter:Lt===Y.NEAREST?Qo.POINT:Qo.BILINEAR,mipmapFilter:Us.NO_MIP,maxAnisotropy:V})}return(0,Q.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(r){var n=r.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),lS=function(){function e(t,r){(0,ye.Z)(this,e),this.device=t,this.options=r,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,Q.Z)(e,[{key:"createColorRenderTarget",value:function(){var r=this.options,n=r.width,i=r.height,a=r.color;a&&(sS(a)?(this.colorTexture=a.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=a.width,this.height=a.height):n&&i&&(this.colorTexture=this.device.createTexture({format:Dt.U8_RGBA_RT,usage:Mu.RENDER_TARGET,width:n,height:i}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=i))}},{key:"createDepthRenderTarget",value:function(){var r=this.options,n=r.width,i=r.height,a=r.depth;a&&(sS(a)?(this.depthTexture=a.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=a.width,this.height=a.height):n&&i&&(this.depthTexture=this.device.createTexture({format:Dt.D24_S8,usage:Mu.RENDER_TARGET,width:n,height:i}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=i))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var r,n;(r=this.colorRenderTarget)===null||r===void 0||r.destroy(),(n=this.depthRenderTarget)===null||n===void 0||n.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;(this.width!==n||this.height!==i)&&(this.destroy(),this.options.width=n,this.options.height=i,this.createColorRenderTarget(),this.createDepthRenderTarget())}}]),e}(),OL=mi.isPlainObject,kL=mi.isTypedArray,DL=function(){function e(t,r,n){var i=this;(0,ye.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),(0,F.Z)(this,"vertexBuffers",[]),this.device=t,this.options=r,this.service=n;var a=r.vs,s=r.fs,l=r.attributes,c=r.uniforms,p=r.count,y=r.elements;this.options=r;var b=t.createProgram({vertex:{glsl:a},fragment:{glsl:s}});this.program=b,c&&(this.uniforms=this.extractUniforms(c));var A=[],w=0;Object.keys(l).forEach(function(P){var L=l[P],V=L.get();i.vertexBuffers.push(V.get());var K=L.attribute,le=K.offset,xe=le===void 0?0:le,ke=K.stride,je=ke===void 0?0:ke,it=K.size,vt=it===void 0?1:it,Lt=K.divisor,lr=Lt===void 0?0:Lt,cr=K.shaderLocation,Rr=cr===void 0?0:cr;A.push({arrayStride:je||vt*4,stepMode:Td.VERTEX,attributes:[{format:AL[vt],shaderLocation:Rr,offset:xe,divisor:lr}]}),w=V.size/vt}),p||(this.options.count=w),y&&(this.indexBuffer=y.get());var I=t.createInputLayout({vertexBufferDescriptors:A,indexBufferFormat:y?Dt.U32_R:null,program:b});this.inputLayout=I,this.pipeline=this.createPipeline(r)}return(0,Q.Z)(e,[{key:"createPipeline",value:function(r,n){var i=r.primitive,a=i===void 0?Y.TRIANGLES:i,s=r.depth,l=r.cull,c=r.blend,p=r.stencil,y=this.initDepthDrawParams({depth:s}),b=!!(y&&y.enable),A=this.initCullDrawParams({cull:l}),w=!!(A&&A.enable),I=this.getBlendDrawParams({blend:c}),P=!!(I&&I.enable),L=this.getStencilDrawParams({stencil:p}),V=!!(L&&L.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:SL[a],colorAttachmentFormats:[Dt.U8_RGBA_RT],depthStencilAttachmentFormat:Dt.D24_S8,megaStateDescriptor:{attachmentsState:[n?{channelWriteMask:eu.ALL,rgbBlendState:{blendMode:Js.ADD,blendSrcFactor:$i.ONE,blendDstFactor:$i.ZERO},alphaBlendState:{blendMode:Js.ADD,blendSrcFactor:$i.ONE,blendDstFactor:$i.ZERO}}:{channelWriteMask:V&&L.opFront.zpass===zo.REPLACE?eu.NONE:eu.ALL,rgbBlendState:{blendMode:P&&I.equation.rgb||Js.ADD,blendSrcFactor:P&&I.func.srcRGB||$i.SRC_ALPHA,blendDstFactor:P&&I.func.dstRGB||$i.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:P&&I.equation.alpha||Js.ADD,blendSrcFactor:P&&I.func.srcAlpha||$i.ONE,blendDstFactor:P&&I.func.dstAlpha||$i.ONE}}],blendConstant:P?Uy:void 0,depthWrite:b,depthCompare:b&&y.func||Fi.LESS,cullMode:w&&A.face||Zl.NONE,stencilWrite:V,stencilFront:{compare:V?L.func.cmp:Fi.ALWAYS,passOp:L.opFront.zpass},stencilBack:{compare:V?L.func.cmp:Fi.ALWAYS,passOp:L.opBack.zpass}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(r){this.uniforms=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){var i=this,a=(0,O.Z)((0,O.Z)({},this.options),r),s=a.count,l=s===void 0?0:s,c=a.instances,p=a.elements,y=a.uniforms,b=y===void 0?{}:y,A=a.uniformBuffers,w=a.textures;this.uniforms=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(b));var I=this.service,P=I.renderPass,L=I.currentFramebuffer,V=I.width,K=I.height;if(this.pipeline=this.createPipeline(a,n),P.setViewport(0,0,(L==null?void 0:L.width)||V,(L==null?void 0:L.height)||K),P.setPipeline(this.pipeline),P.setStencilReference(1),P.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(xe){return{buffer:xe}}),p?{buffer:this.indexBuffer,offset:0}:null),A&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:A.map(function(xe,ke){var je=xe;return{binding:ke,buffer:je.get(),size:je.size}}),samplerBindings:w==null?void 0:w.map(function(xe){return{texture:xe.texture,sampler:xe.sampler}})})),this.bindings&&(P.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(xe){var ke=i.uniforms[xe];ke instanceof uS?i.uniforms[xe]=ke.get():ke instanceof lS&&(i.uniforms[xe]=ke.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),p){var le=p.count;le===0?P.draw(l,c):P.drawIndexed(le,c)}else P.draw(l,c)}},{key:"destroy",value:function(){var r,n,i;this.program.destroy(),(r=this.vertexBuffers)===null||r===void 0||r.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r){var n=r.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:wL[n.func||Y.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:Mg[s&&s.srcRGB||Y.SRC_ALPHA],srcAlpha:Mg[s&&s.srcAlpha||Y.SRC_ALPHA],dstRGB:Mg[s&&s.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:Mg[s&&s.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:oS[l&&l.rgb||Y.FUNC_ADD],alpha:oS[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,c=i.func,p=c===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:c,y=i.opFront,b=y===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:y,A=i.opBack,w=A===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:A;return{enable:!!a,mask:l,func:(0,O.Z)((0,O.Z)({},p),{},{cmp:RL[p.cmp]}),opFront:{fail:Fv[b.fail],zfail:Fv[b.zfail],zpass:Fv[b.zpass]},opBack:{fail:Fv[w.fail],zfail:Fv[w.zfail],zpass:Fv[w.zpass]}}}},{key:"initCullDrawParams",value:function(r){var n=r.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?Y.BACK:a;return{enable:!!i,face:CL[s]}}}},{key:"extractUniforms",value:function(r){var n=this,i={};return Object.keys(r).forEach(function(a){n.extractUniformsRecursively(a,r[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(r,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||kL(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(r)]=n;return}OL(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){s.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(r,"[").concat(c,"]"))})})}}]),e}();function LL(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var cS,fS,BL=(cS=(0,pr.b2)(),cS(fS=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return t.device.queryVendorInfo().platformString}),(0,F.Z)(this,"createModel",function(r){return new DL(t.device,r,t)}),(0,F.Z)(this,"createAttribute",function(r){return new EL(t.device,r)}),(0,F.Z)(this,"createBuffer",function(r){return new IL(t.device,r)}),(0,F.Z)(this,"createElements",function(r){return new PL(t.device,r)}),(0,F.Z)(this,"createTexture2D",function(r){return new uS(t.device,r)}),(0,F.Z)(this,"createFramebuffer",function(r){return new lS(t.device,r)}),(0,F.Z)(this,"useFramebuffer",function(r,n){t.currentFramebuffer=r,t.beginFrame(),n(),t.endFrame(),t.currentFramebuffer=null}),(0,F.Z)(this,"clear",function(r){var n=r.color,i=r.depth,a=r.stencil,s=r.framebuffer,l=s===void 0?null:s;l&&(l.clearOptions={color:n,depth:i,stencil:a})}),(0,F.Z)(this,"viewport",function(r){var n=r.width,i=r.height;t.width=n,t.height=i}),(0,F.Z)(this,"readPixels",function(r){var n=r.framebuffer,i=r.x,a=r.y,s=r.width,l=r.height,c=t.device.createReadback(),p=n.colorTexture;return c.readTextureSync(p,i,a,s,l,new Uint8Array(s*l*4))}),(0,F.Z)(this,"getViewportSize",function(){return{width:t.width,height:t.height}}),(0,F.Z)(this,"getContainer",function(){var r;return(r=t.canvas)===null||r===void 0?void 0:r.parentElement}),(0,F.Z)(this,"getCanvas",function(){return t.canvas}),(0,F.Z)(this,"getGLContext",function(){return t.device.gl}),(0,F.Z)(this,"destroy",function(){var r;t.canvas=null,(r=t.uniformBuffers)===null||r===void 0||r.forEach(function(n){n.destroy()}),t.device.destroy()})}return(0,Q.Z)(e,[{key:"init",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a){var s,l,c,p,y;return Ae().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,c=s?new mL({shaderCompilerPath:l}):new CD({targets:["webgl2","webgl1"],onContextLost:function(I){console.warn("context lost",I)},onContextCreationError:function(I){console.warn("context creation error",I)},onContextRestored:function(I){console.warn("context restored",I)}}),A.next=5,c.createSwapChain(i);case 5:p=A.sent,p.configureSwapChain(i.width,i.height),this.device=p.getDevice(),this.swapChain=p,this.currentFramebuffer=null,y=this.device.gl,this.extensionObject={OES_texture_float:!LL(y)&&this.device.OES_texture_float},this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Dt.U8_RGBA_RT,width:i.width,height:i.height,usage:Mu.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Dt.D24_S8,width:i.width,height:i.height,usage:Mu.RENDER_TARGET}));case 14:case"end":return A.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"beginFrame",value:function(){var r=this.currentFramebuffer,n=this.swapChain,i=this.mainColorRT,a=this.mainDepthRT,s=n.getOnscreenTexture(),l=r?r.colorRenderTarget:i,c=r?null:s,p=r?r.depthRenderTarget:a,y=(r==null?void 0:r.clearOptions)||{},b=y.color,A=b===void 0?[0,0,0,0]:b,w=y.depth,I=w===void 0?1:w,P=y.stencil,L=P===void 0?0:P,V=l?$m(A[0]*255,A[1]*255,A[2]*255,A[3]):Uy,K=p?I:void 0,le=p?L:void 0,xe=this.device.createRenderPass({colorAttachment:[l],colorResolveTo:[c],colorClearColor:[V],depthStencilAttachment:p,depthClearValue:K,stencilClearValue:le});this.renderPass=xe}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var r=this.device.gl;return r.getParameter(r.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||fS);function FL(e){var t=NL();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function NL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yy=["selectstart","selecting","selectend"],UL=function(e){(0,Je.Z)(r,e);var t=FL(r);function r(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ye.Z)(this,r),i=t.call(this),(0,F.Z)((0,Be.Z)(i),"isEnable",!1),(0,F.Z)((0,Be.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Be.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Be.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,Q.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=On("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,c=l.x,p=l.y,y=Math.min(a,c),b=Math.min(s,p),A=Math.abs(a-c),w=Math.abs(s-p);this.box.style.top="".concat(b,"px"),this.box.style.left="".concat(y,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(w,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,c=l.lng,p=l.lat;return Yc([[a,s],[c,p]])}}]),r}(ba.EventEmitter),zL=function(){function e(t){(0,ye.Z)(this,e);var r=t.id,n=t.map,i=t.canvas,a=t.renderer,s=a===void 0?"regl":a,l=QT();this.container=l,n.setContainer(l,r,i),l.bind(xt.IRendererService).to(s==="regl"?bL:BL).inSingletonScope(),this.sceneService=l.get(xt.ISceneService),this.mapService=l.get(xt.IMapService),this.iconService=l.get(xt.IIconService),this.fontService=l.get(xt.IFontService),this.controlService=l.get(xt.IControlService),this.layerService=l.get(xt.ILayerService),this.debugService=l.get(xt.IDebugService),this.debugService.setEnable(t.debug),this.markerService=l.get(xt.IMarkerService),this.interactionService=l.get(xt.IInteractionService),this.popupService=l.get(xt.IPopupService),this.boxSelect=new UL(this,{}),this.initComponent(r),this.sceneService.init(t),this.initControl()}return(0,Q.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var t=(0,St.Z)(Ae().mark(function n(i){return Ae().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var i=new r(this);i.init()}else this.on("loaded",function(){var a=new r(n);a.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,i=lv(this.container);if(r.setContainer(i,this.container),this.sceneService.addLayer(r),r.inited){var a=this.initMask(r);this.addMask(a,r.id)}else r.on("inited",function(){var s=n.initMask(r);n.addMask(s,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,c=n.maskOpacity,p=c===void 0?0:c;if(!(!i||!a)){var y=new vb().source(a).shape("fill").style({color:l,opacity:p});return y}}},{key:"addMask",value:function(r,n){if(!!r){var i=this.getLayer(n);if(i){var a=lv(this.container);r.setContainer(a,this.container),i.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var t=(0,St.Z)(Ae().mark(function n(){return Ae().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(i){var a=(0,re.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(r,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var t=(0,St.Z)(Ae().mark(function n(i,a){return Ae().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(Yy.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.on(r,n)}else B0.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(Yy.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.once(r,n)}else B0.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){B0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(Yy.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.off(r,n)}else B0.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(r,n||(0,O.Z)((0,O.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(xt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return Nr.REGISTERED_PROTOCOLS[r]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Lu(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,i=r.logoPosition;n&&this.addControl(new px({position:i}))}}],[{key:"addProtocol",value:function(r,n){Nr.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete Nr.REGISTERED_PROTOCOLS[r]}}]),e}(),Q6="2.20.11";function a0(e){return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a0(e)}function hS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function J6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hS(Object(r),!0).forEach(function(n){ZL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZL(e,t,r){return t=VL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VL(e){var t=jL(e,"string");return a0(t)==="symbol"?t:String(t)}function jL(e,t){if(a0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(a0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function e8(e,t){return XL(e)||GL(e,t)||WL(e,t)||HL()}function HL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WL(e,t){if(!!e){if(typeof e=="string")return pS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pS(e,t)}}function pS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function GL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function XL(e){if(Array.isArray(e))return e}var t8=null,r8=null,dS,qy,vS,$L=(dS=Qg(xt.IGlobalConfigService),qy=function(){function e(t){(0,ye.Z)(this,e),Ir(this,"configService",vS,this),this.config=t}return(0,Q.Z)(e,[{key:"setContainer",value:function(r,n,i){r.bind(xt.MapConfig).toConstantValue((0,O.Z)((0,O.Z)({},this.config),{},{id:n,canvas:i})),r.bind(xt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),vS=mn(qy.prototype,"configService",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy),YL=Z(6158),o0=Z.n(YL),qL=function(){function e(t){(0,ye.Z)(this,e),(0,F.Z)(this,"size",1e4),this.size=t||1e4}return(0,Q.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),i=this.mercatorYfromLat(r[1]);return[n,i]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),i=this.latFromMercatorY(r[1]);return[n,i]}}]),e}(),KL={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},mS,gS,yS,_S,xS,bS,Nv,ES,SS,AS,TS,wS={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},QL=12,JL=(mS=(0,pr.b2)(),gS=(0,pr.f3)(xt.MapConfig),yS=(0,pr.f3)(xt.IGlobalConfigService),_S=(0,pr.f3)(xt.ICoordinateSystemService),xS=(0,pr.f3)(xt.IEventEmitter),mS(bS=(Nv=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,F.Z)(this,"version","DEFAUlTMAP"),(0,F.Z)(this,"simpleMapCoord",new qL),(0,F.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ir(this,"config",ES,this),Ir(this,"configService",SS,this),Ir(this,"coordinateSystemService",AS,this),Ir(this,"eventEmitter",TS,this),(0,F.Z)(this,"handleCameraChanged",function(r){var n=t.map.getCenter(),i=n.lat,a=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[a,i],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)})}return(0,Q.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=On("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){cw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(wS[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(wS[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return KL}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[r].concat(a))}},{key:"once",value:function(r){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[r].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),i=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>QL&&n?this.coordinateSystemService.setCoordinateSystem(ml.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(ml.LNGLAT)}}]),e}(),ES=mn(Nv.prototype,"config",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SS=mn(Nv.prototype,"configService",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=mn(Nv.prototype,"coordinateSystemService",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=mn(Nv.prototype,"eventEmitter",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||bS);function s0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pg(e,t){var r=fu([],t,e);return yo(r,r,1/r[3]),r}function n8(e,t){var r=e%t;return r<0?t+r:r}function i8(e,t,r){return r*t+(1-r)*e}function Md(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var bf=Math.PI,CS=bf/4,Hh=bf/180,RS=180/bf,Ky=512,Qy=4003e4,eB=1.5;function MS(e){return Math.pow(2,e)}function tB(e){return Math.log2(e)}function Og(e,t){var r=(0,re.Z)(e,2),n=r[0],i=r[1];Md(Number.isFinite(n)&&Number.isFinite(t)),Md(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),t*=Ky;var a=n*Hh,s=i*Hh,l=t*(a+bf)/(2*bf),c=t*(bf-Math.log(Math.tan(CS+s*.5)))/(2*bf);return[l,c]}function Jy(e,t){var r=(0,re.Z)(e,2),n=r[0],i=r[1];t*=Ky;var a=n/t*(2*bf)-bf,s=2*(Math.atan(Math.exp(bf-i/t*(2*bf)))-CS);return[a*RS,s*RS]}function a8(e){var t=e.latitude;assert(Number.isFinite(t));var r=Math.cos(t*Hh);return tB(Qy*r)-9}function IS(e){var t=e.latitude,r=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:MS(n),Md(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i));var l={},c=Ky*i,p=Math.cos(t*Hh),y=c/360,b=y/p,A=c/Qy/p;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[y,-b,A],l.degreesPerPixel=[1/y,-1/b,1/A],s){var w=Hh*Math.tan(t*Hh)/p,I=y*w/2,P=c/Qy*w,L=P/b*A;l.pixelsPerDegree2=[0,-I,P],l.pixelsPerMeter2=[L,0,L]}return l}function o8(e,t){var r=_slicedToArray(e,3),n=r[0],i=r[1],a=r[2],s=_slicedToArray(t,3),l=s[0],c=s[1],p=s[2],y=1,b=IS({longitude:n,latitude:i,scale:y,highPrecision:!0}),A=b.pixelsPerMeter,w=b.pixelsPerMeter2,I=Og(e,y);I[0]+=l*(A[0]+w[0]*c),I[1]+=c*(A[1]+w[1]*c);var P=Jy(I,y),L=(a||0)+(p||0);return Number.isFinite(a)||Number.isFinite(p)?[P[0],P[1],L]:P}function rB(e){var t=e.height,r=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,c=l===void 0?!1:l,p=s0();return cf(p,p,[0,0,-i]),Ls(p,p,[1,1,1/t]),Wu(p,p,-r*Hh),Hd(p,p,n*Hh),c&&Ls(p,p,[1,-1,1]),s&&cf(p,p,wa.negate([],s)),p}function nB(e){var t=e.width,r=e.height,n=e.altitude,i=n===void 0?eB:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,c=l===void 0?1:l,p=e.farZMultiplier,y=p===void 0?1:p,b=s*Hh,A=Math.atan(.5/i),w=Math.sin(A)*i/Math.sin(Math.PI/2-b-A),I=Math.cos(Math.PI/2-b)*w+i;return{fov:2*Math.atan(r/2/i),aspect:t/r,focalDistance:i,near:c,far:I*y}}function iB(e){var t=e.width,r=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=nB({width:t,height:r,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),c=l.fov,p=l.aspect,y=l.near,b=l.far,A=qf([],c,p,y,b);return A}function aB(e,t){var r=(0,re.Z)(e,3),n=r[0],i=r[1],a=r[2],s=a===void 0?0:a;return Md(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),Pg(t,[n,i,s,1])}function PS(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,re.Z)(e,3),i=n[0],a=n[1],s=n[2];if(Md(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=Pg(t,[i,a,s,1]);return l}var c=Pg(t,[i,a,0,1]),p=Pg(t,[i,a,1,1]),y=c[2],b=p[2],A=y===b?0:((r||0)-y)/(b-y);return Mr.lerp([],c,p,A)}var OS=s0(),oB=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,n=t.height,i=t.viewMatrix,a=i===void 0?OS:i,s=t.projectionMatrix,l=s===void 0?OS:s;(0,ye.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var c=s0();Ko(c,c,this.projectionMatrix),Ko(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var p=s0();Ls(p,p,[this.width/2,-this.height/2,1]),cf(p,p,[1,-1,0]),Ko(p,p,this.viewProjectionMatrix);var y=ai(s0(),p);if(!y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Q.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&$d(r.projectionMatrix,this.projectionMatrix)&&$d(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(r),l=aB(s,this.pixelProjectionMatrix),c=(0,re.Z)(l,2),p=c[0],y=c[1],b=a?y:this.height-y;return r.length===2?[p,b]:[p,b,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,re.Z)(r,3),c=l[0],p=l[1],y=l[2],b=a?p:this.height-p,A=s&&s*this.pixelsPerMeter,w=PS([c,b,y],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(w),P=(0,re.Z)(I,3),L=P[0],V=P[1],K=P[2];return Number.isFinite(y)?[L,V,K]:Number.isFinite(s)?[L,V,s]:[L,V]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),i=(0,re.Z)(n,2),a=i[0],s=i[1],l=(r[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),i=(0,re.Z)(n,2),a=i[0],s=i[1],l=(r[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function sB(e){var t=e.width,r=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,c=e.padding,p=c===void 0?0:c,y=e.offset,b=y===void 0?[0,0]:y,A=(0,re.Z)(n,2),w=(0,re.Z)(A[0],2),I=w[0],P=w[1],L=(0,re.Z)(A[1],2),V=L[0],K=L[1];if(Number.isFinite(p)){var le=p;p={top:le,bottom:le,left:le,right:le}}else Md(Number.isFinite(p.top)&&Number.isFinite(p.bottom)&&Number.isFinite(p.left)&&Number.isFinite(p.right));var xe=new kS({width:t,height:r,longitude:0,latitude:0,zoom:0}),ke=xe.project([I,K]),je=xe.project([V,P]),it=[Math.max(Math.abs(je[0]-ke[0]),a),Math.max(Math.abs(je[1]-ke[1]),a)],vt=[t-p.left-p.right-Math.abs(b[0])*2,r-p.top-p.bottom-Math.abs(b[1])*2];Md(vt[0]>0&&vt[1]>0);var Lt=vt[0]/it[0],lr=vt[1]/it[1],cr=(p.right-p.left)/2/Lt,Rr=(p.bottom-p.top)/2/lr,fn=[(je[0]+ke[0])/2+cr,(je[1]+ke[1])/2+Rr],Pn=xe.unproject(fn),Ri=xe.zoom+Math.log2(Math.abs(Math.min(Lt,lr)));return{longitude:Pn[0],latitude:Pn[1],zoom:Math.min(Ri,l)}}var kS=function(e){(0,Je.Z)(t,e);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,c=n.longitude,p=c===void 0?0:c,y=n.zoom,b=y===void 0?0:y,A=n.pitch,w=A===void 0?0:A,I=n.bearing,P=I===void 0?0:I,L=n.altitude,V=L===void 0?1.5:L,K=n.nearZMultiplier,le=n.farZMultiplier;(0,ye.Z)(this,t),i=i||1,a=a||1;var xe=MS(b);V=Math.max(.75,V);var ke=Og([p,l],xe);ke[2]=0;var je=iB({width:i,height:a,pitch:w,bearing:P,altitude:V,nearZMultiplier:K||1/a,farZMultiplier:le||1.01}),it=rB({height:a,center:ke,pitch:w,bearing:P,altitude:V,flipY:!0});return r=(0,_t.Z)(this,(0,pe.Z)(t).call(this,{width:i,height:a,viewMatrix:it,projectionMatrix:je})),r.latitude=l,r.longitude=p,r.zoom=b,r.pitch=w,r.bearing=P,r.altitude=V,r.scale=xe,r.center=ke,r.pixelsPerMeter=IS((0,Be.Z)((0,Be.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Be.Z)((0,Be.Z)(r))),r}return(0,Q.Z)(t,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Og(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Jy(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=PS(a,this.pixelUnprojectionMatrix),l=Og(i,this.scale),c=Mr.add([],l,Mr.negate([],s)),p=Mr.add([],this.center,c);return Jy(p,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=sB(Object.assign({width:a,height:s,bounds:n},i)),c=l.longitude,p=l.latitude,y=l.zoom;return new t({width:a,height:s,longitude:c,latitude:p,zoom:y})}}]),t}(oB),uB=function(){function e(){(0,ye.Z)(this,e)}return(0,Q.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,i=r.zoom,a=r.pitch,s=r.bearing,l=r.viewportHeight,c=r.viewportWidth;this.viewport=new kS({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),lB=["id","attributionControl","style","token","rotation","mapInstance"],DS,LS;function cB(e){var t=fB();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function fB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function hB(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}hB(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=o0();var pB=0,BS="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",dB=(DS=(0,pr.b2)(),DS(LS=function(e){(0,Je.Z)(r,e);var t=cB(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,F.Z)((0,Be.Z)(n),"version","MAPBOX"),n}return(0,Q.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,c=s.y;return[l-a.x,c-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,c=l===void 0?0:l,p=s.y,y=p===void 0?0:p,b=s.z,A=b===void 0?0:b;return{x:c,y,z:A}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},p=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),y=p.meterInMercatorCoordinateUnits(),b=wr();return cf(b,b,wa.fromValues(p.x-c.x,p.y-c.y,p.z||0-c.z)),Ls(b,b,wa.fromValues(y*l[0],-y*l[1],y*l[2])),Wu(b,b,s[0]),Rh(b,b,s[1]),Hd(b,b,s[2]),b}},{key:"init",value:function(){var n=(0,St.Z)(Ae().mark(function a(){var s=this,l,c,p,y,b,A,w,I,P,L,V,K,le;return Ae().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:l=this.config,c=l.id,p=c===void 0?"map":c,y=l.attributionControl,b=y===void 0?!1:y,A=l.style,w=A===void 0?"light":A,I=l.token,P=I===void 0?BS:I,L=l.rotation,V=L===void 0?0:L,K=l.mapInstance,le=(0,gs.Z)(l,lB),this.viewport=new uB,!K&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),P===BS&&w!=="blank"&&!window.mapboxgl.accessToken&&!K&&console.warn(this.configService.getSceneWarninfo("MapToken")),!K&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=P),K?(this.map=K,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(p),this.map=new window.mapboxgl.Map((0,O.Z)({container:this.$mapContainer,style:this.getMapStyleValue(w),attributionControl:b,bearing:V},le))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return ke.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(o0()).LngLat(i[0],i[1]),l=new(o0()).LngLat(a[0],a[1]),c=s.distanceTo(l),p=o0().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),y=o0().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),b=p.x,A=p.y,w=y.x,I=y.y,P=Math.sqrt(Math.pow(b-w,2)+Math.pow(A-I,2))*4194304*2;return P/c}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+pB++,a.appendChild(s),s}}]),r}(JL))||LS);function vB(e){var t=mB();return function(){var n=(0,pe.Z)(e),i;if(t){var a=(0,pe.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_t.Z)(this,i)}}function mB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gB(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}gB(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var yB=function(e){(0,Je.Z)(r,e);var t=vB(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Q.Z)(r,[{key:"getServiceConstructor",value:function(){return dB}}]),r}($L);function u0(e){return u0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u0(e)}function FS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function NS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FS(Object(r),!0).forEach(function(n){_B(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _B(e,t,r){return t=xB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xB(e){var t=bB(e,"string");return u0(t)==="symbol"?t:String(t)}function bB(e,t){if(u0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(u0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EB(e,t){return wB(e)||TB(e,t)||AB(e,t)||SB()}function SB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AB(e,t){if(!!e){if(typeof e=="string")return US(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return US(e,t)}}function US(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function TB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function wB(e){if(Array.isArray(e))return e}var CB=oe.memo(function(e){var t=e.style,r=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,oe.createRef)(),l=(0,oe.useState)(),c=EB(l,2),p=c[0],y=c[1];return(0,oe.useEffect)(function(){var b=new zL(NS(NS({id:s.current},i),{},{map:new yB(n)}));return b.on("loaded",function(){y(b),a&&a(b)}),function(){b.destroy()}},[]),(0,oe.useEffect)(function(){p&&n.style&&p.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,oe.useEffect)(function(){p&&n.zoom&&p.setZoom(n.zoom)},[n.zoom]),(0,oe.useEffect)(function(){p&&n.center&&p.setCenter(n.center)},[JSON.stringify(n.center)]),(0,oe.useEffect)(function(){p&&n.pitch!==void 0&&p.setPitch(n.pitch||0)},[n.pitch]),(0,oe.useEffect)(function(){p&&n.rotation&&p.setRotation(n.rotation)},[n.rotation]),oe.createElement(_.Provider,{value:p},(0,oe.createElement)("div",{ref:s,style:t,className:r},p&&e.children))}),RB=CB;function l0(e){return l0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l0(e)}function zS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function s8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zS(Object(r),!0).forEach(function(n){MB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MB(e,t,r){return t=IB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IB(e){var t=PB(e,"string");return l0(t)==="symbol"?t:String(t)}function PB(e,t){if(l0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(l0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function u8(e,t){return LB(e)||DB(e,t)||kB(e,t)||OB()}function OB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kB(e,t){if(!!e){if(typeof e=="string")return ZS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ZS(e,t)}}function ZS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function LB(e){if(Array.isArray(e))return e}var l8=null,c8=null;function c0(e){return c0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c0(e)}function VS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function f8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VS(Object(r),!0).forEach(function(n){BB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BB(e,t,r){return t=FB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FB(e){var t=NB(e,"string");return c0(t)==="symbol"?t:String(t)}function NB(e,t){if(c0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h8(e,t){return VB(e)||ZB(e,t)||zB(e,t)||UB()}function UB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zB(e,t){if(!!e){if(typeof e=="string")return jS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jS(e,t)}}function jS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function VB(e){if(Array.isArray(e))return e}var p8=null,d8=null;function f0(e){return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f0(e)}function HS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function v8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HS(Object(r),!0).forEach(function(n){jB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jB(e,t,r){return t=HB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HB(e){var t=WB(e,"string");return f0(t)==="symbol"?t:String(t)}function WB(e,t){if(f0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(f0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function m8(e,t){return YB(e)||$B(e,t)||XB(e,t)||GB()}function GB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XB(e,t){if(!!e){if(typeof e=="string")return WS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WS(e,t)}}function WS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $B(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function YB(e){if(Array.isArray(e))return e}var g8=null,y8=null;function _8(e,t){return JB(e)||QB(e,t)||KB(e,t)||qB()}function qB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KB(e,t){if(!!e){if(typeof e=="string")return GS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GS(e,t)}}function GS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function QB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function JB(e){if(Array.isArray(e))return e}var x8=null;function h0(e){return h0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h0(e)}var b8=null;function XS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function E8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XS(Object(r),!0).forEach(function(n){eF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eF(e,t,r){return t=tF(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tF(e){var t=rF(e,"string");return h0(t)==="symbol"?t:String(t)}function rF(e,t){if(h0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(h0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function S8(e,t){if(e==null)return{};var r=nF(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function nF(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var A8={exportImage:S3,fullscreen:R3,geoLocate:P3,layer:hx,layerSwitch:hx,logo:px,mapTheme:z3,mouseLocation:j3,zoom:Q5,scale:G3},T8=null,$S=Z(73935);function YS(e,t){return sF(e)||oF(e,t)||aF(e,t)||iF()}function iF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aF(e,t){if(!!e){if(typeof e=="string")return qS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qS(e,t)}}function qS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function oF(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function sF(e){if(Array.isArray(e))return e}var KS=oe.useEffect,QS=oe.useState,uF=/\B([A-Z])/g,lF=function(t){return t.replace(uF,"-$1").toLowerCase()};function w8(e){var t=e.className,r=e.style,n=e.children,i=e.position,a=QS(),s=YS(a,2),l=s[0],c=s[1],p=useSceneValue(),y=QS(function(){return document.createElement("div")}),b=YS(y,1),A=b[0];return KS(function(){var w=new Control({position:i});return w.onAdd=function(){if(t&&(A.className=t),r){var I=Object.keys(r).map(function(P){return"".concat(lF(P),":").concat(r[P])}).join(";");A.style.cssText=I}return A},w.onRemove=function(){},c(w),p.addControl(w),function(){p.removeControl(w)}},[]),KS(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,A)}var JS=(0,oe.createContext)({});function C8(){return useContext(JS)}var cF=oe.memo(function(t){var r=t.layer,n=t.active;return r.active(n.option),null},ru()),fF=oe.memo(function(t){var r=t.layer,n=t.animate;return r.animate(n),null},ru()),hF=oe.memo(function(t){var r=t.layer,n=t.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},ru()),pF=oe.memo(function(t){var r=t.layer,n=t.filter;return n.field&&r.filter(n.field,n.values),null},ru()),dF=oe.memo(function(t){var r=t.layer,n=t.scale;return r.scale(n.values),null},ru()),vF=oe.memo(function(t){var r=t.layer,n=t.select;return r.select(n.option),null},ru()),mF=oe.memo(function(t){var r=t.layer,n=t.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},ru()),gF=oe.memo(function(t){var r=t.layer,n=t.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},ru()),yF=["data"];function _F(e,t){if(e==null)return{};var r=xF(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function xF(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var bF=oe.memo(function(t){var r=t.layer,n=t.source,i=n.data,a=_F(n,yF);return r.inited?r.setData(i,a):r.source(i,a),a.autoFit&&r.fitBounds(a&&a.fitBoundsOptions),null},ru()),R8=oe.useEffect,EF=oe.memo(function(t){var r=t.layer,n=t.style;return r.style(n),null},ru());function SF(e,t){return CF(e)||wF(e,t)||TF(e,t)||AF()}function AF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TF(e,t){if(!!e){if(typeof e=="string")return eA(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eA(e,t)}}function eA(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wF(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],c=!0,p=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(y){p=!0,i=y}finally{try{if(!c&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(p)throw i}}return l}}function CF(e){if(Array.isArray(e))return e}var p0=oe.useEffect,RF=oe.useState;function tA(e,t){var r=t.source,n=t.color,i=t.shape,a=t.style,s=t.size,l=t.scale,c=t.active,p=t.select,y=t.filter,b=t.animate,A=t.options,w=t.onLayerLoaded,I=de(),P=RF(function(){var K;switch(e){case"polygonLayer":K=new Im(A);break;case"lineLayer":K=new dy(A);break;case"pointLayer":K=new H0(A);break;case"heatmapLayer":K=new nR(A);break;case"rasterLayer":K=new W0(A);break;case"imageLayer":K=new jx(A);break;case"citybuildingLayer":K=new CC(A);break;default:K=new Im(A)}return K.on("inited",function(){w&&w(K,I)}),K}),L=SF(P,1),V=L[0];return p0(function(){return I.addLayer(V),function(){I.removeLayer(V)}},[]),p0(function(){V.inited&&A&&V.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),p0(function(){V.inited&&(A==null?void 0:A.zIndex)&&V.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),p0(function(){V.inited&&(A==null?void 0:A.blend)&&V.setBlend(A.blend)},[A==null?void 0:A.blend]),p0(function(){I.render()}),oe.createElement(JS.Provider,{value:V},oe.createElement(bF,{layer:V,source:r}),l&&oe.createElement(dF,{layer:V,scale:l}),n&&oe.createElement(hF,{layer:V,color:n}),s&&oe.createElement(gF,{layer:V,size:s}),i&&oe.createElement(mF,{layer:V,shape:i}),a&&oe.createElement(EF,{layer:V,style:a}),c&&oe.createElement(cF,{layer:V,active:c}),p&&oe.createElement(vF,{layer:V,select:p}),y&&oe.createElement(pF,{layer:V,filter:y}),b&&oe.createElement(fF,{layer:V,animate:b}),t.children)}var M8=null,I8=null,MF=oe.memo(function(t){return tA("pointLayer",t)}),IF=oe.memo(function(t){return tA("heatmapLayer",t)}),P8=null,O8=null,k8=null,D8=oe.useEffect,L8=null,B8=null;function Uv(e){return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uv(e)}function rA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function kg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rA(Object(r),!0).forEach(function(n){PF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rA(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PF(e,t,r){return t=iA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OF(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nA(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,iA(n.key),n)}}function kF(e,t,r){return t&&nA(e.prototype,t),r&&nA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function iA(e){var t=DF(e,"string");return Uv(t)==="symbol"?t:String(t)}function DF(e,t){if(Uv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Uv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LF(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e_(e,t)}function e_(e,t){return e_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},e_(e,t)}function BF(e){var t=UF();return function(){var n=Dg(e),i;if(t){var a=Dg(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return FF(this,i)}}function FF(e,t){if(t&&(Uv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NF(e)}function NF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Dg(e){return Dg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Dg(e)}var F8=function(e){LF(r,e);var t=BF(r);function r(n){var i;return OF(this,r),i=t.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return kF(r,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,c=a.option,p=a.lngLat,y=new Fy(kg(kg({},c),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&y.setLnglat(s),p&&y.setLnglat(p),l&&y.setHTML(this.el),this.popup=y,this.scene.addPopup(y)}},{key:"componentDidUpdate",value:function(i){var a,s,l,c,p,y,b=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(c=l.lnglat)===null||c===void 0?void 0:c.lng,(p=this.props)===null||p===void 0||(y=p.lnglat)===null||y===void 0?void 0:y.lat],w=b.toString()!==A.toString();if(w){var I;this.popup.remove(),this.popup=new Fy(kg(kg({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return oe.createElement(_.Consumer,{},function(a){return a&&(i.scene=a),(0,$S.createPortal)(i.props.children,i.el)})}}]),r}(oe.PureComponent);function zv(e){return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zv(e)}function zF(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aA(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VF(n.key),n)}}function ZF(e,t,r){return t&&aA(e.prototype,t),r&&aA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function VF(e){var t=jF(e,"string");return zv(t)==="symbol"?t:String(t)}function jF(e,t){if(zv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HF(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t_(e,t)}function t_(e,t){return t_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},t_(e,t)}function WF(e){var t=$F();return function(){var n=Lg(e),i;if(t){var a=Lg(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return GF(this,i)}}function GF(e,t){if(t&&(zv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XF(e)}function XF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $F(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lg(e){return Lg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Lg(e)}var N8=function(e){HF(r,e);var t=WF(r);function r(n){var i;return zF(this,r),i=t.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return ZF(r,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,c=i.onMarkerLoaded,p=new ax(l);a&&p.setLnglat(a),s&&p.setElement(this.el),this.marker=p,c&&c(p),this.scene.addMarker(p)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return oe.createElement(_.Consumer,{},function(a){return a&&(i.scene=a),(0,$S.createPortal)(i.props.children,i.el)})}}]),r}(oe.PureComponent),U8=oe.useEffect,z8=null,Z8=null,V8=oe.useEffect,j8=null},66213:function(vr,se,Z){"use strict";Z.d(se,{Z:function(){return _}});var ge=Z(77608);function oe(de,j){for(;!Object.prototype.hasOwnProperty.call(de,j)&&(de=(0,ge.Z)(de),de!==null););return de}function _(){return typeof Reflect!="undefined"&&Reflect.get?_=Reflect.get.bind():_=function(j,ue,ie){var De=oe(j,ue);if(!!De){var ne=Object.getOwnPropertyDescriptor(De,ue);return ne.get?ne.get.call(arguments.length<3?j:ie):ne.value}},_.apply(this,arguments)}},59591:function(vr,se,Z){var ge=Z(50008).default;function oe(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */vr.exports=oe=function(){return de},vr.exports.__esModule=!0,vr.exports.default=vr.exports;var _,de={},j=Object.prototype,ue=j.hasOwnProperty,ie=Object.defineProperty||function(Ye,We,ot){Ye[We]=ot.value},De=typeof Symbol=="function"?Symbol:{},ne=De.iterator||"@@iterator",Ze=De.asyncIterator||"@@asyncIterator",nt=De.toStringTag||"@@toStringTag";function rt(Ye,We,ot){return Object.defineProperty(Ye,We,{value:ot,enumerable:!0,configurable:!0,writable:!0}),Ye[We]}try{rt({},"")}catch(Ye){rt=function(ot,Tt,gr){return ot[Tt]=gr}}function Pt(Ye,We,ot,Tt){var gr=We&&We.prototype instanceof Fr?We:Fr,wt=Object.create(gr.prototype),hn=new Ce(Tt||[]);return ie(wt,"_invoke",{value:te(Ye,ot,hn)}),wt}function Ct(Ye,We,ot){try{return{type:"normal",arg:Ye.call(We,ot)}}catch(Tt){return{type:"throw",arg:Tt}}}de.wrap=Pt;var $t="suspendedStart",rr="suspendedYield",zt="executing",Mt="completed",Et={};function Fr(){}function Ar(){}function dr(){}var It={};rt(It,ne,function(){return this});var ct=Object.getPrototypeOf,Ft=ct&&ct(ct(pt([])));Ft&&Ft!==j&&ue.call(Ft,ne)&&(It=Ft);var ht=dr.prototype=Fr.prototype=Object.create(It);function sr(Ye){["next","throw","return"].forEach(function(We){rt(Ye,We,function(ot){return this._invoke(We,ot)})})}function br(Ye,We){function ot(gr,wt,hn,Hr){var Vr=Ct(Ye[gr],Ye,wt);if(Vr.type!=="throw"){var qn=Vr.arg,Nn=qn.value;return Nn&&ge(Nn)=="object"&&ue.call(Nn,"__await")?We.resolve(Nn.__await).then(function(dn){ot("next",dn,hn,Hr)},function(dn){ot("throw",dn,hn,Hr)}):We.resolve(Nn).then(function(dn){qn.value=dn,hn(qn)},function(dn){return ot("throw",dn,hn,Hr)})}Hr(Vr.arg)}var Tt;ie(this,"_invoke",{value:function(wt,hn){function Hr(){return new We(function(Vr,qn){ot(wt,hn,Vr,qn)})}return Tt=Tt?Tt.then(Hr,Hr):Hr()}})}function te(Ye,We,ot){var Tt=$t;return function(gr,wt){if(Tt===zt)throw new Error("Generator is already running");if(Tt===Mt){if(gr==="throw")throw wt;return{value:_,done:!0}}for(ot.method=gr,ot.arg=wt;;){var hn=ot.delegate;if(hn){var Hr=Ne(hn,ot);if(Hr){if(Hr===Et)continue;return Hr}}if(ot.method==="next")ot.sent=ot._sent=ot.arg;else if(ot.method==="throw"){if(Tt===$t)throw Tt=Mt,ot.arg;ot.dispatchException(ot.arg)}else ot.method==="return"&&ot.abrupt("return",ot.arg);Tt=zt;var Vr=Ct(Ye,We,ot);if(Vr.type==="normal"){if(Tt=ot.done?Mt:rr,Vr.arg===Et)continue;return{value:Vr.arg,done:ot.done}}Vr.type==="throw"&&(Tt=Mt,ot.method="throw",ot.arg=Vr.arg)}}}function Ne(Ye,We){var ot=We.method,Tt=Ye.iterator[ot];if(Tt===_)return We.delegate=null,ot==="throw"&&Ye.iterator.return&&(We.method="return",We.arg=_,Ne(Ye,We),We.method==="throw")||ot!=="return"&&(We.method="throw",We.arg=new TypeError("The iterator does not provide a '"+ot+"' method")),Et;var gr=Ct(Tt,Ye.iterator,We.arg);if(gr.type==="throw")return We.method="throw",We.arg=gr.arg,We.delegate=null,Et;var wt=gr.arg;return wt?wt.done?(We[Ye.resultName]=wt.value,We.next=Ye.nextLoc,We.method!=="return"&&(We.method="next",We.arg=_),We.delegate=null,Et):wt:(We.method="throw",We.arg=new TypeError("iterator result is not an object"),We.delegate=null,Et)}function O(Ye){var We={tryLoc:Ye[0]};1 in Ye&&(We.catchLoc=Ye[1]),2 in Ye&&(We.finallyLoc=Ye[2],We.afterLoc=Ye[3]),this.tryEntries.push(We)}function Pe(Ye){var We=Ye.completion||{};We.type="normal",delete We.arg,Ye.completion=We}function Ce(Ye){this.tryEntries=[{tryLoc:"root"}],Ye.forEach(O,this),this.reset(!0)}function pt(Ye){if(Ye||Ye===""){var We=Ye[ne];if(We)return We.call(Ye);if(typeof Ye.next=="function")return Ye;if(!isNaN(Ye.length)){var ot=-1,Tt=function gr(){for(;++ot<Ye.length;)if(ue.call(Ye,ot))return gr.value=Ye[ot],gr.done=!1,gr;return gr.value=_,gr.done=!0,gr};return Tt.next=Tt}}throw new TypeError(ge(Ye)+" is not iterable")}return Ar.prototype=dr,ie(ht,"constructor",{value:dr,configurable:!0}),ie(dr,"constructor",{value:Ar,configurable:!0}),Ar.displayName=rt(dr,nt,"GeneratorFunction"),de.isGeneratorFunction=function(Ye){var We=typeof Ye=="function"&&Ye.constructor;return!!We&&(We===Ar||(We.displayName||We.name)==="GeneratorFunction")},de.mark=function(Ye){return Object.setPrototypeOf?Object.setPrototypeOf(Ye,dr):(Ye.__proto__=dr,rt(Ye,nt,"GeneratorFunction")),Ye.prototype=Object.create(ht),Ye},de.awrap=function(Ye){return{__await:Ye}},sr(br.prototype),rt(br.prototype,Ze,function(){return this}),de.AsyncIterator=br,de.async=function(Ye,We,ot,Tt,gr){gr===void 0&&(gr=Promise);var wt=new br(Pt(Ye,We,ot,Tt),gr);return de.isGeneratorFunction(We)?wt:wt.next().then(function(hn){return hn.done?hn.value:wt.next()})},sr(ht),rt(ht,nt,"Generator"),rt(ht,ne,function(){return this}),rt(ht,"toString",function(){return"[object Generator]"}),de.keys=function(Ye){var We=Object(Ye),ot=[];for(var Tt in We)ot.push(Tt);return ot.reverse(),function gr(){for(;ot.length;){var wt=ot.pop();if(wt in We)return gr.value=wt,gr.done=!1,gr}return gr.done=!0,gr}},de.values=pt,Ce.prototype={constructor:Ce,reset:function(We){if(this.prev=0,this.next=0,this.sent=this._sent=_,this.done=!1,this.delegate=null,this.method="next",this.arg=_,this.tryEntries.forEach(Pe),!We)for(var ot in this)ot.charAt(0)==="t"&&ue.call(this,ot)&&!isNaN(+ot.slice(1))&&(this[ot]=_)},stop:function(){this.done=!0;var We=this.tryEntries[0].completion;if(We.type==="throw")throw We.arg;return this.rval},dispatchException:function(We){if(this.done)throw We;var ot=this;function Tt(qn,Nn){return hn.type="throw",hn.arg=We,ot.next=qn,Nn&&(ot.method="next",ot.arg=_),!!Nn}for(var gr=this.tryEntries.length-1;gr>=0;--gr){var wt=this.tryEntries[gr],hn=wt.completion;if(wt.tryLoc==="root")return Tt("end");if(wt.tryLoc<=this.prev){var Hr=ue.call(wt,"catchLoc"),Vr=ue.call(wt,"finallyLoc");if(Hr&&Vr){if(this.prev<wt.catchLoc)return Tt(wt.catchLoc,!0);if(this.prev<wt.finallyLoc)return Tt(wt.finallyLoc)}else if(Hr){if(this.prev<wt.catchLoc)return Tt(wt.catchLoc,!0)}else{if(!Vr)throw new Error("try statement without catch or finally");if(this.prev<wt.finallyLoc)return Tt(wt.finallyLoc)}}}},abrupt:function(We,ot){for(var Tt=this.tryEntries.length-1;Tt>=0;--Tt){var gr=this.tryEntries[Tt];if(gr.tryLoc<=this.prev&&ue.call(gr,"finallyLoc")&&this.prev<gr.finallyLoc){var wt=gr;break}}wt&&(We==="break"||We==="continue")&&wt.tryLoc<=ot&&ot<=wt.finallyLoc&&(wt=null);var hn=wt?wt.completion:{};return hn.type=We,hn.arg=ot,wt?(this.method="next",this.next=wt.finallyLoc,Et):this.complete(hn)},complete:function(We,ot){if(We.type==="throw")throw We.arg;return We.type==="break"||We.type==="continue"?this.next=We.arg:We.type==="return"?(this.rval=this.arg=We.arg,this.method="return",this.next="end"):We.type==="normal"&&ot&&(this.next=ot),Et},finish:function(We){for(var ot=this.tryEntries.length-1;ot>=0;--ot){var Tt=this.tryEntries[ot];if(Tt.finallyLoc===We)return this.complete(Tt.completion,Tt.afterLoc),Pe(Tt),Et}},catch:function(We){for(var ot=this.tryEntries.length-1;ot>=0;--ot){var Tt=this.tryEntries[ot];if(Tt.tryLoc===We){var gr=Tt.completion;if(gr.type==="throw"){var wt=gr.arg;Pe(Tt)}return wt}}throw new Error("illegal catch attempt")},delegateYield:function(We,ot,Tt){return this.delegate={iterator:pt(We),resultName:ot,nextLoc:Tt},this.method==="next"&&(this.arg=_),Et}},de}vr.exports=oe,vr.exports.__esModule=!0,vr.exports.default=vr.exports},87757:function(vr,se,Z){var ge=Z(59591)();vr.exports=ge;try{regeneratorRuntime=ge}catch(oe){typeof globalThis=="object"?globalThis.regeneratorRuntime=ge:Function("r","regeneratorRuntime = r")(ge)}},38163:function(vr){vr.exports=se;function se(oe,_){var de=oe&&oe.type,j;if(de==="FeatureCollection")for(j=0;j<oe.features.length;j++)se(oe.features[j],_);else if(de==="GeometryCollection")for(j=0;j<oe.geometries.length;j++)se(oe.geometries[j],_);else if(de==="Feature")se(oe.geometry,_);else if(de==="Polygon")Z(oe.coordinates,_);else if(de==="MultiPolygon")for(j=0;j<oe.coordinates.length;j++)Z(oe.coordinates[j],_);return oe}function Z(oe,_){if(oe.length!==0){ge(oe[0],_);for(var de=1;de<oe.length;de++)ge(oe[de],!_)}}function ge(oe,_){for(var de=0,j=0,ue=0,ie=oe.length,De=ie-1;ue<ie;De=ue++){var ne=(oe[ue][0]-oe[De][0])*(oe[De][1]+oe[ue][1]),Ze=de+ne;j+=Math.abs(de)>=Math.abs(ne)?de-Ze+ne:ne-Ze+de,de=Ze}de+j>=0!=!!_&&oe.reverse()}},75550:function(vr){"use strict";vr.exports=se;function se(Z,ge){this.x=Z,this.y=ge}se.prototype={clone:function(){return new se(this.x,this.y)},add:function(Z){return this.clone()._add(Z)},sub:function(Z){return this.clone()._sub(Z)},multByPoint:function(Z){return this.clone()._multByPoint(Z)},divByPoint:function(Z){return this.clone()._divByPoint(Z)},mult:function(Z){return this.clone()._mult(Z)},div:function(Z){return this.clone()._div(Z)},rotate:function(Z){return this.clone()._rotate(Z)},rotateAround:function(Z,ge){return this.clone()._rotateAround(Z,ge)},matMult:function(Z){return this.clone()._matMult(Z)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(Z){return this.x===Z.x&&this.y===Z.y},dist:function(Z){return Math.sqrt(this.distSqr(Z))},distSqr:function(Z){var ge=Z.x-this.x,oe=Z.y-this.y;return ge*ge+oe*oe},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(Z){return Math.atan2(this.y-Z.y,this.x-Z.x)},angleWith:function(Z){return this.angleWithSep(Z.x,Z.y)},angleWithSep:function(Z,ge){return Math.atan2(this.x*ge-this.y*Z,this.x*Z+this.y*ge)},_matMult:function(Z){var ge=Z[0]*this.x+Z[1]*this.y,oe=Z[2]*this.x+Z[3]*this.y;return this.x=ge,this.y=oe,this},_add:function(Z){return this.x+=Z.x,this.y+=Z.y,this},_sub:function(Z){return this.x-=Z.x,this.y-=Z.y,this},_mult:function(Z){return this.x*=Z,this.y*=Z,this},_div:function(Z){return this.x/=Z,this.y/=Z,this},_multByPoint:function(Z){return this.x*=Z.x,this.y*=Z.y,this},_divByPoint:function(Z){return this.x/=Z.x,this.y/=Z.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var Z=this.y;return this.y=this.x,this.x=-Z,this},_rotate:function(Z){var ge=Math.cos(Z),oe=Math.sin(Z),_=ge*this.x-oe*this.y,de=oe*this.x+ge*this.y;return this.x=_,this.y=de,this},_rotateAround:function(Z,ge){var oe=Math.cos(Z),_=Math.sin(Z),de=ge.x+oe*(this.x-ge.x)-_*(this.y-ge.y),j=ge.y+_*(this.x-ge.x)+oe*(this.y-ge.y);return this.x=de,this.y=j,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},se.convert=function(Z){return Z instanceof se?Z:Array.isArray(Z)?new se(Z[0],Z[1]):Z}},49296:function(vr){"use strict";vr.exports=Z,vr.exports.default=Z;var se=1e20;function Z(j,ue,ie,De,ne,Ze){this.fontSize=j||24,this.buffer=ue===void 0?3:ue,this.cutoff=De||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=Ze||"normal",this.radius=ie||8;var nt=this.size=this.fontSize+this.buffer*2,rt=nt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=nt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(rt*rt),this.gridInner=new Float64Array(rt*rt),this.f=new Float64Array(rt),this.z=new Float64Array(rt+1),this.v=new Uint16Array(rt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(nt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ge(j,ue,ie,De,ne,Ze,nt){Ze.fill(se,0,ue*ie),nt.fill(0,0,ue*ie);for(var rt=(ue-De)/2,Pt=0;Pt<ne;Pt++)for(var Ct=0;Ct<De;Ct++){var $t=(Pt+rt)*ue+Ct+rt,rr=j.data[4*(Pt*De+Ct)+3]/255;if(rr===1)Ze[$t]=0,nt[$t]=se;else if(rr===0)Ze[$t]=se,nt[$t]=0;else{var zt=Math.max(0,.5-rr),Mt=Math.max(0,rr-.5);Ze[$t]=zt*zt,nt[$t]=Mt*Mt}}}function oe(j,ue,ie,De,ne,Ze,nt){for(var rt=0;rt<ue*ie;rt++){var Pt=Math.sqrt(De[rt])-Math.sqrt(ne[rt]);j[rt]=Math.round(255-255*(Pt/Ze+nt))}}Z.prototype._draw=function(j,ue){var ie=this.ctx.measureText(j),De=ie.width,ne=2*this.buffer,Ze,nt,rt,Pt,Ct,$t,rr,zt;ue&&this.useMetrics?(Ct=Math.floor(ie.actualBoundingBoxAscent),zt=this.buffer+Math.ceil(ie.actualBoundingBoxAscent),$t=this.buffer,rr=this.buffer,nt=Math.min(this.size,Math.ceil(ie.actualBoundingBoxRight-ie.actualBoundingBoxLeft)),Pt=Math.min(this.size-$t,Math.ceil(ie.actualBoundingBoxAscent+ie.actualBoundingBoxDescent)),Ze=nt+ne,rt=Pt+ne,this.ctx.textBaseline="alphabetic"):(Ze=nt=this.size,rt=Pt=this.size,Ct=19*this.fontSize/24,$t=rr=0,zt=this.middle,this.ctx.textBaseline="middle");var Mt;nt&&Pt&&(this.ctx.clearRect(rr,$t,nt,Pt),this.ctx.fillText(j,this.buffer,zt),Mt=this.ctx.getImageData(rr,$t,nt,Pt));var Et=new Uint8ClampedArray(Ze*rt);return ge(Mt,Ze,rt,nt,Pt,this.gridOuter,this.gridInner),_(this.gridOuter,Ze,rt,this.f,this.v,this.z),_(this.gridInner,Ze,rt,this.f,this.v,this.z),oe(Et,Ze,rt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Et,metrics:{width:nt,height:Pt,sdfWidth:Ze,sdfHeight:rt,top:Ct,left:0,advance:De}}},Z.prototype.draw=function(j){return this._draw(j,!1).data},Z.prototype.drawWithMetrics=function(j){return this._draw(j,!0)};function _(j,ue,ie,De,ne,Ze){for(var nt=0;nt<ue;nt++)de(j,nt,ue,ie,De,ne,Ze);for(var rt=0;rt<ie;rt++)de(j,rt*ue,1,ue,De,ne,Ze)}function de(j,ue,ie,De,ne,Ze,nt){var rt,Pt,Ct,$t;for(Ze[0]=0,nt[0]=-se,nt[1]=se,rt=0;rt<De;rt++)ne[rt]=j[ue+rt*ie];for(rt=1,Pt=0,Ct=0;rt<De;rt++){do $t=Ze[Pt],Ct=(ne[rt]-ne[$t]+rt*rt-$t*$t)/(rt-$t)/2;while(Ct<=nt[Pt]&&--Pt>-1);Pt++,Ze[Pt]=rt,nt[Pt]=Ct,nt[Pt+1]=se}for(rt=0,Pt=0;rt<De;rt++){for(;nt[Pt+1]<rt;)Pt++;$t=Ze[Pt],j[ue+rt*ie]=ne[$t]+(rt-$t)*(rt-$t)}}},38929:function(vr,se,Z){vr.exports.VectorTile=Z(22779),Z(66024),Z(59701)},22779:function(vr,se,Z){"use strict";var ge=Z(59701);vr.exports=oe;function oe(de,j){this.layers=de.readFields(_,{},j)}function _(de,j,ue){if(de===3){var ie=new ge(ue,ue.readVarint()+ue.pos);ie.length&&(j[ie.name]=ie)}}},66024:function(vr,se,Z){"use strict";var ge=Z(75550);vr.exports=oe;function oe(ie,De,ne,Ze,nt){this.properties={},this.extent=ne,this.type=0,this._pbf=ie,this._geometry=-1,this._keys=Ze,this._values=nt,ie.readFields(_,this,De)}function _(ie,De,ne){ie==1?De.id=ne.readVarint():ie==2?de(ne,De):ie==3?De.type=ne.readVarint():ie==4&&(De._geometry=ne.pos)}function de(ie,De){for(var ne=ie.readVarint()+ie.pos;ie.pos<ne;){var Ze=De._keys[ie.readVarint()],nt=De._values[ie.readVarint()];De.properties[Ze]=nt}}oe.types=["Unknown","Point","LineString","Polygon"],oe.prototype.loadGeometry=function(){var ie=this._pbf;ie.pos=this._geometry;for(var De=ie.readVarint()+ie.pos,ne=1,Ze=0,nt=0,rt=0,Pt=[],Ct;ie.pos<De;){if(Ze<=0){var $t=ie.readVarint();ne=$t&7,Ze=$t>>3}if(Ze--,ne===1||ne===2)nt+=ie.readSVarint(),rt+=ie.readSVarint(),ne===1&&(Ct&&Pt.push(Ct),Ct=[]),Ct.push(new ge(nt,rt));else if(ne===7)Ct&&Ct.push(Ct[0].clone());else throw new Error("unknown command "+ne)}return Ct&&Pt.push(Ct),Pt},oe.prototype.bbox=function(){var ie=this._pbf;ie.pos=this._geometry;for(var De=ie.readVarint()+ie.pos,ne=1,Ze=0,nt=0,rt=0,Pt=Infinity,Ct=-Infinity,$t=Infinity,rr=-Infinity;ie.pos<De;){if(Ze<=0){var zt=ie.readVarint();ne=zt&7,Ze=zt>>3}if(Ze--,ne===1||ne===2)nt+=ie.readSVarint(),rt+=ie.readSVarint(),nt<Pt&&(Pt=nt),nt>Ct&&(Ct=nt),rt<$t&&($t=rt),rt>rr&&(rr=rt);else if(ne!==7)throw new Error("unknown command "+ne)}return[Pt,$t,Ct,rr]},oe.prototype.toGeoJSON=function(ie,De,ne){var Ze=this.extent*Math.pow(2,ne),nt=this.extent*ie,rt=this.extent*De,Pt=this.loadGeometry(),Ct=oe.types[this.type],$t,rr;function zt(Fr){for(var Ar=0;Ar<Fr.length;Ar++){var dr=Fr[Ar],It=180-(dr.y+rt)*360/Ze;Fr[Ar]=[(dr.x+nt)*360/Ze-180,360/Math.PI*Math.atan(Math.exp(It*Math.PI/180))-90]}}switch(this.type){case 1:var Mt=[];for($t=0;$t<Pt.length;$t++)Mt[$t]=Pt[$t][0];Pt=Mt,zt(Pt);break;case 2:for($t=0;$t<Pt.length;$t++)zt(Pt[$t]);break;case 3:for(Pt=j(Pt),$t=0;$t<Pt.length;$t++)for(rr=0;rr<Pt[$t].length;rr++)zt(Pt[$t][rr]);break}Pt.length===1?Pt=Pt[0]:Ct="Multi"+Ct;var Et={type:"Feature",geometry:{type:Ct,coordinates:Pt},properties:this.properties};return"id"in this&&(Et.id=this.id),Et};function j(ie){var De=ie.length;if(De<=1)return[ie];for(var ne=[],Ze,nt,rt=0;rt<De;rt++){var Pt=ue(ie[rt]);Pt!==0&&(nt===void 0&&(nt=Pt<0),nt===Pt<0?(Ze&&ne.push(Ze),Ze=[ie[rt]]):Ze.push(ie[rt]))}return Ze&&ne.push(Ze),ne}function ue(ie){for(var De=0,ne=0,Ze=ie.length,nt=Ze-1,rt,Pt;ne<Ze;nt=ne++)rt=ie[ne],Pt=ie[nt],De+=(Pt.x-rt.x)*(rt.y+Pt.y);return De}},59701:function(vr,se,Z){"use strict";var ge=Z(66024);vr.exports=oe;function oe(j,ue){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=j,this._keys=[],this._values=[],this._features=[],j.readFields(_,this,ue),this.length=this._features.length}function _(j,ue,ie){j===15?ue.version=ie.readVarint():j===1?ue.name=ie.readString():j===5?ue.extent=ie.readVarint():j===2?ue._features.push(ie.pos):j===3?ue._keys.push(ie.readString()):j===4&&ue._values.push(de(ie))}function de(j){for(var ue=null,ie=j.readVarint()+j.pos;j.pos<ie;){var De=j.readVarint()>>3;ue=De===1?j.readString():De===2?j.readFloat():De===3?j.readDouble():De===4?j.readVarint64():De===5?j.readVarint():De===6?j.readSVarint():De===7?j.readBoolean():null}return ue}oe.prototype.feature=function(j){if(j<0||j>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[j];var ue=this._pbf.readVarint()+this._pbf.pos;return new ge(this._pbf,ue,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(vr,se,Z){"use strict";Z.d(se,{Z:function(){return sr}});var ge=Z(22122),oe=Z(67294),_=Z(57838),de=Z(96159),j=Z(96156),ue=Z(94184),ie=Z.n(ue),De=Z(53124),ne=Z(90860),Ze=Z(11726),nt=Z.n(Ze),rt=function(te){var Ne=te.value,O=te.formatter,Pe=te.precision,Ce=te.decimalSeparator,pt=te.groupSeparator,Ye=pt===void 0?"":pt,We=te.prefixCls,ot;if(typeof O=="function")ot=O(Ne);else{var Tt=String(Ne),gr=Tt.match(/^(-?)(\d*)(\.(\d+))?$/);if(!gr||Tt==="-")ot=Tt;else{var wt=gr[1],hn=gr[2]||"0",Hr=gr[4]||"";hn=hn.replace(/\B(?=(\d{3})+(?!\d))/g,Ye),typeof Pe=="number"&&(Hr=nt()(Hr,Pe,"0").slice(0,Pe>0?Pe:0)),Hr&&(Hr="".concat(Ce).concat(Hr)),ot=[oe.createElement("span",{key:"int",className:"".concat(We,"-content-value-int")},wt,hn),Hr&&oe.createElement("span",{key:"decimal",className:"".concat(We,"-content-value-decimal")},Hr)]}}return oe.createElement("span",{className:"".concat(We,"-content-value")},ot)},Pt=rt,Ct=function(te){var Ne=te.prefixCls,O=te.className,Pe=te.style,Ce=te.valueStyle,pt=te.value,Ye=pt===void 0?0:pt,We=te.title,ot=te.valueRender,Tt=te.prefix,gr=te.suffix,wt=te.loading,hn=wt===void 0?!1:wt,Hr=te.direction,Vr=te.onMouseEnter,qn=te.onMouseLeave,Nn=te.decimalSeparator,dn=Nn===void 0?".":Nn,Ci=te.groupSeparator,di=Ci===void 0?",":Ci,ta=oe.createElement(Pt,(0,ge.Z)({decimalSeparator:dn,groupSeparator:di},te,{value:Ye})),Rn=ie()(Ne,(0,j.Z)({},"".concat(Ne,"-rtl"),Hr==="rtl"),O);return oe.createElement("div",{className:Rn,style:Pe,onMouseEnter:Vr,onMouseLeave:qn},We&&oe.createElement("div",{className:"".concat(Ne,"-title")},We),oe.createElement(ne.Z,{paragraph:!1,loading:hn,className:"".concat(Ne,"-skeleton")},oe.createElement("div",{style:Ce,className:"".concat(Ne,"-content")},Tt&&oe.createElement("span",{className:"".concat(Ne,"-content-prefix")},Tt),ot?ot(ta):ta,gr&&oe.createElement("span",{className:"".concat(Ne,"-content-suffix")},gr))))},$t=(0,De.PG)({prefixCls:"statistic"})(Ct),rr=$t,zt=Z(28481),Mt=Z(32475),Et=Z.n(Mt),Fr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Ar(br,te){var Ne=br,O=/\[[^\]]*]/g,Pe=(te.match(O)||[]).map(function(We){return We.slice(1,-1)}),Ce=te.replace(O,"[]"),pt=Fr.reduce(function(We,ot){var Tt=(0,zt.Z)(ot,2),gr=Tt[0],wt=Tt[1];if(We.includes(gr)){var hn=Math.floor(Ne/wt);return Ne-=hn*wt,We.replace(new RegExp("".concat(gr,"+"),"g"),function(Hr){var Vr=Hr.length;return Et()(hn.toString(),Vr,"0")})}return We},Ce),Ye=0;return pt.replace(O,function(){var We=Pe[Ye];return Ye+=1,We})}function dr(br,te){var Ne=te.format,O=Ne===void 0?"":Ne,Pe=new Date(br).getTime(),Ce=Date.now(),pt=Math.max(Pe-Ce,0);return Ar(pt,O)}var It=1e3/30;function ct(br){return new Date(br).getTime()}var Ft=function(te){var Ne=te.value,O=te.format,Pe=O===void 0?"HH:mm:ss":O,Ce=te.onChange,pt=te.onFinish,Ye=(0,_.Z)(),We=oe.useRef(null),ot=function(){pt==null||pt(),We.current&&(clearInterval(We.current),We.current=null)},Tt=function(){var Hr=ct(Ne);Hr>=Date.now()&&(We.current=setInterval(function(){Ye(),Ce==null||Ce(Hr-Date.now()),Hr<Date.now()&&ot()},It))};oe.useEffect(function(){return Tt(),function(){We.current&&(clearInterval(We.current),We.current=null)}},[Ne]);var gr=function(Hr,Vr){return dr(Hr,(0,ge.Z)((0,ge.Z)({},Vr),{format:Pe}))},wt=function(Hr){return(0,de.Tm)(Hr,{title:void 0})};return oe.createElement(rr,(0,ge.Z)({},te,{valueRender:wt,formatter:gr}))},ht=oe.memo(Ft);rr.Countdown=ht;var sr=rr},95300:function(vr,se,Z){"use strict";var ge=Z(38663),oe=Z.n(ge),_=Z(81903),de=Z.n(_),j=Z(18446)},9187:function(vr){"use strict";vr.exports=se,vr.exports.default=se;function se(O,Pe,Ce){Ce=Ce||2;var pt=Pe&&Pe.length,Ye=pt?Pe[0]*Ce:O.length,We=Z(O,0,Ye,Ce,!0),ot=[];if(!We||We.next===We.prev)return ot;var Tt,gr,wt,hn,Hr,Vr,qn;if(pt&&(We=ie(O,Pe,We,Ce)),O.length>80*Ce){Tt=wt=O[0],gr=hn=O[1];for(var Nn=Ce;Nn<Ye;Nn+=Ce)Hr=O[Nn],Vr=O[Nn+1],Hr<Tt&&(Tt=Hr),Vr<gr&&(gr=Vr),Hr>wt&&(wt=Hr),Vr>hn&&(hn=Vr);qn=Math.max(wt-Tt,hn-gr),qn=qn!==0?32767/qn:0}return oe(We,ot,Ce,Tt,gr,qn,0),ot}function Z(O,Pe,Ce,pt,Ye){var We,ot;if(Ye===Ne(O,Pe,Ce,pt)>0)for(We=Pe;We<Ce;We+=pt)ot=sr(We,O[We],O[We+1],ot);else for(We=Ce-pt;We>=Pe;We-=pt)ot=sr(We,O[We],O[We+1],ot);return ot&&Et(ot,ot.next)&&(br(ot),ot=ot.next),ot}function ge(O,Pe){if(!O)return O;Pe||(Pe=O);var Ce=O,pt;do if(pt=!1,!Ce.steiner&&(Et(Ce,Ce.next)||Mt(Ce.prev,Ce,Ce.next)===0)){if(br(Ce),Ce=Pe=Ce.prev,Ce===Ce.next)break;pt=!0}else Ce=Ce.next;while(pt||Ce!==Pe);return Pe}function oe(O,Pe,Ce,pt,Ye,We,ot){if(!!O){!ot&&We&&rt(O,pt,Ye,We);for(var Tt=O,gr,wt;O.prev!==O.next;){if(gr=O.prev,wt=O.next,We?de(O,pt,Ye,We):_(O)){Pe.push(gr.i/Ce|0),Pe.push(O.i/Ce|0),Pe.push(wt.i/Ce|0),br(O),O=wt.next,Tt=wt.next;continue}if(O=wt,O===Tt){ot?ot===1?(O=j(ge(O),Pe,Ce),oe(O,Pe,Ce,pt,Ye,We,2)):ot===2&&ue(O,Pe,Ce,pt,Ye,We):oe(ge(O),Pe,Ce,pt,Ye,We,1);break}}}}function _(O){var Pe=O.prev,Ce=O,pt=O.next;if(Mt(Pe,Ce,pt)>=0)return!1;for(var Ye=Pe.x,We=Ce.x,ot=pt.x,Tt=Pe.y,gr=Ce.y,wt=pt.y,hn=Ye<We?Ye<ot?Ye:ot:We<ot?We:ot,Hr=Tt<gr?Tt<wt?Tt:wt:gr<wt?gr:wt,Vr=Ye>We?Ye>ot?Ye:ot:We>ot?We:ot,qn=Tt>gr?Tt>wt?Tt:wt:gr>wt?gr:wt,Nn=pt.next;Nn!==Pe;){if(Nn.x>=hn&&Nn.x<=Vr&&Nn.y>=Hr&&Nn.y<=qn&&rr(Ye,Tt,We,gr,ot,wt,Nn.x,Nn.y)&&Mt(Nn.prev,Nn,Nn.next)>=0)return!1;Nn=Nn.next}return!0}function de(O,Pe,Ce,pt){var Ye=O.prev,We=O,ot=O.next;if(Mt(Ye,We,ot)>=0)return!1;for(var Tt=Ye.x,gr=We.x,wt=ot.x,hn=Ye.y,Hr=We.y,Vr=ot.y,qn=Tt<gr?Tt<wt?Tt:wt:gr<wt?gr:wt,Nn=hn<Hr?hn<Vr?hn:Vr:Hr<Vr?Hr:Vr,dn=Tt>gr?Tt>wt?Tt:wt:gr>wt?gr:wt,Ci=hn>Hr?hn>Vr?hn:Vr:Hr>Vr?Hr:Vr,di=Ct(qn,Nn,Pe,Ce,pt),ta=Ct(dn,Ci,Pe,Ce,pt),Rn=O.prevZ,Bn=O.nextZ;Rn&&Rn.z>=di&&Bn&&Bn.z<=ta;){if(Rn.x>=qn&&Rn.x<=dn&&Rn.y>=Nn&&Rn.y<=Ci&&Rn!==Ye&&Rn!==ot&&rr(Tt,hn,gr,Hr,wt,Vr,Rn.x,Rn.y)&&Mt(Rn.prev,Rn,Rn.next)>=0||(Rn=Rn.prevZ,Bn.x>=qn&&Bn.x<=dn&&Bn.y>=Nn&&Bn.y<=Ci&&Bn!==Ye&&Bn!==ot&&rr(Tt,hn,gr,Hr,wt,Vr,Bn.x,Bn.y)&&Mt(Bn.prev,Bn,Bn.next)>=0))return!1;Bn=Bn.nextZ}for(;Rn&&Rn.z>=di;){if(Rn.x>=qn&&Rn.x<=dn&&Rn.y>=Nn&&Rn.y<=Ci&&Rn!==Ye&&Rn!==ot&&rr(Tt,hn,gr,Hr,wt,Vr,Rn.x,Rn.y)&&Mt(Rn.prev,Rn,Rn.next)>=0)return!1;Rn=Rn.prevZ}for(;Bn&&Bn.z<=ta;){if(Bn.x>=qn&&Bn.x<=dn&&Bn.y>=Nn&&Bn.y<=Ci&&Bn!==Ye&&Bn!==ot&&rr(Tt,hn,gr,Hr,wt,Vr,Bn.x,Bn.y)&&Mt(Bn.prev,Bn,Bn.next)>=0)return!1;Bn=Bn.nextZ}return!0}function j(O,Pe,Ce){var pt=O;do{var Ye=pt.prev,We=pt.next.next;!Et(Ye,We)&&Fr(Ye,pt,pt.next,We)&&ct(Ye,We)&&ct(We,Ye)&&(Pe.push(Ye.i/Ce|0),Pe.push(pt.i/Ce|0),Pe.push(We.i/Ce|0),br(pt),br(pt.next),pt=O=We),pt=pt.next}while(pt!==O);return ge(pt)}function ue(O,Pe,Ce,pt,Ye,We){var ot=O;do{for(var Tt=ot.next.next;Tt!==ot.prev;){if(ot.i!==Tt.i&&zt(ot,Tt)){var gr=ht(ot,Tt);ot=ge(ot,ot.next),gr=ge(gr,gr.next),oe(ot,Pe,Ce,pt,Ye,We,0),oe(gr,Pe,Ce,pt,Ye,We,0);return}Tt=Tt.next}ot=ot.next}while(ot!==O)}function ie(O,Pe,Ce,pt){var Ye=[],We,ot,Tt,gr,wt;for(We=0,ot=Pe.length;We<ot;We++)Tt=Pe[We]*pt,gr=We<ot-1?Pe[We+1]*pt:O.length,wt=Z(O,Tt,gr,pt,!1),wt===wt.next&&(wt.steiner=!0),Ye.push($t(wt));for(Ye.sort(De),We=0;We<Ye.length;We++)Ce=ne(Ye[We],Ce);return Ce}function De(O,Pe){return O.x-Pe.x}function ne(O,Pe){var Ce=Ze(O,Pe);if(!Ce)return Pe;var pt=ht(Ce,O);return ge(pt,pt.next),ge(Ce,Ce.next)}function Ze(O,Pe){var Ce=Pe,pt=O.x,Ye=O.y,We=-Infinity,ot;do{if(Ye<=Ce.y&&Ye>=Ce.next.y&&Ce.next.y!==Ce.y){var Tt=Ce.x+(Ye-Ce.y)*(Ce.next.x-Ce.x)/(Ce.next.y-Ce.y);if(Tt<=pt&&Tt>We&&(We=Tt,ot=Ce.x<Ce.next.x?Ce:Ce.next,Tt===pt))return ot}Ce=Ce.next}while(Ce!==Pe);if(!ot)return null;var gr=ot,wt=ot.x,hn=ot.y,Hr=Infinity,Vr;Ce=ot;do pt>=Ce.x&&Ce.x>=wt&&pt!==Ce.x&&rr(Ye<hn?pt:We,Ye,wt,hn,Ye<hn?We:pt,Ye,Ce.x,Ce.y)&&(Vr=Math.abs(Ye-Ce.y)/(pt-Ce.x),ct(Ce,O)&&(Vr<Hr||Vr===Hr&&(Ce.x>ot.x||Ce.x===ot.x&&nt(ot,Ce)))&&(ot=Ce,Hr=Vr)),Ce=Ce.next;while(Ce!==gr);return ot}function nt(O,Pe){return Mt(O.prev,O,Pe.prev)<0&&Mt(Pe.next,O,O.next)<0}function rt(O,Pe,Ce,pt){var Ye=O;do Ye.z===0&&(Ye.z=Ct(Ye.x,Ye.y,Pe,Ce,pt)),Ye.prevZ=Ye.prev,Ye.nextZ=Ye.next,Ye=Ye.next;while(Ye!==O);Ye.prevZ.nextZ=null,Ye.prevZ=null,Pt(Ye)}function Pt(O){var Pe,Ce,pt,Ye,We,ot,Tt,gr,wt=1;do{for(Ce=O,O=null,We=null,ot=0;Ce;){for(ot++,pt=Ce,Tt=0,Pe=0;Pe<wt&&(Tt++,pt=pt.nextZ,!!pt);Pe++);for(gr=wt;Tt>0||gr>0&&pt;)Tt!==0&&(gr===0||!pt||Ce.z<=pt.z)?(Ye=Ce,Ce=Ce.nextZ,Tt--):(Ye=pt,pt=pt.nextZ,gr--),We?We.nextZ=Ye:O=Ye,Ye.prevZ=We,We=Ye;Ce=pt}We.nextZ=null,wt*=2}while(ot>1);return O}function Ct(O,Pe,Ce,pt,Ye){return O=(O-Ce)*Ye|0,Pe=(Pe-pt)*Ye|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,Pe=(Pe|Pe<<8)&16711935,Pe=(Pe|Pe<<4)&252645135,Pe=(Pe|Pe<<2)&858993459,Pe=(Pe|Pe<<1)&1431655765,O|Pe<<1}function $t(O){var Pe=O,Ce=O;do(Pe.x<Ce.x||Pe.x===Ce.x&&Pe.y<Ce.y)&&(Ce=Pe),Pe=Pe.next;while(Pe!==O);return Ce}function rr(O,Pe,Ce,pt,Ye,We,ot,Tt){return(Ye-ot)*(Pe-Tt)>=(O-ot)*(We-Tt)&&(O-ot)*(pt-Tt)>=(Ce-ot)*(Pe-Tt)&&(Ce-ot)*(We-Tt)>=(Ye-ot)*(pt-Tt)}function zt(O,Pe){return O.next.i!==Pe.i&&O.prev.i!==Pe.i&&!It(O,Pe)&&(ct(O,Pe)&&ct(Pe,O)&&Ft(O,Pe)&&(Mt(O.prev,O,Pe.prev)||Mt(O,Pe.prev,Pe))||Et(O,Pe)&&Mt(O.prev,O,O.next)>0&&Mt(Pe.prev,Pe,Pe.next)>0)}function Mt(O,Pe,Ce){return(Pe.y-O.y)*(Ce.x-Pe.x)-(Pe.x-O.x)*(Ce.y-Pe.y)}function Et(O,Pe){return O.x===Pe.x&&O.y===Pe.y}function Fr(O,Pe,Ce,pt){var Ye=dr(Mt(O,Pe,Ce)),We=dr(Mt(O,Pe,pt)),ot=dr(Mt(Ce,pt,O)),Tt=dr(Mt(Ce,pt,Pe));return!!(Ye!==We&&ot!==Tt||Ye===0&&Ar(O,Ce,Pe)||We===0&&Ar(O,pt,Pe)||ot===0&&Ar(Ce,O,pt)||Tt===0&&Ar(Ce,Pe,pt))}function Ar(O,Pe,Ce){return Pe.x<=Math.max(O.x,Ce.x)&&Pe.x>=Math.min(O.x,Ce.x)&&Pe.y<=Math.max(O.y,Ce.y)&&Pe.y>=Math.min(O.y,Ce.y)}function dr(O){return O>0?1:O<0?-1:0}function It(O,Pe){var Ce=O;do{if(Ce.i!==O.i&&Ce.next.i!==O.i&&Ce.i!==Pe.i&&Ce.next.i!==Pe.i&&Fr(Ce,Ce.next,O,Pe))return!0;Ce=Ce.next}while(Ce!==O);return!1}function ct(O,Pe){return Mt(O.prev,O,O.next)<0?Mt(O,Pe,O.next)>=0&&Mt(O,O.prev,Pe)>=0:Mt(O,Pe,O.prev)<0||Mt(O,O.next,Pe)<0}function Ft(O,Pe){var Ce=O,pt=!1,Ye=(O.x+Pe.x)/2,We=(O.y+Pe.y)/2;do Ce.y>We!=Ce.next.y>We&&Ce.next.y!==Ce.y&&Ye<(Ce.next.x-Ce.x)*(We-Ce.y)/(Ce.next.y-Ce.y)+Ce.x&&(pt=!pt),Ce=Ce.next;while(Ce!==O);return pt}function ht(O,Pe){var Ce=new te(O.i,O.x,O.y),pt=new te(Pe.i,Pe.x,Pe.y),Ye=O.next,We=Pe.prev;return O.next=Pe,Pe.prev=O,Ce.next=Ye,Ye.prev=Ce,pt.next=Ce,Ce.prev=pt,We.next=pt,pt.prev=We,pt}function sr(O,Pe,Ce,pt){var Ye=new te(O,Pe,Ce);return pt?(Ye.next=pt.next,Ye.prev=pt,pt.next.prev=Ye,pt.next=Ye):(Ye.prev=Ye,Ye.next=Ye),Ye}function br(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function te(O,Pe,Ce){this.i=O,this.x=Pe,this.y=Ce,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}se.deviation=function(O,Pe,Ce,pt){var Ye=Pe&&Pe.length,We=Ye?Pe[0]*Ce:O.length,ot=Math.abs(Ne(O,0,We,Ce));if(Ye)for(var Tt=0,gr=Pe.length;Tt<gr;Tt++){var wt=Pe[Tt]*Ce,hn=Tt<gr-1?Pe[Tt+1]*Ce:O.length;ot-=Math.abs(Ne(O,wt,hn,Ce))}var Hr=0;for(Tt=0;Tt<pt.length;Tt+=3){var Vr=pt[Tt]*Ce,qn=pt[Tt+1]*Ce,Nn=pt[Tt+2]*Ce;Hr+=Math.abs((O[Vr]-O[Nn])*(O[qn+1]-O[Vr+1])-(O[Vr]-O[qn])*(O[Nn+1]-O[Vr+1]))}return ot===0&&Hr===0?0:Math.abs((Hr-ot)/ot)};function Ne(O,Pe,Ce,pt){for(var Ye=0,We=Pe,ot=Ce-pt;We<Ce;We+=pt)Ye+=(O[ot]-O[We])*(O[We+1]+O[ot+1]),ot=We;return Ye}se.flatten=function(O){for(var Pe=O[0][0].length,Ce={vertices:[],holes:[],dimensions:Pe},pt=0,Ye=0;Ye<O.length;Ye++){for(var We=0;We<O[Ye].length;We++)for(var ot=0;ot<Pe;ot++)Ce.vertices.push(O[Ye][We][ot]);Ye>0&&(pt+=O[Ye-1].length,Ce.holes.push(pt))}return Ce}},67709:function(vr){function se(ge){var oe=ge.target||ge.srcElement;oe.__resizeRAF__&&cancelAnimationFrame(oe.__resizeRAF__),oe.__resizeRAF__=requestAnimationFrame(function(){var _=oe.__resizeTrigger__,de=_&&_.__resizeListeners__;de&&de.forEach(function(j){j.call(_,ge)})})}var Z=function(oe,_){var de=this,j=de.document,ue,ie=j.attachEvent;typeof navigator!="undefined"&&(ue=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function De(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",se)}if(!oe.__resizeListeners__)if(oe.__resizeListeners__=[],ie)oe.__resizeTrigger__=oe,oe.attachEvent("onresize",se);else{getComputedStyle(oe).position==="static"&&(oe.style.position="relative");var ne=oe.__resizeTrigger__=j.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=oe,ne.onload=De,ne.type="text/html",ue&&oe.appendChild(ne),ne.data="about:blank",ue||oe.appendChild(ne)}oe.__resizeListeners__.push(_)};vr.exports=typeof window=="undefined"?Z:Z.bind(window),vr.exports.unbind=function(ge,oe){var _=document.attachEvent,de=ge.__resizeListeners__||[];if(oe){var j=de.indexOf(oe);j!==-1&&de.splice(j,1)}else de=ge.__resizeListeners__=[];if(!de.length){if(_)ge.detachEvent("onresize",se);else if(ge.__resizeTrigger__){var ue=ge.__resizeTrigger__.contentDocument,ie=ue&&ue.defaultView;ie&&(ie.removeEventListener("resize",se),delete ie.__resizeTrigger__),ge.__resizeTrigger__=!ge.removeChild(ge.__resizeTrigger__)}delete ge.__resizeListeners__}}},26729:function(vr){"use strict";var se=Object.prototype.hasOwnProperty,Z="~";function ge(){}Object.create&&(ge.prototype=Object.create(null),new ge().__proto__||(Z=!1));function oe(ue,ie,De){this.fn=ue,this.context=ie,this.once=De||!1}function _(ue,ie,De,ne,Ze){if(typeof De!="function")throw new TypeError("The listener must be a function");var nt=new oe(De,ne||ue,Ze),rt=Z?Z+ie:ie;return ue._events[rt]?ue._events[rt].fn?ue._events[rt]=[ue._events[rt],nt]:ue._events[rt].push(nt):(ue._events[rt]=nt,ue._eventsCount++),ue}function de(ue,ie){--ue._eventsCount==0?ue._events=new ge:delete ue._events[ie]}function j(){this._events=new ge,this._eventsCount=0}j.prototype.eventNames=function(){var ie=[],De,ne;if(this._eventsCount===0)return ie;for(ne in De=this._events)se.call(De,ne)&&ie.push(Z?ne.slice(1):ne);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols(De)):ie},j.prototype.listeners=function(ie){var De=Z?Z+ie:ie,ne=this._events[De];if(!ne)return[];if(ne.fn)return[ne.fn];for(var Ze=0,nt=ne.length,rt=new Array(nt);Ze<nt;Ze++)rt[Ze]=ne[Ze].fn;return rt},j.prototype.listenerCount=function(ie){var De=Z?Z+ie:ie,ne=this._events[De];return ne?ne.fn?1:ne.length:0},j.prototype.emit=function(ie,De,ne,Ze,nt,rt){var Pt=Z?Z+ie:ie;if(!this._events[Pt])return!1;var Ct=this._events[Pt],$t=arguments.length,rr,zt;if(Ct.fn){switch(Ct.once&&this.removeListener(ie,Ct.fn,void 0,!0),$t){case 1:return Ct.fn.call(Ct.context),!0;case 2:return Ct.fn.call(Ct.context,De),!0;case 3:return Ct.fn.call(Ct.context,De,ne),!0;case 4:return Ct.fn.call(Ct.context,De,ne,Ze),!0;case 5:return Ct.fn.call(Ct.context,De,ne,Ze,nt),!0;case 6:return Ct.fn.call(Ct.context,De,ne,Ze,nt,rt),!0}for(zt=1,rr=new Array($t-1);zt<$t;zt++)rr[zt-1]=arguments[zt];Ct.fn.apply(Ct.context,rr)}else{var Mt=Ct.length,Et;for(zt=0;zt<Mt;zt++)switch(Ct[zt].once&&this.removeListener(ie,Ct[zt].fn,void 0,!0),$t){case 1:Ct[zt].fn.call(Ct[zt].context);break;case 2:Ct[zt].fn.call(Ct[zt].context,De);break;case 3:Ct[zt].fn.call(Ct[zt].context,De,ne);break;case 4:Ct[zt].fn.call(Ct[zt].context,De,ne,Ze);break;default:if(!rr)for(Et=1,rr=new Array($t-1);Et<$t;Et++)rr[Et-1]=arguments[Et];Ct[zt].fn.apply(Ct[zt].context,rr)}}return!0},j.prototype.on=function(ie,De,ne){return _(this,ie,De,ne,!1)},j.prototype.once=function(ie,De,ne){return _(this,ie,De,ne,!0)},j.prototype.removeListener=function(ie,De,ne,Ze){var nt=Z?Z+ie:ie;if(!this._events[nt])return this;if(!De)return de(this,nt),this;var rt=this._events[nt];if(rt.fn)rt.fn===De&&(!Ze||rt.once)&&(!ne||rt.context===ne)&&de(this,nt);else{for(var Pt=0,Ct=[],$t=rt.length;Pt<$t;Pt++)(rt[Pt].fn!==De||Ze&&!rt[Pt].once||ne&&rt[Pt].context!==ne)&&Ct.push(rt[Pt]);Ct.length?this._events[nt]=Ct.length===1?Ct[0]:Ct:de(this,nt)}return this},j.prototype.removeAllListeners=function(ie){var De;return ie?(De=Z?Z+ie:ie,this._events[De]&&de(this,De)):(this._events=new ge,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=Z,j.EventEmitter=j,vr.exports=j},50840:function(vr,se,Z){var ge;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(oe,_,de,j){"use strict";var ue=["","webkit","Moz","MS","ms","o"],ie=_.createElement("div"),De="function",ne=Math.round,Ze=Math.abs,nt=Date.now;function rt(re,Oe,gt){return setTimeout(Fr(re,gt),Oe)}function Pt(re,Oe,gt){return Array.isArray(re)?(Ct(re,gt[Oe],gt),!0):!1}function Ct(re,Oe,gt){var ur;if(!!re)if(re.forEach)re.forEach(Oe,gt);else if(re.length!==j)for(ur=0;ur<re.length;)Oe.call(gt,re[ur],ur,re),ur++;else for(ur in re)re.hasOwnProperty(ur)&&Oe.call(gt,re[ur],ur,re)}function $t(re,Oe,gt){var ur="DEPRECATED METHOD: "+Oe+`
`+gt+` AT 
`;return function(){var Jr=new Error("get-stack-trace"),Ln=Jr&&Jr.stack?Jr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zi=oe.console&&(oe.console.warn||oe.console.log);return Zi&&Zi.call(oe.console,ur,Ln),re.apply(this,arguments)}}var rr;typeof Object.assign!="function"?rr=function(Oe){if(Oe===j||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var gt=Object(Oe),ur=1;ur<arguments.length;ur++){var Jr=arguments[ur];if(Jr!==j&&Jr!==null)for(var Ln in Jr)Jr.hasOwnProperty(Ln)&&(gt[Ln]=Jr[Ln])}return gt}:rr=Object.assign;var zt=$t(function(Oe,gt,ur){for(var Jr=Object.keys(gt),Ln=0;Ln<Jr.length;)(!ur||ur&&Oe[Jr[Ln]]===j)&&(Oe[Jr[Ln]]=gt[Jr[Ln]]),Ln++;return Oe},"extend","Use `assign`."),Mt=$t(function(Oe,gt){return zt(Oe,gt,!0)},"merge","Use `assign`.");function Et(re,Oe,gt){var ur=Oe.prototype,Jr;Jr=re.prototype=Object.create(ur),Jr.constructor=re,Jr._super=ur,gt&&rr(Jr,gt)}function Fr(re,Oe){return function(){return re.apply(Oe,arguments)}}function Ar(re,Oe){return typeof re==De?re.apply(Oe&&Oe[0]||j,Oe):re}function dr(re,Oe){return re===j?Oe:re}function It(re,Oe,gt){Ct(sr(Oe),function(ur){re.addEventListener(ur,gt,!1)})}function ct(re,Oe,gt){Ct(sr(Oe),function(ur){re.removeEventListener(ur,gt,!1)})}function Ft(re,Oe){for(;re;){if(re==Oe)return!0;re=re.parentNode}return!1}function ht(re,Oe){return re.indexOf(Oe)>-1}function sr(re){return re.trim().split(/\s+/g)}function br(re,Oe,gt){if(re.indexOf&&!gt)return re.indexOf(Oe);for(var ur=0;ur<re.length;){if(gt&&re[ur][gt]==Oe||!gt&&re[ur]===Oe)return ur;ur++}return-1}function te(re){return Array.prototype.slice.call(re,0)}function Ne(re,Oe,gt){for(var ur=[],Jr=[],Ln=0;Ln<re.length;){var Zi=Oe?re[Ln][Oe]:re[Ln];br(Jr,Zi)<0&&ur.push(re[Ln]),Jr[Ln]=Zi,Ln++}return gt&&(Oe?ur=ur.sort(function(bo,io){return bo[Oe]>io[Oe]}):ur=ur.sort()),ur}function O(re,Oe){for(var gt,ur,Jr=Oe[0].toUpperCase()+Oe.slice(1),Ln=0;Ln<ue.length;){if(gt=ue[Ln],ur=gt?gt+Jr:Oe,ur in re)return ur;Ln++}return j}var Pe=1;function Ce(){return Pe++}function pt(re){var Oe=re.ownerDocument||re;return Oe.defaultView||Oe.parentWindow||oe}var Ye=/mobile|tablet|ip(ad|hone|od)|android/i,We="ontouchstart"in oe,ot=O(oe,"PointerEvent")!==j,Tt=We&&Ye.test(navigator.userAgent),gr="touch",wt="pen",hn="mouse",Hr="kinect",Vr=25,qn=1,Nn=2,dn=4,Ci=8,di=1,ta=2,Rn=4,Bn=8,_a=16,Hi=ta|Rn,Wa=Bn|_a,Ga=Hi|Wa,Re=["x","y"],Xa=["clientX","clientY"];function ua(re,Oe){var gt=this;this.manager=re,this.callback=Oe,this.element=re.element,this.target=re.options.inputTarget,this.domHandler=function(ur){Ar(re.options.enable,[re])&&gt.handler(ur)},this.init()}ua.prototype={handler:function(){},init:function(){this.evEl&&It(this.element,this.evEl,this.domHandler),this.evTarget&&It(this.target,this.evTarget,this.domHandler),this.evWin&&It(pt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ct(this.element,this.evEl,this.domHandler),this.evTarget&&ct(this.target,this.evTarget,this.domHandler),this.evWin&&ct(pt(this.element),this.evWin,this.domHandler)}};function to(re){var Oe,gt=re.options.inputClass;return gt?Oe=gt:ot?Oe=N:Tt?Oe=ye:We?Oe=yr:Oe=Ht,new Oe(re,Zs)}function Zs(re,Oe,gt){var ur=gt.pointers.length,Jr=gt.changedPointers.length,Ln=Oe&qn&&ur-Jr==0,Zi=Oe&(dn|Ci)&&ur-Jr==0;gt.isFirst=!!Ln,gt.isFinal=!!Zi,Ln&&(re.session={}),gt.eventType=Oe,xs(re,gt),re.emit("hammer.input",gt),re.recognize(gt),re.session.prevInput=gt}function xs(re,Oe){var gt=re.session,ur=Oe.pointers,Jr=ur.length;gt.firstInput||(gt.firstInput=xr(Oe)),Jr>1&&!gt.firstMultiple?gt.firstMultiple=xr(Oe):Jr===1&&(gt.firstMultiple=!1);var Ln=gt.firstInput,Zi=gt.firstMultiple,so=Zi?Zi.center:Ln.center,bo=Oe.center=Yr(ur);Oe.timeStamp=nt(),Oe.deltaTime=Oe.timeStamp-Ln.timeStamp,Oe.angle=fe(so,bo),Oe.distance=Wi(so,bo),bs(gt,Oe),Oe.offsetDirection=Vn(Oe.deltaX,Oe.deltaY);var io=sn(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=io.x,Oe.overallVelocityY=io.y,Oe.overallVelocity=Ze(io.x)>Ze(io.y)?io.x:io.y,Oe.scale=Zi?z(Zi.pointers,ur):1,Oe.rotation=Zi?D(Zi.pointers,ur):0,Oe.maxPointers=gt.prevInput?Oe.pointers.length>gt.prevInput.maxPointers?Oe.pointers.length:gt.prevInput.maxPointers:Oe.pointers.length,Wt(gt,Oe);var Ms=re.element;Ft(Oe.srcEvent.target,Ms)&&(Ms=Oe.srcEvent.target),Oe.target=Ms}function bs(re,Oe){var gt=Oe.center,ur=re.offsetDelta||{},Jr=re.prevDelta||{},Ln=re.prevInput||{};(Oe.eventType===qn||Ln.eventType===dn)&&(Jr=re.prevDelta={x:Ln.deltaX||0,y:Ln.deltaY||0},ur=re.offsetDelta={x:gt.x,y:gt.y}),Oe.deltaX=Jr.x+(gt.x-ur.x),Oe.deltaY=Jr.y+(gt.y-ur.y)}function Wt(re,Oe){var gt=re.lastInterval||Oe,ur=Oe.timeStamp-gt.timeStamp,Jr,Ln,Zi,so;if(Oe.eventType!=Ci&&(ur>Vr||gt.velocity===j)){var bo=Oe.deltaX-gt.deltaX,io=Oe.deltaY-gt.deltaY,Ms=sn(ur,bo,io);Ln=Ms.x,Zi=Ms.y,Jr=Ze(Ms.x)>Ze(Ms.y)?Ms.x:Ms.y,so=Vn(bo,io),re.lastInterval=Oe}else Jr=gt.velocity,Ln=gt.velocityX,Zi=gt.velocityY,so=gt.direction;Oe.velocity=Jr,Oe.velocityX=Ln,Oe.velocityY=Zi,Oe.direction=so}function xr(re){for(var Oe=[],gt=0;gt<re.pointers.length;)Oe[gt]={clientX:ne(re.pointers[gt].clientX),clientY:ne(re.pointers[gt].clientY)},gt++;return{timeStamp:nt(),pointers:Oe,center:Yr(Oe),deltaX:re.deltaX,deltaY:re.deltaY}}function Yr(re){var Oe=re.length;if(Oe===1)return{x:ne(re[0].clientX),y:ne(re[0].clientY)};for(var gt=0,ur=0,Jr=0;Jr<Oe;)gt+=re[Jr].clientX,ur+=re[Jr].clientY,Jr++;return{x:ne(gt/Oe),y:ne(ur/Oe)}}function sn(re,Oe,gt){return{x:Oe/re||0,y:gt/re||0}}function Vn(re,Oe){return re===Oe?di:Ze(re)>=Ze(Oe)?re<0?ta:Rn:Oe<0?Bn:_a}function Wi(re,Oe,gt){gt||(gt=Re);var ur=Oe[gt[0]]-re[gt[0]],Jr=Oe[gt[1]]-re[gt[1]];return Math.sqrt(ur*ur+Jr*Jr)}function fe(re,Oe,gt){gt||(gt=Re);var ur=Oe[gt[0]]-re[gt[0]],Jr=Oe[gt[1]]-re[gt[1]];return Math.atan2(Jr,ur)*180/Math.PI}function D(re,Oe){return fe(Oe[1],Oe[0],Xa)+fe(re[1],re[0],Xa)}function z(re,Oe){return Wi(Oe[0],Oe[1],Xa)/Wi(re[0],re[1],Xa)}var ae={mousedown:qn,mousemove:Nn,mouseup:dn},Se="mousedown",Le="mousemove mouseup";function Ht(){this.evEl=Se,this.evWin=Le,this.pressed=!1,ua.apply(this,arguments)}Et(Ht,ua,{handler:function(Oe){var gt=ae[Oe.type];gt&qn&&Oe.button===0&&(this.pressed=!0),gt&Nn&&Oe.which!==1&&(gt=dn),!!this.pressed&&(gt&dn&&(this.pressed=!1),this.callback(this.manager,gt,{pointers:[Oe],changedPointers:[Oe],pointerType:hn,srcEvent:Oe}))}});var Ot={pointerdown:qn,pointermove:Nn,pointerup:dn,pointercancel:Ci,pointerout:Ci},kt={2:gr,3:wt,4:hn,5:Hr},yt="pointerdown",U="pointermove pointerup pointercancel";oe.MSPointerEvent&&!oe.PointerEvent&&(yt="MSPointerDown",U="MSPointerMove MSPointerUp MSPointerCancel");function N(){this.evEl=yt,this.evWin=U,ua.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Et(N,ua,{handler:function(Oe){var gt=this.store,ur=!1,Jr=Oe.type.toLowerCase().replace("ms",""),Ln=Ot[Jr],Zi=kt[Oe.pointerType]||Oe.pointerType,so=Zi==gr,bo=br(gt,Oe.pointerId,"pointerId");Ln&qn&&(Oe.button===0||so)?bo<0&&(gt.push(Oe),bo=gt.length-1):Ln&(dn|Ci)&&(ur=!0),!(bo<0)&&(gt[bo]=Oe,this.callback(this.manager,Ln,{pointers:gt,changedPointers:[Oe],pointerType:Zi,srcEvent:Oe}),ur&&gt.splice(bo,1))}});var X={touchstart:qn,touchmove:Nn,touchend:dn,touchcancel:Ci},ee="touchstart",Ee="touchstart touchmove touchend touchcancel";function Ue(){this.evTarget=ee,this.evWin=Ee,this.started=!1,ua.apply(this,arguments)}Et(Ue,ua,{handler:function(Oe){var gt=X[Oe.type];if(gt===qn&&(this.started=!0),!!this.started){var ur=et.call(this,Oe,gt);gt&(dn|Ci)&&ur[0].length-ur[1].length==0&&(this.started=!1),this.callback(this.manager,gt,{pointers:ur[0],changedPointers:ur[1],pointerType:gr,srcEvent:Oe})}}});function et(re,Oe){var gt=te(re.touches),ur=te(re.changedTouches);return Oe&(dn|Ci)&&(gt=Ne(gt.concat(ur),"identifier",!0)),[gt,ur]}var he={touchstart:qn,touchmove:Nn,touchend:dn,touchcancel:Ci},Q="touchstart touchmove touchend touchcancel";function ye(){this.evTarget=Q,this.targetIds={},ua.apply(this,arguments)}Et(ye,ua,{handler:function(Oe){var gt=he[Oe.type],ur=Je.call(this,Oe,gt);!ur||this.callback(this.manager,gt,{pointers:ur[0],changedPointers:ur[1],pointerType:gr,srcEvent:Oe})}});function Je(re,Oe){var gt=te(re.touches),ur=this.targetIds;if(Oe&(qn|Nn)&&gt.length===1)return ur[gt[0].identifier]=!0,[gt,gt];var Jr,Ln,Zi=te(re.changedTouches),so=[],bo=this.target;if(Ln=gt.filter(function(io){return Ft(io.target,bo)}),Oe===qn)for(Jr=0;Jr<Ln.length;)ur[Ln[Jr].identifier]=!0,Jr++;for(Jr=0;Jr<Zi.length;)ur[Zi[Jr].identifier]&&so.push(Zi[Jr]),Oe&(dn|Ci)&&delete ur[Zi[Jr].identifier],Jr++;if(!!so.length)return[Ne(Ln.concat(so),"identifier",!0),so]}var _t=2500,pe=25;function yr(){ua.apply(this,arguments);var re=Fr(this.handler,this);this.touch=new ye(this.manager,re),this.mouse=new Ht(this.manager,re),this.primaryTouch=null,this.lastTouches=[]}Et(yr,ua,{handler:function(Oe,gt,ur){var Jr=ur.pointerType==gr,Ln=ur.pointerType==hn;if(!(Ln&&ur.sourceCapabilities&&ur.sourceCapabilities.firesTouchEvents)){if(Jr)tn.call(this,gt,ur);else if(Ln&&Jt.call(this,ur))return;this.callback(Oe,gt,ur)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function tn(re,Oe){re&qn?(this.primaryTouch=Oe.changedPointers[0].identifier,rn.call(this,Oe)):re&(dn|Ci)&&rn.call(this,Oe)}function rn(re){var Oe=re.changedPointers[0];if(Oe.identifier===this.primaryTouch){var gt={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(gt);var ur=this.lastTouches,Jr=function(){var Ln=ur.indexOf(gt);Ln>-1&&ur.splice(Ln,1)};setTimeout(Jr,_t)}}function Jt(re){for(var Oe=re.srcEvent.clientX,gt=re.srcEvent.clientY,ur=0;ur<this.lastTouches.length;ur++){var Jr=this.lastTouches[ur],Ln=Math.abs(Oe-Jr.x),Zi=Math.abs(gt-Jr.y);if(Ln<=pe&&Zi<=pe)return!0}return!1}var Kr=O(ie.style,"touchAction"),Nr=Kr!==j,Xr="compute",si="auto",un="manipulation",vi="none",Ni="pan-x",yi="pan-y",Mi=Qi();function Ii(re,Oe){this.manager=re,this.set(Oe)}Ii.prototype={set:function(re){re==Xr&&(re=this.compute()),Nr&&this.manager.element.style&&Mi[re]&&(this.manager.element.style[Kr]=re),this.actions=re.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var re=[];return Ct(this.manager.recognizers,function(Oe){Ar(Oe.options.enable,[Oe])&&(re=re.concat(Oe.getTouchAction()))}),xo(re.join(" "))},preventDefaults:function(re){var Oe=re.srcEvent,gt=re.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var ur=this.actions,Jr=ht(ur,vi)&&!Mi[vi],Ln=ht(ur,yi)&&!Mi[yi],Zi=ht(ur,Ni)&&!Mi[Ni];if(Jr){var so=re.pointers.length===1,bo=re.distance<2,io=re.deltaTime<250;if(so&&bo&&io)return}if(!(Zi&&Ln)&&(Jr||Ln&&gt&Hi||Zi&&gt&Wa))return this.preventSrc(Oe)},preventSrc:function(re){this.manager.session.prevented=!0,re.preventDefault()}};function xo(re){if(ht(re,vi))return vi;var Oe=ht(re,Ni),gt=ht(re,yi);return Oe&&gt?vi:Oe||gt?Oe?Ni:yi:ht(re,un)?un:si}function Qi(){if(!Nr)return!1;var re={},Oe=oe.CSS&&oe.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(gt){re[gt]=Oe?oe.CSS.supports("touch-action",gt):!0}),re}var xa=1,Pi=2,_i=4,Ti=8,Ca=Ti,Vs=16,ca=32;function Ra(re){this.options=rr({},this.defaults,re||{}),this.id=Ce(),this.manager=null,this.options.enable=dr(this.options.enable,!0),this.state=xa,this.simultaneous={},this.requireFail=[]}Ra.prototype={defaults:{},set:function(re){return rr(this.options,re),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(re){if(Pt(re,"recognizeWith",this))return this;var Oe=this.simultaneous;return re=va(re,this),Oe[re.id]||(Oe[re.id]=re,re.recognizeWith(this)),this},dropRecognizeWith:function(re){return Pt(re,"dropRecognizeWith",this)?this:(re=va(re,this),delete this.simultaneous[re.id],this)},requireFailure:function(re){if(Pt(re,"requireFailure",this))return this;var Oe=this.requireFail;return re=va(re,this),br(Oe,re)===-1&&(Oe.push(re),re.requireFailure(this)),this},dropRequireFailure:function(re){if(Pt(re,"dropRequireFailure",this))return this;re=va(re,this);var Oe=br(this.requireFail,re);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(re){return!!this.simultaneous[re.id]},emit:function(re){var Oe=this,gt=this.state;function ur(Jr){Oe.manager.emit(Jr,re)}gt<Ti&&ur(Oe.options.event+qu(gt)),ur(Oe.options.event),re.additionalEvent&&ur(re.additionalEvent),gt>=Ti&&ur(Oe.options.event+qu(gt))},tryEmit:function(re){if(this.canEmit())return this.emit(re);this.state=ca},canEmit:function(){for(var re=0;re<this.requireFail.length;){if(!(this.requireFail[re].state&(ca|xa)))return!1;re++}return!0},recognize:function(re){var Oe=rr({},re);if(!Ar(this.options.enable,[this,Oe])){this.reset(),this.state=ca;return}this.state&(Ca|Vs|ca)&&(this.state=xa),this.state=this.process(Oe),this.state&(Pi|_i|Ti|Vs)&&this.tryEmit(Oe)},process:function(re){},getTouchAction:function(){},reset:function(){}};function qu(re){return re&Vs?"cancel":re&Ti?"end":re&_i?"move":re&Pi?"start":""}function tu(re){return re==_a?"down":re==Bn?"up":re==ta?"left":re==Rn?"right":""}function va(re,Oe){var gt=Oe.manager;return gt?gt.get(re):re}function ls(){Ra.apply(this,arguments)}Et(ls,Ra,{defaults:{pointers:1},attrTest:function(re){var Oe=this.options.pointers;return Oe===0||re.pointers.length===Oe},process:function(re){var Oe=this.state,gt=re.eventType,ur=Oe&(Pi|_i),Jr=this.attrTest(re);return ur&&(gt&Ci||!Jr)?Oe|Vs:ur||Jr?gt&dn?Oe|Ti:Oe&Pi?Oe|_i:Pi:ca}});function fi(){ls.apply(this,arguments),this.pX=null,this.pY=null}Et(fi,ls,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ga},getTouchAction:function(){var re=this.options.direction,Oe=[];return re&Hi&&Oe.push(yi),re&Wa&&Oe.push(Ni),Oe},directionTest:function(re){var Oe=this.options,gt=!0,ur=re.distance,Jr=re.direction,Ln=re.deltaX,Zi=re.deltaY;return Jr&Oe.direction||(Oe.direction&Hi?(Jr=Ln===0?di:Ln<0?ta:Rn,gt=Ln!=this.pX,ur=Math.abs(re.deltaX)):(Jr=Zi===0?di:Zi<0?Bn:_a,gt=Zi!=this.pY,ur=Math.abs(re.deltaY))),re.direction=Jr,gt&&ur>Oe.threshold&&Jr&Oe.direction},attrTest:function(re){return ls.prototype.attrTest.call(this,re)&&(this.state&Pi||!(this.state&Pi)&&this.directionTest(re))},emit:function(re){this.pX=re.deltaX,this.pY=re.deltaY;var Oe=tu(re.direction);Oe&&(re.additionalEvent=this.options.event+Oe),this._super.emit.call(this,re)}});function ia(){ls.apply(this,arguments)}Et(ia,ls,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[vi]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.scale-1)>this.options.threshold||this.state&Pi)},emit:function(re){if(re.scale!==1){var Oe=re.scale<1?"in":"out";re.additionalEvent=this.options.event+Oe}this._super.emit.call(this,re)}});function Ma(){Ra.apply(this,arguments),this._timer=null,this._input=null}Et(Ma,Ra,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[si]},process:function(re){var Oe=this.options,gt=re.pointers.length===Oe.pointers,ur=re.distance<Oe.threshold,Jr=re.deltaTime>Oe.time;if(this._input=re,!ur||!gt||re.eventType&(dn|Ci)&&!Jr)this.reset();else if(re.eventType&qn)this.reset(),this._timer=rt(function(){this.state=Ca,this.tryEmit()},Oe.time,this);else if(re.eventType&dn)return Ca;return ca},reset:function(){clearTimeout(this._timer)},emit:function(re){this.state===Ca&&(re&&re.eventType&dn?this.manager.emit(this.options.event+"up",re):(this._input.timeStamp=nt(),this.manager.emit(this.options.event,this._input)))}});function aa(){ls.apply(this,arguments)}Et(aa,ls,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[vi]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.rotation)>this.options.threshold||this.state&Pi)}});function Jo(){ls.apply(this,arguments)}Et(Jo,ls,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Hi|Wa,pointers:1},getTouchAction:function(){return fi.prototype.getTouchAction.call(this)},attrTest:function(re){var Oe=this.options.direction,gt;return Oe&(Hi|Wa)?gt=re.overallVelocity:Oe&Hi?gt=re.overallVelocityX:Oe&Wa&&(gt=re.overallVelocityY),this._super.attrTest.call(this,re)&&Oe&re.offsetDirection&&re.distance>this.options.threshold&&re.maxPointers==this.options.pointers&&Ze(gt)>this.options.velocity&&re.eventType&dn},emit:function(re){var Oe=tu(re.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,re),this.manager.emit(this.options.event,re)}});function jo(){Ra.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Et(jo,Ra,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[un]},process:function(re){var Oe=this.options,gt=re.pointers.length===Oe.pointers,ur=re.distance<Oe.threshold,Jr=re.deltaTime<Oe.time;if(this.reset(),re.eventType&qn&&this.count===0)return this.failTimeout();if(ur&&Jr&&gt){if(re.eventType!=dn)return this.failTimeout();var Ln=this.pTime?re.timeStamp-this.pTime<Oe.interval:!0,Zi=!this.pCenter||Wi(this.pCenter,re.center)<Oe.posThreshold;this.pTime=re.timeStamp,this.pCenter=re.center,!Zi||!Ln?this.count=1:this.count+=1,this._input=re;var so=this.count%Oe.taps;if(so===0)return this.hasRequireFailures()?(this._timer=rt(function(){this.state=Ca,this.tryEmit()},Oe.interval,this),Pi):Ca}return ca},failTimeout:function(){return this._timer=rt(function(){this.state=ca},this.options.interval,this),ca},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ca&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Pu(re,Oe){return Oe=Oe||{},Oe.recognizers=dr(Oe.recognizers,Pu.defaults.preset),new Fa(re,Oe)}Pu.VERSION="2.0.7",Pu.defaults={domEvents:!1,touchAction:Xr,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[ia,{enable:!1},["rotate"]],[Jo,{direction:Hi}],[fi,{direction:Hi},["swipe"]],[jo],[jo,{event:"doubletap",taps:2},["tap"]],[Ma]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Rs=1,pc=2;function Fa(re,Oe){this.options=rr({},Pu.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||re,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=re,this.input=to(this),this.touchAction=new Ii(this,this.options.touchAction),zi(this,!0),Ct(this.options.recognizers,function(gt){var ur=this.add(new gt[0](gt[1]));gt[2]&&ur.recognizeWith(gt[2]),gt[3]&&ur.requireFailure(gt[3])},this)}Fa.prototype={set:function(re){return rr(this.options,re),re.touchAction&&this.touchAction.update(),re.inputTarget&&(this.input.destroy(),this.input.target=re.inputTarget,this.input.init()),this},stop:function(re){this.session.stopped=re?pc:Rs},recognize:function(re){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(re);var gt,ur=this.recognizers,Jr=Oe.curRecognizer;(!Jr||Jr&&Jr.state&Ca)&&(Jr=Oe.curRecognizer=null);for(var Ln=0;Ln<ur.length;)gt=ur[Ln],Oe.stopped!==pc&&(!Jr||gt==Jr||gt.canRecognizeWith(Jr))?gt.recognize(re):gt.reset(),!Jr&&gt.state&(Pi|_i|Ti)&&(Jr=Oe.curRecognizer=gt),Ln++}},get:function(re){if(re instanceof Ra)return re;for(var Oe=this.recognizers,gt=0;gt<Oe.length;gt++)if(Oe[gt].options.event==re)return Oe[gt];return null},add:function(re){if(Pt(re,"add",this))return this;var Oe=this.get(re.options.event);return Oe&&this.remove(Oe),this.recognizers.push(re),re.manager=this,this.touchAction.update(),re},remove:function(re){if(Pt(re,"remove",this))return this;if(re=this.get(re),re){var Oe=this.recognizers,gt=br(Oe,re);gt!==-1&&(Oe.splice(gt,1),this.touchAction.update())}return this},on:function(re,Oe){if(re!==j&&Oe!==j){var gt=this.handlers;return Ct(sr(re),function(ur){gt[ur]=gt[ur]||[],gt[ur].push(Oe)}),this}},off:function(re,Oe){if(re!==j){var gt=this.handlers;return Ct(sr(re),function(ur){Oe?gt[ur]&&gt[ur].splice(br(gt[ur],Oe),1):delete gt[ur]}),this}},emit:function(re,Oe){this.options.domEvents&&Ho(re,Oe);var gt=this.handlers[re]&&this.handlers[re].slice();if(!(!gt||!gt.length)){Oe.type=re,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var ur=0;ur<gt.length;)gt[ur](Oe),ur++}},destroy:function(){this.element&&zi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function zi(re,Oe){var gt=re.element;if(!!gt.style){var ur;Ct(re.options.cssProps,function(Jr,Ln){ur=O(gt.style,Ln),Oe?(re.oldCssProps[ur]=gt.style[ur],gt.style[ur]=Jr):gt.style[ur]=re.oldCssProps[ur]||""}),Oe||(re.oldCssProps={})}}function Ho(re,Oe){var gt=_.createEvent("Event");gt.initEvent(re,!0,!0),gt.gesture=Oe,Oe.target.dispatchEvent(gt)}rr(Pu,{INPUT_START:qn,INPUT_MOVE:Nn,INPUT_END:dn,INPUT_CANCEL:Ci,STATE_POSSIBLE:xa,STATE_BEGAN:Pi,STATE_CHANGED:_i,STATE_ENDED:Ti,STATE_RECOGNIZED:Ca,STATE_CANCELLED:Vs,STATE_FAILED:ca,DIRECTION_NONE:di,DIRECTION_LEFT:ta,DIRECTION_RIGHT:Rn,DIRECTION_UP:Bn,DIRECTION_DOWN:_a,DIRECTION_HORIZONTAL:Hi,DIRECTION_VERTICAL:Wa,DIRECTION_ALL:Ga,Manager:Fa,Input:ua,TouchAction:Ii,TouchInput:ye,MouseInput:Ht,PointerEventInput:N,TouchMouseInput:yr,SingleTouchInput:Ue,Recognizer:Ra,AttrRecognizer:ls,Tap:jo,Pan:fi,Swipe:Jo,Pinch:ia,Rotate:aa,Press:Ma,on:It,off:ct,each:Ct,merge:Mt,extend:zt,assign:rr,inherit:Et,bindFn:Fr,prefixed:O});var Yt=typeof oe!="undefined"?oe:typeof self!="undefined"?self:{};Yt.Hammer=Pu,ge=function(){return Pu}.call(se,Z,se,vr),ge!==j&&(vr.exports=ge)})(window,document,"Hammer")},80645:function(vr,se){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */se.read=function(Z,ge,oe,_,de){var j,ue,ie=de*8-_-1,De=(1<<ie)-1,ne=De>>1,Ze=-7,nt=oe?de-1:0,rt=oe?-1:1,Pt=Z[ge+nt];for(nt+=rt,j=Pt&(1<<-Ze)-1,Pt>>=-Ze,Ze+=ie;Ze>0;j=j*256+Z[ge+nt],nt+=rt,Ze-=8);for(ue=j&(1<<-Ze)-1,j>>=-Ze,Ze+=_;Ze>0;ue=ue*256+Z[ge+nt],nt+=rt,Ze-=8);if(j===0)j=1-ne;else{if(j===De)return ue?NaN:(Pt?-1:1)*Infinity;ue=ue+Math.pow(2,_),j=j-ne}return(Pt?-1:1)*ue*Math.pow(2,j-_)},se.write=function(Z,ge,oe,_,de,j){var ue,ie,De,ne=j*8-de-1,Ze=(1<<ne)-1,nt=Ze>>1,rt=de===23?Math.pow(2,-24)-Math.pow(2,-77):0,Pt=_?0:j-1,Ct=_?1:-1,$t=ge<0||ge===0&&1/ge<0?1:0;for(ge=Math.abs(ge),isNaN(ge)||ge===Infinity?(ie=isNaN(ge)?1:0,ue=Ze):(ue=Math.floor(Math.log(ge)/Math.LN2),ge*(De=Math.pow(2,-ue))<1&&(ue--,De*=2),ue+nt>=1?ge+=rt/De:ge+=rt*Math.pow(2,1-nt),ge*De>=2&&(ue++,De/=2),ue+nt>=Ze?(ie=0,ue=Ze):ue+nt>=1?(ie=(ge*De-1)*Math.pow(2,de),ue=ue+nt):(ie=ge*Math.pow(2,nt-1)*Math.pow(2,de),ue=0));de>=8;Z[oe+Pt]=ie&255,Pt+=Ct,ie/=256,de-=8);for(ue=ue<<de|ie,ne+=de;ne>0;Z[oe+Pt]=ue&255,Pt+=Ct,ue/=256,ne-=8);Z[oe+Pt-Ct]|=$t*128}},7375:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0});var Z=Symbol.for("INJECTION");function ge(ue,ie,De,ne){function Ze(){return ne&&!Reflect.hasMetadata(Z,this,ie)&&Reflect.defineMetadata(Z,De(),this,ie),Reflect.hasMetadata(Z,this,ie)?Reflect.getMetadata(Z,this,ie):De()}function nt(rt){Reflect.defineMetadata(Z,rt,this,ie)}Object.defineProperty(ue,ie,{configurable:!0,enumerable:!0,get:Ze,set:nt})}function oe(ue,ie){return function(De){return function(ne,Ze){var nt=function(){return ue.get(De)};ge(ne,Ze,nt,ie)}}}se.makePropertyInjectDecorator=oe;function _(ue,ie){return function(De,ne){return function(Ze,nt){var rt=function(){return ue.getNamed(De,ne)};ge(Ze,nt,rt,ie)}}}se.makePropertyInjectNamedDecorator=_;function de(ue,ie){return function(De,ne,Ze){return function(nt,rt){var Pt=function(){return ue.getTagged(De,ne,Ze)};ge(nt,rt,Pt,ie)}}}se.makePropertyInjectTaggedDecorator=de;function j(ue,ie){return function(De){return function(ne,Ze){var nt=function(){return ue.getAll(De)};ge(ne,Ze,nt,ie)}}}se.makePropertyMultiInjectDecorator=j},84879:function(vr,se,Z){"use strict";var ge;ge={value:!0};var oe=Z(7375);function _(de,j){j===void 0&&(j=!0);var ue=oe.makePropertyInjectDecorator(de,j),ie=oe.makePropertyInjectNamedDecorator(de,j),De=oe.makePropertyInjectTaggedDecorator(de,j),ne=oe.makePropertyMultiInjectDecorator(de,j);return{lazyInject:ue,lazyInjectNamed:ie,lazyInjectTagged:De,lazyMultiInject:ne}}se.Z=_},99934:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.tagProperty=se.tagParameter=se.decorate=void 0;var ge=Z(16674),oe=Z(6867);function _(ne,Ze,nt,rt){var Pt=oe.TAGGED;j(Pt,ne,Ze,rt,nt)}se.tagParameter=_;function de(ne,Ze,nt){var rt=oe.TAGGED_PROP;j(rt,ne.constructor,Ze,nt)}se.tagProperty=de;function j(ne,Ze,nt,rt,Pt){var Ct={},$t=typeof Pt=="number",rr=Pt!==void 0&&$t?Pt.toString():nt;if($t&&nt!==void 0)throw new Error(ge.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,Ze)&&(Ct=Reflect.getMetadata(ne,Ze));var zt=Ct[rr];if(!Array.isArray(zt))zt=[];else for(var Mt=0,Et=zt;Mt<Et.length;Mt++){var Fr=Et[Mt];if(Fr.key===rt.key)throw new Error(ge.DUPLICATED_METADATA+" "+Fr.key.toString())}zt.push(rt),Ct[rr]=zt,Reflect.defineMetadata(ne,Ct,Ze)}function ue(ne,Ze){Reflect.decorate(ne,Ze)}function ie(ne,Ze){return function(nt,rt){Ze(nt,rt,ne)}}function De(ne,Ze,nt){typeof nt=="number"?ue([ie(nt,ne)],Ze):typeof nt=="string"?Reflect.decorate([ne],Ze,nt):ue([ne],Ze)}se.decorate=De},5744:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.inject=se.LazyServiceIdentifer=void 0;var ge=Z(16674),oe=Z(6867),_=Z(47738),de=Z(99934),j=function(){function ie(De){this._cb=De}return ie.prototype.unwrap=function(){return this._cb()},ie}();se.LazyServiceIdentifer=j;function ue(ie){return function(De,ne,Ze){if(ie===void 0)throw new Error(ge.UNDEFINED_INJECT_ANNOTATION(De.name));var nt=new _.Metadata(oe.INJECT_TAG,ie);typeof Ze=="number"?de.tagParameter(De,ne,Ze,nt):de.tagProperty(De,ne,nt)}}se.inject=ue},64315:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.injectable=void 0;var ge=Z(16674),oe=Z(6867);function _(){return function(de){if(Reflect.hasOwnMetadata(oe.PARAM_TYPES,de))throw new Error(ge.DUPLICATED_INJECTABLE_DECORATOR);var j=Reflect.getMetadata(oe.DESIGN_PARAM_TYPES,de)||[];return Reflect.defineMetadata(oe.PARAM_TYPES,j,de),de}}se.injectable=_},71693:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.multiInject=void 0;var ge=Z(6867),oe=Z(47738),_=Z(99934);function de(j){return function(ue,ie,De){var ne=new oe.Metadata(ge.MULTI_INJECT_TAG,j);typeof De=="number"?_.tagParameter(ue,ie,De,ne):_.tagProperty(ue,ie,ne)}}se.multiInject=de},38085:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.named=void 0;var ge=Z(6867),oe=Z(47738),_=Z(99934);function de(j){return function(ue,ie,De){var ne=new oe.Metadata(ge.NAMED_TAG,j);typeof De=="number"?_.tagParameter(ue,ie,De,ne):_.tagProperty(ue,ie,ne)}}se.named=de},6515:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.optional=void 0;var ge=Z(6867),oe=Z(47738),_=Z(99934);function de(){return function(j,ue,ie){var De=new oe.Metadata(ge.OPTIONAL_TAG,!0);typeof ie=="number"?_.tagParameter(j,ue,ie,De):_.tagProperty(j,ue,De)}}se.optional=de},7014:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.postConstruct=void 0;var ge=Z(16674),oe=Z(6867),_=Z(47738);function de(){return function(j,ue,ie){var De=new _.Metadata(oe.POST_CONSTRUCT,ue);if(Reflect.hasOwnMetadata(oe.POST_CONSTRUCT,j.constructor))throw new Error(ge.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(oe.POST_CONSTRUCT,De,j.constructor)}}se.postConstruct=de},32052:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.tagged=void 0;var ge=Z(47738),oe=Z(99934);function _(de,j){return function(ue,ie,De){var ne=new ge.Metadata(de,j);typeof De=="number"?oe.tagParameter(ue,ie,De,ne):oe.tagProperty(ue,ie,ne)}}se.tagged=_},55638:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.targetName=void 0;var ge=Z(6867),oe=Z(47738),_=Z(99934);function de(j){return function(ue,ie,De){var ne=new oe.Metadata(ge.NAME_TAG,j);_.tagParameter(ue,ie,De,ne)}}se.targetName=de},86757:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.unmanaged=void 0;var ge=Z(6867),oe=Z(47738),_=Z(99934);function de(){return function(j,ue,ie){var De=new oe.Metadata(ge.UNMANAGED_TAG,!0);_.tagParameter(j,ue,ie,De)}}se.unmanaged=de},44290:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Binding=void 0;var ge=Z(28421),oe=Z(37791),_=function(){function de(j,ue){this.id=oe.id(),this.activated=!1,this.serviceIdentifier=j,this.scope=ue,this.type=ge.BindingTypeEnum.Invalid,this.constraint=function(ie){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return de.prototype.clone=function(){var j=new de(this.serviceIdentifier,this.scope);return j.activated=j.scope===ge.BindingScopeEnum.Singleton?this.activated:!1,j.implementationType=this.implementationType,j.dynamicValue=this.dynamicValue,j.scope=this.scope,j.type=this.type,j.factory=this.factory,j.provider=this.provider,j.constraint=this.constraint,j.onActivation=this.onActivation,j.cache=this.cache,j},de}();se.Binding=_},23184:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingCount=void 0;var Z={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};se.BindingCount=Z},16674:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.STACK_OVERFLOW=se.CIRCULAR_DEPENDENCY_IN_FACTORY=se.POST_CONSTRUCT_ERROR=se.MULTIPLE_POST_CONSTRUCT_METHODS=se.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=se.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=se.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=se.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=se.ARGUMENTS_LENGTH_MISMATCH=se.INVALID_DECORATOR_OPERATION=se.INVALID_TO_SELF_VALUE=se.INVALID_FUNCTION_BINDING=se.INVALID_MIDDLEWARE_RETURN=se.NO_MORE_SNAPSHOTS_AVAILABLE=se.INVALID_BINDING_TYPE=se.NOT_IMPLEMENTED=se.CIRCULAR_DEPENDENCY=se.UNDEFINED_INJECT_ANNOTATION=se.MISSING_INJECT_ANNOTATION=se.MISSING_INJECTABLE_ANNOTATION=se.NOT_REGISTERED=se.CANNOT_UNBIND=se.AMBIGUOUS_MATCH=se.KEY_NOT_FOUND=se.NULL_ARGUMENT=se.DUPLICATED_METADATA=se.DUPLICATED_INJECTABLE_DECORATOR=void 0,se.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",se.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",se.NULL_ARGUMENT="NULL argument",se.KEY_NOT_FOUND="Key Not Found",se.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",se.CANNOT_UNBIND="Could not unbind serviceIdentifier:",se.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",se.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",se.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Z=function(de){return"@inject called with undefined this could mean that the class "+de+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};se.UNDEFINED_INJECT_ANNOTATION=Z,se.CIRCULAR_DEPENDENCY="Circular dependency found:",se.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",se.INVALID_BINDING_TYPE="Invalid binding type:",se.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",se.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",se.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",se.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",se.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ge=function(){for(var de=[],j=0;j<arguments.length;j++)de[j]=arguments[j];return"The number of constructor arguments in the derived class "+(de[0]+" must be >= than the number of constructor arguments of its base class.")};se.ARGUMENTS_LENGTH_MISMATCH=ge,se.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",se.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",se.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",se.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",se.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var oe=function(){for(var de=[],j=0;j<arguments.length;j++)de[j]=arguments[j];return"@postConstruct error in class "+de[0]+": "+de[1]};se.POST_CONSTRUCT_ERROR=oe;var _=function(){for(var de=[],j=0;j<arguments.length;j++)de[j]=arguments[j];return"It looks like there is a circular dependency "+("in one of the '"+de[0]+"' bindings. Please investigate bindings with")+("service identifier '"+de[1]+"'.")};se.CIRCULAR_DEPENDENCY_IN_FACTORY=_,se.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.TargetTypeEnum=se.BindingTypeEnum=se.BindingScopeEnum=void 0;var Z={Request:"Request",Singleton:"Singleton",Transient:"Transient"};se.BindingScopeEnum=Z;var ge={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};se.BindingTypeEnum=ge;var oe={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};se.TargetTypeEnum=oe},6867:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.NON_CUSTOM_TAG_KEYS=se.POST_CONSTRUCT=se.DESIGN_PARAM_TYPES=se.PARAM_TYPES=se.TAGGED_PROP=se.TAGGED=se.MULTI_INJECT_TAG=se.INJECT_TAG=se.OPTIONAL_TAG=se.UNMANAGED_TAG=se.NAME_TAG=se.NAMED_TAG=void 0,se.NAMED_TAG="named",se.NAME_TAG="name",se.UNMANAGED_TAG="unmanaged",se.OPTIONAL_TAG="optional",se.INJECT_TAG="inject",se.MULTI_INJECT_TAG="multi_inject",se.TAGGED="inversify:tagged",se.TAGGED_PROP="inversify:tagged_props",se.PARAM_TYPES="inversify:paramtypes",se.DESIGN_PARAM_TYPES="design:paramtypes",se.POST_CONSTRUCT="post_construct";function Z(){return[se.INJECT_TAG,se.MULTI_INJECT_TAG,se.NAME_TAG,se.UNMANAGED_TAG,se.NAMED_TAG,se.OPTIONAL_TAG]}se.NON_CUSTOM_TAG_KEYS=Z()},51389:function(vr,se,Z){"use strict";var ge=this&&this.__awaiter||function(zt,Mt,Et,Fr){function Ar(dr){return dr instanceof Et?dr:new Et(function(It){It(dr)})}return new(Et||(Et=Promise))(function(dr,It){function ct(sr){try{ht(Fr.next(sr))}catch(br){It(br)}}function Ft(sr){try{ht(Fr.throw(sr))}catch(br){It(br)}}function ht(sr){sr.done?dr(sr.value):Ar(sr.value).then(ct,Ft)}ht((Fr=Fr.apply(zt,Mt||[])).next())})},oe=this&&this.__generator||function(zt,Mt){var Et={label:0,sent:function(){if(dr[0]&1)throw dr[1];return dr[1]},trys:[],ops:[]},Fr,Ar,dr,It;return It={next:ct(0),throw:ct(1),return:ct(2)},typeof Symbol=="function"&&(It[Symbol.iterator]=function(){return this}),It;function ct(ht){return function(sr){return Ft([ht,sr])}}function Ft(ht){if(Fr)throw new TypeError("Generator is already executing.");for(;Et;)try{if(Fr=1,Ar&&(dr=ht[0]&2?Ar.return:ht[0]?Ar.throw||((dr=Ar.return)&&dr.call(Ar),0):Ar.next)&&!(dr=dr.call(Ar,ht[1])).done)return dr;switch(Ar=0,dr&&(ht=[ht[0]&2,dr.value]),ht[0]){case 0:case 1:dr=ht;break;case 4:return Et.label++,{value:ht[1],done:!1};case 5:Et.label++,Ar=ht[1],ht=[0];continue;case 7:ht=Et.ops.pop(),Et.trys.pop();continue;default:if(dr=Et.trys,!(dr=dr.length>0&&dr[dr.length-1])&&(ht[0]===6||ht[0]===2)){Et=0;continue}if(ht[0]===3&&(!dr||ht[1]>dr[0]&&ht[1]<dr[3])){Et.label=ht[1];break}if(ht[0]===6&&Et.label<dr[1]){Et.label=dr[1],dr=ht;break}if(dr&&Et.label<dr[2]){Et.label=dr[2],Et.ops.push(ht);break}dr[2]&&Et.ops.pop(),Et.trys.pop();continue}ht=Mt.call(zt,Et)}catch(sr){ht=[6,sr],Ar=0}finally{Fr=dr=0}if(ht[0]&5)throw ht[1];return{value:ht[0]?ht[1]:void 0,done:!0}}},_=this&&this.__spreadArray||function(zt,Mt){for(var Et=0,Fr=Mt.length,Ar=zt.length;Et<Fr;Et++,Ar++)zt[Ar]=Mt[Et];return zt};Object.defineProperty(se,"__esModule",{value:!0}),se.Container=void 0;var de=Z(44290),j=Z(16674),ue=Z(28421),ie=Z(6867),De=Z(51377),ne=Z(86311),Ze=Z(31927),nt=Z(15451),rt=Z(37791),Pt=Z(55800),Ct=Z(85700),$t=Z(80175),rr=function(){function zt(Mt){this._appliedMiddleware=[];var Et=Mt||{};if(typeof Et!="object")throw new Error(""+j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Et.defaultScope===void 0)Et.defaultScope=ue.BindingScopeEnum.Transient;else if(Et.defaultScope!==ue.BindingScopeEnum.Singleton&&Et.defaultScope!==ue.BindingScopeEnum.Transient&&Et.defaultScope!==ue.BindingScopeEnum.Request)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Et.autoBindInjectable===void 0)Et.autoBindInjectable=!1;else if(typeof Et.autoBindInjectable!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Et.skipBaseClassChecks===void 0)Et.skipBaseClassChecks=!1;else if(typeof Et.skipBaseClassChecks!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Et.autoBindInjectable,defaultScope:Et.defaultScope,skipBaseClassChecks:Et.skipBaseClassChecks},this.id=rt.id(),this._bindingDictionary=new $t.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new De.MetadataReader}return zt.merge=function(Mt,Et){for(var Fr=[],Ar=2;Ar<arguments.length;Ar++)Fr[Ar-2]=arguments[Ar];var dr=new zt,It=_([Mt,Et],Fr).map(function(ht){return ne.getBindingDictionary(ht)}),ct=ne.getBindingDictionary(dr);function Ft(ht,sr){ht.traverse(function(br,te){te.forEach(function(Ne){sr.add(Ne.serviceIdentifier,Ne.clone())})})}return It.forEach(function(ht){Ft(ht,ct)}),dr},zt.prototype.load=function(){for(var Mt=[],Et=0;Et<arguments.length;Et++)Mt[Et]=arguments[Et];for(var Fr=this._getContainerModuleHelpersFactory(),Ar=0,dr=Mt;Ar<dr.length;Ar++){var It=dr[Ar],ct=Fr(It.id);It.registry(ct.bindFunction,ct.unbindFunction,ct.isboundFunction,ct.rebindFunction)}},zt.prototype.loadAsync=function(){for(var Mt=[],Et=0;Et<arguments.length;Et++)Mt[Et]=arguments[Et];return ge(this,void 0,void 0,function(){var Fr,Ar,dr,It,ct;return oe(this,function(Ft){switch(Ft.label){case 0:Fr=this._getContainerModuleHelpersFactory(),Ar=0,dr=Mt,Ft.label=1;case 1:return Ar<dr.length?(It=dr[Ar],ct=Fr(It.id),[4,It.registry(ct.bindFunction,ct.unbindFunction,ct.isboundFunction,ct.rebindFunction)]):[3,4];case 2:Ft.sent(),Ft.label=3;case 3:return Ar++,[3,1];case 4:return[2]}})})},zt.prototype.unload=function(){for(var Mt=this,Et=[],Fr=0;Fr<arguments.length;Fr++)Et[Fr]=arguments[Fr];var Ar=function(dr){return function(It){return It.moduleId===dr}};Et.forEach(function(dr){var It=Ar(dr.id);Mt._bindingDictionary.removeByCondition(It)})},zt.prototype.bind=function(Mt){var Et=this.options.defaultScope||ue.BindingScopeEnum.Transient,Fr=new de.Binding(Mt,Et);return this._bindingDictionary.add(Mt,Fr),new nt.BindingToSyntax(Fr)},zt.prototype.rebind=function(Mt){return this.unbind(Mt),this.bind(Mt)},zt.prototype.unbind=function(Mt){try{this._bindingDictionary.remove(Mt)}catch(Et){throw new Error(j.CANNOT_UNBIND+" "+Pt.getServiceIdentifierAsString(Mt))}},zt.prototype.unbindAll=function(){this._bindingDictionary=new $t.Lookup},zt.prototype.isBound=function(Mt){var Et=this._bindingDictionary.hasKey(Mt);return!Et&&this.parent&&(Et=this.parent.isBound(Mt)),Et},zt.prototype.isBoundNamed=function(Mt,Et){return this.isBoundTagged(Mt,ie.NAMED_TAG,Et)},zt.prototype.isBoundTagged=function(Mt,Et,Fr){var Ar=!1;if(this._bindingDictionary.hasKey(Mt)){var dr=this._bindingDictionary.get(Mt),It=ne.createMockRequest(this,Mt,Et,Fr);Ar=dr.some(function(ct){return ct.constraint(It)})}return!Ar&&this.parent&&(Ar=this.parent.isBoundTagged(Mt,Et,Fr)),Ar},zt.prototype.snapshot=function(){this._snapshots.push(Ct.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},zt.prototype.restore=function(){var Mt=this._snapshots.pop();if(Mt===void 0)throw new Error(j.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Mt.bindings,this._middleware=Mt.middleware},zt.prototype.createChild=function(Mt){var Et=new zt(Mt||this.options);return Et.parent=this,Et},zt.prototype.applyMiddleware=function(){for(var Mt=[],Et=0;Et<arguments.length;Et++)Mt[Et]=arguments[Et];this._appliedMiddleware=this._appliedMiddleware.concat(Mt);var Fr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Mt.reduce(function(Ar,dr){return dr(Ar)},Fr)},zt.prototype.applyCustomMetadataReader=function(Mt){this._metadataReader=Mt},zt.prototype.get=function(Mt){return this._get(!1,!1,ue.TargetTypeEnum.Variable,Mt)},zt.prototype.getTagged=function(Mt,Et,Fr){return this._get(!1,!1,ue.TargetTypeEnum.Variable,Mt,Et,Fr)},zt.prototype.getNamed=function(Mt,Et){return this.getTagged(Mt,ie.NAMED_TAG,Et)},zt.prototype.getAll=function(Mt){return this._get(!0,!0,ue.TargetTypeEnum.Variable,Mt)},zt.prototype.getAllTagged=function(Mt,Et,Fr){return this._get(!1,!0,ue.TargetTypeEnum.Variable,Mt,Et,Fr)},zt.prototype.getAllNamed=function(Mt,Et){return this.getAllTagged(Mt,ie.NAMED_TAG,Et)},zt.prototype.resolve=function(Mt){var Et=this.createChild();return Et.bind(Mt).toSelf(),this._appliedMiddleware.forEach(function(Fr){Et.applyMiddleware(Fr)}),Et.get(Mt)},zt.prototype._getContainerModuleHelpersFactory=function(){var Mt=this,Et=function(ct,Ft){ct._binding.moduleId=Ft},Fr=function(ct){return function(Ft){var ht=Mt.bind.bind(Mt),sr=ht(Ft);return Et(sr,ct),sr}},Ar=function(ct){return function(Ft){var ht=Mt.unbind.bind(Mt);ht(Ft)}},dr=function(ct){return function(Ft){var ht=Mt.isBound.bind(Mt);return ht(Ft)}},It=function(ct){return function(Ft){var ht=Mt.rebind.bind(Mt),sr=ht(Ft);return Et(sr,ct),sr}};return function(ct){return{bindFunction:Fr(ct),isboundFunction:dr(ct),rebindFunction:It(ct),unbindFunction:Ar(ct)}}},zt.prototype._get=function(Mt,Et,Fr,Ar,dr,It){var ct=null,Ft={avoidConstraints:Mt,contextInterceptor:function(ht){return ht},isMultiInject:Et,key:dr,serviceIdentifier:Ar,targetType:Fr,value:It};if(this._middleware){if(ct=this._middleware(Ft),ct==null)throw new Error(j.INVALID_MIDDLEWARE_RETURN)}else ct=this._planAndResolve()(Ft);return ct},zt.prototype._planAndResolve=function(){var Mt=this;return function(Et){var Fr=ne.plan(Mt._metadataReader,Mt,Et.isMultiInject,Et.targetType,Et.serviceIdentifier,Et.key,Et.value,Et.avoidConstraints);Fr=Et.contextInterceptor(Fr);var Ar=Ze.resolve(Fr);return Ar}},zt}();se.Container=rr},33244:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.AsyncContainerModule=se.ContainerModule=void 0;var ge=Z(37791),oe=function(){function de(j){this.id=ge.id(),this.registry=j}return de}();se.ContainerModule=oe;var _=function(){function de(j){this.id=ge.id(),this.registry=j}return de}();se.AsyncContainerModule=_},85700:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.ContainerSnapshot=void 0;var Z=function(){function ge(){}return ge.of=function(oe,_){var de=new ge;return de.bindings=oe,de.middleware=_,de},ge}();se.ContainerSnapshot=Z},80175:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Lookup=void 0;var ge=Z(16674),oe=function(){function _(){this._map=new Map}return _.prototype.getMap=function(){return this._map},_.prototype.add=function(de,j){if(de==null)throw new Error(ge.NULL_ARGUMENT);if(j==null)throw new Error(ge.NULL_ARGUMENT);var ue=this._map.get(de);ue!==void 0?(ue.push(j),this._map.set(de,ue)):this._map.set(de,[j])},_.prototype.get=function(de){if(de==null)throw new Error(ge.NULL_ARGUMENT);var j=this._map.get(de);if(j!==void 0)return j;throw new Error(ge.KEY_NOT_FOUND)},_.prototype.remove=function(de){if(de==null)throw new Error(ge.NULL_ARGUMENT);if(!this._map.delete(de))throw new Error(ge.KEY_NOT_FOUND)},_.prototype.removeByCondition=function(de){var j=this;this._map.forEach(function(ue,ie){var De=ue.filter(function(ne){return!de(ne)});De.length>0?j._map.set(ie,De):j._map.delete(ie)})},_.prototype.hasKey=function(de){if(de==null)throw new Error(ge.NULL_ARGUMENT);return this._map.has(de)},_.prototype.clone=function(){var de=new _;return this._map.forEach(function(j,ue){j.forEach(function(ie){return de.add(ue,ie.clone())})}),de},_.prototype.traverse=function(de){this._map.forEach(function(j,ue){de(ue,j)})},_}();se.Lookup=oe},86700:function(vr,se,Z){"use strict";var ge;ge={value:!0},ge=ge=ge=ge=ge=ge=se.GW=ge=ge=se.zY=ge=ge=ge=ge=ge=se.f3=ge=ge=se.b2=ge=ge=ge=ge=ge=se.W2=ge=void 0;var oe=Z(6867);ge=oe;var _=Z(51389);Object.defineProperty(se,"W2",{enumerable:!0,get:function(){return _.Container}});var de=Z(28421);ge={enumerable:!0,get:function(){return de.BindingScopeEnum}},ge={enumerable:!0,get:function(){return de.BindingTypeEnum}},ge={enumerable:!0,get:function(){return de.TargetTypeEnum}};var j=Z(33244);ge={enumerable:!0,get:function(){return j.AsyncContainerModule}},ge={enumerable:!0,get:function(){return j.ContainerModule}};var ue=Z(64315);Object.defineProperty(se,"b2",{enumerable:!0,get:function(){return ue.injectable}});var ie=Z(32052);ge={enumerable:!0,get:function(){return ie.tagged}};var De=Z(38085);ge={enumerable:!0,get:function(){return De.named}};var ne=Z(5744);Object.defineProperty(se,"f3",{enumerable:!0,get:function(){return ne.inject}}),ge={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var Ze=Z(6515);ge={enumerable:!0,get:function(){return Ze.optional}};var nt=Z(86757);ge={enumerable:!0,get:function(){return nt.unmanaged}};var rt=Z(71693);ge={enumerable:!0,get:function(){return rt.multiInject}};var Pt=Z(55638);ge={enumerable:!0,get:function(){return Pt.targetName}};var Ct=Z(7014);Object.defineProperty(se,"zY",{enumerable:!0,get:function(){return Ct.postConstruct}});var $t=Z(51377);ge={enumerable:!0,get:function(){return $t.MetadataReader}};var rr=Z(37791);ge={enumerable:!0,get:function(){return rr.id}};var zt=Z(99934);Object.defineProperty(se,"GW",{enumerable:!0,get:function(){return zt.decorate}});var Mt=Z(80758);ge={enumerable:!0,get:function(){return Mt.traverseAncerstors}},ge={enumerable:!0,get:function(){return Mt.taggedConstraint}},ge={enumerable:!0,get:function(){return Mt.namedConstraint}},ge={enumerable:!0,get:function(){return Mt.typeConstraint}};var Et=Z(55800);ge={enumerable:!0,get:function(){return Et.getServiceIdentifierAsString}};var Fr=Z(70600);ge={enumerable:!0,get:function(){return Fr.multiBindToService}}},95228:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Context=void 0;var ge=Z(37791),oe=function(){function _(de){this.id=ge.id(),this.container=de}return _.prototype.addPlan=function(de){this.plan=de},_.prototype.setCurrentRequest=function(de){this.currentRequest=de},_}();se.Context=oe},47738:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Metadata=void 0;var ge=Z(6867),oe=function(){function _(de,j){this.key=de,this.value=j}return _.prototype.toString=function(){return this.key===ge.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},_}();se.Metadata=oe},51377:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.MetadataReader=void 0;var ge=Z(6867),oe=function(){function _(){}return _.prototype.getConstructorMetadata=function(de){var j=Reflect.getMetadata(ge.PARAM_TYPES,de),ue=Reflect.getMetadata(ge.TAGGED,de);return{compilerGeneratedMetadata:j,userGeneratedMetadata:ue||{}}},_.prototype.getPropertiesMetadata=function(de){var j=Reflect.getMetadata(ge.TAGGED_PROP,de)||[];return j},_}();se.MetadataReader=oe},55314:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Plan=void 0;var Z=function(){function ge(oe,_){this.parentContext=oe,this.rootRequest=_}return ge}();se.Plan=Z},86311:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.getBindingDictionary=se.createMockRequest=se.plan=void 0;var ge=Z(23184),oe=Z(16674),_=Z(28421),de=Z(6867),j=Z(85265),ue=Z(55800),ie=Z(95228),De=Z(47738),ne=Z(55314),Ze=Z(6e3),nt=Z(6748),rt=Z(18924);function Pt(Ar){return Ar._bindingDictionary}se.getBindingDictionary=Pt;function Ct(Ar,dr,It,ct,Ft,ht){var sr=Ar?de.MULTI_INJECT_TAG:de.INJECT_TAG,br=new De.Metadata(sr,It),te=new rt.Target(dr,ct,It,br);if(Ft!==void 0){var Ne=new De.Metadata(Ft,ht);te.metadata.push(Ne)}return te}function $t(Ar,dr,It,ct,Ft){var ht=Mt(It.container,Ft.serviceIdentifier),sr=[];return ht.length===ge.BindingCount.NoBindingsAvailable&&It.container.options.autoBindInjectable&&typeof Ft.serviceIdentifier=="function"&&Ar.getConstructorMetadata(Ft.serviceIdentifier).compilerGeneratedMetadata&&(It.container.bind(Ft.serviceIdentifier).toSelf(),ht=Mt(It.container,Ft.serviceIdentifier)),dr?sr=ht:sr=ht.filter(function(br){var te=new nt.Request(br.serviceIdentifier,It,ct,br,Ft);return br.constraint(te)}),rr(Ft.serviceIdentifier,sr,Ft,It.container),sr}function rr(Ar,dr,It,ct){switch(dr.length){case ge.BindingCount.NoBindingsAvailable:if(It.isOptional())return dr;var Ft=ue.getServiceIdentifierAsString(Ar),ht=oe.NOT_REGISTERED;throw ht+=ue.listMetadataForTarget(Ft,It),ht+=ue.listRegisteredBindingsForServiceIdentifier(ct,Ft,Mt),new Error(ht);case ge.BindingCount.OnlyOneBindingAvailable:if(!It.isArray())return dr;case ge.BindingCount.MultipleBindingsAvailable:default:if(It.isArray())return dr;var Ft=ue.getServiceIdentifierAsString(Ar),ht=oe.AMBIGUOUS_MATCH+" "+Ft;throw ht+=ue.listRegisteredBindingsForServiceIdentifier(ct,Ft,Mt),new Error(ht)}}function zt(Ar,dr,It,ct,Ft,ht){var sr,br;if(Ft===null){sr=$t(Ar,dr,ct,null,ht),br=new nt.Request(It,ct,null,sr,ht);var te=new ne.Plan(ct,br);ct.addPlan(te)}else sr=$t(Ar,dr,ct,Ft,ht),br=Ft.addChildRequest(ht.serviceIdentifier,sr,ht);sr.forEach(function(Ne){var O=null;if(ht.isArray())O=br.addChildRequest(Ne.serviceIdentifier,Ne,ht);else{if(Ne.cache)return;O=br}if(Ne.type===_.BindingTypeEnum.Instance&&Ne.implementationType!==null){var Pe=Ze.getDependencies(Ar,Ne.implementationType);if(!ct.container.options.skipBaseClassChecks){var Ce=Ze.getBaseClassDependencyCount(Ar,Ne.implementationType);if(Pe.length<Ce){var pt=oe.ARGUMENTS_LENGTH_MISMATCH(Ze.getFunctionName(Ne.implementationType));throw new Error(pt)}}Pe.forEach(function(Ye){zt(Ar,!1,Ye.serviceIdentifier,ct,O,Ye)})}})}function Mt(Ar,dr){var It=[],ct=Pt(Ar);return ct.hasKey(dr)?It=ct.get(dr):Ar.parent!==null&&(It=Mt(Ar.parent,dr)),It}function Et(Ar,dr,It,ct,Ft,ht,sr,br){br===void 0&&(br=!1);var te=new ie.Context(dr),Ne=Ct(It,ct,Ft,"",ht,sr);try{return zt(Ar,br,Ft,te,null,Ne),te}catch(O){throw j.isStackOverflowExeption(O)&&te.plan&&ue.circularDependencyToException(te.plan.rootRequest),O}}se.plan=Et;function Fr(Ar,dr,It,ct){var Ft=new rt.Target(_.TargetTypeEnum.Variable,"",dr,new De.Metadata(It,ct)),ht=new ie.Context(Ar),sr=new nt.Request(dr,ht,null,[],Ft);return sr}se.createMockRequest=Fr},88460:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.QueryableString=void 0;var Z=function(){function ge(oe){this.str=oe}return ge.prototype.startsWith=function(oe){return this.str.indexOf(oe)===0},ge.prototype.endsWith=function(oe){var _="",de=oe.split("").reverse().join("");return _=this.str.split("").reverse().join(""),this.startsWith.call({str:_},de)},ge.prototype.contains=function(oe){return this.str.indexOf(oe)!==-1},ge.prototype.equals=function(oe){return this.str===oe},ge.prototype.value=function(){return this.str},ge}();se.QueryableString=Z},6e3:function(vr,se,Z){"use strict";var ge=this&&this.__spreadArray||function($t,rr){for(var zt=0,Mt=rr.length,Et=$t.length;zt<Mt;zt++,Et++)$t[Et]=rr[zt];return $t};Object.defineProperty(se,"__esModule",{value:!0}),se.getFunctionName=se.getBaseClassDependencyCount=se.getDependencies=void 0;var oe=Z(5744),_=Z(16674),de=Z(28421),j=Z(6867),ue=Z(55800);Object.defineProperty(se,"getFunctionName",{enumerable:!0,get:function(){return ue.getFunctionName}});var ie=Z(18924);function De($t,rr){var zt=ue.getFunctionName(rr),Mt=ne($t,zt,rr,!1);return Mt}se.getDependencies=De;function ne($t,rr,zt,Mt){var Et=$t.getConstructorMetadata(zt),Fr=Et.compilerGeneratedMetadata;if(Fr===void 0){var Ar=_.MISSING_INJECTABLE_ANNOTATION+" "+rr+".";throw new Error(Ar)}var dr=Et.userGeneratedMetadata,It=Object.keys(dr),ct=zt.length===0&&It.length>0,Ft=It.length>zt.length,ht=ct||Ft?It.length:zt.length,sr=nt(Mt,rr,Fr,dr,ht),br=rt($t,zt),te=ge(ge([],sr),br);return te}function Ze($t,rr,zt,Mt,Et){var Fr=Et[$t.toString()]||[],Ar=Ct(Fr),dr=Ar.unmanaged!==!0,It=Mt[$t],ct=Ar.inject||Ar.multiInject;if(It=ct||It,It instanceof oe.LazyServiceIdentifer&&(It=It.unwrap()),dr){var Ft=It===Object,ht=It===Function,sr=It===void 0,br=Ft||ht||sr;if(!rr&&br){var te=_.MISSING_INJECT_ANNOTATION+" argument "+$t+" in class "+zt+".";throw new Error(te)}var Ne=new ie.Target(de.TargetTypeEnum.ConstructorArgument,Ar.targetName,It);return Ne.metadata=Fr,Ne}return null}function nt($t,rr,zt,Mt,Et){for(var Fr=[],Ar=0;Ar<Et;Ar++){var dr=Ar,It=Ze(dr,$t,rr,zt,Mt);It!==null&&Fr.push(It)}return Fr}function rt($t,rr){for(var zt=$t.getPropertiesMetadata(rr),Mt=[],Et=Object.keys(zt),Fr=0,Ar=Et;Fr<Ar.length;Fr++){var dr=Ar[Fr],It=zt[dr],ct=Ct(zt[dr]),Ft=ct.targetName||dr,ht=ct.inject||ct.multiInject,sr=new ie.Target(de.TargetTypeEnum.ClassProperty,Ft,ht);sr.metadata=It,Mt.push(sr)}var br=Object.getPrototypeOf(rr.prototype).constructor;if(br!==Object){var te=rt($t,br);Mt=ge(ge([],Mt),te)}return Mt}function Pt($t,rr){var zt=Object.getPrototypeOf(rr.prototype).constructor;if(zt!==Object){var Mt=ue.getFunctionName(zt),Et=ne($t,Mt,zt,!0),Fr=Et.map(function(It){return It.metadata.filter(function(ct){return ct.key===j.UNMANAGED_TAG})}),Ar=[].concat.apply([],Fr).length,dr=Et.length-Ar;return dr>0?dr:Pt($t,zt)}else return 0}se.getBaseClassDependencyCount=Pt;function Ct($t){var rr={};return $t.forEach(function(zt){rr[zt.key.toString()]=zt.value}),{inject:rr[j.INJECT_TAG],multiInject:rr[j.MULTI_INJECT_TAG],targetName:rr[j.NAME_TAG],unmanaged:rr[j.UNMANAGED_TAG]}}},6748:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Request=void 0;var ge=Z(37791),oe=function(){function _(de,j,ue,ie,De){this.id=ge.id(),this.serviceIdentifier=de,this.parentContext=j,this.parentRequest=ue,this.target=De,this.childRequests=[],this.bindings=Array.isArray(ie)?ie:[ie],this.requestScope=ue===null?new Map:null}return _.prototype.addChildRequest=function(de,j,ue){var ie=new _(de,this.parentContext,this,j,ue);return this.childRequests.push(ie),ie},_}();se.Request=oe},18924:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.Target=void 0;var ge=Z(6867),oe=Z(37791),_=Z(47738),de=Z(88460),j=function(){function ue(ie,De,ne,Ze){this.id=oe.id(),this.type=ie,this.serviceIdentifier=ne,this.name=new de.QueryableString(De||""),this.metadata=new Array;var nt=null;typeof Ze=="string"?nt=new _.Metadata(ge.NAMED_TAG,Ze):Ze instanceof _.Metadata&&(nt=Ze),nt!==null&&this.metadata.push(nt)}return ue.prototype.hasTag=function(ie){for(var De=0,ne=this.metadata;De<ne.length;De++){var Ze=ne[De];if(Ze.key===ie)return!0}return!1},ue.prototype.isArray=function(){return this.hasTag(ge.MULTI_INJECT_TAG)},ue.prototype.matchesArray=function(ie){return this.matchesTag(ge.MULTI_INJECT_TAG)(ie)},ue.prototype.isNamed=function(){return this.hasTag(ge.NAMED_TAG)},ue.prototype.isTagged=function(){return this.metadata.some(function(ie){return ge.NON_CUSTOM_TAG_KEYS.every(function(De){return ie.key!==De})})},ue.prototype.isOptional=function(){return this.matchesTag(ge.OPTIONAL_TAG)(!0)},ue.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ie){return ie.key===ge.NAMED_TAG})[0]:null},ue.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ie){return ge.NON_CUSTOM_TAG_KEYS.every(function(De){return ie.key!==De})}):null},ue.prototype.matchesNamedTag=function(ie){return this.matchesTag(ge.NAMED_TAG)(ie)},ue.prototype.matchesTag=function(ie){var De=this;return function(ne){for(var Ze=0,nt=De.metadata;Ze<nt.length;Ze++){var rt=nt[Ze];if(rt.key===ie&&rt.value===ne)return!0}return!1}},ue}();se.Target=j},52279:function(vr,se,Z){"use strict";var ge=this&&this.__spreadArray||function(ne,Ze){for(var nt=0,rt=Ze.length,Pt=ne.length;nt<rt;nt++,Pt++)ne[Pt]=Ze[nt];return ne};Object.defineProperty(se,"__esModule",{value:!0}),se.resolveInstance=void 0;var oe=Z(16674),_=Z(28421),de=Z(6867);function j(ne,Ze,nt){var rt=Ze.filter(function(Ct){return Ct.target!==null&&Ct.target.type===_.TargetTypeEnum.ClassProperty}),Pt=rt.map(nt);return rt.forEach(function(Ct,$t){var rr="";rr=Ct.target.name.value();var zt=Pt[$t];ne[rr]=zt}),ne}function ue(ne,Ze){return new(ne.bind.apply(ne,ge([void 0],Ze)))}function ie(ne,Ze){if(Reflect.hasMetadata(de.POST_CONSTRUCT,ne)){var nt=Reflect.getMetadata(de.POST_CONSTRUCT,ne);try{Ze[nt.value]()}catch(rt){throw new Error(oe.POST_CONSTRUCT_ERROR(ne.name,rt.message))}}}function De(ne,Ze,nt){var rt=null;if(Ze.length>0){var Pt=Ze.filter(function($t){return $t.target!==null&&$t.target.type===_.TargetTypeEnum.ConstructorArgument}),Ct=Pt.map(nt);rt=ue(ne,Ct),rt=j(rt,Ze,nt)}else rt=new ne;return ie(ne,rt),rt}se.resolveInstance=De},31927:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.resolve=void 0;var ge=Z(16674),oe=Z(28421),_=Z(85265),de=Z(55800),j=Z(52279),ue=function(ne,Ze,nt){try{return nt()}catch(rt){throw _.isStackOverflowExeption(rt)?new Error(ge.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,Ze.toString())):rt}},ie=function(ne){return function(Ze){Ze.parentContext.setCurrentRequest(Ze);var nt=Ze.bindings,rt=Ze.childRequests,Pt=Ze.target&&Ze.target.isArray(),Ct=!Ze.parentRequest||!Ze.parentRequest.target||!Ze.target||!Ze.parentRequest.target.matchesArray(Ze.target.serviceIdentifier);if(Pt&&Ct)return rt.map(function(Fr){var Ar=ie(ne);return Ar(Fr)});var $t=null;if(Ze.target.isOptional()&&nt.length===0)return;var rr=nt[0],zt=rr.scope===oe.BindingScopeEnum.Singleton,Mt=rr.scope===oe.BindingScopeEnum.Request;if(zt&&rr.activated)return rr.cache;if(Mt&&ne!==null&&ne.has(rr.id))return ne.get(rr.id);if(rr.type===oe.BindingTypeEnum.ConstantValue)$t=rr.cache,rr.activated=!0;else if(rr.type===oe.BindingTypeEnum.Function)$t=rr.cache,rr.activated=!0;else if(rr.type===oe.BindingTypeEnum.Constructor)$t=rr.implementationType;else if(rr.type===oe.BindingTypeEnum.DynamicValue&&rr.dynamicValue!==null)$t=ue("toDynamicValue",rr.serviceIdentifier,function(){return rr.dynamicValue(Ze.parentContext)});else if(rr.type===oe.BindingTypeEnum.Factory&&rr.factory!==null)$t=ue("toFactory",rr.serviceIdentifier,function(){return rr.factory(Ze.parentContext)});else if(rr.type===oe.BindingTypeEnum.Provider&&rr.provider!==null)$t=ue("toProvider",rr.serviceIdentifier,function(){return rr.provider(Ze.parentContext)});else if(rr.type===oe.BindingTypeEnum.Instance&&rr.implementationType!==null)$t=j.resolveInstance(rr.implementationType,rt,ie(ne));else{var Et=de.getServiceIdentifierAsString(Ze.serviceIdentifier);throw new Error(ge.INVALID_BINDING_TYPE+" "+Et)}return typeof rr.onActivation=="function"&&($t=rr.onActivation(Ze.parentContext,$t)),zt&&(rr.cache=$t,rr.activated=!0),Mt&&ne!==null&&!ne.has(rr.id)&&ne.set(rr.id,$t),$t}};function De(ne){var Ze=ie(ne.plan.rootRequest.requestScope);return Ze(ne.plan.rootRequest)}se.resolve=De},83366:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingInSyntax=void 0;var ge=Z(28421),oe=Z(71325),_=function(){function de(j){this._binding=j}return de.prototype.inRequestScope=function(){return this._binding.scope=ge.BindingScopeEnum.Request,new oe.BindingWhenOnSyntax(this._binding)},de.prototype.inSingletonScope=function(){return this._binding.scope=ge.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},de.prototype.inTransientScope=function(){return this._binding.scope=ge.BindingScopeEnum.Transient,new oe.BindingWhenOnSyntax(this._binding)},de}();se.BindingInSyntax=_},74889:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingInWhenOnSyntax=void 0;var ge=Z(83366),oe=Z(51811),_=Z(98370),de=function(){function j(ue){this._binding=ue,this._bindingWhenSyntax=new _.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new oe.BindingOnSyntax(this._binding),this._bindingInSyntax=new ge.BindingInSyntax(ue)}return j.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},j.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},j.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},j.prototype.when=function(ue){return this._bindingWhenSyntax.when(ue)},j.prototype.whenTargetNamed=function(ue){return this._bindingWhenSyntax.whenTargetNamed(ue)},j.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},j.prototype.whenTargetTagged=function(ue,ie){return this._bindingWhenSyntax.whenTargetTagged(ue,ie)},j.prototype.whenInjectedInto=function(ue){return this._bindingWhenSyntax.whenInjectedInto(ue)},j.prototype.whenParentNamed=function(ue){return this._bindingWhenSyntax.whenParentNamed(ue)},j.prototype.whenParentTagged=function(ue,ie){return this._bindingWhenSyntax.whenParentTagged(ue,ie)},j.prototype.whenAnyAncestorIs=function(ue){return this._bindingWhenSyntax.whenAnyAncestorIs(ue)},j.prototype.whenNoAncestorIs=function(ue){return this._bindingWhenSyntax.whenNoAncestorIs(ue)},j.prototype.whenAnyAncestorNamed=function(ue){return this._bindingWhenSyntax.whenAnyAncestorNamed(ue)},j.prototype.whenAnyAncestorTagged=function(ue,ie){return this._bindingWhenSyntax.whenAnyAncestorTagged(ue,ie)},j.prototype.whenNoAncestorNamed=function(ue){return this._bindingWhenSyntax.whenNoAncestorNamed(ue)},j.prototype.whenNoAncestorTagged=function(ue,ie){return this._bindingWhenSyntax.whenNoAncestorTagged(ue,ie)},j.prototype.whenAnyAncestorMatches=function(ue){return this._bindingWhenSyntax.whenAnyAncestorMatches(ue)},j.prototype.whenNoAncestorMatches=function(ue){return this._bindingWhenSyntax.whenNoAncestorMatches(ue)},j.prototype.onActivation=function(ue){return this._bindingOnSyntax.onActivation(ue)},j}();se.BindingInWhenOnSyntax=de},51811:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingOnSyntax=void 0;var ge=Z(98370),oe=function(){function _(de){this._binding=de}return _.prototype.onActivation=function(de){return this._binding.onActivation=de,new ge.BindingWhenSyntax(this._binding)},_}();se.BindingOnSyntax=oe},15451:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingToSyntax=void 0;var ge=Z(16674),oe=Z(28421),_=Z(74889),de=Z(71325),j=function(){function ue(ie){this._binding=ie}return ue.prototype.to=function(ie){return this._binding.type=oe.BindingTypeEnum.Instance,this._binding.implementationType=ie,new _.BindingInWhenOnSyntax(this._binding)},ue.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ge.INVALID_TO_SELF_VALUE);var ie=this._binding.serviceIdentifier;return this.to(ie)},ue.prototype.toConstantValue=function(ie){return this._binding.type=oe.BindingTypeEnum.ConstantValue,this._binding.cache=ie,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=oe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ue.prototype.toDynamicValue=function(ie){return this._binding.type=oe.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ie,this._binding.implementationType=null,new _.BindingInWhenOnSyntax(this._binding)},ue.prototype.toConstructor=function(ie){return this._binding.type=oe.BindingTypeEnum.Constructor,this._binding.implementationType=ie,this._binding.scope=oe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ue.prototype.toFactory=function(ie){return this._binding.type=oe.BindingTypeEnum.Factory,this._binding.factory=ie,this._binding.scope=oe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ue.prototype.toFunction=function(ie){if(typeof ie!="function")throw new Error(ge.INVALID_FUNCTION_BINDING);var De=this.toConstantValue(ie);return this._binding.type=oe.BindingTypeEnum.Function,this._binding.scope=oe.BindingScopeEnum.Singleton,De},ue.prototype.toAutoFactory=function(ie){return this._binding.type=oe.BindingTypeEnum.Factory,this._binding.factory=function(De){var ne=function(){return De.container.get(ie)};return ne},this._binding.scope=oe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ue.prototype.toProvider=function(ie){return this._binding.type=oe.BindingTypeEnum.Provider,this._binding.provider=ie,this._binding.scope=oe.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ue.prototype.toService=function(ie){this.toDynamicValue(function(De){return De.container.get(ie)})},ue}();se.BindingToSyntax=j},71325:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingWhenOnSyntax=void 0;var ge=Z(51811),oe=Z(98370),_=function(){function de(j){this._binding=j,this._bindingWhenSyntax=new oe.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ge.BindingOnSyntax(this._binding)}return de.prototype.when=function(j){return this._bindingWhenSyntax.when(j)},de.prototype.whenTargetNamed=function(j){return this._bindingWhenSyntax.whenTargetNamed(j)},de.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},de.prototype.whenTargetTagged=function(j,ue){return this._bindingWhenSyntax.whenTargetTagged(j,ue)},de.prototype.whenInjectedInto=function(j){return this._bindingWhenSyntax.whenInjectedInto(j)},de.prototype.whenParentNamed=function(j){return this._bindingWhenSyntax.whenParentNamed(j)},de.prototype.whenParentTagged=function(j,ue){return this._bindingWhenSyntax.whenParentTagged(j,ue)},de.prototype.whenAnyAncestorIs=function(j){return this._bindingWhenSyntax.whenAnyAncestorIs(j)},de.prototype.whenNoAncestorIs=function(j){return this._bindingWhenSyntax.whenNoAncestorIs(j)},de.prototype.whenAnyAncestorNamed=function(j){return this._bindingWhenSyntax.whenAnyAncestorNamed(j)},de.prototype.whenAnyAncestorTagged=function(j,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(j,ue)},de.prototype.whenNoAncestorNamed=function(j){return this._bindingWhenSyntax.whenNoAncestorNamed(j)},de.prototype.whenNoAncestorTagged=function(j,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(j,ue)},de.prototype.whenAnyAncestorMatches=function(j){return this._bindingWhenSyntax.whenAnyAncestorMatches(j)},de.prototype.whenNoAncestorMatches=function(j){return this._bindingWhenSyntax.whenNoAncestorMatches(j)},de.prototype.onActivation=function(j){return this._bindingOnSyntax.onActivation(j)},de}();se.BindingWhenOnSyntax=_},98370:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.BindingWhenSyntax=void 0;var ge=Z(51811),oe=Z(80758),_=function(){function de(j){this._binding=j}return de.prototype.when=function(j){return this._binding.constraint=j,new ge.BindingOnSyntax(this._binding)},de.prototype.whenTargetNamed=function(j){return this._binding.constraint=oe.namedConstraint(j),new ge.BindingOnSyntax(this._binding)},de.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(j){var ue=j.target!==null&&!j.target.isNamed()&&!j.target.isTagged();return ue},new ge.BindingOnSyntax(this._binding)},de.prototype.whenTargetTagged=function(j,ue){return this._binding.constraint=oe.taggedConstraint(j)(ue),new ge.BindingOnSyntax(this._binding)},de.prototype.whenInjectedInto=function(j){return this._binding.constraint=function(ue){return oe.typeConstraint(j)(ue.parentRequest)},new ge.BindingOnSyntax(this._binding)},de.prototype.whenParentNamed=function(j){return this._binding.constraint=function(ue){return oe.namedConstraint(j)(ue.parentRequest)},new ge.BindingOnSyntax(this._binding)},de.prototype.whenParentTagged=function(j,ue){return this._binding.constraint=function(ie){return oe.taggedConstraint(j)(ue)(ie.parentRequest)},new ge.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorIs=function(j){return this._binding.constraint=function(ue){return oe.traverseAncerstors(ue,oe.typeConstraint(j))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorIs=function(j){return this._binding.constraint=function(ue){return!oe.traverseAncerstors(ue,oe.typeConstraint(j))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorNamed=function(j){return this._binding.constraint=function(ue){return oe.traverseAncerstors(ue,oe.namedConstraint(j))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorNamed=function(j){return this._binding.constraint=function(ue){return!oe.traverseAncerstors(ue,oe.namedConstraint(j))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorTagged=function(j,ue){return this._binding.constraint=function(ie){return oe.traverseAncerstors(ie,oe.taggedConstraint(j)(ue))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorTagged=function(j,ue){return this._binding.constraint=function(ie){return!oe.traverseAncerstors(ie,oe.taggedConstraint(j)(ue))},new ge.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorMatches=function(j){return this._binding.constraint=function(ue){return oe.traverseAncerstors(ue,j)},new ge.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorMatches=function(j){return this._binding.constraint=function(ue){return!oe.traverseAncerstors(ue,j)},new ge.BindingOnSyntax(this._binding)},de}();se.BindingWhenSyntax=_},80758:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.typeConstraint=se.namedConstraint=se.taggedConstraint=se.traverseAncerstors=void 0;var ge=Z(6867),oe=Z(47738),_=function(ie,De){var ne=ie.parentRequest;return ne!==null?De(ne)?!0:_(ne,De):!1};se.traverseAncerstors=_;var de=function(ie){return function(De){var ne=function(Ze){return Ze!==null&&Ze.target!==null&&Ze.target.matchesTag(ie)(De)};return ne.metaData=new oe.Metadata(ie,De),ne}};se.taggedConstraint=de;var j=de(ge.NAMED_TAG);se.namedConstraint=j;var ue=function(ie){return function(De){var ne=null;if(De!==null)if(ne=De.bindings[0],typeof ie=="string"){var Ze=ne.serviceIdentifier;return Ze===ie}else{var nt=De.bindings[0].implementationType;return ie===nt}return!1}};se.typeConstraint=ue},70600:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.multiBindToService=void 0;var Z=function(ge){return function(oe){return function(){for(var _=[],de=0;de<arguments.length;de++)_[de]=arguments[de];return _.forEach(function(j){return ge.bind(j).toService(oe)})}}};se.multiBindToService=Z},85265:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.isStackOverflowExeption=void 0;var ge=Z(16674);function oe(_){return _ instanceof RangeError||_.message===ge.STACK_OVERFLOW}se.isStackOverflowExeption=oe},37791:function(vr,se){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.id=void 0;var Z=0;function ge(){return Z++}se.id=ge},55800:function(vr,se,Z){"use strict";Object.defineProperty(se,"__esModule",{value:!0}),se.circularDependencyToException=se.listMetadataForTarget=se.listRegisteredBindingsForServiceIdentifier=se.getServiceIdentifierAsString=se.getFunctionName=void 0;var ge=Z(16674);function oe(ne){if(typeof ne=="function"){var Ze=ne;return Ze.name}else{if(typeof ne=="symbol")return ne.toString();var Ze=ne;return Ze}}se.getServiceIdentifierAsString=oe;function _(ne,Ze,nt){var rt="",Pt=nt(ne,Ze);return Pt.length!==0&&(rt=`
Registered bindings:`,Pt.forEach(function(Ct){var $t="Object";Ct.implementationType!==null&&($t=De(Ct.implementationType)),rt=rt+`
 `+$t,Ct.constraint.metaData&&(rt=rt+" - "+Ct.constraint.metaData)})),rt}se.listRegisteredBindingsForServiceIdentifier=_;function de(ne,Ze){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===Ze?!0:de(ne.parentRequest,Ze)}function j(ne){function Ze(rt,Pt){Pt===void 0&&(Pt=[]);var Ct=oe(rt.serviceIdentifier);return Pt.push(Ct),rt.parentRequest!==null?Ze(rt.parentRequest,Pt):Pt}var nt=Ze(ne);return nt.reverse().join(" --> ")}function ue(ne){ne.childRequests.forEach(function(Ze){if(de(Ze,Ze.serviceIdentifier)){var nt=j(Ze);throw new Error(ge.CIRCULAR_DEPENDENCY+" "+nt)}else ue(Ze)})}se.circularDependencyToException=ue;function ie(ne,Ze){if(Ze.isTagged()||Ze.isNamed()){var nt="",rt=Ze.getNamedTag(),Pt=Ze.getCustomTags();return rt!==null&&(nt+=rt.toString()+`
`),Pt!==null&&Pt.forEach(function(Ct){nt+=Ct.toString()+`
`})," "+ne+`
 `+ne+" - "+nt}else return" "+ne}se.listMetadataForTarget=ie;function De(ne){if(ne.name)return ne.name;var Ze=ne.toString(),nt=Ze.match(/^function\s*([^\s(]+)/);return nt?nt[1]:"Anonymous function: "+Ze}se.getFunctionName=De},29750:function(vr){function se(Z,ge,oe){return Z===Z&&(oe!==void 0&&(Z=Z<=oe?Z:oe),ge!==void 0&&(Z=Z>=ge?Z:ge)),Z}vr.exports=se},74221:function(vr){function se(Z,ge,oe,_){for(var de=oe-1,j=Z.length;++de<j;)if(_(Z[de],ge))return de;return-1}vr.exports=se},65464:function(vr,se,Z){var ge=Z(29932),oe=Z(42118),_=Z(74221),de=Z(7518),j=Z(278),ue=Array.prototype,ie=ue.splice;function De(ne,Ze,nt,rt){var Pt=rt?_:oe,Ct=-1,$t=Ze.length,rr=ne;for(ne===Ze&&(Ze=j(Ze)),nt&&(rr=ge(ne,de(nt)));++Ct<$t;)for(var zt=0,Mt=Ze[Ct],Et=nt?nt(Mt):Mt;(zt=Pt(rr,Et,zt,rt))>-1;)rr!==ne&&ie.call(rr,zt,1),ie.call(ne,zt,1);return ne}vr.exports=De},18190:function(vr){var se=9007199254740991,Z=Math.floor;function ge(oe,_){var de="";if(!oe||_<1||_>se)return de;do _%2&&(de+=oe),_=Z(_/2),_&&(oe+=oe);while(_);return de}vr.exports=ge},78302:function(vr,se,Z){var ge=Z(18190),oe=Z(80531),_=Z(40180),de=Z(62689),j=Z(88016),ue=Z(83140),ie=Math.ceil;function De(ne,Ze){Ze=Ze===void 0?" ":oe(Ze);var nt=Ze.length;if(nt<2)return nt?ge(Ze,ne):Ze;var rt=ge(Ze,ie(ne/j(Ze)));return de(Ze)?_(ue(rt),0,ne).join(""):rt.slice(0,ne)}vr.exports=De},74691:function(vr,se,Z){var ge=Z(29750),oe=Z(14841);function _(de,j,ue){return ue===void 0&&(ue=j,j=void 0),ue!==void 0&&(ue=oe(ue),ue=ue===ue?ue:0),j!==void 0&&(j=oe(j),j=j===j?j:0),ge(oe(de),j,ue)}vr.exports=_},51584:function(vr,se,Z){var ge=Z(44239),oe=Z(37005),_="[object Boolean]";function de(j){return j===!0||j===!1||oe(j)&&ge(j)==_}vr.exports=de},60442:function(vr,se,Z){var ge=Z(90939);function oe(_,de){return ge(_,de)}vr.exports=oe},14293:function(vr){function se(Z){return Z==null}vr.exports=se},81763:function(vr,se,Z){var ge=Z(44239),oe=Z(37005),_="[object Number]";function de(j){return typeof j=="number"||oe(j)&&ge(j)==_}vr.exports=de},30236:function(vr,se,Z){var ge=Z(42980),oe=Z(21463),_=oe(function(de,j,ue,ie){ge(de,j,ue,ie)});vr.exports=_},11726:function(vr,se,Z){var ge=Z(78302),oe=Z(88016),_=Z(40554),de=Z(79833);function j(ue,ie,De){ue=de(ue),ie=_(ie);var ne=ie?oe(ue):0;return ie&&ne<ie?ue+ge(ie-ne,De):ue}vr.exports=j},32475:function(vr,se,Z){var ge=Z(78302),oe=Z(88016),_=Z(40554),de=Z(79833);function j(ue,ie,De){ue=de(ue),ie=_(ie);var ne=ie?oe(ue):0;return ie&&ne<ie?ge(ie-ne,De)+ue:ue}vr.exports=j},97019:function(vr,se,Z){var ge=Z(5976),oe=Z(45604),_=ge(oe);vr.exports=_},45604:function(vr,se,Z){var ge=Z(65464);function oe(_,de){return _&&_.length&&de&&de.length?ge(_,de):_}vr.exports=oe},23493:function(vr,se,Z){var ge=Z(23279),oe=Z(13218),_="Expected a function";function de(j,ue,ie){var De=!0,ne=!0;if(typeof j!="function")throw new TypeError(_);return oe(ie)&&(De="leading"in ie?!!ie.leading:De,ne="trailing"in ie?!!ie.trailing:ne),ge(j,ue,{leading:De,maxWait:ue,trailing:ne})}vr.exports=de},44908:function(vr,se,Z){var ge=Z(45652);function oe(_){return _&&_.length?ge(_):[]}vr.exports=oe},6158:function(vr){(function(se,Z){vr.exports=Z()})(this,function(){"use strict";var se,Z,ge;function oe(_,de){if(!se)se=de;else if(!Z)Z=de;else{var j="var sharedChunk = {}; ("+se+")(sharedChunk); ("+Z+")(sharedChunk);",ue={};se(ue),ge=de(ue),typeof window!="undefined"&&(ge.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}return oe(["exports"],function(_){"use strict";function de(o,u){return o(u={exports:{}},u.exports),u.exports}var j=ue;function ue(o,u,f,m){this.cx=3*o,this.bx=3*(f-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=f,this.p2y=m}ue.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},ue.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},ue.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},ue.prototype.solveCurveX=function(o,u){var f,m,x,E,T;for(u===void 0&&(u=1e-6),x=o,T=0;T<8;T++){if(E=this.sampleCurveX(x)-o,Math.abs(E)<u)return x;var M=this.sampleCurveDerivativeX(x);if(Math.abs(M)<1e-6)break;x-=E/M}if((x=o)<(f=0))return f;if(x>(m=1))return m;for(;f<m;){if(E=this.sampleCurveX(x),Math.abs(E-o)<u)return x;o>E?f=x:m=x,x=.5*(m-f)+f}return x},ue.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var ie=De;function De(o,u){this.x=o,this.y=u}De.prototype={clone:function(){return new De(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,f=o.y-this.y;return u*u+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),f=Math.sin(o),m=f*this.x+u*this.y;return this.x=u*this.x-f*this.y,this.y=m,this},_rotateAround:function(o,u){var f=Math.cos(o),m=Math.sin(o),x=u.y+m*(this.x-u.x)+f*(this.y-u.y);return this.x=u.x+f*(this.x-u.x)-m*(this.y-u.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},De.convert=function(o){return o instanceof De?o:Array.isArray(o)?new De(o[0],o[1]):o};var ne=typeof self!="undefined"?self:{},Ze=Math.pow(2,53)-1;function nt(o,u,f,m){var x=new j(o,u,f,m);return function(E){return x.solve(E)}}var rt=nt(.25,.1,.25,1);function Pt(o,u,f){return Math.min(f,Math.max(u,o))}function Ct(o,u,f){var m=f-u,x=((o-u)%m+m)%m+u;return x===u?f:x}function $t(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}var rr=1;function zt(){return rr++}function Mt(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Et(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Fr(o,u){o.forEach(function(f){u[f]&&(u[f]=u[f].bind(u))})}function Ar(o,u){return o.indexOf(u,o.length-u.length)!==-1}function dr(o,u,f){var m={};for(var x in o)m[x]=u.call(f||this,o[x],x,o);return m}function It(o,u,f){var m={};for(var x in o)u.call(f||this,o[x],x,o)&&(m[x]=o[x]);return m}function ct(o){return Array.isArray(o)?o.map(ct):typeof o=="object"&&o?dr(o,ct):o}var Ft={};function ht(o){Ft[o]||(typeof console!="undefined"&&console.warn(o),Ft[o]=!0)}function sr(o,u,f){return(f.y-o.y)*(u.x-o.x)>(u.y-o.y)*(f.x-o.x)}function br(o){for(var u=0,f=0,m=o.length,x=m-1,E=void 0,T=void 0;f<m;x=f++)u+=((T=o[x]).x-(E=o[f]).x)*(E.y+T.y);return u}function te(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ne(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,x,E,T){var M=E||T;return u[x]=!M||M.toLowerCase(),""}),u["max-age"]){var f=parseInt(u["max-age"],10);isNaN(f)?delete u["max-age"]:u["max-age"]=f}return u}var O=null;function Pe(o){if(O==null){var u=o.navigator?o.navigator.userAgent:null;O=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return O}function Ce(o){try{var u=ne[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(f){return!1}}var pt,Ye,We,ot,Tt=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),gr=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,wt=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,hn={now:Tt,frame:function(o){var u=gr(o);return{cancel:function(){return wt(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var f=ne.document.createElement("canvas"),m=f.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return f.width=o.width,f.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return pt||(pt=ne.document.createElement("a")),pt.href=o,pt.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(Ye==null&&(Ye=ne.matchMedia("(prefers-reduced-motion: reduce)")),Ye.matches)}},Hr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Vr={supported:!1,testSupport:function(o){!qn&&ot&&(Nn?dn(o):We=o)}},qn=!1,Nn=!1;function dn(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,ot),o.isContextLost())return;Vr.supported=!0}catch(f){}o.deleteTexture(u),qn=!0}ne.document&&((ot=ne.document.createElement("img")).onload=function(){We&&dn(We),We=null,Nn=!0},ot.onerror=function(){qn=!0,We=null},ot.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ci="01",di=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function ta(o){return o.indexOf("mapbox:")===0}di.prototype._createSkuToken=function(){var o=function(){for(var u="",f=0;f<10;f++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ci,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},di.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},di.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},di.prototype.normalizeStyleURL=function(o,u){if(!ta(o))return o;var f=Hi(o);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},di.prototype.normalizeGlyphsURL=function(o,u){if(!ta(o))return o;var f=Hi(o);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},di.prototype.normalizeSourceURL=function(o,u){if(!ta(o))return o;var f=Hi(o);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||u)},di.prototype.normalizeSpriteURL=function(o,u,f,m){var x=Hi(o);return ta(o)?(x.path="/styles/v1"+x.path+"/sprite"+u+f,this._makeAPIURL(x,this._customAccessToken||m)):(x.path+=""+u+f,Wa(x))},di.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ta(o))return o;var f=Hi(o);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(hn.devicePixelRatio>=2||u===512?"@2x":"")+(Vr.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var m=this._customAccessToken||function(x){for(var E=0,T=x;E<T.length;E+=1){var M=T[E].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(f.params)||Hr.ACCESS_TOKEN;return Hr.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,m)},di.prototype.canonicalizeTileURL=function(o,u){var f=Hi(o);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=f.path.replace("/v4/","");var x=f.params;return u&&(x=x.filter(function(E){return!E.match(/^access_token=/)})),x.length&&(m+="?"+x.join("&")),m},di.prototype.canonicalizeTileset=function(o,u){for(var f=!!u&&ta(u),m=[],x=0,E=o.tiles||[];x<E.length;x+=1){var T=E[x];Bn(T)?m.push(this.canonicalizeTileURL(T,f)):m.push(T)}return m},di.prototype._makeAPIURL=function(o,u){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Hi(Hr.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var x=o.params.indexOf("secure");x>=0&&o.params.splice(x,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!Hr.REQUIRE_ACCESS_TOKEN)return Wa(o);if(!(u=u||Hr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),Wa(o)};var Rn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Bn(o){return Rn.test(o)}var _a=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Hi(o){var u=o.match(_a);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function Wa(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function Ga(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(u[1]).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(f){return null}}var Re=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Re.prototype.getStorageKey=function(o){var u,f=Ga(Hr.ACCESS_TOKEN);return u=f&&f.u?ne.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,function(m,x){return String.fromCharCode(Number("0x"+x))})):Hr.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},Re.prototype.fetchEventData=function(){var o=Ce("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{var m=ne.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var x=ne.localStorage.getItem(f);x&&(this.anonId=x)}catch(E){ht("Unable to read from LocalStorage")}},Re.prototype.saveEventData=function(){var o=Ce("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{ne.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){ht("Unable to write to LocalStorage")}},Re.prototype.processRequests=function(o){},Re.prototype.postEvent=function(o,u,f,m){var x=this;if(Hr.EVENTS_URL){var E=Hi(Hr.EVENTS_URL);E.params.push("access_token="+(m||Hr.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ci,userId:this.anonId},M=u?$t(T,u):T,B={url:Wa(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=yt(B,function(H){x.pendingRequest=null,f(H),x.saveEventData(),x.processRequests(m)})}},Re.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var Xa,ua,to=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(f,m,x,E){this.skuToken=x;var T=!(!E&&!Hr.ACCESS_TOKEN),M=Array.isArray(f)&&f.some(function(B){return ta(B)||Bn(B)});Hr.EVENTS_URL&&T&&M&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(f){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),E=x.id,T=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),Et(this.anonId)||(this.anonId=Mt()),this.postEvent(T,{skuToken:this.skuToken},function(M){M||E&&(m.success[E]=!0)},f))}},u}(Re),Zs=new(function(o){function u(f){o.call(this,"appUserTurnstile"),this._customAccessToken=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(f,m){Hr.EVENTS_URL&&Hr.ACCESS_TOKEN&&Array.isArray(f)&&f.some(function(x){return ta(x)||Bn(x)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(f){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Ga(Hr.ACCESS_TOKEN),E=x?x.u:Hr.ACCESS_TOKEN,T=E!==this.eventData.tokenU;Et(this.anonId)||(this.anonId=Mt(),T=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),H=new Date(M),$=(M-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||B.getDate()!==H.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(q){q||(m.eventData.lastSuccess=M,m.eventData.tokenU=E)},f)}},u}(Re)),xs=Zs.postTurnstileEvent.bind(Zs),bs=new to,Wt=bs.postMapLoadEvent.bind(bs),xr=500,Yr=50;function sn(){ne.caches&&!Xa&&(Xa=ne.caches.open("mapbox-tiles"))}function Vn(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Wi,fe=1/0;function D(){return Wi==null&&(Wi=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),Wi}var z={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(z);var ae=function(o){function u(f,m,x){m===401&&Bn(x)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,f),this.status=m,this.url=x,this.name=this.constructor.name,this.message=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),Se=te()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},Le,Ht,Ot=function(o,u){if(!(/^file:/.test(f=o.url)||/^file:/.test(Se())&&!/^\w+:/.test(f))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(m,x){var E,T=new ne.AbortController,M=new ne.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Se(),signal:T.signal}),B=!1,H=!1,$=(E=M.url).indexOf("sku=")>0&&Bn(E);m.type==="json"&&M.headers.set("Accept","application/json");var q=function(me,ze,He){if(!H){if(me&&me.message!=="SecurityError"&&ht(me),ze&&He)return ce(ze);var lt=Date.now();ne.fetch(M).then(function(tt){if(tt.ok){var Rt=$?tt.clone():null;return ce(tt,Rt,lt)}return x(new ae(tt.statusText,tt.status,m.url))}).catch(function(tt){tt.code!==20&&x(new Error(tt.message))})}},ce=function(me,ze,He){(m.type==="arrayBuffer"?me.arrayBuffer():m.type==="json"?me.json():me.text()).then(function(lt){H||(ze&&He&&function(tt,Rt,Ut){if(sn(),Xa){var Kt={status:Rt.status,statusText:Rt.statusText,headers:new ne.Headers};Rt.headers.forEach(function(hr,Wr){return Kt.headers.set(Wr,hr)});var ar=Ne(Rt.headers.get("Cache-Control")||"");ar["no-store"]||(ar["max-age"]&&Kt.headers.set("Expires",new Date(Ut+1e3*ar["max-age"]).toUTCString()),new Date(Kt.headers.get("Expires")).getTime()-Ut<42e4||function(hr,Wr){if(ua===void 0)try{new Response(new ReadableStream),ua=!0}catch(on){ua=!1}ua?Wr(hr.body):hr.blob().then(Wr)}(Rt,function(hr){var Wr=new ne.Response(hr,Kt);sn(),Xa&&Xa.then(function(on){return on.put(Vn(tt.url),Wr)}).catch(function(on){return ht(on.message)})}))}}(M,ze,He),B=!0,x(null,lt,me.headers.get("Cache-Control"),me.headers.get("Expires")))}).catch(function(lt){H||x(new Error(lt.message))})};return $?function(me,ze){if(sn(),!Xa)return ze(null);var He=Vn(me.url);Xa.then(function(lt){lt.match(He).then(function(tt){var Rt=function(Ut){if(!Ut)return!1;var Kt=new Date(Ut.headers.get("Expires")||0),ar=Ne(Ut.headers.get("Cache-Control")||"");return Kt>Date.now()&&!ar["no-cache"]}(tt);lt.delete(He),Rt&&lt.put(He,tt.clone()),ze(null,tt,Rt)}).catch(ze)}).catch(ze)}(M,q):q(null,null),{cancel:function(){H=!0,B||T.abort()}}}(o,u);if(te()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var f;return function(m,x){var E=new ne.XMLHttpRequest;for(var T in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){x(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var M=E.response;if(m.type==="json")try{M=JSON.parse(E.response)}catch(B){return x(B)}x(null,M,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else x(new ae(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},kt=function(o,u){return Ot($t(o,{type:"arrayBuffer"}),u)},yt=function(o,u){return Ot($t(o,{method:"POST"}),u)},U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Le=[],Ht=0;var N=function(o,u){if(Vr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ht>=Hr.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return Le.push(f),f}Ht++;var m=!1,x=function(){if(!m)for(m=!0,Ht--;Le.length&&Ht<Hr.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Le.shift();T.cancelled||(T.cancel=N(T.requestParameters,T.callback).cancel)}},E=kt(o,function(T,M,B,H){x(),T?u(T):M&&(D()?function($,q){var ce=new ne.Blob([new Uint8Array($)],{type:"image/png"});ne.createImageBitmap(ce).then(function(me){q(null,me)}).catch(function(me){q(new Error("Could not load image because of "+me.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,u):function($,q,ce,me){var ze=new ne.Image,He=ne.URL;ze.onload=function(){q(null,ze),He.revokeObjectURL(ze.src),ze.onload=null,ne.requestAnimationFrame(function(){ze.src=U})},ze.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var lt=new ne.Blob([new Uint8Array($)],{type:"image/png"});ze.cacheControl=ce,ze.expires=me,ze.src=$.byteLength?He.createObjectURL(lt):U}(M,u,B,H))});return{cancel:function(){E.cancel(),x()}}};function X(o,u,f){f[o]&&f[o].indexOf(u)!==-1||(f[o]=f[o]||[],f[o].push(u))}function ee(o,u,f){if(f&&f[o]){var m=f[o].indexOf(u);m!==-1&&f[o].splice(m,1)}}var Ee=function(o,u){u===void 0&&(u={}),$t(this,u),this.type=o},Ue=function(o){function u(f,m){m===void 0&&(m={}),o.call(this,"error",$t({error:f},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Ee),et=function(){};et.prototype.on=function(o,u){return this._listeners=this._listeners||{},X(o,u,this._listeners),this},et.prototype.off=function(o,u){return ee(o,u,this._listeners),ee(o,u,this._oneTimeListeners),this},et.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},X(o,u,this._oneTimeListeners),this},et.prototype.fire=function(o,u){typeof o=="string"&&(o=new Ee(o,u||{}));var f=o.type;if(this.listens(f)){o.target=this;for(var m=0,x=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];m<x.length;m+=1)x[m].call(this,o);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];E<T.length;E+=1){var M=T[E];ee(f,M,this._oneTimeListeners),M.call(this,o)}var B=this._eventedParent;B&&($t(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(o))}else o instanceof Ue&&console.error(o.error);return this},et.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},et.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Q=function(o,u,f,m){this.message=(o?o+": ":"")+f,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function ye(o){var u=o.value;return u?[new Q(o.key,u,"constants have been deprecated as of v8")]:[]}function Je(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}function _t(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function pe(o){if(Array.isArray(o))return o.map(pe);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var f in o)u[f]=pe(o[f]);return u}return _t(o)}var yr=function(o){function u(f,m){o.call(this,m),this.message=m,this.key=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),tn=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var f=0,m=u;f<m.length;f+=1){var x=m[f];this.bindings[x[0]]=x[1]}};tn.prototype.concat=function(o){return new tn(this,o)},tn.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},tn.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var rn={kind:"null"},Jt={kind:"number"},Kr={kind:"string"},Nr={kind:"boolean"},Xr={kind:"color"},si={kind:"object"},un={kind:"value"},vi={kind:"collator"},Ni={kind:"formatted"},yi={kind:"resolvedImage"};function Mi(o,u){return{kind:"array",itemType:o,N:u}}function Ii(o){if(o.kind==="array"){var u=Ii(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var xo=[rn,Jt,Kr,Nr,Xr,Ni,si,Mi(un),yi];function Qi(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Qi(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var f=0,m=xo;f<m.length;f+=1)if(!Qi(m[f],u))return null}}return"Expected "+Ii(o)+" but found "+Ii(u)+" instead."}function xa(o,u){return u.some(function(f){return f.kind===o.kind})}function Pi(o,u){return u.some(function(f){return f==="null"?o===null:f==="array"?Array.isArray(o):f==="object"?o&&!Array.isArray(o)&&typeof o=="object":f===typeof o})}var _i=de(function(o,u){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function x(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function E(M){return(B=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:B>1?1:B;var B}function T(M,B,H){return H<0?H+=1:H>1&&(H-=1),6*H<1?M+(B-M)*H*6:2*H<1?B:3*H<2?M+(B-M)*(2/3-H)*6:M}try{u.parseCSSColor=function(M){var B,H=M.replace(/ /g,"").toLowerCase();if(H in f)return f[H].slice();if(H[0]==="#")return H.length===4?(B=parseInt(H.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:H.length===7&&(B=parseInt(H.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var $=H.indexOf("("),q=H.indexOf(")");if($!==-1&&q+1===H.length){var ce=H.substr(0,$),me=H.substr($+1,q-($+1)).split(","),ze=1;switch(ce){case"rgba":if(me.length!==4)return null;ze=E(me.pop());case"rgb":return me.length!==3?null:[x(me[0]),x(me[1]),x(me[2]),ze];case"hsla":if(me.length!==4)return null;ze=E(me.pop());case"hsl":if(me.length!==3)return null;var He=(parseFloat(me[0])%360+360)%360/360,lt=E(me[1]),tt=E(me[2]),Rt=tt<=.5?tt*(lt+1):tt+lt-tt*lt,Ut=2*tt-Rt;return[m(255*T(Ut,Rt,He+1/3)),m(255*T(Ut,Rt,He)),m(255*T(Ut,Rt,He-1/3)),ze];default:return null}}return null}}catch(M){}}).parseCSSColor,Ti=function(o,u,f,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=f,this.a=m};Ti.parse=function(o){if(o){if(o instanceof Ti)return o;if(typeof o=="string"){var u=_i(o);if(u)return new Ti(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ti.prototype.toString=function(){var o=this.toArray(),u=o[1],f=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(f)+","+m+")"},Ti.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ti.black=new Ti(0,0,0,1),Ti.white=new Ti(1,1,1,1),Ti.transparent=new Ti(0,0,0,0),Ti.red=new Ti(1,0,0,1);var Ca=function(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ca.prototype.compare=function(o,u){return this.collator.compare(o,u)},Ca.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Vs=function(o,u,f,m,x){this.text=o,this.image=u,this.scale=f,this.fontStack=m,this.textColor=x},ca=function(o){this.sections=o};ca.fromString=function(o){return new ca([new Vs(o,null,null,null,null)])},ca.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},ca.factory=function(o){return o instanceof ca?o:ca.fromString(o)},ca.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},ca.prototype.serialize=function(){for(var o=["format"],u=0,f=this.sections;u<f.length;u+=1){var m=f[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var x={};m.fontStack&&(x["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(x["font-scale"]=m.scale),m.textColor&&(x["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(x)}}return o};var Ra=function(o){this.name=o.name,this.available=o.available};function qu(o,u,f,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,f,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,f,m]:[o,u,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function tu(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ti||o instanceof Ca||o instanceof ca||o instanceof Ra)return!0;if(Array.isArray(o)){for(var u=0,f=o;u<f.length;u+=1)if(!tu(f[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!tu(o[m]))return!1;return!0}return!1}function va(o){if(o===null)return rn;if(typeof o=="string")return Kr;if(typeof o=="boolean")return Nr;if(typeof o=="number")return Jt;if(o instanceof Ti)return Xr;if(o instanceof Ca)return vi;if(o instanceof ca)return Ni;if(o instanceof Ra)return yi;if(Array.isArray(o)){for(var u,f=o.length,m=0,x=o;m<x.length;m+=1){var E=va(x[m]);if(u){if(u===E)continue;u=un;break}u=E}return Mi(u||un,f)}return si}function ls(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ti||o instanceof ca||o instanceof Ra?o.toString():JSON.stringify(o)}Ra.prototype.toString=function(){return this.name},Ra.fromString=function(o){return o?new Ra({name:o,available:!1}):null},Ra.prototype.serialize=function(){return["image",this.name]};var fi=function(o,u){this.type=o,this.value=u};fi.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!tu(o[1]))return u.error("invalid value");var f=o[1],m=va(f),x=u.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new fi(m,f)},fi.prototype.evaluate=function(){return this.value},fi.prototype.eachChild=function(){},fi.prototype.outputDefined=function(){return!0},fi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ti?["rgba"].concat(this.value.toArray()):this.value instanceof ca?this.value.serialize():this.value};var ia=function(o){this.name="ExpressionEvaluationError",this.message=o};ia.prototype.toJSON=function(){return this.message};var Ma={string:Kr,number:Jt,boolean:Nr,object:si},aa=function(o,u){this.type=o,this.args=u};aa.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f,m=1,x=o[0];if(x==="array"){var E,T;if(o.length>2){var M=o[1];if(typeof M!="string"||!(M in Ma)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ma[M],m++}else E=un;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}f=Mi(E,T)}else f=Ma[x];for(var B=[];m<o.length;m++){var H=u.parse(o[m],m,un);if(!H)return null;B.push(H)}return new aa(f,B)},aa.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var f=this.args[u].evaluate(o);if(!Qi(this.type,va(f)))return f;if(u===this.args.length-1)throw new ia("Expected value to be of type "+Ii(this.type)+", but found "+Ii(va(f))+" instead.")}return null},aa.prototype.eachChild=function(o){this.args.forEach(o)},aa.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},aa.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var f=o.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(x){return x.serialize()}))};var Jo=function(o){this.type=Ni,this.sections=o};Jo.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f=o[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");for(var m=[],x=!1,E=1;E<=o.length-1;++E){var T=o[E];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var M=null;if(T["font-scale"]&&!(M=u.parse(T["font-scale"],1,Jt)))return null;var B=null;if(T["text-font"]&&!(B=u.parse(T["text-font"],1,Mi(Kr))))return null;var H=null;if(T["text-color"]&&!(H=u.parse(T["text-color"],1,Xr)))return null;var $=m[m.length-1];$.scale=M,$.font=B,$.textColor=H}else{var q=u.parse(o[E],1,un);if(!q)return null;var ce=q.type.kind;if(ce!=="string"&&ce!=="value"&&ce!=="null"&&ce!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:q,scale:null,font:null,textColor:null})}}return new Jo(m)},Jo.prototype.evaluate=function(o){return new ca(this.sections.map(function(u){var f=u.content.evaluate(o);return va(f)===yi?new Vs("",f,null,null,null):new Vs(ls(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},Jo.prototype.eachChild=function(o){for(var u=0,f=this.sections;u<f.length;u+=1){var m=f[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},Jo.prototype.outputDefined=function(){return!1},Jo.prototype.serialize=function(){for(var o=["format"],u=0,f=this.sections;u<f.length;u+=1){var m=f[u];o.push(m.content.serialize());var x={};m.scale&&(x["font-scale"]=m.scale.serialize()),m.font&&(x["text-font"]=m.font.serialize()),m.textColor&&(x["text-color"]=m.textColor.serialize()),o.push(x)}return o};var jo=function(o){this.type=yi,this.input=o};jo.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var f=u.parse(o[1],1,Kr);return f?new jo(f):u.error("No image name provided.")},jo.prototype.evaluate=function(o){var u=this.input.evaluate(o),f=Ra.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f},jo.prototype.eachChild=function(o){o(this.input)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){return["image",this.input.serialize()]};var Pu={"to-boolean":Nr,"to-color":Xr,"to-number":Jt,"to-string":Kr},Rs=function(o,u){this.type=o,this.args=u};Rs.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var f=o[0];if((f==="to-boolean"||f==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Pu[f],x=[],E=1;E<o.length;E++){var T=u.parse(o[E],E,un);if(!T)return null;x.push(T)}return new Rs(m,x)},Rs.prototype.evaluate=function(o){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(o));if(this.type.kind==="color"){for(var u,f,m=0,x=this.args;m<x.length;m+=1){if(f=null,(u=x[m].evaluate(o))instanceof Ti)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(f=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":qu(u[0],u[1],u[2],u[3])))return new Ti(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ia(f||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,M=0,B=this.args;M<B.length;M+=1){if((T=B[M].evaluate(o))===null)return 0;var H=Number(T);if(!isNaN(H))return H}throw new ia("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?ca.fromString(ls(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ra.fromString(ls(this.args[0].evaluate(o))):ls(this.args[0].evaluate(o))},Rs.prototype.eachChild=function(o){this.args.forEach(o)},Rs.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Rs.prototype.serialize=function(){if(this.type.kind==="formatted")return new Jo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jo(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var pc=["Unknown","Point","LineString","Polygon"],Fa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Fa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Fa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?pc[this.feature.type]:this.feature.type:null},Fa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Fa.prototype.canonicalID=function(){return this.canonical},Fa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Fa.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ti.parse(o)),u};var zi=function(o,u,f,m){this.name=o,this.type=u,this._evaluate=f,this.args=m};zi.prototype.evaluate=function(o){return this._evaluate(o,this.args)},zi.prototype.eachChild=function(o){this.args.forEach(o)},zi.prototype.outputDefined=function(){return!1},zi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},zi.parse=function(o,u){var f,m=o[0],x=zi.definitions[m];if(!x)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,M=T.filter(function(Gn){var En=Gn[0];return!Array.isArray(En)||En.length===o.length-1}),B=null,H=0,$=M;H<$.length;H+=1){var q=$[H],ce=q[0],me=q[1];B=new Ku(u.registry,u.path,null,u.scope);for(var ze=[],He=!1,lt=1;lt<o.length;lt++){var tt=o[lt],Rt=Array.isArray(ce)?ce[lt-1]:ce.type,Ut=B.parse(tt,1+ze.length,Rt);if(!Ut){He=!0;break}ze.push(Ut)}if(!He)if(Array.isArray(ce)&&ce.length!==ze.length)B.error("Expected "+ce.length+" arguments, but found "+ze.length+" instead.");else{for(var Kt=0;Kt<ze.length;Kt++){var ar=Array.isArray(ce)?ce[Kt]:ce.type,hr=ze[Kt];B.concat(Kt+1).checkSubtype(ar,hr.type)}if(B.errors.length===0)return new zi(m,E,me,ze)}}if(M.length===1)(f=u.errors).push.apply(f,B.errors);else{for(var Wr=(M.length?M:T).map(function(Gn){var En;return En=Gn[0],Array.isArray(En)?"("+En.map(Ii).join(", ")+")":"("+Ii(En.type)+"...)"}).join(" | "),on=[],Un=1;Un<o.length;Un++){var _n=u.parse(o[Un],1+on.length);if(!_n)return null;on.push(Ii(_n.type))}u.error("Expected arguments of type "+Wr+", but found ("+on.join(", ")+") instead.")}return null},zi.register=function(o,u){for(var f in zi.definitions=u,u)o[f]=zi};var Ho=function(o,u,f){this.type=vi,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u};function Yt(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function re(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function Oe(o,u){var f=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,x=Math.pow(2,u.z);return[Math.round(f*x*8192),Math.round(m*x*8192)]}function gt(o,u,f){return u[1]>o[1]!=f[1]>o[1]&&o[0]<(f[0]-u[0])*(o[1]-u[1])/(f[1]-u[1])+u[0]}function ur(o,u){for(var f,m,x,E,T,M,B,H=!1,$=0,q=u.length;$<q;$++)for(var ce=u[$],me=0,ze=ce.length;me<ze-1;me++){if((E=(f=o)[0]-(m=ce[me])[0])*(B=f[1]-(x=ce[me+1])[1])-(M=f[0]-x[0])*(T=f[1]-m[1])==0&&E*M<=0&&T*B<=0)return!1;gt(o,ce[me],ce[me+1])&&(H=!H)}return H}function Jr(o,u){for(var f=0;f<u.length;f++)if(ur(o,u[f]))return!0;return!1}function Ln(o,u,f,m){var x=m[0]-f[0],E=m[1]-f[1],T=(o[0]-f[0])*E-x*(o[1]-f[1]),M=(u[0]-f[0])*E-x*(u[1]-f[1]);return T>0&&M<0||T<0&&M>0}function Zi(o,u,f){for(var m=0,x=f;m<x.length;m+=1)for(var E=x[m],T=0;T<E.length-1;++T)if((q=[($=E[T+1])[0]-(H=E[T])[0],$[1]-H[1]])[0]*(ce=[(B=u)[0]-(M=o)[0],B[1]-M[1]])[1]-q[1]*ce[0]!=0&&Ln(M,B,H,$)&&Ln(H,$,M,B))return!0;var M,B,H,$,q,ce;return!1}function so(o,u){for(var f=0;f<o.length;++f)if(!ur(o[f],u))return!1;for(var m=0;m<o.length-1;++m)if(Zi(o[m],o[m+1],u))return!1;return!0}function bo(o,u){for(var f=0;f<u.length;f++)if(so(o,u[f]))return!0;return!1}function io(o,u,f){for(var m=[],x=0;x<o.length;x++){for(var E=[],T=0;T<o[x].length;T++){var M=Oe(o[x][T],f);Yt(u,M),E.push(M)}m.push(E)}return m}function Ms(o,u,f){for(var m=[],x=0;x<o.length;x++){var E=io(o[x],u,f);m.push(E)}return m}function Zc(o,u,f,m){if(o[0]<f[0]||o[0]>f[2]){var x=.5*m,E=o[0]-f[0]>x?-m:f[0]-o[0]>x?m:0;E===0&&(E=o[0]-f[2]>x?-m:f[2]-o[0]>x?m:0),o[0]+=E}Yt(u,o)}function ru(o,u,f,m){for(var x=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],T=[],M=0,B=o;M<B.length;M+=1)for(var H=0,$=B[M];H<$.length;H+=1){var q=$[H],ce=[q.x+E[0],q.y+E[1]];Zc(ce,u,f,x),T.push(ce)}return T}function Ef(o,u,f,m){for(var x,E=8192*Math.pow(2,m.z),T=[8192*m.x,8192*m.y],M=[],B=0,H=o;B<H.length;B+=1){for(var $=[],q=0,ce=H[B];q<ce.length;q+=1){var me=ce[q],ze=[me.x+T[0],me.y+T[1]];Yt(u,ze),$.push(ze)}M.push($)}if(u[2]-u[0]<=E/2){(x=u)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var He=0,lt=M;He<lt.length;He+=1)for(var tt=0,Rt=lt[He];tt<Rt.length;tt+=1)Zc(Rt[tt],u,f,E)}return M}Ho.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var f=o[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");var m=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Nr);if(!m)return null;var x=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Nr);if(!x)return null;var E=null;return f.locale&&!(E=u.parse(f.locale,1,Kr))?null:new Ho(m,x,E)},Ho.prototype.evaluate=function(o){return new Ca(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},Ho.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Wo=function(o,u){this.type=Nr,this.geojson=o,this.geometries=u};function bl(o){if(o instanceof zi&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Wo)return!1;var u=!0;return o.eachChild(function(f){u&&!bl(f)&&(u=!1)}),u}function El(o){if(o instanceof zi&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(f){u&&!El(f)&&(u=!1)}),u}function Ou(o,u){if(o instanceof zi&&u.indexOf(o.name)>=0)return!1;var f=!0;return o.eachChild(function(m){f&&!Ou(m,u)&&(f=!1)}),f}Wo.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(tu(o[1])){var f=o[1];if(f.type==="FeatureCollection")for(var m=0;m<f.features.length;++m){var x=f.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Wo(f,f.features[m].geometry)}else if(f.type==="Feature"){var E=f.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Wo(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Wo(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Wo.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,f){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=io(f.coordinates,x,E),M=ru(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var B=0,H=M;B<H.length;B+=1)if(!ur(H[B],T))return!1}if(f.type==="MultiPolygon"){var $=Ms(f.coordinates,x,E),q=ru(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var ce=0,me=q;ce<me.length;ce+=1)if(!Jr(me[ce],$))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,f){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=io(f.coordinates,x,E),M=Ef(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var B=0,H=M;B<H.length;B+=1)if(!so(H[B],T))return!1}if(f.type==="MultiPolygon"){var $=Ms(f.coordinates,x,E),q=Ef(u.geometry(),m,x,E);if(!re(m,x))return!1;for(var ce=0,me=q;ce<me.length;ce+=1)if(!bo(me[ce],$))return!1}return!0}(o,this.geometries)}return!1},Wo.prototype.eachChild=function(){},Wo.prototype.outputDefined=function(){return!0},Wo.prototype.serialize=function(){return["within",this.geojson]};var ku=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};ku.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var f=o[1];return u.scope.has(f)?new ku(f,u.scope.get(f)):u.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},ku.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},ku.prototype.eachChild=function(){},ku.prototype.outputDefined=function(){return!1},ku.prototype.serialize=function(){return["var",this.name]};var Ku=function(o,u,f,m,x){u===void 0&&(u=[]),m===void 0&&(m=new tn),x===void 0&&(x=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=x,this.expectedType=f};function Vc(o,u){for(var f,m=o.length-1,x=0,E=m,T=0;x<=E;)if((f=o[T=Math.floor((x+E)/2)])<=u){if(T===m||u<o[T+1])return T;x=T+1}else{if(!(f>u))throw new ia("Input is not a number.");E=T-1}return 0}Ku.prototype.parse=function(o,u,f,m,x){return x===void 0&&(x={}),u?this.concat(u,f,m)._parse(o,x):this._parse(o,x)},Ku.prototype._parse=function(o,u){function f(H,$,q){return q==="assert"?new aa($,[H]):q==="coerce"?new Rs($,[H]):H}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[m];if(x){var E=x.parse(o,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,M=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else E=f(E,T,u.typeAnnotation||"coerce");else E=f(E,T,u.typeAnnotation||"assert")}if(!(E instanceof fi)&&E.type.kind!=="resolvedImage"&&function H($){if($ instanceof ku)return H($.boundExpression);if($ instanceof zi&&$.name==="error"||$ instanceof Ho||$ instanceof Wo)return!1;var q=$ instanceof Rs||$ instanceof aa,ce=!0;return $.eachChild(function(me){ce=q?ce&&H(me):ce&&me instanceof fi}),!!ce&&bl($)&&Ou($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var B=new Fa;try{E=new fi(E.type,E.evaluate(B))}catch(H){return this.error(H.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},Ku.prototype.concat=function(o,u,f){var m=typeof o=="number"?this.path.concat(o):this.path,x=f?this.scope.concat(f):this.scope;return new Ku(this.registry,m,u||null,x,this.errors)},Ku.prototype.error=function(o){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];var m=""+this.key+u.map(function(x){return"["+x+"]"}).join("");this.errors.push(new yr(m,o))},Ku.prototype.checkSubtype=function(o,u){var f=Qi(o,u);return f&&this.error(f),f};var Is=function(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,x=f;m<x.length;m+=1){var E=x[m],T=E[1];this.labels.push(E[0]),this.outputs.push(T)}};function $a(o,u,f){return o*(1-f)+u*f}Is.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var f=u.parse(o[1],1,Jt);if(!f)return null;var m=[],x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E=1;E<o.length;E+=2){var T=E===1?-1/0:o[E],M=o[E+1],B=E,H=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(m.length&&m[m.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var $=u.parse(M,H,x);if(!$)return null;x=x||$.type,m.push([T,$])}return new Is(x,f,m)},Is.prototype.evaluate=function(o){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);var x=u.length;return m>=u[x-1]?f[x-1].evaluate(o):f[Vc(u,m)].evaluate(o)},Is.prototype.eachChild=function(o){o(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)o(f[u])},Is.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Is.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var Sl=Object.freeze({__proto__:null,number:$a,color:function(o,u,f){return new Ti($a(o.r,u.r,f),$a(o.g,u.g,f),$a(o.b,u.b,f),$a(o.a,u.a,f))},array:function(o,u,f){return o.map(function(m,x){return $a(m,u[x],f)})}}),Qu=6/29*3*(6/29),Sf=Math.PI/180,Wh=180/Math.PI;function Af(o){return o>.008856451679035631?Math.pow(o,1/3):o/Qu+4/29}function ch(o){return o>6/29?o*o*o:Qu*(o-4/29)}function fh(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function hh(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Gh(o){var u=hh(o.r),f=hh(o.g),m=hh(o.b),x=Af((.4124564*u+.3575761*f+.1804375*m)/.95047),E=Af((.2126729*u+.7151522*f+.072175*m)/1);return{l:116*E-16,a:500*(x-E),b:200*(E-Af((.0193339*u+.119192*f+.9503041*m)/1.08883)),alpha:o.a}}function Xh(o){var u=(o.l+16)/116,f=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*ch(u),f=.95047*ch(f),m=1.08883*ch(m),new Ti(fh(3.2404542*f-1.5371385*u-.4985314*m),fh(-.969266*f+1.8760108*u+.041556*m),fh(.0556434*f-.2040259*u+1.0572252*m),o.alpha)}function Np(o,u,f){var m=u-o;return o+f*(m>180||m<-180?m-360*Math.round(m/360):m)}var jc={forward:Gh,reverse:Xh,interpolate:function(o,u,f){return{l:$a(o.l,u.l,f),a:$a(o.a,u.a,f),b:$a(o.b,u.b,f),alpha:$a(o.alpha,u.alpha,f)}}},Du={forward:function(o){var u=Gh(o),f=u.l,m=u.a,x=u.b,E=Math.atan2(x,m)*Wh;return{h:E<0?E+360:E,c:Math.sqrt(m*m+x*x),l:f,alpha:o.a}},reverse:function(o){var u=o.h*Sf,f=o.c;return Xh({l:o.l,a:Math.cos(u)*f,b:Math.sin(u)*f,alpha:o.alpha})},interpolate:function(o,u,f){return{h:Np(o.h,u.h,f),c:$a(o.c,u.c,f),l:$a(o.l,u.l,f),alpha:$a(o.alpha,u.alpha,f)}}},$h=Object.freeze({__proto__:null,lab:jc,hcl:Du}),Go=function(o,u,f,m,x){this.type=o,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(var E=0,T=x;E<T.length;E+=1){var M=T[E],B=M[1];this.labels.push(M[0]),this.outputs.push(B)}};function Hl(o,u,f,m){var x=m-f,E=o-f;return x===0?0:u===1?E/x:(Math.pow(u,E)-1)/(Math.pow(u,x)-1)}Go.interpolationFactor=function(o,u,f,m){var x=0;if(o.name==="exponential")x=Hl(u,o.base,f,m);else if(o.name==="linear")x=Hl(u,1,f,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;x=new j(E[0],E[1],E[2],E[3]).solve(Hl(u,1,f,m))}return x},Go.parse=function(o,u){var f=o[0],m=o[1],x=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var T=m[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(lt){return typeof lt!="number"||lt<0||lt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(x=u.parse(x,2,Jt)))return null;var B=[],H=null;f==="interpolate-hcl"||f==="interpolate-lab"?H=Xr:u.expectedType&&u.expectedType.kind!=="value"&&(H=u.expectedType);for(var $=0;$<E.length;$+=2){var q=E[$],ce=E[$+1],me=$+3,ze=$+4;if(typeof q!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(B.length&&B[B.length-1][0]>=q)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);var He=u.parse(ce,ze,H);if(!He)return null;H=H||He.type,B.push([q,He])}return H.kind==="number"||H.kind==="color"||H.kind==="array"&&H.itemType.kind==="number"&&typeof H.N=="number"?new Go(H,f,m,x,B):u.error("Type "+Ii(H)+" is not interpolatable.")},Go.prototype.evaluate=function(o){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return f[0].evaluate(o);var x=u.length;if(m>=u[x-1])return f[x-1].evaluate(o);var E=Vc(u,m),T=Go.interpolationFactor(this.interpolation,m,u[E],u[E+1]),M=f[E].evaluate(o),B=f[E+1].evaluate(o);return this.operator==="interpolate"?Sl[this.type.kind.toLowerCase()](M,B,T):this.operator==="interpolate-hcl"?Du.reverse(Du.interpolate(Du.forward(M),Du.forward(B),T)):jc.reverse(jc.interpolate(jc.forward(M),jc.forward(B),T))},Go.prototype.eachChild=function(o){o(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)o(f[u])},Go.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Go.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u};var Al=function(o,u){this.type=o,this.args=u};Al.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var f=null,m=u.expectedType;m&&m.kind!=="value"&&(f=m);for(var x=[],E=0,T=o.slice(1);E<T.length;E+=1){var M=u.parse(T[E],1+x.length,f,void 0,{typeAnnotation:"omit"});if(!M)return null;f=f||M.type,x.push(M)}var B=m&&x.some(function(H){return Qi(m,H.type)});return new Al(B?un:f,x)},Al.prototype.evaluate=function(o){for(var u,f=null,m=0,x=0,E=this.args;x<E.length&&(m++,(f=E[x].evaluate(o))&&f instanceof Ra&&!f.available&&(u||(u=f.name),f=null,m===this.args.length&&(f=u)),f===null);x+=1);return f},Al.prototype.eachChild=function(o){this.args.forEach(o)},Al.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Al.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var js=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};js.prototype.evaluate=function(o){return this.result.evaluate(o)},js.prototype.eachChild=function(o){for(var u=0,f=this.bindings;u<f.length;u+=1)o(f[u][1]);o(this.result)},js.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var f=[],m=1;m<o.length-1;m+=2){var x=o[m];if(typeof x!="string")return u.error("Expected string, but found "+typeof x+" instead.",m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;f.push([x,E])}var T=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return T?new js(f,T):null},js.prototype.outputDefined=function(){return this.result.outputDefined()},js.prototype.serialize=function(){for(var o=["let"],u=0,f=this.bindings;u<f.length;u+=1){var m=f[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var Tl=function(o,u,f){this.type=o,this.index=u,this.input=f};Tl.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,Jt),m=u.parse(o[2],2,Mi(u.expectedType||un));return f&&m?new Tl(m.type.itemType,f,m):null},Tl.prototype.evaluate=function(o){var u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new ia("Array index out of bounds: "+u+" < 0.");if(u>=f.length)throw new ia("Array index out of bounds: "+u+" > "+(f.length-1)+".");if(u!==Math.floor(u))throw new ia("Array index must be an integer, but found "+u+" instead.");return f[u]},Tl.prototype.eachChild=function(o){o(this.index),o(this.input)},Tl.prototype.outputDefined=function(){return!1},Tl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var nu=function(o,u){this.type=Nr,this.needle=o,this.haystack=u};nu.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,un),m=u.parse(o[2],2,un);return f&&m?xa(f.type,[Nr,Kr,Jt,rn,un])?new nu(f,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(f.type)+" instead"):null},nu.prototype.evaluate=function(o){var u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!Pi(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Ii(va(u))+" instead.");if(!Pi(f,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Ii(va(f))+" instead.");return f.indexOf(u)>=0},nu.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},nu.prototype.outputDefined=function(){return!0},nu.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var mi=function(o,u,f){this.type=Jt,this.needle=o,this.haystack=u,this.fromIndex=f};mi.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,un),m=u.parse(o[2],2,un);if(!f||!m)return null;if(!xa(f.type,[Nr,Kr,Jt,rn,un]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(f.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,Jt);return x?new mi(f,m,x):null}return new mi(f,m)},mi.prototype.evaluate=function(o){var u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Pi(u,["boolean","string","number","null"]))throw new ia("Expected first argument to be of type boolean, string, number or null, but found "+Ii(va(u))+" instead.");if(!Pi(f,["string","array"]))throw new ia("Expected second argument to be of type array or string, but found "+Ii(va(f))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return f.indexOf(u,m)}return f.indexOf(u)},mi.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},mi.prototype.outputDefined=function(){return!1},mi.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Hs=function(o,u,f,m,x,E){this.inputType=o,this.type=u,this.input=f,this.cases=m,this.outputs=x,this.otherwise=E};Hs.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var f,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var x={},E=[],T=2;T<o.length-1;T+=2){var M=o[T],B=o[T+1];Array.isArray(M)||(M=[M]);var H=u.concat(T);if(M.length===0)return H.error("Expected at least one branch label.");for(var $=0,q=M;$<q.length;$+=1){var ce=q[$];if(typeof ce!="number"&&typeof ce!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ce=="number"&&Math.abs(ce)>Number.MAX_SAFE_INTEGER)return H.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ce=="number"&&Math.floor(ce)!==ce)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,va(ce)))return null}else f=va(ce);if(x[String(ce)]!==void 0)return H.error("Branch labels must be unique.");x[String(ce)]=E.length}var me=u.parse(B,T,m);if(!me)return null;m=m||me.type,E.push(me)}var ze=u.parse(o[1],1,un);if(!ze)return null;var He=u.parse(o[o.length-1],o.length-1,m);return He?ze.type.kind!=="value"&&u.concat(1).checkSubtype(f,ze.type)?null:new Hs(f,m,ze,x,E,He):null},Hs.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(va(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},Hs.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},Hs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},Hs.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],f=[],m={},x=0,E=Object.keys(this.cases).sort();x<E.length;x+=1){var T=E[x];(q=m[this.cases[T]])===void 0?(m[this.cases[T]]=f.length,f.push([this.cases[T],[T]])):f[q][1].push(T)}for(var M=function(me){return o.inputType.kind==="number"?Number(me):me},B=0,H=f;B<H.length;B+=1){var $=H[B],q=$[0],ce=$[1];u.push(ce.length===1?M(ce[0]):ce.map(M)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Lu=function(o,u,f){this.type=o,this.branches=u,this.otherwise=f};Lu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);for(var m=[],x=1;x<o.length-1;x+=2){var E=u.parse(o[x],x,Nr);if(!E)return null;var T=u.parse(o[x+1],x+1,f);if(!T)return null;m.push([E,T]),f=f||T.type}var M=u.parse(o[o.length-1],o.length-1,f);return M?new Lu(f,m,M):null},Lu.prototype.evaluate=function(o){for(var u=0,f=this.branches;u<f.length;u+=1){var m=f[u],x=m[1];if(m[0].evaluate(o))return x.evaluate(o)}return this.otherwise.evaluate(o)},Lu.prototype.eachChild=function(o){for(var u=0,f=this.branches;u<f.length;u+=1){var m=f[u],x=m[1];o(m[0]),o(x)}o(this.otherwise)},Lu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},Lu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Ju=function(o,u,f,m){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=m};function ph(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Yh(o,u,f,m){return m.compare(u,f)===0}function On(o,u,f){var m=o!=="=="&&o!=="!=";return function(){function x(E,T,M){this.type=Nr,this.lhs=E,this.rhs=T,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return x.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var M=E[0],B=T.parse(E[1],1,un);if(!B)return null;if(!ph(M,B.type))return T.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ii(B.type)+"'.");var H=T.parse(E[2],2,un);if(!H)return null;if(!ph(M,H.type))return T.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ii(H.type)+"'.");if(B.type.kind!==H.type.kind&&B.type.kind!=="value"&&H.type.kind!=="value")return T.error("Cannot compare types '"+Ii(B.type)+"' and '"+Ii(H.type)+"'.");m&&(B.type.kind==="value"&&H.type.kind!=="value"?B=new aa(H.type,[B]):B.type.kind!=="value"&&H.type.kind==="value"&&(H=new aa(B.type,[H])));var $=null;if(E.length===4){if(B.type.kind!=="string"&&H.type.kind!=="string"&&B.type.kind!=="value"&&H.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(E[3],3,vi)))return null}return new x(B,H,$)},x.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var B=va(T),H=va(M);if(B.kind!==H.kind||B.kind!=="string"&&B.kind!=="number")throw new ia('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+B.kind+", "+H.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var $=va(T),q=va(M);if($.kind!=="string"||q.kind!=="string")return u(E,T,M)}return this.collator?f(E,T,M,this.collator.evaluate(E)):u(E,T,M)},x.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var E=[o];return this.eachChild(function(T){E.push(T.serialize())}),E},x}()}Ju.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1,un),m=u.parse(o[2],2,Jt);if(!f||!m)return null;if(!xa(f.type,[Mi(un),Kr,un]))return u.error("Expected first argument to be of type array or string, but found "+Ii(f.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,Jt);return x?new Ju(f.type,f,m,x):null}return new Ju(f.type,f,m)},Ju.prototype.evaluate=function(o){var u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!Pi(u,["string","array"]))throw new ia("Expected first argument to be of type array or string, but found "+Ii(va(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(f,m)}return u.slice(f)},Ju.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},Ju.prototype.outputDefined=function(){return!1},Ju.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ws=On("==",function(o,u,f){return u===f},Yh),cs=On("!=",function(o,u,f){return u!==f},function(o,u,f,m){return!Yh(0,u,f,m)}),du=On("<",function(o,u,f){return u<f},function(o,u,f,m){return m.compare(u,f)<0}),Na=On(">",function(o,u,f){return u>f},function(o,u,f,m){return m.compare(u,f)>0}),Tf=On("<=",function(o,u,f){return u<=f},function(o,u,f,m){return m.compare(u,f)<=0}),qh=On(">=",function(o,u,f){return u>=f},function(o,u,f,m){return m.compare(u,f)>=0}),es=function(o,u,f,m,x){this.type=Kr,this.number=o,this.locale=u,this.currency=f,this.minFractionDigits=m,this.maxFractionDigits=x};es.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var f=u.parse(o[1],1,Jt);if(!f)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var x=null;if(m.locale&&!(x=u.parse(m.locale,1,Kr)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,Kr)))return null;var T=null;if(m["min-fraction-digits"]&&!(T=u.parse(m["min-fraction-digits"],1,Jt)))return null;var M=null;return m["max-fraction-digits"]&&!(M=u.parse(m["max-fraction-digits"],1,Jt))?null:new es(f,x,E,T,M)},es.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},es.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},es.prototype.outputDefined=function(){return!1},es.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var wl=function(o){this.type=Jt,this.input=o};wl.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var f=u.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ii(f.type)+" instead."):new wl(f):null},wl.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ia("Expected value to be of type string or array, but found "+Ii(va(u))+" instead.")},wl.prototype.eachChild=function(o){o(this.input)},wl.prototype.outputDefined=function(){return!1},wl.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Bu={"==":Ws,"!=":cs,">":Na,"<":du,">=":qh,"<=":Tf,array:aa,at:Tl,boolean:aa,case:Lu,coalesce:Al,collator:Ho,format:Jo,image:jo,in:nu,"index-of":mi,interpolate:Go,"interpolate-hcl":Go,"interpolate-lab":Go,length:wl,let:js,literal:fi,match:Hs,number:aa,"number-format":es,object:aa,slice:Ju,step:Is,string:aa,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:ku,within:Wo};function el(o,u){var f=u[0],m=u[1],x=u[2],E=u[3];f=f.evaluate(o),m=m.evaluate(o),x=x.evaluate(o);var T=E?E.evaluate(o):1,M=qu(f,m,x,T);if(M)throw new ia(M);return new Ti(f/255*T,m/255*T,x/255*T,T)}function wf(o,u){return o in u}function Hc(o,u){var f=u[o];return f===void 0?null:f}function vu(o){return{type:o}}function Aa(o){return{result:"success",value:o}}function tl(o){return{result:"error",value:o}}function Fu(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Kh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Wc(o){return!!o.expression&&o.expression.interpolated}function ma(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function dc(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Gc(o){return o}function rl(o,u,f){return o!==void 0?o:u!==void 0?u:f!==void 0?f:void 0}function mu(o,u,f,m,x){return rl(typeof f===x?m[f]:void 0,o.default,u.default)}function dh(o,u,f){if(ma(f)!=="number")return rl(o.default,u.default);var m=o.stops.length;if(m===1||f<=o.stops[0][0])return o.stops[0][1];if(f>=o.stops[m-1][0])return o.stops[m-1][1];var x=Vc(o.stops.map(function(E){return E[0]}),f);return o.stops[x][1]}function vc(o,u,f){var m=o.base!==void 0?o.base:1;if(ma(f)!=="number")return rl(o.default,u.default);var x=o.stops.length;if(x===1||f<=o.stops[0][0])return o.stops[0][1];if(f>=o.stops[x-1][0])return o.stops[x-1][1];var E=Vc(o.stops.map(function(q){return q[0]}),f),T=function(q,ce,me,ze){var He=ze-me,lt=q-me;return He===0?0:ce===1?lt/He:(Math.pow(ce,lt)-1)/(Math.pow(ce,He)-1)}(f,m,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],B=o.stops[E+1][1],H=Sl[u.type]||Gc;if(o.colorSpace&&o.colorSpace!=="rgb"){var $=$h[o.colorSpace];H=function(q,ce){return $.reverse($.interpolate($.forward(q),$.forward(ce),T))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var q=[],ce=arguments.length;ce--;)q[ce]=arguments[ce];var me=M.evaluate.apply(void 0,q),ze=B.evaluate.apply(void 0,q);if(me!==void 0&&ze!==void 0)return H(me,ze,T)}}:H(M,B,T)}function nl(o,u,f){return u.type==="color"?f=Ti.parse(f):u.type==="formatted"?f=ca.fromString(f.toString()):u.type==="resolvedImage"?f=Ra.fromString(f.toString()):ma(f)===u.type||u.type==="enum"&&u.values[f]||(f=void 0),rl(f,o.default,u.default)}zi.register(Bu,{error:[{kind:"error"},[Kr],function(o,u){throw new ia(u[0].evaluate(o))}],typeof:[Kr,[un],function(o,u){return Ii(va(u[0].evaluate(o)))}],"to-rgba":[Mi(Jt,4),[Xr],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[Xr,[Jt,Jt,Jt],el],rgba:[Xr,[Jt,Jt,Jt,Jt],el],has:{type:Nr,overloads:[[[Kr],function(o,u){return wf(u[0].evaluate(o),o.properties())}],[[Kr,si],function(o,u){var f=u[1];return wf(u[0].evaluate(o),f.evaluate(o))}]]},get:{type:un,overloads:[[[Kr],function(o,u){return Hc(u[0].evaluate(o),o.properties())}],[[Kr,si],function(o,u){var f=u[1];return Hc(u[0].evaluate(o),f.evaluate(o))}]]},"feature-state":[un,[Kr],function(o,u){return Hc(u[0].evaluate(o),o.featureState||{})}],properties:[si,[],function(o){return o.properties()}],"geometry-type":[Kr,[],function(o){return o.geometryType()}],id:[un,[],function(o){return o.id()}],zoom:[Jt,[],function(o){return o.globals.zoom}],"heatmap-density":[Jt,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[Jt,[],function(o){return o.globals.lineProgress||0}],accumulated:[un,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[Jt,vu(Jt),function(o,u){for(var f=0,m=0,x=u;m<x.length;m+=1)f+=x[m].evaluate(o);return f}],"*":[Jt,vu(Jt),function(o,u){for(var f=1,m=0,x=u;m<x.length;m+=1)f*=x[m].evaluate(o);return f}],"-":{type:Jt,overloads:[[[Jt,Jt],function(o,u){var f=u[1];return u[0].evaluate(o)-f.evaluate(o)}],[[Jt],function(o,u){return-u[0].evaluate(o)}]]},"/":[Jt,[Jt,Jt],function(o,u){var f=u[1];return u[0].evaluate(o)/f.evaluate(o)}],"%":[Jt,[Jt,Jt],function(o,u){var f=u[1];return u[0].evaluate(o)%f.evaluate(o)}],ln2:[Jt,[],function(){return Math.LN2}],pi:[Jt,[],function(){return Math.PI}],e:[Jt,[],function(){return Math.E}],"^":[Jt,[Jt,Jt],function(o,u){var f=u[1];return Math.pow(u[0].evaluate(o),f.evaluate(o))}],sqrt:[Jt,[Jt],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[Jt,[Jt],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[Jt,[Jt],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[Jt,[Jt],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[Jt,[Jt],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[Jt,[Jt],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[Jt,[Jt],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[Jt,[Jt],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[Jt,[Jt],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[Jt,[Jt],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[Jt,vu(Jt),function(o,u){return Math.min.apply(Math,u.map(function(f){return f.evaluate(o)}))}],max:[Jt,vu(Jt),function(o,u){return Math.max.apply(Math,u.map(function(f){return f.evaluate(o)}))}],abs:[Jt,[Jt],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[Jt,[Jt],function(o,u){var f=u[0].evaluate(o);return f<0?-Math.round(-f):Math.round(f)}],floor:[Jt,[Jt],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[Jt,[Jt],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[Nr,[Kr,un],function(o,u){var f=u[0],m=u[1];return o.properties()[f.value]===m.value}],"filter-id-==":[Nr,[un],function(o,u){var f=u[0];return o.id()===f.value}],"filter-type-==":[Nr,[Kr],function(o,u){var f=u[0];return o.geometryType()===f.value}],"filter-<":[Nr,[Kr,un],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x<E}],"filter-id-<":[Nr,[un],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m<x}],"filter->":[Nr,[Kr,un],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x>E}],"filter-id->":[Nr,[un],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m>x}],"filter-<=":[Nr,[Kr,un],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x<=E}],"filter-id-<=":[Nr,[un],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m<=x}],"filter->=":[Nr,[Kr,un],function(o,u){var f=u[0],m=u[1],x=o.properties()[f.value],E=m.value;return typeof x==typeof E&&x>=E}],"filter-id->=":[Nr,[un],function(o,u){var f=u[0],m=o.id(),x=f.value;return typeof m==typeof x&&m>=x}],"filter-has":[Nr,[un],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[Nr,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[Nr,[Mi(Kr)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[Nr,[Mi(un)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[Nr,[Kr,Mi(un)],function(o,u){var f=u[0];return u[1].value.indexOf(o.properties()[f.value])>=0}],"filter-in-large":[Nr,[Kr,Mi(un)],function(o,u){var f=u[0],m=u[1];return function(x,E,T,M){for(;T<=M;){var B=T+M>>1;if(E[B]===x)return!0;E[B]>x?M=B-1:T=B+1}return!1}(o.properties()[f.value],m.value,0,m.value.length-1)}],all:{type:Nr,overloads:[[[Nr,Nr],function(o,u){var f=u[1];return u[0].evaluate(o)&&f.evaluate(o)}],[vu(Nr),function(o,u){for(var f=0,m=u;f<m.length;f+=1)if(!m[f].evaluate(o))return!1;return!0}]]},any:{type:Nr,overloads:[[[Nr,Nr],function(o,u){var f=u[1];return u[0].evaluate(o)||f.evaluate(o)}],[vu(Nr),function(o,u){for(var f=0,m=u;f<m.length;f+=1)if(m[f].evaluate(o))return!0;return!1}]]},"!":[Nr,[Nr],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[Nr,[Kr],function(o,u){var f=o.globals&&o.globals.isSupportedScript;return!f||f(u[0].evaluate(o))}],upcase:[Kr,[Kr],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[Kr,[Kr],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[Kr,vu(un),function(o,u){return u.map(function(f){return ls(f.evaluate(o))}).join("")}],"resolved-locale":[Kr,[vi],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var Cl=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Fa,this._defaultValue=u?function(f){return f.type==="color"&&dc(f.default)?new Ti(0,0,0,0):f.type==="color"?Ti.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function mc(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Bu}function il(o,u){var f=new Ku(Bu,[],u?function(x){var E={color:Xr,string:Kr,number:Jt,enum:Kr,boolean:Nr,formatted:Ni,resolvedImage:yi};return x.type==="array"?Mi(E[x.value]||un,x.length):E[x.type]}(u):void 0),m=f.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Aa(new Cl(m,u)):tl(f.errors)}Cl.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Cl.prototype.evaluate=function(o,u,f,m,x,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ia("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var gc=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!El(u.expression)};gc.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,x,E)},gc.prototype.evaluate=function(o,u,f,m,x,E){return this._styleExpression.evaluate(o,u,f,m,x,E)};var yc=function(o,u,f,m){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!El(u.expression),this.interpolationType=m};function vh(o,u){if((o=il(o,u)).result==="error")return o;var f=o.value.expression,m=bl(f);if(!m&&!Fu(u))return tl([new yr("","data expressions not supported")]);var x=Ou(f,["zoom"]);if(!x&&!Kh(u))return tl([new yr("","zoom expressions not supported")]);var E=function T(M){var B=null;if(M instanceof js)B=T(M.result);else if(M instanceof Al)for(var H=0,$=M.args;H<$.length&&!(B=T($[H]));H+=1);else(M instanceof Is||M instanceof Go)&&M.input instanceof zi&&M.input.name==="zoom"&&(B=M);return B instanceof yr||M.eachChild(function(q){var ce=T(q);ce instanceof yr?B=ce:!B&&ce?B=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&ce&&B!==ce&&(B=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(f);return E||x?E instanceof yr?tl([E]):E instanceof Go&&!Wc(u)?tl([new yr("",'"interpolate" expressions cannot be used with this property')]):Aa(E?new yc(m?"camera":"composite",o.value,E.labels,E instanceof Go?E.interpolation:void 0):new gc(m?"constant":"source",o.value)):tl([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}yc.prototype.evaluateWithoutErrorHandling=function(o,u,f,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,m,x,E)},yc.prototype.evaluate=function(o,u,f,m,x,E){return this._styleExpression.evaluate(o,u,f,m,x,E)},yc.prototype.interpolationFactor=function(o,u,f){return this.interpolationType?Go.interpolationFactor(this.interpolationType,o,u,f):0};var Rl=function(o,u){this._parameters=o,this._specification=u,Je(this,function f(m,x){var E,T,M,B=x.type==="color",H=m.stops&&typeof m.stops[0][0]=="object",$=H||!(H||m.property!==void 0),q=m.type||(Wc(x)?"exponential":"interval");if(B&&((m=Je({},m)).stops&&(m.stops=m.stops.map(function(_n){return[_n[0],Ti.parse(_n[1])]})),m.default=Ti.parse(m.default?m.default:x.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!$h[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(q==="exponential")E=vc;else if(q==="interval")E=dh;else if(q==="categorical"){E=mu,T=Object.create(null);for(var ce=0,me=m.stops;ce<me.length;ce+=1){var ze=me[ce];T[ze[0]]=ze[1]}M=typeof m.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');E=nl}if(H){for(var He={},lt=[],tt=0;tt<m.stops.length;tt++){var Rt=m.stops[tt],Ut=Rt[0].zoom;He[Ut]===void 0&&(He[Ut]={zoom:Ut,type:m.type,property:m.property,default:m.default,stops:[]},lt.push(Ut)),He[Ut].stops.push([Rt[0].value,Rt[1]])}for(var Kt=[],ar=0,hr=lt;ar<hr.length;ar+=1){var Wr=hr[ar];Kt.push([He[Wr].zoom,f(He[Wr],x)])}var on={name:"linear"};return{kind:"composite",interpolationType:on,interpolationFactor:Go.interpolationFactor.bind(void 0,on),zoomStops:Kt.map(function(_n){return _n[0]}),evaluate:function(_n,Gn){var En=_n.zoom;return vc({stops:Kt,base:m.base},x,En).evaluate(En,Gn)}}}if($){var Un=q==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Un,interpolationFactor:Go.interpolationFactor.bind(void 0,Un),zoomStops:m.stops.map(function(_n){return _n[0]}),evaluate:function(_n){return E(m,x,_n.zoom,T,M)}}}return{kind:"source",evaluate:function(_n,Gn){var En=Gn&&Gn.properties?Gn.properties[m.property]:void 0;return En===void 0?rl(m.default,x.default):E(m,x,En,T,M)}}}(this._parameters,this._specification))};function gu(o){var u=o.key,f=o.value,m=o.valueSpec||{},x=o.objectElementValidators||{},E=o.style,T=o.styleSpec,M=[],B=ma(f);if(B!=="object")return[new Q(u,f,"object expected, "+B+" found")];for(var H in f){var $=H.split(".")[0],q=m[$]||m["*"],ce=void 0;if(x[$])ce=x[$];else if(m[$])ce=Di;else if(x["*"])ce=x["*"];else{if(!m["*"]){M.push(new Q(u,f[H],'unknown property "'+H+'"'));continue}ce=Di}M=M.concat(ce({key:(u&&u+".")+H,value:f[H],valueSpec:q,style:E,styleSpec:T,object:f,objectKey:H},f))}for(var me in m)x[me]||m[me].required&&m[me].default===void 0&&f[me]===void 0&&M.push(new Q(u,f,'missing required property "'+me+'"'));return M}function Xc(o){var u=o.value,f=o.valueSpec,m=o.style,x=o.styleSpec,E=o.key,T=o.arrayElementValidator||Di;if(ma(u)!=="array")return[new Q(E,u,"array expected, "+ma(u)+" found")];if(f.length&&u.length!==f.length)return[new Q(E,u,"array length "+f.length+" expected, length "+u.length+" found")];if(f["min-length"]&&u.length<f["min-length"])return[new Q(E,u,"array length at least "+f["min-length"]+" expected, length "+u.length+" found")];var M={type:f.value,values:f.values};x.$version<7&&(M.function=f.function),ma(f.value)==="object"&&(M=f.value);for(var B=[],H=0;H<u.length;H++)B=B.concat(T({array:u,arrayIndex:H,value:u[H],valueSpec:M,style:m,styleSpec:x,key:E+"["+H+"]"}));return B}function mh(o){var u=o.key,f=o.value,m=o.valueSpec,x=ma(f);return x==="number"&&f!=f&&(x="NaN"),x!=="number"?[new Q(u,f,"number expected, "+x+" found")]:"minimum"in m&&f<m.minimum?[new Q(u,f,f+" is less than the minimum value "+m.minimum)]:"maximum"in m&&f>m.maximum?[new Q(u,f,f+" is greater than the maximum value "+m.maximum)]:[]}function $c(o){var u,f,m,x=o.valueSpec,E=_t(o.value.type),T={},M=E!=="categorical"&&o.value.property===void 0,B=!M,H=ma(o.value.stops)==="array"&&ma(o.value.stops[0])==="array"&&ma(o.value.stops[0][0])==="object",$=gu({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(me){if(E==="identity")return[new Q(me.key,me.value,'identity function may not have a "stops" property')];var ze=[],He=me.value;return ze=ze.concat(Xc({key:me.key,value:He,valueSpec:me.valueSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:q})),ma(He)==="array"&&He.length===0&&ze.push(new Q(me.key,He,"array must have at least one stop")),ze},default:function(me){return Di({key:me.key,value:me.value,valueSpec:x,style:me.style,styleSpec:me.styleSpec})}}});return E==="identity"&&M&&$.push(new Q(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||$.push(new Q(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!Wc(o.valueSpec)&&$.push(new Q(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(B&&!Fu(o.valueSpec)?$.push(new Q(o.key,o.value,"property functions not supported")):M&&!Kh(o.valueSpec)&&$.push(new Q(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!H||o.value.property!==void 0||$.push(new Q(o.key,o.value,'"property" property is required')),$;function q(me){var ze=[],He=me.value,lt=me.key;if(ma(He)!=="array")return[new Q(lt,He,"array expected, "+ma(He)+" found")];if(He.length!==2)return[new Q(lt,He,"array length 2 expected, length "+He.length+" found")];if(H){if(ma(He[0])!=="object")return[new Q(lt,He,"object expected, "+ma(He[0])+" found")];if(He[0].zoom===void 0)return[new Q(lt,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new Q(lt,He,"object stop key must have value")];if(m&&m>_t(He[0].zoom))return[new Q(lt,He[0].zoom,"stop zoom values must appear in ascending order")];_t(He[0].zoom)!==m&&(m=_t(He[0].zoom),f=void 0,T={}),ze=ze.concat(gu({key:lt+"[0]",value:He[0],valueSpec:{zoom:{}},style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:mh,value:ce}}))}else ze=ze.concat(ce({key:lt+"[0]",value:He[0],valueSpec:{},style:me.style,styleSpec:me.styleSpec},He));return mc(pe(He[1]))?ze.concat([new Q(lt+"[1]",He[1],"expressions are not allowed in function stops.")]):ze.concat(Di({key:lt+"[1]",value:He[1],valueSpec:x,style:me.style,styleSpec:me.styleSpec}))}function ce(me,ze){var He=ma(me.value),lt=_t(me.value),tt=me.value!==null?me.value:ze;if(u){if(He!==u)return[new Q(me.key,tt,He+" stop domain type must match previous stop domain type "+u)]}else u=He;if(He!=="number"&&He!=="string"&&He!=="boolean")return[new Q(me.key,tt,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&E!=="categorical"){var Rt="number expected, "+He+" found";return Fu(x)&&E===void 0&&(Rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Q(me.key,tt,Rt)]}return E!=="categorical"||He!=="number"||isFinite(lt)&&Math.floor(lt)===lt?E!=="categorical"&&He==="number"&&f!==void 0&&lt<f?[new Q(me.key,tt,"stop domain values must appear in ascending order")]:(f=lt,E==="categorical"&&lt in T?[new Q(me.key,tt,"stop domain values must be unique")]:(T[lt]=!0,[])):[new Q(me.key,tt,"integer expected, found "+lt)]}}function yu(o){var u=(o.expressionContext==="property"?vh:il)(pe(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new Q(""+o.key+m.key,o.value,m.message)});var f=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!f.outputDefined())return[new Q(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!El(f))return[new Q(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!El(f))return[new Q(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Ou(f,["zoom","feature-state"]))return[new Q(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!bl(f))return[new Q(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nu(o){var u=o.key,f=o.value,m=o.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(_t(f))===-1&&x.push(new Q(u,f,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(m.values).indexOf(_t(f))===-1&&x.push(new Q(u,f,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(f)+" found")),x}function _c(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,f=o.slice(1);u<f.length;u+=1){var m=f[u];if(!_c(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}Rl.deserialize=function(o){return new Rl(o._parameters,o._specification)},Rl.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var xc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wl(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};_c(o)||(o=bc(o));var u=il(o,xc);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return{filter:function(f,m,x){return u.value.evaluate(f,m,{},x)},needGeometry:function f(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var x=1;x<m.length;x++)if(f(m[x]))return!0;return!1}(o)}}function Qh(o,u){return o<u?-1:o>u?1:0}function bc(o){if(!o)return!0;var u,f=o[0];return o.length<=1?f!=="any":f==="=="?Jh(o[1],o[2],"=="):f==="!="?Rf(Jh(o[1],o[2],"==")):f==="<"||f===">"||f==="<="||f===">="?Jh(o[1],o[2],f):f==="any"?(u=o.slice(1),["any"].concat(u.map(bc))):f==="all"?["all"].concat(o.slice(1).map(bc)):f==="none"?["all"].concat(o.slice(1).map(bc).map(Rf)):f==="in"?Cf(o[1],o.slice(2)):f==="!in"?Rf(Cf(o[1],o.slice(2))):f==="has"?ep(o[1]):f==="!has"?Rf(ep(o[1])):f!=="within"||o}function Jh(o,u,f){switch(o){case"$type":return["filter-type-"+f,u];case"$id":return["filter-id-"+f,u];default:return["filter-"+f,o,u]}}function Cf(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(f){return typeof f!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(Qh)]]:["filter-in-small",o,["literal",u]]}}function ep(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Rf(o){return["!",o]}function Ya(o){return _c(pe(o.value))?yu(Je({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(f){var m=f.value,x=f.key;if(ma(m)!=="array")return[new Q(x,m,"array expected, "+ma(m)+" found")];var E,T=f.styleSpec,M=[];if(m.length<1)return[new Q(x,m,"filter array must have at least 1 element")];switch(M=M.concat(Nu({key:x+"[0]",value:m[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),_t(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&_t(m[1])==="$type"&&M.push(new Q(x,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new Q(x,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ma(m[1]))!=="string"&&M.push(new Q(x+"[1]",m[1],"string expected, "+E+" found"));for(var B=2;B<m.length;B++)E=ma(m[B]),_t(m[1])==="$type"?M=M.concat(Nu({key:x+"["+B+"]",value:m[B],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new Q(x+"["+B+"]",m[B],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var H=1;H<m.length;H++)M=M.concat(u({key:x+"["+H+"]",value:m[H],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":E=ma(m[1]),m.length!==2?M.push(new Q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&M.push(new Q(x+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ma(m[1]),m.length!==2?M.push(new Q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&M.push(new Q(x+"[1]",m[1],"object expected, "+E+" found"))}return M}(o)}function Mf(o,u){var f=o.key,m=o.style,x=o.styleSpec,E=o.value,T=o.objectKey,M=x[u+"_"+o.layerType];if(!M)return[];var B=T.match(/^(.*)-transition$/);if(u==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return Di({key:f,value:E,valueSpec:x.transition,style:m,styleSpec:x});var H,$=o.valueSpec||M[T];if(!$)return[new Q(f,E,'unknown property "'+T+'"')];if(ma(E)==="string"&&Fu($)&&!$.tokens&&(H=/^{([^}]+)}$/.exec(E)))return[new Q(f,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(H[1])+" }`.")];var q=[];return o.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&q.push(new Q(f,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&dc(pe(E))&&_t(E.type)==="identity"&&q.push(new Q(f,E,'"text-font" does not support identity functions'))),q.concat(Di({key:o.key,value:E,valueSpec:$,style:m,styleSpec:x,expressionContext:"property",propertyType:u,propertyKey:T}))}function tp(o){return Mf(o,"paint")}function Ec(o){return Mf(o,"layout")}function gh(o){var u=[],f=o.value,m=o.key,x=o.style,E=o.styleSpec;f.type||f.ref||u.push(new Q(m,f,'either "type" or "ref" is required'));var T,M=_t(f.type),B=_t(f.ref);if(f.id)for(var H=_t(f.id),$=0;$<o.arrayIndex;$++){var q=x.layers[$];_t(q.id)===H&&u.push(new Q(m,f.id,'duplicate layer id "'+f.id+'", previously used at line '+q.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach(function(ze){ze in f&&u.push(new Q(m,f[ze],'"'+ze+'" is prohibited for ref layers'))}),x.layers.forEach(function(ze){_t(ze.id)===B&&(T=ze)}),T?T.ref?u.push(new Q(m,f.ref,"ref cannot reference another ref layer")):M=_t(T.type):u.push(new Q(m,f.ref,'ref layer "'+B+'" not found'));else if(M!=="background")if(f.source){var ce=x.sources&&x.sources[f.source],me=ce&&_t(ce.type);ce?me==="vector"&&M==="raster"?u.push(new Q(m,f.source,'layer "'+f.id+'" requires a raster source')):me==="raster"&&M!=="raster"?u.push(new Q(m,f.source,'layer "'+f.id+'" requires a vector source')):me!=="vector"||f["source-layer"]?me==="raster-dem"&&M!=="hillshade"?u.push(new Q(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!f.paint||!f.paint["line-gradient"]||me==="geojson"&&ce.lineMetrics||u.push(new Q(m,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Q(m,f,'layer "'+f.id+'" must specify a "source-layer"')):u.push(new Q(m,f.source,'source "'+f.source+'" not found'))}else u.push(new Q(m,f,'missing required property "source"'));return u=u.concat(gu({key:m,value:f,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Di({key:m+".type",value:f.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:f,objectKey:"type"})},filter:Ya,layout:function(ze){return gu({layer:f,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(He){return Ec(Je({layerType:M},He))}}})},paint:function(ze){return gu({layer:f,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(He){return tp(Je({layerType:M},He))}}})}}}))}function Gl(o){var u=o.value,f=o.key,m=ma(u);return m!=="string"?[new Q(f,u,"string expected, "+m+" found")]:[]}var oa={promoteId:function(o){var u=o.key,f=o.value;if(ma(f)==="string")return Gl({key:u,value:f});var m=[];for(var x in f)m.push.apply(m,Gl({key:u+"."+x,value:f[x]}));return m}};function Sc(o){var u=o.value,f=o.key,m=o.styleSpec,x=o.style;if(!u.type)return[new Q(f,u,'"type" is required')];var E,T=_t(u.type);switch(T){case"vector":case"raster":case"raster-dem":return gu({key:f,value:u,valueSpec:m["source_"+T.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:oa});case"geojson":if(E=gu({key:f,value:u,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:oa}),u.cluster)for(var M in u.clusterProperties){var B=u.clusterProperties[M],H=B[0],$=typeof H=="string"?[H,["accumulated"],["get",M]]:H;E.push.apply(E,yu({key:f+"."+M+".map",value:B[1],expressionContext:"cluster-map"})),E.push.apply(E,yu({key:f+"."+M+".reduce",value:$,expressionContext:"cluster-reduce"}))}return E;case"video":return gu({key:f,value:u,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return gu({key:f,value:u,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new Q(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nu({key:f+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:m})}}function Gs(o){var u=o.value,f=o.styleSpec,m=f.light,x=o.style,E=[],T=ma(u);if(u===void 0)return E;if(T!=="object")return E.concat([new Q("light",u,"object expected, "+T+" found")]);for(var M in u){var B=M.match(/^(.*)-transition$/);E=E.concat(B&&m[B[1]]&&m[B[1]].transition?Di({key:M,value:u[M],valueSpec:f.transition,style:x,styleSpec:f}):m[M]?Di({key:M,value:u[M],valueSpec:m[M],style:x,styleSpec:f}):[new Q(M,u[M],'unknown property "'+M+'"')])}return E}var Ml={"*":function(){return[]},array:Xc,boolean:function(o){var u=o.value,f=o.key,m=ma(u);return m!=="boolean"?[new Q(f,u,"boolean expected, "+m+" found")]:[]},number:mh,color:function(o){var u=o.key,f=o.value,m=ma(f);return m!=="string"?[new Q(u,f,"color expected, "+m+" found")]:_i(f)===null?[new Q(u,f,'color expected, "'+f+'" found')]:[]},constants:ye,enum:Nu,filter:Ya,function:$c,layer:gh,object:gu,source:Sc,light:Gs,string:Gl,formatted:function(o){return Gl(o).length===0?[]:yu(o)},resolvedImage:function(o){return Gl(o).length===0?[]:yu(o)}};function Di(o){var u=o.value,f=o.valueSpec,m=o.styleSpec;return f.expression&&dc(_t(u))?$c(o):f.expression&&mc(pe(u))?yu(o):f.type&&Ml[f.type]?Ml[f.type](o):gu(Je({},o,{valueSpec:f.type?m[f.type]:f}))}function ga(o){var u=o.value,f=o.key,m=Gl(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new Q(f,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new Q(f,u,'"glyphs" url must include a "{range}" token'))),m}function Ps(o,u){u===void 0&&(u=he);var f=[];return f=f.concat(Di({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:ga,"*":function(){return[]}}})),o.constants&&(f=f.concat(ye({key:"constants",value:o.constants,style:o,styleSpec:u}))),If(f)}function If(o){return[].concat(o).sort(function(u,f){return u.line-f.line})}function Ac(o){return function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return If(o.apply(this,u))}}Ps.source=Ac(Sc),Ps.light=Ac(Gs),Ps.layer=Ac(gh),Ps.filter=Ac(Ya),Ps.paintProperty=Ac(tp),Ps.layoutProperty=Ac(Ec);var Pf=Ps,Uu=Pf.light,Of=Pf.paintProperty,Yc=Pf.layoutProperty;function Xl(o,u){var f=!1;if(u&&u.length)for(var m=0,x=u;m<x.length;m+=1)o.fire(new Ue(new Error(x[m].message))),f=!0;return f}var Po=Ia;function Ia(o,u,f){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(u=x[1])+2*(f=x[2]);for(var E=0;E<this.d*this.d;E++){var T=x[3+E],M=x[3+E+1];m.push(T===M?null:x.subarray(T,M))}var B=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],B),this.bboxes=x.subarray(B),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var H=0;H<this.d*this.d;H++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;var $=f/u*o;this.min=-$,this.max=o+$}Ia.prototype.insert=function(o,u,f,m,x){this._forEachCell(u,f,m,x,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(x)},Ia.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ia.prototype._insertCell=function(o,u,f,m,x,E){this.cells[x].push(E)},Ia.prototype.query=function(o,u,f,m,x){var E=this.min,T=this.max;if(o<=E&&u<=E&&T<=f&&T<=m&&!x)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,f,m,this._queryCell,M,{},x),M},Ia.prototype._queryCell=function(o,u,f,m,x,E,T,M){var B=this.cells[x];if(B!==null)for(var H=this.keys,$=this.bboxes,q=0;q<B.length;q++){var ce=B[q];if(T[ce]===void 0){var me=4*ce;(M?M($[me+0],$[me+1],$[me+2],$[me+3]):o<=$[me+2]&&u<=$[me+3]&&f>=$[me+0]&&m>=$[me+1])?(T[ce]=!0,E.push(H[ce])):T[ce]=!1}}},Ia.prototype._forEachCell=function(o,u,f,m,x,E,T,M){for(var B=this._convertToCellCoord(o),H=this._convertToCellCoord(u),$=this._convertToCellCoord(f),q=this._convertToCellCoord(m),ce=B;ce<=$;ce++)for(var me=H;me<=q;me++){var ze=this.d*me+ce;if((!M||M(this._convertFromCellCoord(ce),this._convertFromCellCoord(me),this._convertFromCellCoord(ce+1),this._convertFromCellCoord(me+1)))&&x.call(this,o,u,f,m,ze,E,T,M))return}},Ia.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Ia.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Ia.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,f=0,m=0;m<this.cells.length;m++)f+=this.cells[m].length;var x=new Int32Array(u+f+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var E=u,T=0;T<o.length;T++){var M=o[T];x[3+T]=E,x.set(M,E),E+=M.length}return x[3+o.length]=E,x.set(this.keys,E),x[3+o.length+1]=E+=this.keys.length,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer};var qc=ne.ImageData,rp=ne.ImageBitmap,Pa={};function An(o,u,f){f===void 0&&(f={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),Pa[o]={klass:u,omit:f.omit||[],shallow:f.shallow||[]}}for(var fs in An("Object",Object),Po.serialize=function(o,u){var f=o.toArrayBuffer();return u&&u.push(f),{buffer:f}},Po.deserialize=function(o){return new Po(o.buffer)},An("Grid",Po),An("Color",Ti),An("Error",Error),An("ResolvedImage",Ra),An("StylePropertyFunction",Rl),An("StyleExpression",Cl,{omit:["_evaluator"]}),An("ZoomDependentExpression",yc),An("ZoomConstantExpression",gc),An("CompoundExpression",zi,{omit:["_evaluate"]}),Bu)Bu[fs]._classRegistryKey||An("Expression_"+fs,Bu[fs]);function Tc(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Kc(o){return rp&&o instanceof rp}function hs(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Tc(o)||Kc(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var f=o;return u&&u.push(f.buffer),f}if(o instanceof qc)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],x=0,E=o;x<E.length;x+=1)m.push(hs(E[x],u));return m}if(typeof o=="object"){var T=o.constructor,M=T._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var B=T.serialize?T.serialize(o,u):{};if(!T.serialize){for(var H in o)if(o.hasOwnProperty(H)&&!(Pa[M].omit.indexOf(H)>=0)){var $=o[H];B[H]=Pa[M].shallow.indexOf(H)>=0?$:hs($,u)}o instanceof Error&&(B.message=o.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(B.$name=M),B}throw new Error("can't serialize object of type "+typeof o)}function sa(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Tc(o)||Kc(o)||ArrayBuffer.isView(o)||o instanceof qc)return o;if(Array.isArray(o))return o.map(sa);if(typeof o=="object"){var u=o.$name||"Object",f=Pa[u].klass;if(!f)throw new Error("can't deserialize unregistered class "+u);if(f.deserialize)return f.deserialize(o);for(var m=Object.create(f.prototype),x=0,E=Object.keys(o);x<E.length;x+=1){var T=E[x];if(T!=="$name"){var M=o[T];m[T]=Pa[u].shallow.indexOf(T)>=0?M:sa(M)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var kf=function(){this.first=!0};kf.prototype.update=function(o,u){var f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))};var ln={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function Il(o){for(var u=0,f=o;u<f.length;u+=1)if(Qc(f[u].charCodeAt(0)))return!0;return!1}function Qc(o){return!(o!==746&&o!==747&&(o<4352||!(ln["Bopomofo Extended"](o)||ln.Bopomofo(o)||ln["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||ln["CJK Compatibility Ideographs"](o)||ln["CJK Compatibility"](o)||ln["CJK Radicals Supplement"](o)||ln["CJK Strokes"](o)||!(!ln["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||ln["CJK Unified Ideographs Extension A"](o)||ln["CJK Unified Ideographs"](o)||ln["Enclosed CJK Letters and Months"](o)||ln["Hangul Compatibility Jamo"](o)||ln["Hangul Jamo Extended-A"](o)||ln["Hangul Jamo Extended-B"](o)||ln["Hangul Jamo"](o)||ln["Hangul Syllables"](o)||ln.Hiragana(o)||ln["Ideographic Description Characters"](o)||ln.Kanbun(o)||ln["Kangxi Radicals"](o)||ln["Katakana Phonetic Extensions"](o)||ln.Katakana(o)&&o!==12540||!(!ln["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!ln["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||ln["Unified Canadian Aboriginal Syllabics"](o)||ln["Unified Canadian Aboriginal Syllabics Extended"](o)||ln["Vertical Forms"](o)||ln["Yijing Hexagram Symbols"](o)||ln["Yi Syllables"](o)||ln["Yi Radicals"](o))))}function Df(o){return!(Qc(o)||function(u){return!!(ln["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||ln["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||ln["Letterlike Symbols"](u)||ln["Number Forms"](u)||ln["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||ln["Control Pictures"](u)&&u!==9251||ln["Optical Character Recognition"](u)||ln["Enclosed Alphanumerics"](u)||ln["Geometric Shapes"](u)||ln["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||ln["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||ln["CJK Symbols and Punctuation"](u)||ln.Katakana(u)||ln["Private Use Area"](u)||ln["CJK Compatibility Forms"](u)||ln["Small Form Variants"](u)||ln["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function Xs(o){return o>=1424&&o<=2303||ln["Arabic Presentation Forms-A"](o)||ln["Arabic Presentation Forms-B"](o)}function $s(o,u){return!(!u&&Xs(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||ln.Khmer(o))}function Lf(o){for(var u=0,f=o;u<f.length;u+=1)if(Xs(f[u].charCodeAt(0)))return!0;return!1}var Bf=null,ps="unavailable",zu=null,yh=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ps="error"),Bf&&Bf(o)};function wc(){Ff.fire(new Ee("pluginStateChange",{pluginStatus:ps,pluginURL:zu}))}var Ff=new et,Jc=function(){return ps},ds=function(){if(ps!=="deferred"||!zu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ps="loading",wc(),zu&&kt({url:zu},function(o){o?yh(o):(ps="loaded",wc())})},Ys={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ps==="loaded"||Ys.applyArabicShaping!=null},isLoading:function(){return ps==="loading"},setState:function(o){ps=o.pluginStatus,zu=o.pluginURL},isParsed:function(){return Ys.applyArabicShaping!=null&&Ys.processBidirectionalText!=null&&Ys.processStyledBidirectionalText!=null},getPluginURL:function(){return zu}},St=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kf,this.transition={})};St.prototype.isSupportedScript=function(o){return function(u,f){for(var m=0,x=u;m<x.length;m+=1)if(!$s(x[m].charCodeAt(0),f))return!1;return!0}(o,Ys.isLoaded())},St.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},St.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}};var Be=function(o,u){this.property=o,this.value=u,this.expression=function(f,m){if(dc(f))return new Rl(f,m);if(mc(f)){var x=vh(f,m);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var E=f;return typeof f=="string"&&m.type==="color"&&(E=Ti.parse(f)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};Be.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Be.prototype.possiblyEvaluate=function(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)};var F=function(o){this.property=o,this.value=new Be(o,void 0)};F.prototype.transitioned=function(o,u){return new Ae(this.property,this.value,u,$t({},o.transition,this.transition),o.now)},F.prototype.untransitioned=function(){return new Ae(this.property,this.value,null,{},0)};var Oo=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};Oo.prototype.getValue=function(o){return ct(this._values[o].value.value)},Oo.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].value=new Be(this._values[o].property,u===null?void 0:ct(u))},Oo.prototype.getTransition=function(o){return ct(this._values[o].transition)},Oo.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].transition=ct(u)||void 0},Oo.prototype.serialize=function(){for(var o={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u],x=this.getValue(m);x!==void 0&&(o[m]=x);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},Oo.prototype.transitioned=function(o,u){for(var f=new al(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var E=x[m];f._values[E]=this._values[E].transitioned(o,u._values[E])}return f},Oo.prototype.untransitioned=function(){for(var o=new al(this._properties),u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u];o._values[m]=this._values[m].untransitioned()}return o};var Ae=function(o,u,f,m,x){this.property=o,this.value=u,this.begin=x+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=f)};Ae.prototype.possiblyEvaluate=function(o,u,f){var m=o.now||0,x=this.value.possiblyEvaluate(o,u,f),E=this.prior;if(E){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return E.possiblyEvaluate(o,u,f);var T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,f),x,function(M){if(M<=0)return 0;if(M>=1)return 1;var B=M*M,H=B*M;return 4*(M<.5?H:3*(M-B)+H-.75)}(T))}return x};var al=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};al.prototype.possiblyEvaluate=function(o,u,f){for(var m=new ol(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,f)}return m},al.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var ba=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};ba.prototype.getValue=function(o){return ct(this._values[o].value)},ba.prototype.setValue=function(o,u){this._values[o]=new Be(this._values[o].property,u===null?void 0:ct(u))},ba.prototype.serialize=function(){for(var o={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var m=f[u],x=this.getValue(m);x!==void 0&&(o[m]=x)}return o},ba.prototype.possiblyEvaluate=function(o,u,f){for(var m=new ol(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,f)}return m};var ko=function(o,u,f){this.property=o,this.value=u,this.parameters=f};ko.prototype.isConstant=function(){return this.value.kind==="constant"},ko.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},ko.prototype.evaluate=function(o,u,f,m){return this.property.evaluate(this.value,this.parameters,o,u,f,m)};var ol=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};ol.prototype.get=function(o){return this._values[o]};var wn=function(o){this.specification=o};wn.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},wn.prototype.interpolate=function(o,u,f){var m=Sl[this.specification.type];return m?m(o,u,f):o};var Cn=function(o,u){this.specification=o,this.overrides=u};Cn.prototype.possiblyEvaluate=function(o,u,f,m){return new ko(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},f,m)}:o.expression,u)},Cn.prototype.interpolate=function(o,u,f){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new ko(this,{kind:"constant",value:void 0},o.parameters);var m=Sl[this.specification.type];return m?new ko(this,{kind:"constant",value:m(o.value.value,u.value.value,f)},o.parameters):o},Cn.prototype.evaluate=function(o,u,f,m,x,E){return o.kind==="constant"?o.value:o.evaluate(u,f,m,x,E)};var Es=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,m,x,E){if(f.value===void 0)return new ko(this,{kind:"constant",value:void 0},m);if(f.expression.kind==="constant"){var T=f.expression.evaluate(m,null,{},x,E),M=f.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,B=this._calculate(M,M,M,m);return new ko(this,{kind:"constant",value:B},m)}if(f.expression.kind==="camera"){var H=this._calculate(f.expression.evaluate({zoom:m.zoom-1}),f.expression.evaluate({zoom:m.zoom}),f.expression.evaluate({zoom:m.zoom+1}),m);return new ko(this,{kind:"constant",value:H},m)}return new ko(this,f.expression,m)},u.prototype.evaluate=function(f,m,x,E,T,M){if(f.kind==="source"){var B=f.evaluate(m,x,E,T,M);return this._calculate(B,B,B,m)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(m.zoom)-1},x,E),f.evaluate({zoom:Math.floor(m.zoom)},x,E),f.evaluate({zoom:Math.floor(m.zoom)+1},x,E),m):f.value},u.prototype._calculate=function(f,m,x,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:f,to:m}:{from:x,to:m}},u.prototype.interpolate=function(f){return f},u}(Cn),Eo=function(o){this.specification=o};Eo.prototype.possiblyEvaluate=function(o,u,f,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var x=o.expression.evaluate(u,null,{},f,m);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new St(Math.floor(u.zoom-1),u)),o.expression.evaluate(new St(Math.floor(u.zoom),u)),o.expression.evaluate(new St(Math.floor(u.zoom+1),u)),u)}},Eo.prototype._calculate=function(o,u,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}},Eo.prototype.interpolate=function(o){return o};var _u=function(o){this.specification=o};_u.prototype.possiblyEvaluate=function(o,u,f,m){return!!o.expression.evaluate(u,null,{},f,m)},_u.prototype.interpolate=function(){return!1};var Oa=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var f=o[u];f.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new Be(f,void 0),x=this.defaultTransitionablePropertyValues[u]=new F(f);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};An("DataDrivenProperty",Cn),An("DataConstantProperty",wn),An("CrossFadedDataDrivenProperty",Es),An("CrossFadedProperty",Eo),An("ColorRampProperty",_u);var iu=function(o){function u(f,m){if(o.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),m.layout&&(this._unevaluatedLayout=new ba(m.layout)),m.paint)){for(var x in this._transitionablePaint=new Oo(m.paint),f.paint)this.setPaintProperty(x,f.paint[x],{validate:!1});for(var E in f.layout)this.setLayoutProperty(E,f.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ol(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},u.prototype.setLayoutProperty=function(f,m,x){x===void 0&&(x={}),m!=null&&this._validate(Yc,"layers."+this.id+".layout."+f,f,m,x)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,m):this.visibility=m)},u.prototype.getPaintProperty=function(f){return Ar(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-"-transition".length)):this._transitionablePaint.getValue(f)},u.prototype.setPaintProperty=function(f,m,x){if(x===void 0&&(x={}),m!=null&&this._validate(Of,"layers."+this.id+".paint."+f,f,m,x))return!1;if(Ar(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-"-transition".length),m||void 0),!1;var E=this._transitionablePaint._values[f],T=E.property.specification["property-type"]==="cross-faded-data-driven",M=E.value.isDataDriven(),B=E.value;this._transitionablePaint.setValue(f,m),this._handleSpecialPaintPropertyUpdate(f);var H=this._transitionablePaint._values[f].value;return H.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(f,B,H)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){},u.prototype._handleOverridablePaintPropertyUpdate=function(f,m,x){return!1},u.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(f,m){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,m)},u.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),It(f,function(m,x){return!(m===void 0||x==="layout"&&!Object.keys(m).length||x==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(f,m,x,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Xl(this,f.call(Pf,{key:m,layerType:this.type,objectKey:x,value:E,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var f in this.paint._values){var m=this.paint.get(f);if(m instanceof ko&&Fu(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(et),Zu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},sl=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Vi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(o,u){u===void 0&&(u=1);var f=0,m=0;return{members:o.map(function(x){var E=Zu[x.type].BYTES_PER_ELEMENT,T=f=Nf(f,Math.max(u,E)),M=x.components||1;return m=Math.max(m,E),f+=E*M,{name:x.name,type:x.type,components:M,offset:T}}),size:Nf(f,Math.max(m,u)),alignment:u}}function Nf(o,u){return Math.ceil(o/u)*u}Vi.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},Vi.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Vi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Vi.prototype.clear=function(){this.length=0},Vi.prototype.resize=function(o){this.reserve(o),this.length=o},Vi.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Vi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Pl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.int16[E+0]=m,this.int16[E+1]=x,f},u}(Vi);Pl.prototype.bytesPerElement=4,An("StructArrayLayout2i4",Pl);var Uf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=4*f;return this.int16[M+0]=m,this.int16[M+1]=x,this.int16[M+2]=E,this.int16[M+3]=T,f},u}(Vi);Uf.prototype.bytesPerElement=8,An("StructArrayLayout4i8",Uf);var ul=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,B){var H=6*f;return this.int16[H+0]=m,this.int16[H+1]=x,this.int16[H+2]=E,this.int16[H+3]=T,this.int16[H+4]=M,this.int16[H+5]=B,f},u}(Vi);ul.prototype.bytesPerElement=12,An("StructArrayLayout2i4i12",ul);var Os=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,B){var H=4*f,$=8*f;return this.int16[H+0]=m,this.int16[H+1]=x,this.uint8[$+4]=E,this.uint8[$+5]=T,this.uint8[$+6]=M,this.uint8[$+7]=B,f},u}(Vi);Os.prototype.bytesPerElement=8,An("StructArrayLayout2i4ub8",Os);var Ol=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.float32[E+0]=m,this.float32[E+1]=x,f},u}(Vi);Ol.prototype.bytesPerElement=8,An("StructArrayLayout2f8",Ol);var xu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,B,H,$,q){var ce=this.length;return this.resize(ce+1),this.emplace(ce,f,m,x,E,T,M,B,H,$,q)},u.prototype.emplace=function(f,m,x,E,T,M,B,H,$,q,ce){var me=10*f;return this.uint16[me+0]=m,this.uint16[me+1]=x,this.uint16[me+2]=E,this.uint16[me+3]=T,this.uint16[me+4]=M,this.uint16[me+5]=B,this.uint16[me+6]=H,this.uint16[me+7]=$,this.uint16[me+8]=q,this.uint16[me+9]=ce,f},u}(Vi);xu.prototype.bytesPerElement=20,An("StructArrayLayout10ui20",xu);var ef=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,B,H,$,q,ce,me){var ze=this.length;return this.resize(ze+1),this.emplace(ze,f,m,x,E,T,M,B,H,$,q,ce,me)},u.prototype.emplace=function(f,m,x,E,T,M,B,H,$,q,ce,me,ze){var He=12*f;return this.int16[He+0]=m,this.int16[He+1]=x,this.int16[He+2]=E,this.int16[He+3]=T,this.uint16[He+4]=M,this.uint16[He+5]=B,this.uint16[He+6]=H,this.uint16[He+7]=$,this.int16[He+8]=q,this.int16[He+9]=ce,this.int16[He+10]=me,this.int16[He+11]=ze,f},u}(Vi);ef.prototype.bytesPerElement=24,An("StructArrayLayout4i4ui4i24",ef);var Cc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.float32[T+0]=m,this.float32[T+1]=x,this.float32[T+2]=E,f},u}(Vi);Cc.prototype.bytesPerElement=12,An("StructArrayLayout3f12",Cc);var tf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.uint32[1*f+0]=m,f},u}(Vi);tf.prototype.bytesPerElement=4,An("StructArrayLayout1ul4",tf);var zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,B,H,$){var q=this.length;return this.resize(q+1),this.emplace(q,f,m,x,E,T,M,B,H,$)},u.prototype.emplace=function(f,m,x,E,T,M,B,H,$,q){var ce=10*f,me=5*f;return this.int16[ce+0]=m,this.int16[ce+1]=x,this.int16[ce+2]=E,this.int16[ce+3]=T,this.int16[ce+4]=M,this.int16[ce+5]=B,this.uint32[me+3]=H,this.uint16[ce+8]=$,this.uint16[ce+9]=q,f},u}(Vi);zf.prototype.bytesPerElement=20,An("StructArrayLayout6i1ul2ui20",zf);var $l=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M){var B=this.length;return this.resize(B+1),this.emplace(B,f,m,x,E,T,M)},u.prototype.emplace=function(f,m,x,E,T,M,B){var H=6*f;return this.int16[H+0]=m,this.int16[H+1]=x,this.int16[H+2]=E,this.int16[H+3]=T,this.int16[H+4]=M,this.int16[H+5]=B,f},u}(Vi);$l.prototype.bytesPerElement=12,An("StructArrayLayout2i2i2i12",$l);var Yl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T){var M=this.length;return this.resize(M+1),this.emplace(M,f,m,x,E,T)},u.prototype.emplace=function(f,m,x,E,T,M){var B=4*f,H=8*f;return this.float32[B+0]=m,this.float32[B+1]=x,this.float32[B+2]=E,this.int16[H+6]=T,this.int16[H+7]=M,f},u}(Vi);Yl.prototype.bytesPerElement=16,An("StructArrayLayout2f1f2i16",Yl);var _h=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=12*f,B=3*f;return this.uint8[M+0]=m,this.uint8[M+1]=x,this.float32[B+1]=E,this.float32[B+2]=T,f},u}(Vi);_h.prototype.bytesPerElement=12,An("StructArrayLayout2ub2f12",_h);var Vu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.uint16[T+0]=m,this.uint16[T+1]=x,this.uint16[T+2]=E,f},u}(Vi);Vu.prototype.bytesPerElement=6,An("StructArrayLayout3ui6",Vu);var Xo=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt){var Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt)},u.prototype.emplace=function(f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt,Ut){var Kt=24*f,ar=12*f,hr=48*f;return this.int16[Kt+0]=m,this.int16[Kt+1]=x,this.uint16[Kt+2]=E,this.uint16[Kt+3]=T,this.uint32[ar+2]=M,this.uint32[ar+3]=B,this.uint32[ar+4]=H,this.uint16[Kt+10]=$,this.uint16[Kt+11]=q,this.uint16[Kt+12]=ce,this.float32[ar+7]=me,this.float32[ar+8]=ze,this.uint8[hr+36]=He,this.uint8[hr+37]=lt,this.uint8[hr+38]=tt,this.uint32[ar+10]=Rt,this.int16[Kt+22]=Ut,f},u}(Vi);Xo.prototype.bytesPerElement=48,An("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xo);var Zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt,Ut,Kt,ar,hr,Wr,on,Un,_n,Gn,En,wi){var oi=this.length;return this.resize(oi+1),this.emplace(oi,f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt,Ut,Kt,ar,hr,Wr,on,Un,_n,Gn,En,wi)},u.prototype.emplace=function(f,m,x,E,T,M,B,H,$,q,ce,me,ze,He,lt,tt,Rt,Ut,Kt,ar,hr,Wr,on,Un,_n,Gn,En,wi,oi){var Ir=34*f,mn=17*f;return this.int16[Ir+0]=m,this.int16[Ir+1]=x,this.int16[Ir+2]=E,this.int16[Ir+3]=T,this.int16[Ir+4]=M,this.int16[Ir+5]=B,this.int16[Ir+6]=H,this.int16[Ir+7]=$,this.uint16[Ir+8]=q,this.uint16[Ir+9]=ce,this.uint16[Ir+10]=me,this.uint16[Ir+11]=ze,this.uint16[Ir+12]=He,this.uint16[Ir+13]=lt,this.uint16[Ir+14]=tt,this.uint16[Ir+15]=Rt,this.uint16[Ir+16]=Ut,this.uint16[Ir+17]=Kt,this.uint16[Ir+18]=ar,this.uint16[Ir+19]=hr,this.uint16[Ir+20]=Wr,this.uint16[Ir+21]=on,this.uint16[Ir+22]=Un,this.uint32[mn+12]=_n,this.float32[mn+13]=Gn,this.float32[mn+14]=En,this.float32[mn+15]=wi,this.float32[mn+16]=oi,f},u}(Vi);Zf.prototype.bytesPerElement=68,An("StructArrayLayout8i15ui1ul4f68",Zf);var ll=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.float32[1*f+0]=m,f},u}(Vi);ll.prototype.bytesPerElement=4,An("StructArrayLayout1f4",ll);var au=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=3*f;return this.int16[T+0]=m,this.int16[T+1]=x,this.int16[T+2]=E,f},u}(Vi);au.prototype.bytesPerElement=6,An("StructArrayLayout3i6",au);var xh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,f,m,x)},u.prototype.emplace=function(f,m,x,E){var T=4*f;return this.uint32[2*f+0]=m,this.uint16[T+2]=x,this.uint16[T+3]=E,f},u}(Vi);xh.prototype.bytesPerElement=8,An("StructArrayLayout1ul2ui8",xh);var rf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m){var x=this.length;return this.resize(x+1),this.emplace(x,f,m)},u.prototype.emplace=function(f,m,x){var E=2*f;return this.uint16[E+0]=m,this.uint16[E+1]=x,f},u}(Vi);rf.prototype.bytesPerElement=4,An("StructArrayLayout2ui4",rf);var cl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var m=this.length;return this.resize(m+1),this.emplace(m,f)},u.prototype.emplace=function(f,m){return this.uint16[1*f+0]=m,f},u}(Vi);cl.prototype.bytesPerElement=2,An("StructArrayLayout1ui2",cl);var Vf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,m,x,E)},u.prototype.emplace=function(f,m,x,E,T){var M=4*f;return this.float32[M+0]=m,this.float32[M+1]=x,this.float32[M+2]=E,this.float32[M+3]=T,f},u}(Vi);Vf.prototype.bytesPerElement=16,An("StructArrayLayout4f16",Vf);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new ie(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,f),u}(sl);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new h(this,f)},u}(zf);An("CollisionBoxArray",v);var d=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,f),u}(sl);d.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new d(this,f)},u}(Xo);An("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,f),u}(sl);S.prototype.size=68;var C=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new S(this,f)},u}(Zf);An("SymbolInstanceArray",C);var R=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(f){return this.float32[1*f+0]},u}(ll);An("GlyphOffsetArray",R);var k=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(f){return this.int16[3*f+0]},u.prototype.gety=function(f){return this.int16[3*f+1]},u.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},u}(au);An("SymbolLineVertexArray",k);var G=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,f),u}(sl);G.prototype.size=8;var J=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(f){return new G(this,f)},u}(xh);An("FeatureIndexArray",J);var _e=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,be=function(o){o===void 0&&(o=[]),this.segments=o};function Te(o,u){return 256*(o=Pt(Math.floor(o),0,255))+Pt(Math.floor(u),0,255)}be.prototype.prepareSegment=function(o,u,f,m){var x=this.segments[this.segments.length-1];return o>be.MAX_VERTEX_ARRAY_LENGTH&&ht("Max vertices per segment is "+be.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!x||x.vertexLength+o>be.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x},be.prototype.get=function(){return this.segments},be.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var f=u[o];for(var m in f.vaos)f.vaos[m].destroy()}},be.simpleSegment=function(o,u,f,m){return new be([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])},be.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,An("SegmentVector",be);var $e=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ve=de(function(o){o.exports=function(u,f){var m,x,E,T,M,B,H,$;for(x=u.length-(m=3&u.length),E=f,M=3432918353,B=461845907,$=0;$<x;)H=255&u.charCodeAt($)|(255&u.charCodeAt(++$))<<8|(255&u.charCodeAt(++$))<<16|(255&u.charCodeAt(++$))<<24,++$,E=27492+(65535&(T=5*(65535&(E=(E^=H=(65535&(H=(H=(65535&H)*M+(((H>>>16)*M&65535)<<16)&4294967295)<<15|H>>>17))*B+(((H>>>16)*B&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(H=0,m){case 3:H^=(255&u.charCodeAt($+2))<<16;case 2:H^=(255&u.charCodeAt($+1))<<8;case 1:E^=H=(65535&(H=(H=(65535&(H^=255&u.charCodeAt($)))*M+(((H>>>16)*M&65535)<<16)&4294967295)<<15|H>>>17))*B+(((H>>>16)*B&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),st=de(function(o){o.exports=function(u,f){for(var m,x=u.length,E=f^x,T=0;x>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Fe=Ve,at=st;Fe.murmur3=Ve,Fe.murmur2=at;var bt=function(){this.ids=[],this.positions=[],this.indexed=!1};bt.prototype.add=function(o,u,f,m){this.ids.push(nr(o)),this.positions.push(u,f,m)},bt.prototype.getPositions=function(o){for(var u=nr(o),f=0,m=this.ids.length-1;f<m;){var x=f+m>>1;this.ids[x]>=u?m=x:f=x+1}for(var E=[];this.ids[f]===u;)E.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return E},bt.serialize=function(o,u){var f=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function x(E,T,M,B){for(;M<B;){for(var H=E[M+B>>1],$=M-1,q=B+1;;){do $++;while(E[$]<H);do q--;while(E[q]>H);if($>=q)break;qt(E,$,q),qt(T,3*$,3*q),qt(T,3*$+1,3*q+1),qt(T,3*$+2,3*q+2)}q-M<B-q?(x(E,T,M,q),M=q+1):(x(E,T,q+1,B),B=q)}}(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}},bt.deserialize=function(o){var u=new bt;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var Nt=Math.pow(2,53)-1;function nr(o){var u=+o;return!isNaN(u)&&u<=Nt?u:Fe(String(o))}function qt(o,u,f){var m=o[u];o[u]=o[f],o[f]=m}An("FeaturePositionMap",bt);var fr=function(o,u){this.gl=o.gl,this.location=u},Er=function(o){function u(f,m){o.call(this,f,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},u}(fr),Gr=function(o){function u(f,m){o.call(this,f,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},u}(fr),Zr=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},u}(fr),vn=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},u}(fr),zn=function(o){function u(f,m){o.call(this,f,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},u}(fr),Hn=function(o){function u(f,m){o.call(this,f,m),this.current=Ti.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},u}(fr),Fn=new Float32Array(16),Bi=function(o){function u(f,m){o.call(this,f,m),this.current=Fn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var m=1;m<16;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},u}(fr);function bn(o){return[Te(255*o.r,255*o.g),Te(255*o.b,255*o.a)]}var ui=function(o,u,f){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=f};ui.prototype.setUniform=function(o,u,f){o.set(f.constantOr(this.value))},ui.prototype.getBinding=function(o,u,f){return this.type==="color"?new Hn(o,u):new Gr(o,u)};var bi=function(o,u){this.uniformNames=u.map(function(f){return"u_"+f}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};bi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},bi.prototype.setUniform=function(o,u,f,m){var x=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)},bi.prototype.getBinding=function(o,u,f){return f.substr(0,9)==="u_pattern"?new zn(o,u):new Gr(o,u)};var ti=function(o,u,f,m){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(function(x){return{name:"a_"+x,type:"Float32",components:f==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ti.prototype.populatePaintArray=function(o,u,f,m,x){var E=this.paintVertexArray.length,T=this.expression.evaluate(new St(0),u,{},m,[],x);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)},ti.prototype.updatePaintArray=function(o,u,f,m){var x=this.expression.evaluate({zoom:0},f,m);this._setPaintValue(o,u,x)},ti.prototype._setPaintValue=function(o,u,f){if(this.type==="color")for(var m=bn(f),x=o;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},ti.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ii=function(o,u,f,m,x,E){this.expression=o,this.uniformNames=u.map(function(T){return"u_"+T+"_t"}),this.type=f,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:f==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ii.prototype.populatePaintArray=function(o,u,f,m,x){var E=this.expression.evaluate(new St(this.zoom),u,{},m,[],x),T=this.expression.evaluate(new St(this.zoom+1),u,{},m,[],x),M=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(M,o,E,T)},ii.prototype.updatePaintArray=function(o,u,f,m){var x=this.expression.evaluate({zoom:this.zoom},f,m),E=this.expression.evaluate({zoom:this.zoom+1},f,m);this._setPaintValue(o,u,x,E)},ii.prototype._setPaintValue=function(o,u,f,m){if(this.type==="color")for(var x=bn(f),E=bn(m),T=o;T<u;T++)this.paintVertexArray.emplace(T,x[0],x[1],E[0],E[1]);else{for(var M=o;M<u;M++)this.paintVertexArray.emplace(M,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}},ii.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ii.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ii.prototype.setUniform=function(o,u){var f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=Pt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(m)},ii.prototype.getBinding=function(o,u,f){return new Gr(o,u)};var gi=function(o,u,f,m,x,E){this.expression=o,this.type=u,this.useIntegerZoom=f,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};gi.prototype.populatePaintArray=function(o,u,f){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],f)},gi.prototype.updatePaintArray=function(o,u,f,m,x){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],x)},gi.prototype._setPaintValues=function(o,u,f,m){if(m&&f){var x=m[f.min],E=m[f.mid],T=m[f.max];if(x&&E&&T)for(var M=o;M<u;M++)this.zoomInPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},gi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,$e.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,$e.members,this.expression.isStateDependent))},gi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Jn=function(o,u,f){this.binders={},this._buffers=[];var m=[];for(var x in o.paint._values)if(f(x)){var E=o.paint.get(x);if(E instanceof ko&&Fu(E.property.specification)){var T=uo(x,o.type),M=E.value,B=E.property.specification.type,H=E.property.useIntegerZoom,$=E.property.specification["property-type"],q=$==="cross-faded"||$==="cross-faded-data-driven";if(M.kind==="constant")this.binders[x]=q?new bi(M.value,T):new ui(M.value,T,B),m.push("/u_"+x);else if(M.kind==="source"||q){var ce=qa(x,B,"source");this.binders[x]=q?new gi(M,B,H,u,ce,o.id):new ti(M,T,B,ce),m.push("/a_"+x)}else{var me=qa(x,B,"composite");this.binders[x]=new ii(M,T,B,H,u,me),m.push("/z_"+x)}}}this.cacheKey=m.sort().join("")};Jn.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof ti||u instanceof ii?u.maxValue:0},Jn.prototype.populatePaintArrays=function(o,u,f,m,x){for(var E in this.binders){var T=this.binders[E];(T instanceof ti||T instanceof ii||T instanceof gi)&&T.populatePaintArray(o,u,f,m,x)}},Jn.prototype.setConstantPatternPositions=function(o,u){for(var f in this.binders){var m=this.binders[f];m instanceof bi&&m.setConstantPatternPositions(o,u)}},Jn.prototype.updatePaintArrays=function(o,u,f,m,x){var E=!1;for(var T in o)for(var M=0,B=u.getPositions(T);M<B.length;M+=1){var H=B[M],$=f.feature(H.index);for(var q in this.binders){var ce=this.binders[q];if((ce instanceof ti||ce instanceof ii||ce instanceof gi)&&ce.expression.isStateDependent===!0){var me=m.paint.get(q);ce.expression=me.value,ce.updatePaintArray(H.start,H.end,$,o[T],x),E=!0}}}return E},Jn.prototype.defines=function(){var o=[];for(var u in this.binders){var f=this.binders[u];(f instanceof ui||f instanceof bi)&&o.push.apply(o,f.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},Jn.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof ti||f instanceof ii)for(var m=0;m<f.paintVertexAttributes.length;m++)o.push(f.paintVertexAttributes[m].name);else if(f instanceof gi)for(var x=0;x<$e.members.length;x++)o.push($e.members[x].name)}return o},Jn.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof ui||f instanceof bi||f instanceof ii)for(var m=0,x=f.uniformNames;m<x.length;m+=1)o.push(x[m])}return o},Jn.prototype.getPaintVertexBuffers=function(){return this._buffers},Jn.prototype.getUniforms=function(o,u){var f=[];for(var m in this.binders){var x=this.binders[m];if(x instanceof ui||x instanceof bi||x instanceof ii)for(var E=0,T=x.uniformNames;E<T.length;E+=1){var M=T[E];if(u[M]){var B=x.getBinding(o,u[M],M);f.push({name:M,property:m,binding:B})}}}return f},Jn.prototype.setUniforms=function(o,u,f,m){for(var x=0,E=u;x<E.length;x+=1){var T=E[x],M=T.name,B=T.property;this.binders[B].setUniform(T.binding,m,f.get(B),M)}},Jn.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var f=this.binders[u];if(o&&f instanceof gi){var m=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof ti||f instanceof ii)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},Jn.prototype.upload=function(o){for(var u in this.binders){var f=this.binders[u];(f instanceof ti||f instanceof ii||f instanceof gi)&&f.upload(o)}this.updatePaintBuffers()},Jn.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof ti||u instanceof ii||u instanceof gi)&&u.destroy()}};var ei=function(o,u,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var m=0,x=o;m<x.length;m+=1){var E=x[m];this.programConfigurations[E.id]=new Jn(E,u,f)}this.needsUpload=!1,this._featureMap=new bt,this._bufferOffset=0};function uo(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function qa(o,u,f){var m={color:{source:Ol,composite:Vf},number:{source:ll,composite:Ol}},x=function(E){return{"line-pattern":{source:xu,composite:xu},"fill-pattern":{source:xu,composite:xu},"fill-extrusion-pattern":{source:xu,composite:xu}}[E]}(o);return x&&x[f]||m[u][f]}ei.prototype.populatePaintArrays=function(o,u,f,m,x,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,u,m,x,E);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},ei.prototype.updatePaintArrays=function(o,u,f,m){for(var x=0,E=f;x<E.length;x+=1){var T=E[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,u,T,m)||this.needsUpload}},ei.prototype.get=function(o){return this.programConfigurations[o]},ei.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},ei.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},An("ConstantBinder",ui),An("CrossFadedConstantBinder",bi),An("SourceExpressionBinder",ti),An("CrossFadedCompositeBinder",gi),An("CompositeExpressionBinder",ii),An("ProgramConfiguration",Jn,{omit:["_buffers"]}),An("ProgramConfigurationSet",ei);var $o=Math.pow(2,14)-1,lo=-$o-1;function Ta(o){for(var u=8192/o.extent,f=o.loadGeometry(),m=0;m<f.length;m++)for(var x=f[m],E=0;E<x.length;E++){var T=x[E],M=Math.round(T.x*u),B=Math.round(T.y*u);T.x=Pt(M,lo,$o),T.y=Pt(B,lo,$o),(M<T.x||M>T.x+1||B<T.y||B>T.y+1)&&ht("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Ka(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?Ta(o):[]}}function Ss(o,u,f,m,x){o.emplaceBack(2*u+(m+1)/2,2*f+(x+1)/2)}var ts=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Pl,this.indexArray=new Vu,this.segments=new be,this.programConfigurations=new ei(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function fl(o,u){for(var f=0;f<o.length;f++)if(bu(u,o[f]))return!0;for(var m=0;m<u.length;m++)if(bu(o,u[m]))return!0;return!!Rc(o,u)}function As(o,u,f){return!!bu(o,u)||!!qs(u,o,f)}function ou(o,u){if(o.length===1)return kl(u,o[0]);for(var f=0;f<u.length;f++)for(var m=u[f],x=0;x<m.length;x++)if(bu(o,m[x]))return!0;for(var E=0;E<o.length;E++)if(kl(u,o[E]))return!0;for(var T=0;T<u.length;T++)if(Rc(o,u[T]))return!0;return!1}function ks(o,u,f){if(o.length>1){if(Rc(o,u))return!0;for(var m=0;m<u.length;m++)if(qs(u[m],o,f))return!0}for(var x=0;x<o.length;x++)if(qs(o[x],u,f))return!0;return!1}function Rc(o,u){if(o.length===0||u.length===0)return!1;for(var f=0;f<o.length-1;f++)for(var m=o[f],x=o[f+1],E=0;E<u.length-1;E++)if(ql(m,x,u[E],u[E+1]))return!0;return!1}function ql(o,u,f,m){return sr(o,f,m)!==sr(u,f,m)&&sr(o,u,f)!==sr(o,u,m)}function qs(o,u,f){var m=f*f;if(u.length===1)return o.distSqr(u[0])<m;for(var x=1;x<u.length;x++)if(hl(o,u[x-1],u[x])<m)return!0;return!1}function hl(o,u,f){var m=u.distSqr(f);if(m===0)return o.distSqr(u);var x=((o.x-u.x)*(f.x-u.x)+(o.y-u.y)*(f.y-u.y))/m;return o.distSqr(x<0?u:x>1?f:f.sub(u)._mult(x)._add(u))}function kl(o,u){for(var f,m,x,E=!1,T=0;T<o.length;T++)for(var M=0,B=(f=o[T]).length-1;M<f.length;B=M++)(m=f[M]).y>u.y!=(x=f[B]).y>u.y&&u.x<(x.x-m.x)*(u.y-m.y)/(x.y-m.y)+m.x&&(E=!E);return E}function bu(o,u){for(var f=!1,m=0,x=o.length-1;m<o.length;x=m++){var E=o[m],T=o[x];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(f=!f)}return f}function pl(o,u,f){var m=f[0],x=f[2];if(o.x<m.x&&u.x<m.x||o.x>x.x&&u.x>x.x||o.y<m.y&&u.y<m.y||o.y>x.y&&u.y>x.y)return!1;var E=sr(o,u,f[0]);return E!==sr(o,u,f[1])||E!==sr(o,u,f[2])||E!==sr(o,u,f[3])}function Lo(o,u,f){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:f.programConfigurations.get(u.id).getMaxValue(o)}function ka(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ds(o,u,f,m,x){if(!u[0]&&!u[1])return o;var E=ie.convert(u)._mult(x);f==="viewport"&&E._rotate(-m);for(var T=[],M=0;M<o.length;M++)T.push(o[M].sub(E));return T}ts.prototype.populate=function(o,u,f){var m=this.layers[0],x=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var T=0,M=o;T<M.length;T+=1){var B=M[T],H=B.feature,$=B.id,q=B.index,ce=B.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,ze=Ka(H,me);if(this.layers[0]._featureFilter.filter(new St(this.zoom),ze,f)){var He=E?E.evaluate(ze,{},f):void 0,lt={id:$,properties:H.properties,type:H.type,sourceLayerIndex:ce,index:q,geometry:me?ze.geometry:Ta(H),patterns:{},sortKey:He};x.push(lt)}}E&&x.sort(function(on,Un){return on.sortKey-Un.sortKey});for(var tt=0,Rt=x;tt<Rt.length;tt+=1){var Ut=Rt[tt],Kt=Ut.geometry,ar=Ut.index,hr=Ut.sourceLayerIndex,Wr=o[ar].feature;this.addFeature(Ut,Kt,ar,f),u.featureIndex.insert(Wr,Kt,ar,hr,this.index)}},ts.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ts.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_e),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ts.prototype.addFeature=function(o,u,f,m){for(var x=0,E=u;x<E.length;x+=1)for(var T=0,M=E[x];T<M.length;T+=1){var B=M[T],H=B.x,$=B.y;if(!(H<0||H>=8192||$<0||$>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),ce=q.vertexLength;Ss(this.layoutVertexArray,H,$,-1,-1),Ss(this.layoutVertexArray,H,$,1,-1),Ss(this.layoutVertexArray,H,$,1,1),Ss(this.layoutVertexArray,H,$,-1,1),this.indexArray.emplaceBack(ce,ce+1,ce+2),this.indexArray.emplaceBack(ce,ce+3,ce+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},m)},An("CircleBucket",ts,{omit:["layers"]});var su=new Oa({"circle-sort-key":new Cn(he.layout_circle["circle-sort-key"])}),Eu={paint:new Oa({"circle-radius":new Cn(he.paint_circle["circle-radius"]),"circle-color":new Cn(he.paint_circle["circle-color"]),"circle-blur":new Cn(he.paint_circle["circle-blur"]),"circle-opacity":new Cn(he.paint_circle["circle-opacity"]),"circle-translate":new wn(he.paint_circle["circle-translate"]),"circle-translate-anchor":new wn(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wn(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wn(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(he.paint_circle["circle-stroke-opacity"])}),layout:su},Li=typeof Float32Array!="undefined"?Float32Array:Array;function Yo(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function So(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3],M=u[4],B=u[5],H=u[6],$=u[7],q=u[8],ce=u[9],me=u[10],ze=u[11],He=u[12],lt=u[13],tt=u[14],Rt=u[15],Ut=f[0],Kt=f[1],ar=f[2],hr=f[3];return o[0]=Ut*m+Kt*M+ar*q+hr*He,o[1]=Ut*x+Kt*B+ar*ce+hr*lt,o[2]=Ut*E+Kt*H+ar*me+hr*tt,o[3]=Ut*T+Kt*$+ar*ze+hr*Rt,o[4]=(Ut=f[4])*m+(Kt=f[5])*M+(ar=f[6])*q+(hr=f[7])*He,o[5]=Ut*x+Kt*B+ar*ce+hr*lt,o[6]=Ut*E+Kt*H+ar*me+hr*tt,o[7]=Ut*T+Kt*$+ar*ze+hr*Rt,o[8]=(Ut=f[8])*m+(Kt=f[9])*M+(ar=f[10])*q+(hr=f[11])*He,o[9]=Ut*x+Kt*B+ar*ce+hr*lt,o[10]=Ut*E+Kt*H+ar*me+hr*tt,o[11]=Ut*T+Kt*$+ar*ze+hr*Rt,o[12]=(Ut=f[12])*m+(Kt=f[13])*M+(ar=f[14])*q+(hr=f[15])*He,o[13]=Ut*x+Kt*B+ar*ce+hr*lt,o[14]=Ut*E+Kt*H+ar*me+hr*tt,o[15]=Ut*T+Kt*$+ar*ze+hr*Rt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,f=arguments.length;f--;)u+=o[f]*o[f];return Math.sqrt(u)});var uu,Mc=So;function ju(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3];return o[0]=f[0]*m+f[4]*x+f[8]*E+f[12]*T,o[1]=f[1]*m+f[5]*x+f[9]*E+f[13]*T,o[2]=f[2]*m+f[6]*x+f[10]*E+f[14]*T,o[3]=f[3]*m+f[7]*x+f[11]*E+f[15]*T,o}uu=new Li(3),Li!=Float32Array&&(uu[0]=0,uu[1]=0,uu[2]=0),function(){var o=new Li(4);Li!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var nf=(function(){var o=new Li(2);Li!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(f){o.call(this,f,Eu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new ts(f)},u.prototype.queryRadius=function(f){var m=f;return Lo("circle-radius",this,m)+Lo("circle-stroke-width",this,m)+ka(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,B,H){for(var $=Ds(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,B),q=this.paint.get("circle-radius").evaluate(m,x)+this.paint.get("circle-stroke-width").evaluate(m,x),ce=this.paint.get("circle-pitch-alignment")==="map",me=ce?$:function(Wr,on){return Wr.map(function(Un){return Kl(Un,on)})}($,H),ze=ce?q*B:q,He=0,lt=E;He<lt.length;He+=1)for(var tt=0,Rt=lt[He];tt<Rt.length;tt+=1){var Ut=Rt[tt],Kt=ce?Ut:Kl(Ut,H),ar=ze,hr=ju([],[Ut.x,Ut.y,0,1],H);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ar*=hr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ar*=M.cameraToCenterDistance/hr[3]),As(me,Kt,ar))return!0}return!1},u}(iu));function Kl(o,u){var f=ju([],[o.x,o.y,0,1],u);return new ie(f[0]/f[3],f[1]/f[3])}var Ao=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(ts);function Mr(o,u,f,m){var x=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==x*E*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(x*E*f);return o.width=x,o.height=E,o.data=m,o}function Ql(o,u,f){var m=u.width,x=u.height;if(m!==o.width||x!==o.height){var E=Mr({},{width:m,height:x},f);Pd(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,x)},f),o.width=m,o.height=x,o.data=E.data}}function Pd(o,u,f,m,x,E){if(x.width===0||x.height===0)return u;if(x.width>o.width||x.height>o.height||f.x>o.width-x.width||f.y>o.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>u.width||x.height>u.height||m.x>u.width-x.width||m.y>u.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=o.data,M=u.data,B=0;B<x.height;B++)for(var H=((f.y+B)*o.width+f.x)*E,$=((m.y+B)*u.width+m.x)*E,q=0;q<x.width*E;q++)M[$+q]=T[H+q];return u}An("HeatmapBucket",Ao,{omit:["layers"]});var Ua=function(o,u){Mr(this,o,1,u)};Ua.prototype.resize=function(o){Ql(this,o,1)},Ua.prototype.clone=function(){return new Ua({width:this.width,height:this.height},new Uint8Array(this.data))},Ua.copy=function(o,u,f,m,x){Pd(o,u,f,m,x,1)};var ao=function(o,u){Mr(this,o,4,u)};ao.prototype.resize=function(o){Ql(this,o,4)},ao.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},ao.prototype.clone=function(){return new ao({width:this.width,height:this.height},new Uint8Array(this.data))},ao.copy=function(o,u,f,m,x){Pd(o,u,f,m,x,4)},An("AlphaImage",Ua),An("RGBAImage",ao);var af={paint:new Oa({"heatmap-radius":new Cn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wn(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _u(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wn(he.paint_heatmap["heatmap-opacity"])})};function np(o){var u={},f=o.resolution||256,m=o.clips?o.clips.length:1,x=o.image||new ao({width:f,height:m}),E=function(ze,He,lt){u[o.evaluationKey]=lt;var tt=o.expression.evaluate(u);x.data[ze+He+0]=Math.floor(255*tt.r/tt.a),x.data[ze+He+1]=Math.floor(255*tt.g/tt.a),x.data[ze+He+2]=Math.floor(255*tt.b/tt.a),x.data[ze+He+3]=Math.floor(255*tt.a)};if(o.clips)for(var T=0,M=0;T<m;++T,M+=4*f)for(var B=0,H=0;B<f;B++,H+=4){var $=B/(f-1),q=o.clips[T];E(M,H,q.start*(1-$)+q.end*$)}else for(var ce=0,me=0;ce<f;ce++,me+=4)E(0,me,ce/(f-1));return x}var Su=function(o){function u(f){o.call(this,f,af),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new Ao(f)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=np({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(iu),jf={paint:new Oa({"hillshade-illumination-direction":new wn(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wn(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wn(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wn(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wn(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wn(he.paint_hillshade["hillshade-accent-color"])})},Up=function(o){function u(f){o.call(this,f,jf)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(iu),d0=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,ip=of,zp=of;function of(o,u,f){f=f||2;var m,x,E,T,M,B,H,$=u&&u.length,q=$?u[0]*f:o.length,ce=Zp(o,0,q,f,!0),me=[];if(!ce||ce.next===ce.prev)return me;if($&&(ce=function(He,lt,tt,Rt){var Ut,Kt,ar,hr=[];for(Ut=0,Kt=lt.length;Ut<Kt;Ut++)(ar=Zp(He,lt[Ut]*Rt,Ut<Kt-1?lt[Ut+1]*Rt:He.length,Rt,!1))===ar.next&&(ar.steiner=!0),hr.push(Pc(ar));for(hr.sort(Vp),Ut=0;Ut<hr.length;Ut++)ap(hr[Ut],tt),tt=Ic(tt,tt.next);return tt}(o,u,ce,f)),o.length>80*f){m=E=o[0],x=T=o[1];for(var ze=f;ze<q;ze+=f)(M=o[ze])<m&&(m=M),(B=o[ze+1])<x&&(x=B),M>E&&(E=M),B>T&&(T=B);H=(H=Math.max(E-m,T-x))!==0?1/H:0}return bh(ce,me,f,m,x,H),me}function Zp(o,u,f,m,x){var E,T;if(x===Dc(o,u,f,m)>0)for(E=u;E<f;E+=m)T=Wf(E,o[E],o[E+1],T);else for(E=f-m;E>=u;E-=m)T=Wf(E,o[E],o[E+1],T);return T&&sf(T,T.next)&&(ec(T),T=T.next),T}function Ic(o,u){if(!o)return o;u||(u=o);var f,m=o;do if(f=!1,m.steiner||!sf(m,m.next)&&ro(m.prev,m,m.next)!==0)m=m.next;else{if(ec(m),(m=u=m.prev)===m.next)break;f=!0}while(f||m!==u);return u}function bh(o,u,f,m,x,E,T){if(o){!T&&E&&function($,q,ce,me){var ze=$;do ze.z===null&&(ze.z=Eh(ze.x,ze.y,q,ce,me)),ze.prevZ=ze.prev,ze.nextZ=ze.next,ze=ze.next;while(ze!==$);ze.prevZ.nextZ=null,ze.prevZ=null,function(He){var lt,tt,Rt,Ut,Kt,ar,hr,Wr,on=1;do{for(tt=He,He=null,Kt=null,ar=0;tt;){for(ar++,Rt=tt,hr=0,lt=0;lt<on&&(hr++,Rt=Rt.nextZ);lt++);for(Wr=on;hr>0||Wr>0&&Rt;)hr!==0&&(Wr===0||!Rt||tt.z<=Rt.z)?(Ut=tt,tt=tt.nextZ,hr--):(Ut=Rt,Rt=Rt.nextZ,Wr--),Kt?Kt.nextZ=Ut:He=Ut,Ut.prevZ=Kt,Kt=Ut;tt=Rt}Kt.nextZ=null,on*=2}while(ar>1)}(ze)}(o,m,x,E);for(var M,B,H=o;o.prev!==o.next;)if(M=o.prev,B=o.next,E?Vv(o,m,x,E):Zv(o))u.push(M.i/f),u.push(o.i/f),u.push(B.i/f),ec(o),o=B.next,H=B.next;else if((o=B)===H){T?T===1?bh(o=Od(Ic(o),u,f),u,f,m,x,E,2):T===2&&v0(o,u,f,m,x,E):bh(Ic(o),u,f,m,x,E,1);break}}}function Zv(o){var u=o.prev,f=o,m=o.next;if(ro(u,f,m)>=0)return!1;for(var x=o.next.next;x!==o.prev;){if(Oc(u.x,u.y,f.x,f.y,m.x,m.y,x.x,x.y)&&ro(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Vv(o,u,f,m){var x=o.prev,E=o,T=o.next;if(ro(x,E,T)>=0)return!1;for(var M=x.x>E.x?x.x>T.x?x.x:T.x:E.x>T.x?E.x:T.x,B=x.y>E.y?x.y>T.y?x.y:T.y:E.y>T.y?E.y:T.y,H=Eh(x.x<E.x?x.x<T.x?x.x:T.x:E.x<T.x?E.x:T.x,x.y<E.y?x.y<T.y?x.y:T.y:E.y<T.y?E.y:T.y,u,f,m),$=Eh(M,B,u,f,m),q=o.prevZ,ce=o.nextZ;q&&q.z>=H&&ce&&ce.z<=$;){if(q!==o.prev&&q!==o.next&&Oc(x.x,x.y,E.x,E.y,T.x,T.y,q.x,q.y)&&ro(q.prev,q,q.next)>=0||(q=q.prevZ,ce!==o.prev&&ce!==o.next&&Oc(x.x,x.y,E.x,E.y,T.x,T.y,ce.x,ce.y)&&ro(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;q&&q.z>=H;){if(q!==o.prev&&q!==o.next&&Oc(x.x,x.y,E.x,E.y,T.x,T.y,q.x,q.y)&&ro(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ce&&ce.z<=$;){if(ce!==o.prev&&ce!==o.next&&Oc(x.x,x.y,E.x,E.y,T.x,T.y,ce.x,ce.y)&&ro(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function Od(o,u,f){var m=o;do{var x=m.prev,E=m.next.next;!sf(x,E)&&Hp(x,m,m.next,E)&&kc(x,E)&&kc(E,x)&&(u.push(x.i/f),u.push(m.i/f),u.push(E.i/f),ec(m),ec(m.next),m=o=E),m=m.next}while(m!==o);return Ic(m)}function v0(o,u,f,m,x,E){var T=o;do{for(var M=T.next.next;M!==T.prev;){if(T.i!==M.i&&op(T,M)){var B=Hf(T,M);return T=Ic(T,T.next),B=Ic(B,B.next),bh(T,u,f,m,x,E),void bh(B,u,f,m,x,E)}M=M.next}T=T.next}while(T!==o)}function Vp(o,u){return o.x-u.x}function ap(o,u){if(u=function(m,x){var E,T=x,M=m.x,B=m.y,H=-1/0;do{if(B<=T.y&&B>=T.next.y&&T.next.y!==T.y){var $=T.x+(B-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=M&&$>H){if(H=$,$===M){if(B===T.y)return T;if(B===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!E)return null;if(M===H)return E;var q,ce=E,me=E.x,ze=E.y,He=1/0;T=E;do M>=T.x&&T.x>=me&&M!==T.x&&Oc(B<ze?M:H,B,me,ze,B<ze?H:M,B,T.x,T.y)&&(q=Math.abs(B-T.y)/(M-T.x),kc(T,m)&&(q<He||q===He&&(T.x>E.x||T.x===E.x&&jp(E,T)))&&(E=T,He=q)),T=T.next;while(T!==ce);return E}(o,u)){var f=Hf(u,o);Ic(u,u.next),Ic(f,f.next)}}function jp(o,u){return ro(o.prev,o,u.prev)<0&&ro(u.next,o,o.next)<0}function Eh(o,u,f,m,x){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-f)*x)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*x)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function Pc(o){var u=o,f=o;do(u.x<f.x||u.x===f.x&&u.y<f.y)&&(f=u),u=u.next;while(u!==o);return f}function Oc(o,u,f,m,x,E,T,M){return(x-T)*(u-M)-(o-T)*(E-M)>=0&&(o-T)*(m-M)-(f-T)*(u-M)>=0&&(f-T)*(E-M)-(x-T)*(m-M)>=0}function op(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(f,m){var x=f;do{if(x.i!==f.i&&x.next.i!==f.i&&x.i!==m.i&&x.next.i!==m.i&&Hp(x,x.next,f,m))return!0;x=x.next}while(x!==f);return!1}(o,u)&&(kc(o,u)&&kc(u,o)&&function(f,m){var x=f,E=!1,T=(f.x+m.x)/2,M=(f.y+m.y)/2;do x.y>M!=x.next.y>M&&x.next.y!==x.y&&T<(x.next.x-x.x)*(M-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==f);return E}(o,u)&&(ro(o.prev,o,u.prev)||ro(o,u.prev,u))||sf(o,u)&&ro(o.prev,o,o.next)>0&&ro(u.prev,u,u.next)>0)}function ro(o,u,f){return(u.y-o.y)*(f.x-u.x)-(u.x-o.x)*(f.y-u.y)}function sf(o,u){return o.x===u.x&&o.y===u.y}function Hp(o,u,f,m){var x=dl(ro(o,u,f)),E=dl(ro(o,u,m)),T=dl(ro(f,m,o)),M=dl(ro(f,m,u));return x!==E&&T!==M||!(x!==0||!Jl(o,f,u))||!(E!==0||!Jl(o,m,u))||!(T!==0||!Jl(f,o,m))||!(M!==0||!Jl(f,u,m))}function Jl(o,u,f){return u.x<=Math.max(o.x,f.x)&&u.x>=Math.min(o.x,f.x)&&u.y<=Math.max(o.y,f.y)&&u.y>=Math.min(o.y,f.y)}function dl(o){return o>0?1:o<0?-1:0}function kc(o,u){return ro(o.prev,o,o.next)<0?ro(o,u,o.next)>=0&&ro(o,o.prev,u)>=0:ro(o,u,o.prev)<0||ro(o,o.next,u)<0}function Hf(o,u){var f=new Gf(o.i,o.x,o.y),m=new Gf(u.i,u.x,u.y),x=o.next,E=u.prev;return o.next=u,u.prev=o,f.next=x,x.prev=f,m.next=f,f.prev=m,E.next=m,m.prev=E,m}function Wf(o,u,f,m){var x=new Gf(o,u,f);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function ec(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Gf(o,u,f){this.i=o,this.x=u,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dc(o,u,f,m){for(var x=0,E=u,T=f-m;E<f;E+=m)x+=(o[T]-o[E])*(o[E+1]+o[T+1]),T=E;return x}function sp(o,u,f,m,x){(function E(T,M,B,H,$){for(;H>B;){if(H-B>600){var q=H-B+1,ce=M-B+1,me=Math.log(q),ze=.5*Math.exp(2*me/3),He=.5*Math.sqrt(me*ze*(q-ze)/q)*(ce-q/2<0?-1:1);E(T,M,Math.max(B,Math.floor(M-ce*ze/q+He)),Math.min(H,Math.floor(M+(q-ce)*ze/q+He)),$)}var lt=T[M],tt=B,Rt=H;for(Dl(T,B,M),$(T[H],lt)>0&&Dl(T,B,H);tt<Rt;){for(Dl(T,tt,Rt),tt++,Rt--;$(T[tt],lt)<0;)tt++;for(;$(T[Rt],lt)>0;)Rt--}$(T[B],lt)===0?Dl(T,B,Rt):Dl(T,++Rt,H),Rt<=M&&(B=Rt+1),M<=Rt&&(H=Rt-1)}})(o,u,f||0,m||o.length-1,x||uf)}function Dl(o,u,f){var m=o[u];o[u]=o[f],o[f]=m}function uf(o,u){return o<u?-1:o>u?1:0}function Au(o,u){var f=o.length;if(f<=1)return[o];for(var m,x,E=[],T=0;T<f;T++){var M=br(o[T]);M!==0&&(o[T].area=Math.abs(M),x===void 0&&(x=M<0),x===M<0?(m&&E.push(m),m=[o[T]]):m.push(o[T]))}if(m&&E.push(m),u>1)for(var B=0;B<E.length;B++)E[B].length<=u||(sp(E[B],u,1,E[B].length-1,Wp),E[B]=E[B].slice(0,u));return E}function Wp(o,u){return u.area-o.area}function Gp(o,u,f){for(var m=f.patternDependencies,x=!1,E=0,T=u;E<T.length;E+=1){var M=T[E].paint.get(o+"-pattern");M.isConstant()||(x=!0);var B=M.constantOr(null);B&&(x=!0,m[B.to]=!0,m[B.from]=!0)}return x}function Xp(o,u,f,m,x){for(var E=x.patternDependencies,T=0,M=u;T<M.length;T+=1){var B=M[T],H=B.paint.get(o+"-pattern").value;if(H.kind!=="constant"){var $=H.evaluate({zoom:m-1},f,{},x.availableImages),q=H.evaluate({zoom:m},f,{},x.availableImages),ce=H.evaluate({zoom:m+1},f,{},x.availableImages);q=q&&q.name?q.name:q,ce=ce&&ce.name?ce.name:ce,E[$=$&&$.name?$.name:$]=!0,E[q]=!0,E[ce]=!0,f.patterns[B.id]={min:$,mid:q,max:ce}}}return f}of.deviation=function(o,u,f,m){var x=u&&u.length,E=Math.abs(Dc(o,0,x?u[0]*f:o.length,f));if(x)for(var T=0,M=u.length;T<M;T++)E-=Math.abs(Dc(o,u[T]*f,T<M-1?u[T+1]*f:o.length,f));var B=0;for(T=0;T<m.length;T+=3){var H=m[T]*f,$=m[T+1]*f,q=m[T+2]*f;B+=Math.abs((o[H]-o[q])*(o[$+1]-o[H+1])-(o[H]-o[$])*(o[q+1]-o[H+1]))}return E===0&&B===0?0:Math.abs((B-E)/E)},of.flatten=function(o){for(var u=o[0][0].length,f={vertices:[],holes:[],dimensions:u},m=0,x=0;x<o.length;x++){for(var E=0;E<o[x].length;E++)for(var T=0;T<u;T++)f.vertices.push(o[x][E][T]);x>0&&f.holes.push(m+=o[x-1].length)}return f},ip.default=zp;var Tu=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pl,this.indexArray=new Vu,this.indexArray2=new rf,this.programConfigurations=new ei(o.layers,o.zoom),this.segments=new be,this.segments2=new be,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Tu.prototype.populate=function(o,u,f){this.hasPattern=Gp("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],B=M.feature,H=M.id,$=M.index,q=M.sourceLayerIndex,ce=this.layers[0]._featureFilter.needGeometry,me=Ka(B,ce);if(this.layers[0]._featureFilter.filter(new St(this.zoom),me,f)){var ze=m?m.evaluate(me,{},f,u.availableImages):void 0,He={id:H,properties:B.properties,type:B.type,sourceLayerIndex:q,index:$,geometry:ce?me.geometry:Ta(B),patterns:{},sortKey:ze};x.push(He)}}m&&x.sort(function(Wr,on){return Wr.sortKey-on.sortKey});for(var lt=0,tt=x;lt<tt.length;lt+=1){var Rt=tt[lt],Ut=Rt.geometry,Kt=Rt.index,ar=Rt.sourceLayerIndex;if(this.hasPattern){var hr=Xp("fill",this.layers,Rt,this.zoom,u);this.patternFeatures.push(hr)}else this.addFeature(Rt,Ut,Kt,f,{});u.featureIndex.insert(o[Kt].feature,Ut,Kt,ar,this.index)}},Tu.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},Tu.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},Tu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Tu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Tu.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,d0),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},Tu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Tu.prototype.addFeature=function(o,u,f,m,x){for(var E=0,T=Au(u,500);E<T.length;E+=1){for(var M=T[E],B=0,H=0,$=M;H<$.length;H+=1)B+=$[H].length;for(var q=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),ce=q.vertexLength,me=[],ze=[],He=0,lt=M;He<lt.length;He+=1){var tt=lt[He];if(tt.length!==0){tt!==M[0]&&ze.push(me.length/2);var Rt=this.segments2.prepareSegment(tt.length,this.layoutVertexArray,this.indexArray2),Ut=Rt.vertexLength;this.layoutVertexArray.emplaceBack(tt[0].x,tt[0].y),this.indexArray2.emplaceBack(Ut+tt.length-1,Ut),me.push(tt[0].x),me.push(tt[0].y);for(var Kt=1;Kt<tt.length;Kt++)this.layoutVertexArray.emplaceBack(tt[Kt].x,tt[Kt].y),this.indexArray2.emplaceBack(Ut+Kt-1,Ut+Kt),me.push(tt[Kt].x),me.push(tt[Kt].y);Rt.vertexLength+=tt.length,Rt.primitiveLength+=tt.length}}for(var ar=ip(me,ze),hr=0;hr<ar.length;hr+=3)this.indexArray.emplaceBack(ce+ar[hr],ce+ar[hr+1],ce+ar[hr+2]);q.vertexLength+=B,q.primitiveLength+=ar.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},An("FillBucket",Tu,{omit:["layers","patternFeatures"]});var Lc=new Oa({"fill-sort-key":new Cn(he.layout_fill["fill-sort-key"])}),Xf={paint:new Oa({"fill-antialias":new wn(he.paint_fill["fill-antialias"]),"fill-opacity":new Cn(he.paint_fill["fill-opacity"]),"fill-color":new Cn(he.paint_fill["fill-color"]),"fill-outline-color":new Cn(he.paint_fill["fill-outline-color"]),"fill-translate":new wn(he.paint_fill["fill-translate"]),"fill-translate-anchor":new wn(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new Es(he.paint_fill["fill-pattern"])}),layout:Lc},kd=function(o){function u(f){o.call(this,f,Xf)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(f,m){o.prototype.recalculate.call(this,f,m);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(f){return new Tu(f)},u.prototype.queryRadius=function(){return ka(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,B){return ou(Ds(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,B),E)},u.prototype.isTileClipped=function(){return!0},u}(iu),up=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dd=Ll;function Ll(o,u,f,m,x){this.properties={},this.extent=f,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=x,o.readFields(Ld,this,u)}function Ld(o,u,f){o==1?u.id=f.readVarint():o==2?function(m,x){for(var E=m.readVarint()+m.pos;m.pos<E;){var T=x._keys[m.readVarint()],M=x._values[m.readVarint()];x.properties[T]=M}}(f,u):o==3?u.type=f.readVarint():o==4&&(u._geometry=f.pos)}function Hu(o){for(var u,f,m=0,x=0,E=o.length,T=E-1;x<E;T=x++)m+=((f=o[T]).x-(u=o[x]).x)*(u.y+f.y);return m}Ll.types=["Unknown","Point","LineString","Polygon"],Ll.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,f=o.readVarint()+o.pos,m=1,x=0,E=0,T=0,M=[];o.pos<f;){if(x<=0){var B=o.readVarint();m=7&B,x=B>>3}if(x--,m===1||m===2)E+=o.readSVarint(),T+=o.readSVarint(),m===1&&(u&&M.push(u),u=[]),u.push(new ie(E,T));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&M.push(u),M},Ll.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,f=1,m=0,x=0,E=0,T=1/0,M=-1/0,B=1/0,H=-1/0;o.pos<u;){if(m<=0){var $=o.readVarint();f=7&$,m=$>>3}if(m--,f===1||f===2)(x+=o.readSVarint())<T&&(T=x),x>M&&(M=x),(E+=o.readSVarint())<B&&(B=E),E>H&&(H=E);else if(f!==7)throw new Error("unknown command "+f)}return[T,B,M,H]},Ll.prototype.toGeoJSON=function(o,u,f){var m,x,E=this.extent*Math.pow(2,f),T=this.extent*o,M=this.extent*u,B=this.loadGeometry(),H=Ll.types[this.type];function $(me){for(var ze=0;ze<me.length;ze++){var He=me[ze];me[ze]=[360*(He.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(He.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(m=0;m<B.length;m++)q[m]=B[m][0];$(B=q);break;case 2:for(m=0;m<B.length;m++)$(B[m]);break;case 3:for(B=function(me){var ze=me.length;if(ze<=1)return[me];for(var He,lt,tt=[],Rt=0;Rt<ze;Rt++){var Ut=Hu(me[Rt]);Ut!==0&&(lt===void 0&&(lt=Ut<0),lt===Ut<0?(He&&tt.push(He),He=[me[Rt]]):He.push(me[Rt]))}return He&&tt.push(He),tt}(B),m=0;m<B.length;m++)for(x=0;x<B[m].length;x++)$(B[m][x])}B.length===1?B=B[0]:H="Multi"+H;var ce={type:"Feature",geometry:{type:H,coordinates:B},properties:this.properties};return"id"in this&&(ce.id=this.id),ce};var Sh=Bc;function Bc(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(tc,this,u),this.length=this._features.length}function tc(o,u,f){o===15?u.version=f.readVarint():o===1?u.name=f.readString():o===5?u.extent=f.readVarint():o===2?u._features.push(f.pos):o===3?u._keys.push(f.readString()):o===4&&u._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;x=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return x}(f))}function Bl(o,u,f){if(o===3){var m=new Sh(f,f.readVarint()+f.pos);m.length&&(u[m.name]=m)}}Bc.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new Dd(this._pbf,u,this.extent,this._keys,this._values)};var Fc={VectorTile:function(o,u){this.layers=o.readFields(Bl,{},u)},VectorTileFeature:Dd,VectorTileLayer:Sh},Ah=Fc.VectorTileFeature.types,Th=Math.pow(2,13);function rs(o,u,f,m,x,E,T,M){o.emplaceBack(u,f,2*Math.floor(m*Th)+T,x*Th*2,E*Th*2,Math.round(M))}var qo=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ul,this.indexArray=new Vu,this.programConfigurations=new ei(o.layers,o.zoom),this.segments=new be,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function To(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}qo.prototype.populate=function(o,u,f){this.features=[],this.hasPattern=Gp("fill-extrusion",this.layers,u);for(var m=0,x=o;m<x.length;m+=1){var E=x[m],T=E.feature,M=E.id,B=E.index,H=E.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,q=Ka(T,$);if(this.layers[0]._featureFilter.filter(new St(this.zoom),q,f)){var ce={id:M,sourceLayerIndex:H,index:B,geometry:$?q.geometry:Ta(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Xp("fill-extrusion",this.layers,ce,this.zoom,u)):this.addFeature(ce,ce.geometry,B,f,{}),u.featureIndex.insert(T,ce.geometry,B,H,this.index,!0)}}},qo.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.features;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},qo.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},qo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qo.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,up),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},qo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qo.prototype.addFeature=function(o,u,f,m,x){for(var E=0,T=Au(u,500);E<T.length;E+=1){for(var M=T[E],B=0,H=0,$=M;H<$.length;H+=1)B+=$[H].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ce=0,me=M;ce<me.length;ce+=1){var ze=me[ce];if(ze.length!==0&&!((mn=ze).every(function(xi){return xi.x<0})||mn.every(function(xi){return xi.x>8192})||mn.every(function(xi){return xi.y<0})||mn.every(function(xi){return xi.y>8192})))for(var He=0,lt=0;lt<ze.length;lt++){var tt=ze[lt];if(lt>=1){var Rt=ze[lt-1];if(!To(tt,Rt)){q.vertexLength+4>be.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ut=tt.sub(Rt)._perp()._unit(),Kt=Rt.dist(tt);He+Kt>32768&&(He=0),rs(this.layoutVertexArray,tt.x,tt.y,Ut.x,Ut.y,0,0,He),rs(this.layoutVertexArray,tt.x,tt.y,Ut.x,Ut.y,0,1,He),rs(this.layoutVertexArray,Rt.x,Rt.y,Ut.x,Ut.y,0,0,He+=Kt),rs(this.layoutVertexArray,Rt.x,Rt.y,Ut.x,Ut.y,0,1,He);var ar=q.vertexLength;this.indexArray.emplaceBack(ar,ar+2,ar+1),this.indexArray.emplaceBack(ar+1,ar+2,ar+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+B>be.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),Ah[o.type]==="Polygon"){for(var hr=[],Wr=[],on=q.vertexLength,Un=0,_n=M;Un<_n.length;Un+=1){var Gn=_n[Un];if(Gn.length!==0){Gn!==M[0]&&Wr.push(hr.length/2);for(var En=0;En<Gn.length;En++){var wi=Gn[En];rs(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),hr.push(wi.x),hr.push(wi.y)}}}for(var oi=ip(hr,Wr),Ir=0;Ir<oi.length;Ir+=3)this.indexArray.emplaceBack(on+oi[Ir],on+oi[Ir+2],on+oi[Ir+1]);q.primitiveLength+=oi.length/3,q.vertexLength+=B}}var mn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},An("FillExtrusionBucket",qo,{omit:["layers","features"]});var lu={paint:new Oa({"fill-extrusion-opacity":new wn(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wn(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wn(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Es(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wn(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Bd=function(o){function u(f){o.call(this,f,lu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(f){return new qo(f)},u.prototype.queryRadius=function(){return ka(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,B,H){var $=Ds(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,B),q=this.paint.get("fill-extrusion-height").evaluate(m,x),ce=this.paint.get("fill-extrusion-base").evaluate(m,x),me=function(He,lt,tt,Rt){for(var Ut=[],Kt=0,ar=He;Kt<ar.length;Kt+=1){var hr=ar[Kt],Wr=[hr.x,hr.y,0,1];ju(Wr,Wr,lt),Ut.push(new ie(Wr[0]/Wr[3],Wr[1]/Wr[3]))}return Ut}($,H),ze=function(He,lt,tt,Rt){for(var Ut=[],Kt=[],ar=Rt[8]*lt,hr=Rt[9]*lt,Wr=Rt[10]*lt,on=Rt[11]*lt,Un=Rt[8]*tt,_n=Rt[9]*tt,Gn=Rt[10]*tt,En=Rt[11]*tt,wi=0,oi=He;wi<oi.length;wi+=1){for(var Ir=[],mn=[],xi=0,Yi=oi[wi];xi<Yi.length;xi+=1){var $n=Yi[xi],ra=$n.x,Qa=$n.y,mo=Rt[0]*ra+Rt[4]*Qa+Rt[12],oo=Rt[1]*ra+Rt[5]*Qa+Rt[13],Ja=Rt[2]*ra+Rt[6]*Qa+Rt[14],go=Rt[3]*ra+Rt[7]*Qa+Rt[15],os=Ja+Wr,ss=go+on,Ks=mo+Un,vs=oo+_n,Qs=Ja+Gn,yo=go+En,ms=new ie((mo+ar)/ss,(oo+hr)/ss);ms.z=os/ss,Ir.push(ms);var Ui=new ie(Ks/yo,vs/yo);Ui.z=Qs/yo,mn.push(Ui)}Ut.push(Ir),Kt.push(mn)}return[Ut,Kt]}(E,ce,q,H);return function(He,lt,tt){var Rt=1/0;ou(tt,lt)&&(Rt=lp(tt,lt[0]));for(var Ut=0;Ut<lt.length;Ut++)for(var Kt=lt[Ut],ar=He[Ut],hr=0;hr<Kt.length-1;hr++){var Wr=Kt[hr],on=[Wr,Kt[hr+1],ar[hr+1],ar[hr],Wr];fl(tt,on)&&(Rt=Math.min(Rt,lp(tt,on)))}return Rt!==1/0&&Rt}(ze[0],ze[1],me)},u}(iu);function $f(o,u){return o.x*u.x+o.y*u.y}function lp(o,u){if(o.length===1){for(var f,m=0,x=u[m++];!f||x.equals(f);)if(!(f=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],T=o[0],M=f.sub(x),B=E.sub(x),H=T.sub(x),$=$f(M,M),q=$f(M,B),ce=$f(B,B),me=$f(H,M),ze=$f(H,B),He=$*ce-q*q,lt=(ce*me-q*ze)/He,tt=($*ze-q*me)/He,Rt=x.z*(1-lt-tt)+f.z*lt+E.z*tt;if(isFinite(Rt))return Rt}return 1/0}for(var Ut=1/0,Kt=0,ar=u;Kt<ar.length;Kt+=1)Ut=Math.min(Ut,ar[Kt].z);return Ut}var Fd=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Nd=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ud=Fc.VectorTileFeature.types,jv=Math.cos(Math.PI/180*37.5),cp=Math.pow(2,14)/.5,Ts=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(f){u.gradients[f.id]={}}),this.layoutVertexArray=new Os,this.layoutVertexArray2=new Ol,this.indexArray=new Vu,this.programConfigurations=new ei(o.layers,o.zoom),this.segments=new be,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};Ts.prototype.populate=function(o,u,f){this.hasPattern=Gp("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],B=M.feature,H=M.id,$=M.index,q=M.sourceLayerIndex,ce=this.layers[0]._featureFilter.needGeometry,me=Ka(B,ce);if(this.layers[0]._featureFilter.filter(new St(this.zoom),me,f)){var ze=m?m.evaluate(me,{},f):void 0,He={id:H,properties:B.properties,type:B.type,sourceLayerIndex:q,index:$,geometry:ce?me.geometry:Ta(B),patterns:{},sortKey:ze};x.push(He)}}m&&x.sort(function(Wr,on){return Wr.sortKey-on.sortKey});for(var lt=0,tt=x;lt<tt.length;lt+=1){var Rt=tt[lt],Ut=Rt.geometry,Kt=Rt.index,ar=Rt.sourceLayerIndex;if(this.hasPattern){var hr=Xp("line",this.layers,Rt,this.zoom,u);this.patternFeatures.push(hr)}else this.addFeature(Rt,Ut,Kt,f,{});u.featureIndex.insert(o[Kt].feature,Ut,Kt,ar,this.index)}},Ts.prototype.update=function(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)},Ts.prototype.addFeatures=function(o,u,f){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,f)}},Ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ts.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Nd)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fd),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ts.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},Ts.prototype.addFeature=function(o,u,f,m,x){var E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),M=E.get("line-cap"),B=E.get("line-miter-limit"),H=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var $=0,q=u;$<q.length;$+=1)this.addLine(q[$],o,T,M,B,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,m)},Ts.prototype.addLine=function(o,u,f,m,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<o.length-1;T++)this.totalDistance+=o[T].dist(o[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Ud[u.type]==="Polygon",B=o.length;B>=2&&o[B-1].equals(o[B-2]);)B--;for(var H=0;H<B-1&&o[H].equals(o[H+1]);)H++;if(!(B<(M?3:2))){f==="bevel"&&(x=1.05);var $,q=this.overscaling<=16?122880/(512*this.overscaling):0,ce=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),me=void 0,ze=void 0,He=void 0,lt=void 0;this.e1=this.e2=-1,M&&(lt=o[H].sub($=o[B-2])._unit()._perp());for(var tt=H;tt<B;tt++)if(!(ze=tt===B-1?M?o[H+1]:void 0:o[tt+1])||!o[tt].equals(ze)){lt&&(He=lt),$&&(me=$),$=o[tt],lt=ze?ze.sub($)._unit()._perp():He;var Rt=(He=He||lt).add(lt);Rt.x===0&&Rt.y===0||Rt._unit();var Ut=He.x*lt.x+He.y*lt.y,Kt=Rt.x*lt.x+Rt.y*lt.y,ar=Kt!==0?1/Kt:1/0,hr=2*Math.sqrt(2-2*Kt),Wr=Kt<jv&&me&&ze,on=He.x*lt.y-He.y*lt.x>0;if(Wr&&tt>H){var Un=$.dist(me);if(Un>2*q){var _n=$.sub($.sub(me)._mult(q/Un)._round());this.updateDistance(me,_n),this.addCurrentVertex(_n,He,0,0,ce),me=_n}}var Gn=me&&ze,En=Gn?f:M?"butt":m;if(Gn&&En==="round"&&(ar<E?En="miter":ar<=2&&(En="fakeround")),En==="miter"&&ar>x&&(En="bevel"),En==="bevel"&&(ar>2&&(En="flipbevel"),ar<x&&(En="miter")),me&&this.updateDistance(me,$),En==="miter")Rt._mult(ar),this.addCurrentVertex($,Rt,0,0,ce);else if(En==="flipbevel"){if(ar>100)Rt=lt.mult(-1);else{var wi=ar*He.add(lt).mag()/He.sub(lt).mag();Rt._perp()._mult(wi*(on?-1:1))}this.addCurrentVertex($,Rt,0,0,ce),this.addCurrentVertex($,Rt.mult(-1),0,0,ce)}else if(En==="bevel"||En==="fakeround"){var oi=-Math.sqrt(ar*ar-1),Ir=on?oi:0,mn=on?0:oi;if(me&&this.addCurrentVertex($,He,Ir,mn,ce),En==="fakeround")for(var xi=Math.round(180*hr/Math.PI/20),Yi=1;Yi<xi;Yi++){var $n=Yi/xi;if($n!==.5){var ra=$n-.5;$n+=$n*ra*($n-1)*((1.0904+Ut*(Ut*(3.55645-1.43519*Ut)-3.2452))*ra*ra+(.848013+Ut*(.215638*Ut-1.06021)))}var Qa=lt.sub(He)._mult($n)._add(He)._unit()._mult(on?-1:1);this.addHalfVertex($,Qa.x,Qa.y,!1,on,0,ce)}ze&&this.addCurrentVertex($,lt,-Ir,-mn,ce)}else if(En==="butt")this.addCurrentVertex($,Rt,0,0,ce);else if(En==="square"){var mo=me?1:-1;this.addCurrentVertex($,Rt,mo,mo,ce)}else En==="round"&&(me&&(this.addCurrentVertex($,He,0,0,ce),this.addCurrentVertex($,He,1,1,ce,!0)),ze&&(this.addCurrentVertex($,lt,-1,-1,ce,!0),this.addCurrentVertex($,lt,0,0,ce)));if(Wr&&tt<B-1){var oo=$.dist(ze);if(oo>2*q){var Ja=$.add(ze.sub($)._mult(q/oo)._round());this.updateDistance($,Ja),this.addCurrentVertex(Ja,lt,0,0,ce),$=Ja}}}}},Ts.prototype.addCurrentVertex=function(o,u,f,m,x,E){E===void 0&&(E=!1);var T=u.y*m-u.x,M=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,E,!1,f,x),this.addHalfVertex(o,T,M,E,!0,-m,x),this.distance>cp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,f,m,x,E))},Ts.prototype.addHalfVertex=function(o,u,f,m,x,E,T){var M=.5*(this.lineClips?this.scaledDistance*(cp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),T.primitiveLength++),x?this.e2=B:this.e1=B},Ts.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ts.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},An("LineBucket",Ts,{omit:["layers","patternFeatures"]});var Hv=new Oa({"line-cap":new wn(he.layout_line["line-cap"]),"line-join":new Cn(he.layout_line["line-join"]),"line-miter-limit":new wn(he.layout_line["line-miter-limit"]),"line-round-limit":new wn(he.layout_line["line-round-limit"]),"line-sort-key":new Cn(he.layout_line["line-sort-key"])}),wh={paint:new Oa({"line-opacity":new Cn(he.paint_line["line-opacity"]),"line-color":new Cn(he.paint_line["line-color"]),"line-translate":new wn(he.paint_line["line-translate"]),"line-translate-anchor":new wn(he.paint_line["line-translate-anchor"]),"line-width":new Cn(he.paint_line["line-width"]),"line-gap-width":new Cn(he.paint_line["line-gap-width"]),"line-offset":new Cn(he.paint_line["line-offset"]),"line-blur":new Cn(he.paint_line["line-blur"]),"line-dasharray":new Eo(he.paint_line["line-dasharray"]),"line-pattern":new Es(he.paint_line["line-pattern"]),"line-gradient":new _u(he.paint_line["line-gradient"])}),layout:Hv},Ch=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,m){return m=new St(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,f,m)},u.prototype.evaluate=function(f,m,x,E){return m=$t({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,f,m,x,E)},u}(Cn))(wh.paint.properties["line-width"].specification);Ch.useIntegerZoom=!0;var zd=function(o){function u(f){o.call(this,f,wh),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Is,this.gradientVersion=(this.gradientVersion+1)%Ze)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(f,m){o.prototype.recalculate.call(this,f,m),this.paint._values["line-floorwidth"]=Ch.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},u.prototype.createBucket=function(f){return new Ts(f)},u.prototype.queryRadius=function(f){var m=f,x=lf(Lo("line-width",this,m),Lo("line-gap-width",this,m)),E=Lo("line-offset",this,m);return x/2+Math.abs(E)+ka(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(f,m,x,E,T,M,B){var H=Ds(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,B),$=B/2*lf(this.paint.get("line-width").evaluate(m,x),this.paint.get("line-gap-width").evaluate(m,x)),q=this.paint.get("line-offset").evaluate(m,x);return q&&(E=function(ce,me){for(var ze=[],He=new ie(0,0),lt=0;lt<ce.length;lt++){for(var tt=ce[lt],Rt=[],Ut=0;Ut<tt.length;Ut++){var Kt=tt[Ut],ar=tt[Ut+1],hr=Ut===0?He:Kt.sub(tt[Ut-1])._unit()._perp(),Wr=Ut===tt.length-1?He:ar.sub(Kt)._unit()._perp(),on=hr._add(Wr)._unit();on._mult(1/(on.x*Wr.x+on.y*Wr.y)),Rt.push(on._mult(me)._add(Kt))}ze.push(Rt)}return ze}(E,q*B)),function(ce,me,ze){for(var He=0;He<me.length;He++){var lt=me[He];if(ce.length>=3){for(var tt=0;tt<lt.length;tt++)if(bu(ce,lt[tt]))return!0}if(ks(ce,lt,ze))return!0}return!1}(H,E,$)},u.prototype.isTileClipped=function(){return!0},u}(iu);function lf(o,u){return u>0?u+2*o:o}var Wv=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gv=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),Zd=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vd=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),W=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function we(o,u,f){return o.sections.forEach(function(m){m.text=function(x,E,T){var M=E.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?x=x.toLocaleUpperCase():M==="lowercase"&&(x=x.toLocaleLowerCase()),Ys.applyArabicShaping&&(x=Ys.applyArabicShaping(x)),x}(m.text,u,f)}),o}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Qe={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Qt=function(o,u,f,m,x){var E,T,M=8*x-m-1,B=(1<<M)-1,H=B>>1,$=-7,q=f?x-1:0,ce=f?-1:1,me=o[u+q];for(q+=ce,E=me&(1<<-$)-1,me>>=-$,$+=M;$>0;E=256*E+o[u+q],q+=ce,$-=8);for(T=E&(1<<-$)-1,E>>=-$,$+=m;$>0;T=256*T+o[u+q],q+=ce,$-=8);if(E===0)E=1-H;else{if(E===B)return T?NaN:1/0*(me?-1:1);T+=Math.pow(2,m),E-=H}return(me?-1:1)*T*Math.pow(2,E-m)},mr=function(o,u,f,m,x,E){var T,M,B,H=8*E-x-1,$=(1<<H)-1,q=$>>1,ce=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=m?0:E-1,ze=m?1:-1,He=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(M=isNaN(u)?1:0,T=$):(T=Math.floor(Math.log(u)/Math.LN2),u*(B=Math.pow(2,-T))<1&&(T--,B*=2),(u+=T+q>=1?ce/B:ce*Math.pow(2,1-q))*B>=2&&(T++,B/=2),T+q>=$?(M=0,T=$):T+q>=1?(M=(u*B-1)*Math.pow(2,x),T+=q):(M=u*Math.pow(2,q-1)*Math.pow(2,x),T=0));x>=8;o[f+me]=255&M,me+=ze,M/=256,x-=8);for(T=T<<x|M,H+=x;H>0;o[f+me]=255&T,me+=ze,T/=256,H-=8);o[f+me-ze]|=128*He},er=Zt;function Zt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Zt.Varint=0,Zt.Fixed64=1,Zt.Bytes=2,Zt.Fixed32=5;var Ur=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Or(o){return o.type===Zt.Bytes?o.readVarint()+o.pos:o.pos+1}function Qr(o,u,f){return f?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function jr(o,u,f){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));f.realloc(m);for(var x=f.pos-1;x>=o;x--)f.buf[x+m]=f.buf[x]}function $r(o,u){for(var f=0;f<o.length;f++)u.writeVarint(o[f])}function en(o,u){for(var f=0;f<o.length;f++)u.writeSVarint(o[f])}function kr(o,u){for(var f=0;f<o.length;f++)u.writeFloat(o[f])}function qr(o,u){for(var f=0;f<o.length;f++)u.writeDouble(o[f])}function Bt(o,u){for(var f=0;f<o.length;f++)u.writeBoolean(o[f])}function or(o,u){for(var f=0;f<o.length;f++)u.writeFixed32(o[f])}function zr(o,u){for(var f=0;f<o.length;f++)u.writeSFixed32(o[f])}function pn(o,u){for(var f=0;f<o.length;f++)u.writeFixed64(o[f])}function Tr(o,u){for(var f=0;f<o.length;f++)u.writeSFixed64(o[f])}function gn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function Br(o,u,f){o[f]=u,o[f+1]=u>>>8,o[f+2]=u>>>16,o[f+3]=u>>>24}function cn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function Cr(o,u,f){o===1&&f.readMessage(nn,u)}function nn(o,u,f){if(o===3){var m=f.readMessage(Wn,{}),x=m.width,E=m.height,T=m.left,M=m.top,B=m.advance;u.push({id:m.id,bitmap:new Ua({width:x+6,height:E+6},m.bitmap),metrics:{width:x,height:E,left:T,top:M,advance:B}})}}function Wn(o,u,f){o===1?u.id=f.readVarint():o===2?u.bitmap=f.readBytes():o===3?u.width=f.readVarint():o===4?u.height=f.readVarint():o===5?u.left=f.readSVarint():o===6?u.top=f.readSVarint():o===7&&(u.advance=f.readVarint())}function hi(o){for(var u=0,f=0,m=0,x=o;m<x.length;m+=1){var E=x[m];u+=E.w*E.h,f=Math.max(f,E.w)}o.sort(function(He,lt){return lt.h-He.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),f),h:1/0}],M=0,B=0,H=0,$=o;H<$.length;H+=1)for(var q=$[H],ce=T.length-1;ce>=0;ce--){var me=T[ce];if(!(q.w>me.w||q.h>me.h)){if(q.x=me.x,q.y=me.y,B=Math.max(B,q.y+q.h),M=Math.max(M,q.x+q.w),q.w===me.w&&q.h===me.h){var ze=T.pop();ce<T.length&&(T[ce]=ze)}else q.h===me.h?(me.x+=q.w,me.w-=q.w):q.w===me.w?(me.y+=q.h,me.h-=q.h):(T.push({x:me.x+q.w,y:me.y,w:me.w-q.w,h:q.h}),me.y+=q.h,me.h-=q.h);break}}return{w:M,h:B,fill:u/(M*B)||0}}Zt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),x=m>>3,E=this.pos;this.type=7&m,o(x,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=gn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=cn(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=gn(this.buf,this.pos)+4294967296*gn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=gn(this.buf,this.pos)+4294967296*cn(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Qt(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Qt(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,f,m=this.buf;return u=127&(f=m[this.pos++]),f<128?u:(u|=(127&(f=m[this.pos++]))<<7,f<128?u:(u|=(127&(f=m[this.pos++]))<<14,f<128?u:(u|=(127&(f=m[this.pos++]))<<21,f<128?u:function(x,E,T){var M,B,H=T.buf;if(M=(112&(B=H[T.pos++]))>>4,B<128||(M|=(127&(B=H[T.pos++]))<<3,B<128)||(M|=(127&(B=H[T.pos++]))<<10,B<128)||(M|=(127&(B=H[T.pos++]))<<17,B<128)||(M|=(127&(B=H[T.pos++]))<<24,B<128)||(M|=(1&(B=H[T.pos++]))<<31,B<128))return Qr(x,M,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(f=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Ur?function(f,m,x){return Ur.decode(f.subarray(m,x))}(this.buf,u,o):function(f,m,x){for(var E="",T=m;T<x;){var M,B,H,$=f[T],q=null,ce=$>239?4:$>223?3:$>191?2:1;if(T+ce>x)break;ce===1?$<128&&(q=$):ce===2?(192&(M=f[T+1]))==128&&(q=(31&$)<<6|63&M)<=127&&(q=null):ce===3?(B=f[T+2],(192&(M=f[T+1]))==128&&(192&B)==128&&((q=(15&$)<<12|(63&M)<<6|63&B)<=2047||q>=55296&&q<=57343)&&(q=null)):ce===4&&(B=f[T+2],H=f[T+3],(192&(M=f[T+1]))==128&&(192&B)==128&&(192&H)==128&&((q=(15&$)<<18|(63&M)<<12|(63&B)<<6|63&H)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,ce=1):q>65535&&(q-=65536,E+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),E+=String.fromCharCode(q),T+=ce}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==Zt.Bytes)return o.push(this.readVarint(u));var f=Or(this);for(o=o||[];this.pos<f;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSVarint());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Zt.Bytes)return o.push(this.readBoolean());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFloat());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Zt.Bytes)return o.push(this.readDouble());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed32());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed32());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed64());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed64());var u=Or(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===Zt.Varint)for(;this.buf[this.pos++]>127;);else if(u===Zt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Zt.Fixed32)this.pos+=4;else{if(u!==Zt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var f=new Uint8Array(u);f.set(this.buf),this.buf=f,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Br(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Br(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Br(this.buf,-1&o,this.pos),Br(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Br(this.buf,-1&o,this.pos),Br(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,f){var m,x;if(u>=0?(m=u%4294967296|0,x=u/4294967296|0):(x=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,x=x+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(E,T,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(m,0,f),function(E,T){var M=(7&E)<<4;T.buf[T.pos++]|=M|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(x,f)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,x,E){for(var T,M,B=0;B<x.length;B++){if((T=x.charCodeAt(B))>55295&&T<57344){if(!M){T>56319||B+1===x.length?(m[E++]=239,m[E++]=191,m[E++]=189):M=T;continue}if(T<56320){m[E++]=239,m[E++]=191,m[E++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[E++]=239,m[E++]=191,m[E++]=189,M=null);T<128?m[E++]=T:(T<2048?m[E++]=T>>6|192:(T<65536?m[E++]=T>>12|224:(m[E++]=T>>18|240,m[E++]=T>>12&63|128),m[E++]=T>>6&63|128),m[E++]=63&T|128)}return E}(this.buf,o,this.pos);var f=this.pos-u;f>=128&&jr(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeFloat:function(o){this.realloc(4),mr(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),mr(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var f=0;f<u;f++)this.buf[this.pos++]=o[f]},writeRawMessage:function(o,u){this.pos++;var f=this.pos;o(u,this);var m=this.pos-f;m>=128&&jr(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,f){this.writeTag(o,Zt.Bytes),this.writeRawMessage(u,f)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,$r,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,en,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,Bt,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,kr,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,qr,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,or,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,zr,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,pn,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Tr,u)},writeBytesField:function(o,u){this.writeTag(o,Zt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,Zt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,Zt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,Zt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,Zt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,Zt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,Zt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,Zt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,Zt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,Zt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,Boolean(u))}};var an=function(o,u){var f=u.pixelRatio,m=u.version,x=u.stretchX,E=u.stretchY,T=u.content;this.paddedRect=o,this.pixelRatio=f,this.stretchX=x,this.stretchY=E,this.content=T,this.version=m},Lr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Lr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Lr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Lr.tlbr.get=function(){return this.tl.concat(this.br)},Lr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(an.prototype,Lr);var _r=function(o,u){var f={},m={};this.haveRenderCallbacks=[];var x=[];this.addImages(o,f,x),this.addImages(u,m,x);var E=hi(x),T=new ao({width:E.w||1,height:E.h||1});for(var M in o){var B=o[M],H=f[M].paddedRect;ao.copy(B.data,T,{x:0,y:0},{x:H.x+1,y:H.y+1},B.data)}for(var $ in u){var q=u[$],ce=m[$].paddedRect,me=ce.x+1,ze=ce.y+1,He=q.data.width,lt=q.data.height;ao.copy(q.data,T,{x:0,y:0},{x:me,y:ze},q.data),ao.copy(q.data,T,{x:0,y:lt-1},{x:me,y:ze-1},{width:He,height:1}),ao.copy(q.data,T,{x:0,y:0},{x:me,y:ze+lt},{width:He,height:1}),ao.copy(q.data,T,{x:He-1,y:0},{x:me-1,y:ze},{width:1,height:lt}),ao.copy(q.data,T,{x:0,y:0},{x:me+He,y:ze},{width:1,height:lt})}this.image=T,this.iconPositions=f,this.patternPositions=m};_r.prototype.addImages=function(o,u,f){for(var m in o){var x=o[m],E={x:0,y:0,w:x.data.width+2,h:x.data.height+2};f.push(E),u[m]=new an(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},_r.prototype.patchUpdatedImages=function(o,u){for(var f in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)},_r.prototype.patchUpdatedImage=function(o,u,f){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;f.update(u.data,void 0,{x:m[0],y:m[1]})}},An("ImagePosition",an),An("ImageAtlas",_r);var Xn={horizontal:1,vertical:2,horizontalOnly:3},pr=function(){this.scale=1,this.fontStack="",this.imageName=null};pr.forText=function(o,u){var f=new pr;return f.scale=o||1,f.fontStack=u,f},pr.forImage=function(o){var u=new pr;return u.imageName=o,u};var yn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function xt(o,u,f,m,x,E,T,M,B,H,$,q,ce,me,ze,He){var lt,tt=yn.fromFeature(o,x);q===Xn.vertical&&tt.verticalizePunctuation();var Rt=Ys.processBidirectionalText,Ut=Ys.processStyledBidirectionalText;if(Rt&&tt.sections.length===1){lt=[];for(var Kt=0,ar=Rt(tt.toString(),fo(tt,H,E,u,m,me,ze));Kt<ar.length;Kt+=1){var hr=ar[Kt],Wr=new yn;Wr.text=hr,Wr.sections=tt.sections;for(var on=0;on<hr.length;on++)Wr.sectionIndex.push(0);lt.push(Wr)}}else if(Ut){lt=[];for(var Un=0,_n=Ut(tt.text,tt.sectionIndex,fo(tt,H,E,u,m,me,ze));Un<_n.length;Un+=1){var Gn=_n[Un],En=new yn;En.text=Gn[0],En.sectionIndex=Gn[1],En.sections=tt.sections,lt.push(En)}}else lt=function(Ir,mn){for(var xi=[],Yi=Ir.text,$n=0,ra=0,Qa=mn;ra<Qa.length;ra+=1){var mo=Qa[ra];xi.push(Ir.substring($n,mo)),$n=mo}return $n<Yi.length&&xi.push(Ir.substring($n,Yi.length)),xi}(tt,fo(tt,H,E,u,m,me,ze));var wi=[],oi={positionedLines:wi,text:tt.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Ir,mn,xi,Yi,$n,ra,Qa,mo,oo,Ja,go,os){for(var ss=0,Ks=-17,vs=0,Qs=0,yo=mo==="right"?1:mo==="left"?0:.5,ms=0,Ui=0,Sa=$n;Ui<Sa.length;Ui+=1){var fa=Sa[Ui];fa.trim();var qi=fa.getMaxScale(),cu=24*(qi-1),Bs={positionedGlyphs:[],lineOffset:0};Ir.positionedLines[ms]=Bs;var Va=Bs.positionedGlyphs,Uo=0;if(fa.length()){for(var Fs=0;Fs<fa.length();Fs++){var na=fa.getSection(Fs),pf=fa.getSectionIndex(Fs),fu=fa.getCharCode(Fs),df=0,Mo=null,vf=null,rc=null,$p=24,dp=!(oo===Xn.horizontal||!go&&!Qc(fu)||go&&(ci[fu]||(mf=fu,ln.Arabic(mf)||ln["Arabic Supplement"](mf)||ln["Arabic Extended-A"](mf)||ln["Arabic Presentation Forms-A"](mf)||ln["Arabic Presentation Forms-B"](mf))));if(na.imageName){var Yp=Yi[na.imageName];if(!Yp)continue;rc=na.imageName,Ir.iconsInText=Ir.iconsInText||!0,vf=Yp.paddedRect;var Qf=Yp.displaySize;na.scale=24*na.scale/os,df=cu+(24-Qf[1]*na.scale),$p=(Mo={width:Qf[0],height:Qf[1],left:1,top:-3,advance:dp?Qf[1]:Qf[0]}).advance;var qp=dp?Qf[0]*na.scale-24*qi:Qf[1]*na.scale-24*qi;qp>0&&qp>Uo&&(Uo=qp)}else{var em=xi[na.fontStack],Kp=em&&em[fu];if(Kp&&Kp.rect)vf=Kp.rect,Mo=Kp.metrics;else{var Yd=mn[na.fontStack],tm=Yd&&Yd[fu];if(!tm)continue;Mo=tm.metrics}df=24*(qi-na.scale)}dp?(Ir.verticalizable=!0,Va.push({glyph:fu,imageName:rc,x:ss,y:Ks+df,vertical:dp,scale:na.scale,fontStack:na.fontStack,sectionIndex:pf,metrics:Mo,rect:vf}),ss+=$p*na.scale+Ja):(Va.push({glyph:fu,imageName:rc,x:ss,y:Ks+df,vertical:dp,scale:na.scale,fontStack:na.fontStack,sectionIndex:pf,metrics:Mo,rect:vf}),ss+=Mo.advance*na.scale+Ja)}Va.length!==0&&(vs=Math.max(ss-Ja,vs),ho(Va,0,Va.length-1,yo,Uo)),ss=0;var vp=ra*qi+Uo;Bs.lineOffset=Math.max(Uo,cu),Ks+=vp,Qs=Math.max(vp,Qs),++ms}else Ks+=ra,++ms}var mf,mp=Ks- -17,Ih=Ea(Qa),ml=Ih.horizontalAlign,Fl=Ih.verticalAlign;(function(Qp,Jp,gp,Ph,ed,td,rd,yp,nd){var _p,qd=(Jp-gp)*ed;_p=td!==rd?-yp*Ph- -17:(-Ph*nd+.5)*rd;for(var xp=0,id=Qp;xp<id.length;xp+=1)for(var nc=0,ws=id[xp].positionedGlyphs;nc<ws.length;nc+=1){var Oh=ws[nc];Oh.x+=qd,Oh.y+=_p}})(Ir.positionedLines,yo,ml,Fl,vs,Qs,ra,mp,$n.length),Ir.top+=-Fl*mp,Ir.bottom=Ir.top+mp,Ir.left+=-ml*vs,Ir.right=Ir.left+vs}(oi,u,f,m,lt,T,M,B,q,H,ce,He),!function(Ir){for(var mn=0,xi=Ir;mn<xi.length;mn+=1)if(xi[mn].positionedGlyphs.length!==0)return!1;return!0}(wi)&&oi}yn.fromFeature=function(o,u){for(var f=new yn,m=0;m<o.sections.length;m++){var x=o.sections[m];x.image?f.addImageSection(x):f.addTextSection(x,u)}return f},yn.prototype.length=function(){return this.text.length},yn.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},yn.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},yn.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},yn.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",f=0;f<o.length;f++){var m=o.charCodeAt(f+1)||null,x=o.charCodeAt(f-1)||null;u+=m&&Df(m)&&!Qe[o[f+1]]||x&&Df(x)&&!Qe[o[f-1]]||!Qe[o[f]]?o[f]:Qe[o[f]]}return u}(this.text)},yn.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&ci[this.text.charCodeAt(u)];u++)o++;for(var f=this.text.length,m=this.text.length-1;m>=0&&m>=o&&ci[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(o,f),this.sectionIndex=this.sectionIndex.slice(o,f)},yn.prototype.substring=function(o,u){var f=new yn;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f},yn.prototype.toString=function(){return this.text},yn.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,f){return Math.max(u,o.sections[f].scale)},0)},yn.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(pr.forText(o.scale,o.fontStack||u));for(var f=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(f)},yn.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(pr.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ht("Reached maximum number of images 6401")}else ht("Can't add FormattedSection with an empty image.")},yn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ci={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ri={};function Gi(o,u,f,m,x,E){if(u.imageName){var T=m[u.imageName];return T?T.displaySize[0]*u.scale*24/E+x:0}var M=f[u.fontStack],B=M&&M[o];return B?B.metrics.advance*u.scale+x:0}function co(o,u,f,m){var x=Math.pow(o-u,2);return m?o<u?x/2:2*x:x+Math.abs(f)*f}function Bo(o,u,f){var m=0;return o===10&&(m-=1e4),f&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Ai(o,u,f,m,x,E){for(var T=null,M=co(u,f,x,E),B=0,H=m;B<H.length;B+=1){var $=H[B],q=co(u-$.x,f,x,E)+$.badness;q<=M&&(T=$,M=q)}return{index:o,x:u,priorBreak:T,badness:M}}function fo(o,u,f,m,x,E,T){if(E!=="point")return[];if(!o)return[];for(var M,B=[],H=function(lt,tt,Rt,Ut,Kt,ar){for(var hr=0,Wr=0;Wr<lt.length();Wr++){var on=lt.getSection(Wr);hr+=Gi(lt.getCharCode(Wr),on,Ut,Kt,tt,ar)}return hr/Math.max(1,Math.ceil(hr/Rt))}(o,u,f,m,x,T),$=o.text.indexOf("\u200B")>=0,q=0,ce=0;ce<o.length();ce++){var me=o.getSection(ce),ze=o.getCharCode(ce);if(ci[ze]||(q+=Gi(ze,me,m,x,u,T)),ce<o.length()-1){var He=!((M=ze)<11904||!(ln["Bopomofo Extended"](M)||ln.Bopomofo(M)||ln["CJK Compatibility Forms"](M)||ln["CJK Compatibility Ideographs"](M)||ln["CJK Compatibility"](M)||ln["CJK Radicals Supplement"](M)||ln["CJK Strokes"](M)||ln["CJK Symbols and Punctuation"](M)||ln["CJK Unified Ideographs Extension A"](M)||ln["CJK Unified Ideographs"](M)||ln["Enclosed CJK Letters and Months"](M)||ln["Halfwidth and Fullwidth Forms"](M)||ln.Hiragana(M)||ln["Ideographic Description Characters"](M)||ln["Kangxi Radicals"](M)||ln["Katakana Phonetic Extensions"](M)||ln.Katakana(M)||ln["Vertical Forms"](M)||ln["Yi Radicals"](M)||ln["Yi Syllables"](M)));(ri[ze]||He||me.imageName)&&B.push(Ai(ce+1,q,H,B,Bo(ze,o.getCharCode(ce+1),He&&$),!1))}}return function lt(tt){return tt?lt(tt.priorBreak).concat(tt.index):[]}(Ai(o.length(),q,H,B,0,!0))}function Ea(o){var u=.5,f=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:u,verticalAlign:f}}function ho(o,u,f,m,x){if(m||x)for(var E=o[f],T=(o[f].x+E.metrics.advance*E.scale)*m,M=u;M<=f;M++)o[M].x-=T,o[M].y+=x}function po(o,u,f,m,x,E){var T,M=o.image;if(M.content){var B=M.content,H=M.pixelRatio||1;T=[B[0]/H,B[1]/H,M.displaySize[0]-B[2]/H,M.displaySize[1]-B[3]/H]}var $,q,ce,me,ze=u.left*E,He=u.right*E;f==="width"||f==="both"?(me=x[0]+ze-m[3],q=x[0]+He+m[1]):q=(me=x[0]+(ze+He-M.displaySize[0])/2)+M.displaySize[0];var lt=u.top*E,tt=u.bottom*E;return f==="height"||f==="both"?($=x[1]+lt-m[0],ce=x[1]+tt+m[2]):ce=($=x[1]+(lt+tt-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:$,right:q,bottom:ce,left:me,collisionPadding:T}}ri[10]=!0,ri[32]=!0,ri[38]=!0,ri[40]=!0,ri[41]=!0,ri[43]=!0,ri[45]=!0,ri[47]=!0,ri[173]=!0,ri[183]=!0,ri[8203]=!0,ri[8208]=!0,ri[8211]=!0,ri[8231]=!0;var za=function(o){function u(f,m,x,E){o.call(this,f,m),this.angle=x,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(ie);function wo(o,u){var f=u.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new St(o+1))};if(f.kind==="source")return{kind:"source"};for(var m=f.zoomStops,x=f.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var T=E=Math.max(0,E-1);T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);var M=m[E],B=m[T];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:B,interpolationType:x}:{kind:"camera",minZoom:M,maxZoom:B,minSize:f.evaluate(new St(M)),maxSize:f.evaluate(new St(B)),interpolationType:x}}function ns(o,u,f){var m=u.uSize,x=f.lowerSize;return o.kind==="source"?x/128:o.kind==="composite"?$a(x/128,f.upperSize/128,u.uSizeT):m}function Co(o,u){var f=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var x=o.interpolationType,E=x?Pt(Go.interpolationFactor(x,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=$a(o.minSize,o.maxSize,E):f=E}return{uSizeT:f,uSize:m}}An("Anchor",za);var Ei=Object.freeze({__proto__:null,getSizeData:wo,evaluateSizeForFeature:ns,evaluateSizeForZoom:Co,SIZE_PACK_FACTOR:128});function is(o,u,f,m,x){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,M=0;M>-f/2;){if(--T<0)return!1;M-=o[T].dist(E),E=o[T]}M+=o[T].dist(o[T+1]),T++;for(var B=[],H=0;M<f/2;){var $=o[T],q=o[T+1];if(!q)return!1;var ce=o[T-1].angleTo($)-$.angleTo(q);for(ce=Math.abs((ce+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:M,angleDelta:ce}),H+=ce;M-B[0].distance>m;)H-=B.shift().angleDelta;if(H>x)return!1;T++,M+=$.dist(q)}return!0}function Ji(o){for(var u=0,f=0;f<o.length-1;f++)u+=o[f].dist(o[f+1]);return u}function Kn(o,u,f){return o?.6*u*f:0}function Oi(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function Xi(o,u,f,m,x,E){for(var T=Kn(f,x,E),M=Oi(f,m)*E,B=0,H=Ji(o)/2,$=0;$<o.length-1;$++){var q=o[$],ce=o[$+1],me=q.dist(ce);if(B+me>H){var ze=(H-B)/me,He=$a(q.x,ce.x,ze),lt=$a(q.y,ce.y,ze),tt=new za(He,lt,ce.angleTo(q),$);return tt._round(),!T||is(o,tt,M,T,u)?tt:void 0}B+=me}}function vo(o,u,f,m,x,E,T,M,B){var H=Kn(m,E,T),$=Oi(m,x),q=$*T,ce=o[0].x===0||o[0].x===B||o[0].y===0||o[0].y===B;return u-q<u/4&&(u=q+u/4),function me(ze,He,lt,tt,Rt,Ut,Kt,ar,hr){for(var Wr=Ut/2,on=Ji(ze),Un=0,_n=He-lt,Gn=[],En=0;En<ze.length-1;En++){for(var wi=ze[En],oi=ze[En+1],Ir=wi.dist(oi),mn=oi.angleTo(wi);_n+lt<Un+Ir;){var xi=((_n+=lt)-Un)/Ir,Yi=$a(wi.x,oi.x,xi),$n=$a(wi.y,oi.y,xi);if(Yi>=0&&Yi<hr&&$n>=0&&$n<hr&&_n-Wr>=0&&_n+Wr<=on){var ra=new za(Yi,$n,mn,En);ra._round(),tt&&!is(ze,ra,Ut,tt,Rt)||Gn.push(ra)}}Un+=Ir}return ar||Gn.length||Kt||(Gn=me(ze,Un/2,lt,tt,Rt,Ut,Kt,!0,hr)),Gn}(o,ce?u/2*M%u:($/2+2*E)*T*M%u,u,H,f,q,ce,!1,B)}function vl(o,u,f,m,x){for(var E=[],T=0;T<o.length;T++)for(var M=o[T],B=void 0,H=0;H<M.length-1;H++){var $=M[H],q=M[H+1];$.x<u&&q.x<u||($.x<u?$=new ie(u,$.y+(u-$.x)/(q.x-$.x)*(q.y-$.y))._round():q.x<u&&(q=new ie(u,$.y+(u-$.x)/(q.x-$.x)*(q.y-$.y))._round()),$.y<f&&q.y<f||($.y<f?$=new ie($.x+(f-$.y)/(q.y-$.y)*(q.x-$.x),f)._round():q.y<f&&(q=new ie($.x+(f-$.y)/(q.y-$.y)*(q.x-$.x),f)._round()),$.x>=m&&q.x>=m||($.x>=m?$=new ie(m,$.y+(m-$.x)/(q.x-$.x)*(q.y-$.y))._round():q.x>=m&&(q=new ie(m,$.y+(m-$.x)/(q.x-$.x)*(q.y-$.y))._round()),$.y>=x&&q.y>=x||($.y>=x?$=new ie($.x+(x-$.y)/(q.y-$.y)*(q.x-$.x),x)._round():q.y>=x&&(q=new ie($.x+(x-$.y)/(q.y-$.y)*(q.x-$.x),x)._round()),B&&$.equals(B[B.length-1])||E.push(B=[$]),B.push(q)))))}return E}function Ge(o,u,f,m){var x=[],E=o.image,T=E.pixelRatio,M=E.paddedRect.w-2,B=E.paddedRect.h-2,H=o.right-o.left,$=o.bottom-o.top,q=E.stretchX||[[0,M]],ce=E.stretchY||[[0,B]],me=function(Yi,$n){return Yi+$n[1]-$n[0]},ze=q.reduce(me,0),He=ce.reduce(me,0),lt=M-ze,tt=B-He,Rt=0,Ut=ze,Kt=0,ar=He,hr=0,Wr=lt,on=0,Un=tt;if(E.content&&m){var _n=E.content;Rt=tr(q,0,_n[0]),Kt=tr(ce,0,_n[1]),Ut=tr(q,_n[0],_n[2]),ar=tr(ce,_n[1],_n[3]),hr=_n[0]-Rt,on=_n[1]-Kt,Wr=_n[2]-_n[0]-Ut,Un=_n[3]-_n[1]-ar}var Gn=function(Yi,$n,ra,Qa){var mo=xn(Yi.stretch-Rt,Ut,H,o.left),oo=Si(Yi.fixed-hr,Wr,Yi.stretch,ze),Ja=xn($n.stretch-Kt,ar,$,o.top),go=Si($n.fixed-on,Un,$n.stretch,He),os=xn(ra.stretch-Rt,Ut,H,o.left),ss=Si(ra.fixed-hr,Wr,ra.stretch,ze),Ks=xn(Qa.stretch-Kt,ar,$,o.top),vs=Si(Qa.fixed-on,Un,Qa.stretch,He),Qs=new ie(mo,Ja),yo=new ie(os,Ja),ms=new ie(os,Ks),Ui=new ie(mo,Ks),Sa=new ie(oo/T,go/T),fa=new ie(ss/T,vs/T),qi=u*Math.PI/180;if(qi){var cu=Math.sin(qi),Bs=Math.cos(qi),Va=[Bs,-cu,cu,Bs];Qs._matMult(Va),yo._matMult(Va),Ui._matMult(Va),ms._matMult(Va)}var Uo=Yi.stretch+Yi.fixed,Fs=$n.stretch+$n.fixed;return{tl:Qs,tr:yo,bl:Ui,br:ms,tex:{x:E.paddedRect.x+1+Uo,y:E.paddedRect.y+1+Fs,w:ra.stretch+ra.fixed-Uo,h:Qa.stretch+Qa.fixed-Fs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sa,pixelOffsetBR:fa,minFontScaleX:Wr/T/H,minFontScaleY:Un/T/$,isSDF:f}};if(m&&(E.stretchX||E.stretchY))for(var En=Gt(q,lt,ze),wi=Gt(ce,tt,He),oi=0;oi<En.length-1;oi++)for(var Ir=En[oi],mn=En[oi+1],xi=0;xi<wi.length-1;xi++)x.push(Gn(Ir,wi[xi],mn,wi[xi+1]));else x.push(Gn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:B+1}));return x}function tr(o,u,f){for(var m=0,x=0,E=o;x<E.length;x+=1){var T=E[x];m+=Math.max(u,Math.min(f,T[1]))-Math.max(u,Math.min(f,T[0]))}return m}function Gt(o,u,f){for(var m=[{fixed:-1,stretch:0}],x=0,E=o;x<E.length;x+=1){var T=E[x],M=T[0],B=T[1],H=m[m.length-1];m.push({fixed:M-H.stretch,stretch:H.stretch}),m.push({fixed:M-H.stretch,stretch:H.stretch+(B-M)})}return m.push({fixed:u+1,stretch:f}),m}function xn(o,u,f,m){return o/u*f+m}function Si(o,u,f,m){return o-u*f/m}var la=function(o,u,f,m,x,E,T,M,B,H){if(this.boxStartIndex=o.length,B){var $=E.top,q=E.bottom,ce=E.collisionPadding;ce&&($-=ce[1],q+=ce[3]);var me=q-$;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{var ze=E.top*T-M,He=E.bottom*T+M,lt=E.left*T-M,tt=E.right*T+M,Rt=E.collisionPadding;if(Rt&&(lt-=Rt[0]*T,ze-=Rt[1]*T,tt+=Rt[2]*T,He+=Rt[3]*T),H){var Ut=new ie(lt,ze),Kt=new ie(tt,ze),ar=new ie(lt,He),hr=new ie(tt,He),Wr=H*Math.PI/180;Ut._rotate(Wr),Kt._rotate(Wr),ar._rotate(Wr),hr._rotate(Wr),lt=Math.min(Ut.x,Kt.x,ar.x,hr.x),tt=Math.max(Ut.x,Kt.x,ar.x,hr.x),ze=Math.min(Ut.y,Kt.y,ar.y,hr.y),He=Math.max(Ut.y,Kt.y,ar.y,hr.y)}o.emplaceBack(u.x,u.y,lt,ze,tt,He,f,m,x)}this.boxEndIndex=o.length},ve=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Ie),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function Ie(o,u){return o<u?-1:o>u?1:0}function Ke(o,u,f){u===void 0&&(u=1),f===void 0&&(f=!1);for(var m=1/0,x=1/0,E=-1/0,T=-1/0,M=o[0],B=0;B<M.length;B++){var H=M[B];(!B||H.x<m)&&(m=H.x),(!B||H.y<x)&&(x=H.y),(!B||H.x>E)&&(E=H.x),(!B||H.y>T)&&(T=H.y)}var $=Math.min(E-m,T-x),q=$/2,ce=new ve([],Xt);if($===0)return new ie(m,x);for(var me=m;me<E;me+=$)for(var ze=x;ze<T;ze+=$)ce.push(new Vt(me+q,ze+q,q,o));for(var He=function(Rt){for(var Ut=0,Kt=0,ar=0,hr=Rt[0],Wr=0,on=hr.length,Un=on-1;Wr<on;Un=Wr++){var _n=hr[Wr],Gn=hr[Un],En=_n.x*Gn.y-Gn.x*_n.y;Kt+=(_n.x+Gn.x)*En,ar+=(_n.y+Gn.y)*En,Ut+=3*En}return new Vt(Kt/Ut,ar/Ut,0,Rt)}(o),lt=ce.length;ce.length;){var tt=ce.pop();(tt.d>He.d||!He.d)&&(He=tt,f&&console.log("found best %d after %d probes",Math.round(1e4*tt.d)/1e4,lt)),tt.max-He.d<=u||(ce.push(new Vt(tt.p.x-(q=tt.h/2),tt.p.y-q,q,o)),ce.push(new Vt(tt.p.x+q,tt.p.y-q,q,o)),ce.push(new Vt(tt.p.x-q,tt.p.y+q,q,o)),ce.push(new Vt(tt.p.x+q,tt.p.y+q,q,o)),lt+=4)}return f&&(console.log("num probes: "+lt),console.log("best distance: "+He.d)),He.p}function Xt(o,u){return u.max-o.max}function Vt(o,u,f,m){this.p=new ie(o,u),this.h=f,this.d=function(x,E){for(var T=!1,M=1/0,B=0;B<E.length;B++)for(var H=E[B],$=0,q=H.length,ce=q-1;$<q;ce=$++){var me=H[$],ze=H[ce];me.y>x.y!=ze.y>x.y&&x.x<(ze.x-me.x)*(x.y-me.y)/(ze.y-me.y)+me.x&&(T=!T),M=Math.min(M,hl(x,me,ze))}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}ve.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},ve.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},ve.prototype.peek=function(){return this.data[0]},ve.prototype._up=function(o){for(var u=this.data,f=this.compare,m=u[o];o>0;){var x=o-1>>1,E=u[x];if(f(m,E)>=0)break;u[o]=E,o=x}u[o]=m},ve.prototype._down=function(o){for(var u=this.data,f=this.compare,m=this.length>>1,x=u[o];o<m;){var E=1+(o<<1),T=u[E],M=E+1;if(M<this.length&&f(u[M],T)<0&&(E=M,T=u[M]),f(T,x)>=0)break;u[o]=T,o=E}u[o]=x};var ut=Number.POSITIVE_INFINITY;function mt(o,u){return u[1]!==ut?function(f,m,x){var E=0,T=0;switch(m=Math.abs(m),x=Math.abs(x),f){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(f){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,T]}(o,u[0],u[1]):function(f,m){var x=0,E=0;m<0&&(m=0);var T=m/Math.sqrt(2);switch(f){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(f){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=m;break;case"right":x=-m}return[x,E]}(o,u[0])}function At(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xe(o,u,f,m,x,E,T,M,B,H,$,q,ce,me,ze){var He=function(Kt,ar,hr,Wr,on,Un,_n,Gn){for(var En=Wr.layout.get("text-rotate").evaluate(Un,{})*Math.PI/180,wi=[],oi=0,Ir=ar.positionedLines;oi<Ir.length;oi+=1)for(var mn=Ir[oi],xi=0,Yi=mn.positionedGlyphs;xi<Yi.length;xi+=1){var $n=Yi[xi];if($n.rect){var ra=$n.rect||{},Qa=4,mo=!0,oo=1,Ja=0,go=(on||Gn)&&$n.vertical,os=$n.metrics.advance*$n.scale/2;if(Gn&&ar.verticalizable&&(Ja=mn.lineOffset/2-($n.imageName?-(24-$n.metrics.width*$n.scale)/2:24*($n.scale-1))),$n.imageName){var ss=_n[$n.imageName];mo=ss.sdf,Qa=1/(oo=ss.pixelRatio)}var Ks=on?[$n.x+os,$n.y]:[0,0],vs=on?[0,0]:[$n.x+os+hr[0],$n.y+hr[1]-Ja],Qs=[0,0];go&&(Qs=vs,vs=[0,0]);var yo=($n.metrics.left-Qa)*$n.scale-os+vs[0],ms=(-$n.metrics.top-Qa)*$n.scale+vs[1],Ui=yo+ra.w*$n.scale/oo,Sa=ms+ra.h*$n.scale/oo,fa=new ie(yo,ms),qi=new ie(Ui,ms),cu=new ie(yo,Sa),Bs=new ie(Ui,Sa);if(go){var Va=new ie(-os,os- -17),Uo=-Math.PI/2,Fs=12-os,na=new ie(22-Fs,-($n.imageName?Fs:0)),pf=new(Function.prototype.bind.apply(ie,[null].concat(Qs)));fa._rotateAround(Uo,Va)._add(na)._add(pf),qi._rotateAround(Uo,Va)._add(na)._add(pf),cu._rotateAround(Uo,Va)._add(na)._add(pf),Bs._rotateAround(Uo,Va)._add(na)._add(pf)}if(En){var fu=Math.sin(En),df=Math.cos(En),Mo=[df,-fu,fu,df];fa._matMult(Mo),qi._matMult(Mo),cu._matMult(Mo),Bs._matMult(Mo)}var vf=new ie(0,0),rc=new ie(0,0);wi.push({tl:fa,tr:qi,bl:cu,br:Bs,tex:ra,writingMode:ar.writingMode,glyphOffset:Ks,sectionIndex:$n.sectionIndex,isSDF:mo,pixelOffsetTL:vf,pixelOffsetBR:rc,minFontScaleX:0,minFontScaleY:0})}}return wi}(0,f,M,x,E,T,m,o.allowVerticalPlacement),lt=o.textSizeData,tt=null;lt.kind==="source"?(tt=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&ht(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):lt.kind==="composite"&&((tt=[128*me.compositeTextSizes[0].evaluate(T,{},ze),128*me.compositeTextSizes[1].evaluate(T,{},ze)])[0]>32640||tt[1]>32640)&&ht(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,He,tt,M,E,T,H,u,B.lineStartIndex,B.lineLength,ce,ze);for(var Rt=0,Ut=$;Rt<Ut.length;Rt+=1)q[Ut[Rt]]=o.text.placedSymbolArray.length-1;return 4*He.length}function ft(o){for(var u in o)return o[u];return null}function Me(o,u,f,m){var x=o.compareText;if(u in x){for(var E=x[u],T=E.length-1;T>=0;T--)if(m.dist(E[T])<f)return!0}else x[u]=[];return x[u].push(m),!1}var dt=Fc.VectorTileFeature.types,ir=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jt(o,u,f,m,x,E,T,M,B,H,$,q,ce){var me=M?Math.min(32640,Math.round(M[0])):0,ze=M?Math.min(32640,Math.round(M[1])):0;o.emplaceBack(u,f,Math.round(32*m),Math.round(32*x),E,T,(me<<1)+(B?1:0),ze,16*H,16*$,256*q,256*ce)}function wr(o,u,f){o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f),o.emplaceBack(u.x,u.y,f)}function Sr(o){for(var u=0,f=o.sections;u<f.length;u+=1)if(Lf(f[u].text))return!0;return!1}var Dr=function(o){this.layoutVertexArray=new ef,this.indexArray=new Vu,this.programConfigurations=o,this.segments=new be,this.dynamicLayoutVertexArray=new Cc,this.opacityVertexArray=new tf,this.placedSymbolArray=new g};Dr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Dr.prototype.upload=function(o,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Wv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Gv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,ir,!0),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(o))},Dr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},An("SymbolBuffers",Dr);var Dn=function(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new be,this.collisionVertexArray=new _h};Dn.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Zd.members,!0)},Dn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},An("CollisionBuffers",Dn);var Tn=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yo([]),this.placementViewportMatrix=Yo([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wo(this.zoom,u["text-size"]),this.iconSizeData=wo(this.zoom,u["icon-size"]);var f=this.layers[0].layout,m=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(function(E){return Xn[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};Tn.prototype.createArrays=function(){this.text=new Dr(new ei(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new Dr(new ei(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new R,this.lineVertexArray=new k,this.symbolInstances=new C},Tn.prototype.calculateGlyphDependencies=function(o,u,f,m,x){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(f||m)&&x){var T=Qe[o.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},Tn.prototype.populate=function(o,u,f){var m=this.layers[0],x=m.layout,E=x.get("text-font"),T=x.get("text-field"),M=x.get("icon-image"),B=(T.value.kind!=="constant"||T.value.value instanceof ca&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),H=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],B||H){for(var q=u.iconDependencies,ce=u.glyphDependencies,me=u.availableImages,ze=new St(this.zoom),He=0,lt=o;He<lt.length;He+=1){var tt=lt[He],Rt=tt.feature,Ut=tt.id,Kt=tt.index,ar=tt.sourceLayerIndex,hr=m._featureFilter.needGeometry,Wr=Ka(Rt,hr);if(m._featureFilter.filter(ze,Wr,f)){hr||(Wr.geometry=Ta(Rt));var on=void 0;if(B){var Un=m.getValueAndResolveTokens("text-field",Wr,f,me),_n=ca.factory(Un);Sr(_n)&&(this.hasRTLText=!0),(!this.hasRTLText||Jc()==="unavailable"||this.hasRTLText&&Ys.isParsed())&&(on=we(_n,m,Wr))}var Gn=void 0;if(H){var En=m.getValueAndResolveTokens("icon-image",Wr,f,me);Gn=En instanceof Ra?En:Ra.fromString(En)}if(on||Gn){var wi=this.sortFeaturesByKey?$.evaluate(Wr,{},f):void 0;if(this.features.push({id:Ut,text:on,icon:Gn,index:Kt,sourceLayerIndex:ar,geometry:Wr.geometry,properties:Rt.properties,type:dt[Rt.type],sortKey:wi}),Gn&&(q[Gn.name]=!0),on){var oi=E.evaluate(Wr,{},f).join(","),Ir=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xn.vertical)>=0;for(var mn=0,xi=on.sections;mn<xi.length;mn+=1){var Yi=xi[mn];if(Yi.image)q[Yi.image.name]=!0;else{var $n=Il(on.toString()),ra=Yi.fontStack||oi,Qa=ce[ra]=ce[ra]||{};this.calculateGlyphDependencies(Yi.text,Qa,Ir,this.allowVerticalPlacement,$n)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(mo){var oo={},Ja={},go=[],os=0;function ss(Va){go.push(mo[Va]),os++}function Ks(Va,Uo,Fs){var na=Ja[Va];return delete Ja[Va],Ja[Uo]=na,go[na].geometry[0].pop(),go[na].geometry[0]=go[na].geometry[0].concat(Fs[0]),na}function vs(Va,Uo,Fs){var na=oo[Uo];return delete oo[Uo],oo[Va]=na,go[na].geometry[0].shift(),go[na].geometry[0]=Fs[0].concat(go[na].geometry[0]),na}function Qs(Va,Uo,Fs){var na=Fs?Uo[0][Uo[0].length-1]:Uo[0][0];return Va+":"+na.x+":"+na.y}for(var yo=0;yo<mo.length;yo++){var ms=mo[yo],Ui=ms.geometry,Sa=ms.text?ms.text.toString():null;if(Sa){var fa=Qs(Sa,Ui),qi=Qs(Sa,Ui,!0);if(fa in Ja&&qi in oo&&Ja[fa]!==oo[qi]){var cu=vs(fa,qi,Ui),Bs=Ks(fa,qi,go[cu].geometry);delete oo[fa],delete Ja[qi],Ja[Qs(Sa,go[Bs].geometry,!0)]=Bs,go[cu].geometry=null}else fa in Ja?Ks(fa,qi,Ui):qi in oo?vs(fa,qi,Ui):(ss(yo),oo[fa]=os-1,Ja[qi]=os-1)}else ss(yo)}return go.filter(function(Va){return Va.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(mo,oo){return mo.sortKey-oo.sortKey})}},Tn.prototype.update=function(o,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f))},Tn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Tn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Tn.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Tn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Tn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Tn.prototype.addToLineVertexArray=function(o,u){var f=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]),E={},T=o.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:m},T<u.length-1&&(m+=u[T+1].dist(u[T]));for(var M=o.segment||0;M>=0;M--)E[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=u[M-1].dist(u[M]));for(var B=0;B<u.length;B++){var H=E[B];this.lineVertexArray.emplaceBack(H.x,H.y,H.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},Tn.prototype.addSymbols=function(o,u,f,m,x,E,T,M,B,H,$,q){for(var ce=o.indexArray,me=o.layoutVertexArray,ze=o.segments.prepareSegment(4*u.length,me,ce,this.canOverlap?E.sortKey:void 0),He=this.glyphOffsetArray.length,lt=ze.vertexLength,tt=this.allowVerticalPlacement&&T===Xn.vertical?Math.PI/2:0,Rt=E.text&&E.text.sections,Ut=0;Ut<u.length;Ut++){var Kt=u[Ut],ar=Kt.tl,hr=Kt.tr,Wr=Kt.bl,on=Kt.br,Un=Kt.tex,_n=Kt.pixelOffsetTL,Gn=Kt.pixelOffsetBR,En=Kt.minFontScaleX,wi=Kt.minFontScaleY,oi=Kt.glyphOffset,Ir=Kt.isSDF,mn=Kt.sectionIndex,xi=ze.vertexLength,Yi=oi[1];jt(me,M.x,M.y,ar.x,Yi+ar.y,Un.x,Un.y,f,Ir,_n.x,_n.y,En,wi),jt(me,M.x,M.y,hr.x,Yi+hr.y,Un.x+Un.w,Un.y,f,Ir,Gn.x,_n.y,En,wi),jt(me,M.x,M.y,Wr.x,Yi+Wr.y,Un.x,Un.y+Un.h,f,Ir,_n.x,Gn.y,En,wi),jt(me,M.x,M.y,on.x,Yi+on.y,Un.x+Un.w,Un.y+Un.h,f,Ir,Gn.x,Gn.y,En,wi),wr(o.dynamicLayoutVertexArray,M,tt),ce.emplaceBack(xi,xi+1,xi+2),ce.emplaceBack(xi+1,xi+2,xi+3),ze.vertexLength+=4,ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(oi[0]),Ut!==u.length-1&&mn===u[Ut+1].sectionIndex||o.programConfigurations.populatePaintArrays(me.length,E,E.index,{},q,Rt&&Rt[mn])}o.placedSymbolArray.emplaceBack(M.x,M.y,He,this.glyphOffsetArray.length-He,lt,B,H,M.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],T,0,!1,0,$)},Tn.prototype._addCollisionDebugVertex=function(o,u,f,m,x,E){return u.emplaceBack(0,0),o.emplaceBack(f.x,f.y,m,x,Math.round(E.x),Math.round(E.y))},Tn.prototype.addCollisionDebugVertices=function(o,u,f,m,x,E,T){var M=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),B=M.vertexLength,H=x.layoutVertexArray,$=x.collisionVertexArray,q=T.anchorX,ce=T.anchorY;this._addCollisionDebugVertex(H,$,E,q,ce,new ie(o,u)),this._addCollisionDebugVertex(H,$,E,q,ce,new ie(f,u)),this._addCollisionDebugVertex(H,$,E,q,ce,new ie(f,m)),this._addCollisionDebugVertex(H,$,E,q,ce,new ie(o,m)),M.vertexLength+=4;var me=x.indexArray;me.emplaceBack(B,B+1),me.emplaceBack(B+1,B+2),me.emplaceBack(B+2,B+3),me.emplaceBack(B+3,B),M.primitiveLength+=4},Tn.prototype.addDebugCollisionBoxes=function(o,u,f,m){for(var x=o;x<u;x++){var E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,f)}},Tn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dn($l,Vd.members,rf),this.iconCollisionBox=new Dn($l,Vd.members,rf);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Tn.prototype._deserializeCollisionBoxesForSymbol=function(o,u,f,m,x,E,T,M,B){for(var H={},$=u;$<f;$++){var q=o.get($);H.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},H.textFeatureIndex=q.featureIndex;break}for(var ce=m;ce<x;ce++){var me=o.get(ce);H.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},H.verticalTextFeatureIndex=me.featureIndex;break}for(var ze=E;ze<T;ze++){var He=o.get(ze);H.iconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},H.iconFeatureIndex=He.featureIndex;break}for(var lt=M;lt<B;lt++){var tt=o.get(lt);H.verticalIconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},H.verticalIconFeatureIndex=tt.featureIndex;break}return H},Tn.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},Tn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Tn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Tn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Tn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Tn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Tn.prototype.addIndicesForPlacedSymbol=function(o,u){for(var f=o.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs,x=f.vertexStartIndex;x<m;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)},Tn.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),f=Math.cos(o),m=[],x=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var M=this.symbolInstances.get(T);m.push(0|Math.round(u*M.anchorX+f*M.anchorY)),x.push(M.featureIndex)}return E.sort(function(B,H){return m[B]-m[H]||x[H]-x[B]}),E},Tn.prototype.addToSortKeyRanges=function(o,u){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},Tn.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,m=this.symbolInstanceIndexes;f<m.length;f+=1){var x=this.symbolInstances.get(m[f]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(E,T,M){E>=0&&M.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},An("SymbolBucket",Tn,{omit:["layers","collisionBoxArray","features","compareText"]}),Tn.MAX_GLYPHS=65535,Tn.addDynamicAttributes=wr;var Mn=new Oa({"symbol-placement":new wn(he.layout_symbol["symbol-placement"]),"symbol-spacing":new wn(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wn(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wn(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wn(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wn(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new wn(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wn(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(he.layout_symbol["icon-size"]),"icon-text-fit":new wn(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wn(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(he.layout_symbol["icon-image"]),"icon-rotate":new Cn(he.layout_symbol["icon-rotate"]),"icon-padding":new wn(he.layout_symbol["icon-padding"]),"icon-keep-upright":new wn(he.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(he.layout_symbol["icon-offset"]),"icon-anchor":new Cn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wn(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wn(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wn(he.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(he.layout_symbol["text-field"]),"text-font":new Cn(he.layout_symbol["text-font"]),"text-size":new Cn(he.layout_symbol["text-size"]),"text-max-width":new Cn(he.layout_symbol["text-max-width"]),"text-line-height":new wn(he.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(he.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(he.layout_symbol["text-justify"]),"text-radial-offset":new Cn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wn(he.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(he.layout_symbol["text-anchor"]),"text-max-angle":new wn(he.layout_symbol["text-max-angle"]),"text-writing-mode":new wn(he.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(he.layout_symbol["text-rotate"]),"text-padding":new wn(he.layout_symbol["text-padding"]),"text-keep-upright":new wn(he.layout_symbol["text-keep-upright"]),"text-transform":new Cn(he.layout_symbol["text-transform"]),"text-offset":new Cn(he.layout_symbol["text-offset"]),"text-allow-overlap":new wn(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wn(he.layout_symbol["text-ignore-placement"]),"text-optional":new wn(he.layout_symbol["text-optional"])}),Qn={paint:new Oa({"icon-opacity":new Cn(he.paint_symbol["icon-opacity"]),"icon-color":new Cn(he.paint_symbol["icon-color"]),"icon-halo-color":new Cn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new wn(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new wn(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(he.paint_symbol["text-opacity"]),"text-color":new Cn(he.paint_symbol["text-color"],{runtimeType:Xr,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new Cn(he.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(he.paint_symbol["text-halo-blur"]),"text-translate":new wn(he.paint_symbol["text-translate"]),"text-translate-anchor":new wn(he.paint_symbol["text-translate-anchor"])}),layout:Mn},ai=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:rn,this.defaultValue=o};ai.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},ai.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},ai.prototype.outputDefined=function(){return!1},ai.prototype.serialize=function(){return null},An("FormatSectionOverride",ai,{omit:["defaultValue"]});var ea=function(o){function u(f){o.call(this,f,Qn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(f,m){if(o.prototype.recalculate.call(this,f,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],T=0,M=x;T<M.length;T+=1){var B=M[T];E.indexOf(B)<0&&E.push(B)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(f,m,x,E){var T=this.layout.get(f).evaluate(m,{},x,E),M=this._unevaluatedLayout._values[f];return M.isDataDriven()||mc(M.value)||!T?T:function(B,H){return H.replace(/{([^{}]+)}/g,function($,q){return q in B?String(B[q]):""})}(m.properties,T)},u.prototype.createBucket=function(f){return new Tn(f)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var f=0,m=Qn.paint.overridableProperties;f<m.length;f+=1){var x=m[f];if(u.hasPaintOverride(this.layout,x)){var E,T=this.paint.get(x),M=new ai(T),B=new Cl(M,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new gc("source",B):new yc("composite",B,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new ko(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(f,m,x){return!(!this.layout||m.isDataDriven()||x.isDataDriven())&&u.hasPaintOverride(this.layout,f)},u.hasPaintOverride=function(f,m){var x=f.get("text-field"),E=Qn.paint.properties[m],T=!1,M=function($){for(var q=0,ce=$;q<ce.length;q+=1)if(E.overrides&&E.overrides.hasOverride(ce[q]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof ca)M(x.value.value.sections);else if(x.value.kind==="source"){var B=function($){T||($ instanceof fi&&va($.value)===Ni?M($.value.sections):$ instanceof Jo?M($.sections):$.eachChild(B))},H=x.value;H._styleExpression&&B(H._styleExpression.expression)}return T},u}(iu),Ro={paint:new Oa({"background-color":new wn(he.paint_background["background-color"]),"background-pattern":new Eo(he.paint_background["background-pattern"]),"background-opacity":new wn(he.paint_background["background-opacity"])})},Ko=function(o){function u(f){o.call(this,f,Ro)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(iu),cf={paint:new Oa({"raster-opacity":new wn(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new wn(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wn(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wn(he.paint_raster["raster-brightness-max"]),"raster-saturation":new wn(he.paint_raster["raster-saturation"]),"raster-contrast":new wn(he.paint_raster["raster-contrast"]),"raster-resampling":new wn(he.paint_raster["raster-resampling"]),"raster-fade-duration":new wn(he.paint_raster["raster-fade-duration"])})},Ls=function(o){function u(f){o.call(this,f,cf)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(iu),jd=function(o){function u(f){o.call(this,f,{}),this.implementation=f}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},u.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},u}(iu),Wu={circle:nf,heatmap:Su,hillshade:Up,fill:kd,"fill-extrusion":Bd,line:zd,symbol:ea,background:Ko,raster:Ls},Rh=ne.HTMLImageElement,Hd=ne.HTMLCanvasElement,Xv=ne.HTMLVideoElement,m0=ne.ImageData,Wd=ne.ImageBitmap,Mh=function(o,u,f,m){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,m)};Mh.prototype.update=function(o,u,f){var m=o.width,x=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===x||f),T=this.context,M=T.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],o instanceof Rh||o instanceof Hd||o instanceof Xv||o instanceof m0||Wd&&o instanceof Wd?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,m,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{var B=f||{x:0,y:0},H=B.x,$=B.y;o instanceof Rh||o instanceof Hd||o instanceof Xv||o instanceof m0||Wd&&o instanceof Wd?M.texSubImage2D(M.TEXTURE_2D,0,H,$,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,H,$,m,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Mh.prototype.bind=function(o,u,f){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),f!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,f||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Mh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Mh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var $v=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};$v.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},$v.prototype.remove=function(){delete this._channel,this._callback=function(){}};var fp=function(o,u,f){this.target=o,this.parent=u,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Fr(["receive","process"],this),this.invoker=new $v(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=te()?o:ne};function Yv(o,u,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}fp.prototype.send=function(o,u,f,m,x){var E=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[T]=f);var M=Pe(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:o,hasCallback:!!f,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:hs(u,M)},M),{cancel:function(){f&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},fp.prototype.receive=function(o){var u=o.data,f=u.id;if(f&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[f];var m=this.cancelCallbacks[f];delete this.cancelCallbacks[f],m&&m()}else te()||u.mustQueue?(this.tasks[f]=u,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,u)},fp.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},fp.prototype.processTask=function(o,u){var f=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(sa(u.error)):m(null,sa(u.data)))}else{var x=!1,E=Pe(this.globalScope)?void 0:[],T=u.hasCallback?function($,q){x=!0,delete f.cancelCallbacks[o],f.target.postMessage({id:o,type:"<response>",sourceMapId:f.mapId,error:$?hs($):null,data:hs(q,E)},E)}:function($){x=!0},M=null,B=sa(u.data);if(this.parent[u.type])M=this.parent[u.type](u.sourceMapId,B,T);else if(this.parent.getWorkerSource){var H=u.type.split(".");M=this.parent.getWorkerSource(u.sourceMapId,H[0],B.source)[H[1]](B,T)}else T(new Error("Could not find function "+u.type));!x&&M&&M.cancel&&(this.cancelCallbacks[o]=M.cancel)}},fp.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fo=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Fo.prototype.setNorthEast=function(o){return this._ne=o instanceof Za?new Za(o.lng,o.lat):Za.convert(o),this},Fo.prototype.setSouthWest=function(o){return this._sw=o instanceof Za?new Za(o.lng,o.lat):Za.convert(o),this},Fo.prototype.extend=function(o){var u,f,m=this._sw,x=this._ne;if(o instanceof Za)u=o,f=o;else{if(!(o instanceof Fo))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Fo.convert(o)):this.extend(Za.convert(o)):this;if(f=o._ne,!(u=o._sw)||!f)return this}return m||x?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),x.lng=Math.max(f.lng,x.lng),x.lat=Math.max(f.lat,x.lat)):(this._sw=new Za(u.lng,u.lat),this._ne=new Za(f.lng,f.lat)),this},Fo.prototype.getCenter=function(){return new Za((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fo.prototype.getSouthWest=function(){return this._sw},Fo.prototype.getNorthEast=function(){return this._ne},Fo.prototype.getNorthWest=function(){return new Za(this.getWest(),this.getNorth())},Fo.prototype.getSouthEast=function(){return new Za(this.getEast(),this.getSouth())},Fo.prototype.getWest=function(){return this._sw.lng},Fo.prototype.getSouth=function(){return this._sw.lat},Fo.prototype.getEast=function(){return this._ne.lng},Fo.prototype.getNorth=function(){return this._ne.lat},Fo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fo.prototype.contains=function(o){var u=Za.convert(o),f=u.lng,m=u.lat,x=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&x},Fo.convert=function(o){return!o||o instanceof Fo?o:new Fo(o)};var Za=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Za.prototype.wrap=function(){return new Za(Ct(this.lng,-180,180),this.lat)},Za.prototype.toArray=function(){return[this.lng,this.lat]},Za.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Za.prototype.distanceTo=function(o){var u=Math.PI/180,f=this.lat*u,m=o.lat*u,x=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(x,1))},Za.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Fo(new Za(this.lng-f,this.lat-u),new Za(this.lng+f,this.lat+u))},Za.convert=function(o){if(o instanceof Za)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Za(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Za(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var qv=2*Math.PI*63710088e-1;function g0(o){return qv*Math.cos(o*Math.PI/180)}function y0(o){return(180+o)/360}function _0(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function x0(o,u){return o/g0(u)}function Kv(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Yf=function(o,u,f){f===void 0&&(f=0),this.x=+o,this.y=+u,this.z=+f};Yf.fromLngLat=function(o,u){u===void 0&&(u=0);var f=Za.convert(o);return new Yf(y0(f.lng),_0(f.lat),x0(u,f.lat))},Yf.prototype.toLngLat=function(){return new Za(360*this.x-180,Kv(this.y))},Yf.prototype.toAltitude=function(){return this.z*g0(Kv(this.y))},Yf.prototype.meterInMercatorCoordinateUnits=function(){return 1/qv*(o=Kv(this.y),1/Math.cos(o*Math.PI/180));var o};var qf=function(o,u,f){this.z=o,this.x=u,this.y=f,this.key=hp(0,o,o,u,f)};qf.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},qf.prototype.url=function(o,u){var f,m,x,E,T,M=(m=this.y,x=this.z,E=Yv(256*(f=this.x),256*(m=Math.pow(2,x)-m-1),x),T=Yv(256*(f+1),256*(m+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),B=function(H,$,q){for(var ce,me="",ze=H;ze>0;ze--)me+=($&(ce=1<<ze-1)?1:0)+(q&ce?2:0);return me}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",M)},qf.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new ie(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},qf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var b0=function(o,u){this.wrap=o,this.canonical=u,this.key=hp(o,u.z,u.z,u.x,u.y)},No=function(o,u,f,m,x){this.overscaledZ=o,this.wrap=u,this.canonical=new qf(f,+m,+x),this.key=hp(u,o,f,m,x)};function hp(o,u,f,m,x){(o*=2)<0&&(o=-1*o-1);var E=1<<f;return(E*E*o+E*x+m).toString(36)+f.toString(36)+u.toString(36)}No.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},No.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new No(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},No.prototype.calculateScaledKey=function(o,u){var f=this.canonical.z-o;return o>this.canonical.z?hp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):hp(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)},No.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},No.prototype.children=function(o){if(this.overscaledZ>=o)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new No(u,this.wrap,u,f,m),new No(u,this.wrap,u,f+1,m),new No(u,this.wrap,u,f,m+1),new No(u,this.wrap,u,f+1,m+1)]},No.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},No.prototype.wrapped=function(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},No.prototype.unwrapTo=function(o){return new No(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},No.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},No.prototype.toUnwrapped=function(){return new b0(this.wrap,this.canonical)},No.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},No.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Yf(o.x-this.wrap,o.y))},An("CanonicalTileID",qf),An("OverscaledTileID",No,{omit:["posMatrix"]});var ff=function(o,u,f){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return ht('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(var x=0;x<m;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(m,x)]=this.data[this._idx(m-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,m)]=this.data[this._idx(x,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};ff.prototype.get=function(o,u){var f=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[m],f[m+1],f[m+2])},ff.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},ff.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},ff.prototype._unpackMapbox=function(o,u,f){return(256*o*256+256*u+f)/10-1e4},ff.prototype._unpackTerrarium=function(o,u,f){return 256*o+u+f/256-32768},ff.prototype.getPixels=function(){return new ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},ff.prototype.backfillBorder=function(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,x=u*this.dim+this.dim,E=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:m=x-1;break;case 1:x=m+1}switch(f){case-1:E=T-1;break;case 1:T=E+1}for(var M=-u*this.dim,B=-f*this.dim,H=E;H<T;H++)for(var $=m;$<x;$++)this.data[this._idx($,H)]=o.data[this._idx($+M,H+B)]},An("DEMData",ff);var Gd=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}};Gd.prototype.encode=function(o){return this._stringToNumber[o]},Gd.prototype.decode=function(o){return this._numberToString[o]};var Xd=function(o,u,f,m,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=f,o._y=m,this.properties=o.properties,this.id=x},Qv={geometry:{configurable:!0}};Qv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Qv.geometry.set=function(o){this._geometry=o},Xd.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(Xd.prototype,Qv);var pp=function(){this.state={},this.stateChanges={},this.deletedStates={}};pp.prototype.updateState=function(o,u,f){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},$t(this.stateChanges[o][m],f),this.deletedStates[o]===null)for(var x in this.deletedStates[o]={},this.state[o])x!==m&&(this.deletedStates[o][x]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])f[E]||(this.deletedStates[o][m][E]=null);else for(var T in f)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][T]===null&&delete this.deletedStates[o][m][T]},pp.prototype.removeFeatureState=function(o,u,f){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][f]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(f in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][f]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},pp.prototype.getState=function(o,u){var f=String(u),m=$t({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var x=this.deletedStates[o][u];if(x===null)return{};for(var E in x)delete m[E]}return m},pp.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},pp.prototype.coalesceChanges=function(o,u){var f={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var x={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),$t(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];f[m]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var M={};if(this.deletedStates[T]===null)for(var B in this.state[T])M[B]={},this.state[T][B]={};else for(var H in this.deletedStates[T]){if(this.deletedStates[T][H]===null)this.state[T][H]={};else for(var $=0,q=Object.keys(this.deletedStates[T][H]);$<q.length;$+=1)delete this.state[T][H][q[$]];M[H]=this.state[T][H]}f[T]=f[T]||{},$t(f[T],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var ce in o)o[ce].setFeatureState(f,u)};var hf=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Po(8192,16,0),this.grid3D=new Po(8192,16,0),this.featureIndexArray=new J,this.promoteId=u};function E0(o,u,f,m,x){return dr(o,function(E,T){var M=u instanceof ol?u.get(T):null;return M&&M.evaluate?M.evaluate(f,m,x):M})}function Jv(o){for(var u=1/0,f=1/0,m=-1/0,x=-1/0,E=0,T=o;E<T.length;E+=1){var M=T[E];u=Math.min(u,M.x),f=Math.min(f,M.y),m=Math.max(m,M.x),x=Math.max(x,M.y)}return{minX:u,minY:f,maxX:m,maxY:x}}function Bg(o,u){return u-o}hf.prototype.insert=function(o,u,f,m,x,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,x);for(var M=E?this.grid3D:this.grid,B=0;B<u.length;B++){for(var H=u[B],$=[1/0,1/0,-1/0,-1/0],q=0;q<H.length;q++){var ce=H[q];$[0]=Math.min($[0],ce.x),$[1]=Math.min($[1],ce.y),$[2]=Math.max($[2],ce.x),$[3]=Math.max($[3],ce.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&M.insert(T,$[0],$[1],$[2],$[3])}},hf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Fc.VectorTile(new er(this.rawTileData)).layers,this.sourceLayerCoder=new Gd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},hf.prototype.query=function(o,u,f,m){var x=this;this.loadVTLayers();for(var E=o.params||{},T=8192/o.tileSize/o.scale,M=Wl(E.filter),B=o.queryGeometry,H=o.queryPadding*T,$=Jv(B),q=this.grid.query($.minX-H,$.minY-H,$.maxX+H,$.maxY+H),ce=Jv(o.cameraQueryGeometry),me=this.grid3D.query(ce.minX-H,ce.minY-H,ce.maxX+H,ce.maxY+H,function(Kt,ar,hr,Wr){return function(on,Un,_n,Gn,En){for(var wi=0,oi=on;wi<oi.length;wi+=1){var Ir=oi[wi];if(Un<=Ir.x&&_n<=Ir.y&&Gn>=Ir.x&&En>=Ir.y)return!0}var mn=[new ie(Un,_n),new ie(Un,En),new ie(Gn,En),new ie(Gn,_n)];if(on.length>2){for(var xi=0,Yi=mn;xi<Yi.length;xi+=1)if(bu(on,Yi[xi]))return!0}for(var $n=0;$n<on.length-1;$n++)if(pl(on[$n],on[$n+1],mn))return!0;return!1}(o.cameraQueryGeometry,Kt-H,ar-H,hr+H,Wr+H)}),ze=0,He=me;ze<He.length;ze+=1)q.push(He[ze]);q.sort(Bg);for(var lt,tt={},Rt=function(Kt){var ar=q[Kt];if(ar!==lt){lt=ar;var hr=x.featureIndexArray.get(ar),Wr=null;x.loadMatchingFeature(tt,hr.bucketIndex,hr.sourceLayerIndex,hr.featureIndex,M,E.layers,E.availableImages,u,f,m,function(on,Un,_n){return Wr||(Wr=Ta(on)),Un.queryIntersectsFeature(B,on,_n,Wr,x.z,o.transform,T,o.pixelPosMatrix)})}},Ut=0;Ut<q.length;Ut++)Rt(Ut);return tt},hf.prototype.loadMatchingFeature=function(o,u,f,m,x,E,T,M,B,H,$){var q=this.bucketLayerIDs[u];if(!E||function(on,Un){for(var _n=0;_n<on.length;_n++)if(Un.indexOf(on[_n])>=0)return!0;return!1}(E,q)){var ce=this.sourceLayerCoder.decode(f),me=this.vtLayers[ce].feature(m);if(x.needGeometry){var ze=Ka(me,!0);if(!x.filter(new St(this.tileID.overscaledZ),ze,this.tileID.canonical))return}else if(!x.filter(new St(this.tileID.overscaledZ),me))return;for(var He=this.getId(me,ce),lt=0;lt<q.length;lt++){var tt=q[lt];if(!(E&&E.indexOf(tt)<0)){var Rt=M[tt];if(Rt){var Ut={};He!==void 0&&H&&(Ut=H.getState(Rt.sourceLayer||"_geojsonTileLayer",He));var Kt=$t({},B[tt]);Kt.paint=E0(Kt.paint,Rt.paint,me,Ut,T),Kt.layout=E0(Kt.layout,Rt.layout,me,Ut,T);var ar=!$||$(me,Rt,Ut);if(ar){var hr=new Xd(me,this.z,this.x,this.y,He);hr.layer=Kt;var Wr=o[tt];Wr===void 0&&(Wr=o[tt]=[]),Wr.push({featureIndex:m,feature:hr,intersectionZ:ar})}}}}}},hf.prototype.lookupSymbolFeatures=function(o,u,f,m,x,E,T,M){var B={};this.loadVTLayers();for(var H=Wl(x),$=0,q=o;$<q.length;$+=1)this.loadMatchingFeature(B,f,m,q[$],H,E,T,M,u);return B},hf.prototype.hasLayer=function(o){for(var u=0,f=this.bucketLayerIDs;u<f.length;u+=1)for(var m=0,x=f[u];m<x.length;m+=1)if(o===x[m])return!0;return!1},hf.prototype.getId=function(o,u){var f=o.id;return this.promoteId&&typeof(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(f=Number(f)),f},An("FeatureIndex",hf,{omit:["rawTileData","sourceLayerCoder"]});var as=function(o,u){this.tileID=o,this.uid=zt(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};as.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<hn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},as.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},as.prototype.loadVectorData=function(o,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(H,$){var q={};if(!$)return q;for(var ce=function(){var He=ze[me],lt=He.layerIds.map(function(Ut){return $.getLayer(Ut)}).filter(Boolean);if(lt.length!==0){He.layers=lt,He.stateDependentLayerIds&&(He.stateDependentLayers=He.stateDependentLayerIds.map(function(Ut){return lt.filter(function(Kt){return Kt.id===Ut})[0]}));for(var tt=0,Rt=lt;tt<Rt.length;tt+=1)q[Rt[tt].id]=He}},me=0,ze=H;me<ze.length;me+=1)ce();return q}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[m];if(x instanceof Tn){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof Tn&&T.hasRTLText){this.hasRTLText=!0,Ys.isLoading()||Ys.isLoaded()||Jc()!=="deferred"||ds();break}}for(var M in this.queryPadding=0,this.buckets){var B=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(M).queryRadius(B))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},as.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},as.prototype.getBucket=function(o){return this.buckets[o.id]},as.prototype.upload=function(o){for(var u in this.buckets){var f=this.buckets[u];f.uploadPending()&&f.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mh(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mh(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},as.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},as.prototype.queryRenderedFeatures=function(o,u,f,m,x,E,T,M,B,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:H,transform:M,params:T,queryPadding:this.queryPadding*B},o,u,f):{}},as.prototype.querySourceFeatures=function(o,u){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var m=f.loadVTLayers(),x=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(E)for(var T=Wl(u&&u.filter),M=this.tileID.canonical,B=M.z,H=M.x,$=M.y,q={z:B,x:H,y:$},ce=0;ce<E.length;ce++){var me=E.feature(ce);if(T.needGeometry){var ze=Ka(me,!0);if(!T.filter(new St(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!T.filter(new St(this.tileID.overscaledZ),me))continue;var He=f.getId(me,x),lt=new Xd(me,B,H,$,He);lt.tile=q,o.push(lt)}}},as.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},as.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},as.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var f=Ne(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),x=!1;if(this.expirationTime>m)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},as.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},as.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",T=f[E],M=o[E];if(T&&M&&Object.keys(M).length!==0){x.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=u&&u.style&&u.style.getLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(x)))}}}},as.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},as.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<hn.now()},as.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},as.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=hn.now()+o},as.prototype.setDependencies=function(o,u){for(var f={},m=0,x=u;m<x.length;m+=1)f[x[m]]=!0;this.dependencies[o]=f},as.prototype.hasDependency=function(o,u){for(var f=0,m=o;f<m.length;f+=1){var x=this.dependencies[m[f]];if(x){for(var E=0,T=u;E<T.length;E+=1)if(x[T[E]])return!0}}return!1};var Kf=ne.performance,$d=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},Kf.mark(this._marks.start)};$d.prototype.finish=function(){Kf.mark(this._marks.end);var o=Kf.getEntriesByName(this._marks.measure);return o.length===0&&(Kf.measure(this._marks.measure,this._marks.start,this._marks.end),o=Kf.getEntriesByName(this._marks.measure),Kf.clearMarks(this._marks.start),Kf.clearMarks(this._marks.end),Kf.clearMeasures(this._marks.measure)),o},_.Actor=fp,_.AlphaImage=Ua,_.CanonicalTileID=qf,_.CollisionBoxArray=v,_.Color=Ti,_.DEMData=ff,_.DataConstantProperty=wn,_.DictionaryCoder=Gd,_.EXTENT=8192,_.ErrorEvent=Ue,_.EvaluationParameters=St,_.Event=Ee,_.Evented=et,_.FeatureIndex=hf,_.FillBucket=Tu,_.FillExtrusionBucket=qo,_.ImageAtlas=_r,_.ImagePosition=an,_.LineBucket=Ts,_.LngLat=Za,_.LngLatBounds=Fo,_.MercatorCoordinate=Yf,_.ONE_EM=24,_.OverscaledTileID=No,_.Point=ie,_.Point$1=ie,_.Properties=Oa,_.Protobuf=er,_.RGBAImage=ao,_.RequestManager=di,_.RequestPerformance=$d,_.ResourceType=z,_.SegmentVector=be,_.SourceFeatureState=pp,_.StructArrayLayout1ui2=cl,_.StructArrayLayout2f1f2i16=Yl,_.StructArrayLayout2i4=Pl,_.StructArrayLayout3ui6=Vu,_.StructArrayLayout4i8=Uf,_.SymbolBucket=Tn,_.Texture=Mh,_.Tile=as,_.Transitionable=Oo,_.Uniform1f=Gr,_.Uniform1i=Er,_.Uniform2f=Zr,_.Uniform3f=vn,_.Uniform4f=zn,_.UniformColor=Hn,_.UniformMatrix4f=Bi,_.UnwrappedTileID=b0,_.ValidationError=Q,_.WritingMode=Xn,_.ZoomHistory=kf,_.add=function(o,u,f){return o[0]=u[0]+f[0],o[1]=u[1]+f[1],o[2]=u[2]+f[2],o},_.addDynamicAttributes=wr,_.asyncAll=function(o,u,f){if(!o.length)return f(null,[]);var m=o.length,x=new Array(o.length),E=null;o.forEach(function(T,M){u(T,function(B,H){B&&(E=B),x[M]=H,--m==0&&f(E,x)})})},_.bezier=nt,_.bindAll=Fr,_.browser=hn,_.cacheEntryPossiblyAdded=function(o){++fe>Yr&&(o.getActor().send("enforceCacheSizeLimit",xr),fe=0)},_.clamp=Pt,_.clearTileCache=function(o){var u=ne.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},_.clipLine=vl,_.clone=function(o){var u=new Li(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},_.clone$1=ct,_.clone$2=function(o){var u=new Li(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},_.collisionCircleLayout=W,_.config=Hr,_.create=function(){var o=new Li(16);return Li!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},_.create$1=function(){var o=new Li(9);return Li!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},_.create$2=function(){var o=new Li(4);return Li!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},_.createCommonjsModule=de,_.createExpression=il,_.createLayout=Do,_.createStyleLayer=function(o){return o.type==="custom"?new jd(o):new Wu[o.type](o)},_.cross=function(o,u,f){var m=u[0],x=u[1],E=u[2],T=f[0],M=f[1],B=f[2];return o[0]=x*B-E*M,o[1]=E*T-m*B,o[2]=m*M-x*T,o},_.deepEqual=function o(u,f){if(Array.isArray(u)){if(!Array.isArray(f)||u.length!==f.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],f[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&f!==null){if(typeof f!="object"||Object.keys(u).length!==Object.keys(f).length)return!1;for(var x in u)if(!o(u[x],f[x]))return!1;return!0}return u===f},_.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},_.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},_.ease=rt,_.emitValidationErrors=Xl,_.endsWith=Ar,_.enforceCacheSizeLimit=function(o){sn(),Xa&&Xa.then(function(u){u.keys().then(function(f){for(var m=0;m<f.length-o;m++)u.delete(f[m])})})},_.evaluateSizeForFeature=ns,_.evaluateSizeForZoom=Co,_.evaluateVariableOffset=mt,_.evented=Ff,_.extend=$t,_.featureFilter=Wl,_.filterObject=It,_.fromRotation=function(o,u){var f=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=f,o[2]=0,o[3]=-f,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},_.getAnchorAlignment=Ea,_.getAnchorJustification=At,_.getArrayBuffer=kt,_.getImage=N,_.getJSON=function(o,u){return Ot($t(o,{type:"json"}),u)},_.getRTLTextPluginStatus=Jc,_.getReferrer=Se,_.getVideo=function(o,u){var f,m,x=ne.document.createElement("video");x.muted=!0,x.onloadstart=function(){u(null,x)};for(var E=0;E<o.length;E++){var T=ne.document.createElement("source");f=o[E],m=void 0,(m=ne.document.createElement("a")).href=f,(m.protocol!==ne.document.location.protocol||m.host!==ne.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=o[E],x.appendChild(T)}return{cancel:function(){}}},_.identity=Yo,_.invert=function(o,u){var f=u[0],m=u[1],x=u[2],E=u[3],T=u[4],M=u[5],B=u[6],H=u[7],$=u[8],q=u[9],ce=u[10],me=u[11],ze=u[12],He=u[13],lt=u[14],tt=u[15],Rt=f*M-m*T,Ut=f*B-x*T,Kt=f*H-E*T,ar=m*B-x*M,hr=m*H-E*M,Wr=x*H-E*B,on=$*He-q*ze,Un=$*lt-ce*ze,_n=$*tt-me*ze,Gn=q*lt-ce*He,En=q*tt-me*He,wi=ce*tt-me*lt,oi=Rt*wi-Ut*En+Kt*Gn+ar*_n-hr*Un+Wr*on;return oi?(o[0]=(M*wi-B*En+H*Gn)*(oi=1/oi),o[1]=(x*En-m*wi-E*Gn)*oi,o[2]=(He*Wr-lt*hr+tt*ar)*oi,o[3]=(ce*hr-q*Wr-me*ar)*oi,o[4]=(B*_n-T*wi-H*Un)*oi,o[5]=(f*wi-x*_n+E*Un)*oi,o[6]=(lt*Kt-ze*Wr-tt*Ut)*oi,o[7]=($*Wr-ce*Kt+me*Ut)*oi,o[8]=(T*En-M*_n+H*on)*oi,o[9]=(m*_n-f*En-E*on)*oi,o[10]=(ze*hr-He*Kt+tt*Rt)*oi,o[11]=(q*Kt-$*hr-me*Rt)*oi,o[12]=(M*Un-T*Gn-B*on)*oi,o[13]=(f*Gn-m*Un+x*on)*oi,o[14]=(He*Ut-ze*ar-lt*Rt)*oi,o[15]=($*ar-q*Ut+ce*Rt)*oi,o):null},_.isChar=ln,_.isMapboxURL=ta,_.keysDifference=function(o,u){var f=[];for(var m in o)m in u||f.push(m);return f},_.makeRequest=Ot,_.mapObject=dr,_.mercatorXfromLng=y0,_.mercatorYfromLat=_0,_.mercatorZfromAltitude=x0,_.mul=Mc,_.multiply=So,_.mvt=Fc,_.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},_.normalize=function(o,u){var f=u[0],m=u[1],x=u[2],E=f*f+m*m+x*x;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},_.number=$a,_.offscreenCanvasSupported=D,_.ortho=function(o,u,f,m,x,E,T){var M=1/(u-f),B=1/(m-x),H=1/(E-T);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*B,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*H,o[11]=0,o[12]=(u+f)*M,o[13]=(x+m)*B,o[14]=(T+E)*H,o[15]=1,o},_.parseGlyphPBF=function(o){return new er(o).readFields(Cr,[])},_.pbf=er,_.performSymbolLayout=function(o,u,f,m,x,E,T){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var M=o.layers[0].layout,B=o.layers[0]._unevaluatedLayout._values,H={};if(o.textSizeData.kind==="composite"){var $=o.textSizeData,q=$.maxZoom;H.compositeTextSizes=[B["text-size"].possiblyEvaluate(new St($.minZoom),T),B["text-size"].possiblyEvaluate(new St(q),T)]}if(o.iconSizeData.kind==="composite"){var ce=o.iconSizeData,me=ce.maxZoom;H.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new St(ce.minZoom),T),B["icon-size"].possiblyEvaluate(new St(me),T)]}H.layoutTextSize=B["text-size"].possiblyEvaluate(new St(o.zoom+1),T),H.layoutIconSize=B["icon-size"].possiblyEvaluate(new St(o.zoom+1),T),H.textMaxSize=B["text-size"].possiblyEvaluate(new St(18));for(var ze=24*M.get("text-line-height"),He=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",lt=M.get("text-keep-upright"),tt=M.get("text-size"),Rt=function(){var ar=Kt[Ut],hr=M.get("text-font").evaluate(ar,{},T).join(","),Wr=tt.evaluate(ar,{},T),on=H.layoutTextSize.evaluate(ar,{},T),Un=H.layoutIconSize.evaluate(ar,{},T),_n={horizontal:{},vertical:void 0},Gn=ar.text,En=[0,0];if(Gn){var wi=Gn.toString(),oi=24*M.get("text-letter-spacing").evaluate(ar,{},T),Ir=function(Ui){for(var Sa=0,fa=Ui;Sa<fa.length;Sa+=1)if(qi=fa[Sa].charCodeAt(0),ln.Arabic(qi)||ln["Arabic Supplement"](qi)||ln["Arabic Extended-A"](qi)||ln["Arabic Presentation Forms-A"](qi)||ln["Arabic Presentation Forms-B"](qi))return!1;var qi;return!0}(wi)?oi:0,mn=M.get("text-anchor").evaluate(ar,{},T),xi=M.get("text-variable-anchor");if(!xi){var Yi=M.get("text-radial-offset").evaluate(ar,{},T);En=Yi?mt(mn,[24*Yi,ut]):M.get("text-offset").evaluate(ar,{},T).map(function(Ui){return 24*Ui})}var $n=He?"center":M.get("text-justify").evaluate(ar,{},T),ra=M.get("symbol-placement"),Qa=ra==="point"?24*M.get("text-max-width").evaluate(ar,{},T):0,mo=function(){o.allowVerticalPlacement&&Il(wi)&&(_n.vertical=xt(Gn,u,f,x,hr,Qa,ze,mn,"left",Ir,En,Xn.vertical,!0,ra,on,Wr))};if(!He&&xi){for(var oo=$n==="auto"?xi.map(function(Ui){return At(Ui)}):[$n],Ja=!1,go=0;go<oo.length;go++){var os=oo[go];if(!_n.horizontal[os])if(Ja)_n.horizontal[os]=_n.horizontal[0];else{var ss=xt(Gn,u,f,x,hr,Qa,ze,"center",os,Ir,En,Xn.horizontal,!1,ra,on,Wr);ss&&(_n.horizontal[os]=ss,Ja=ss.positionedLines.length===1)}}mo()}else{$n==="auto"&&($n=At(mn));var Ks=xt(Gn,u,f,x,hr,Qa,ze,mn,$n,Ir,En,Xn.horizontal,!1,ra,on,Wr);Ks&&(_n.horizontal[$n]=Ks),mo(),Il(wi)&&He&&lt&&(_n.vertical=xt(Gn,u,f,x,hr,Qa,ze,mn,$n,Ir,En,Xn.vertical,!1,ra,on,Wr))}}var vs=void 0,Qs=!1;if(ar.icon&&ar.icon.name){var yo=m[ar.icon.name];yo&&(vs=function(Ui,Sa,fa){var qi=Ea(fa),cu=Sa[0]-Ui.displaySize[0]*qi.horizontalAlign,Bs=Sa[1]-Ui.displaySize[1]*qi.verticalAlign;return{image:Ui,top:Bs,bottom:Bs+Ui.displaySize[1],left:cu,right:cu+Ui.displaySize[0]}}(x[ar.icon.name],M.get("icon-offset").evaluate(ar,{},T),M.get("icon-anchor").evaluate(ar,{},T)),Qs=yo.sdf,o.sdfIcons===void 0?o.sdfIcons=yo.sdf:o.sdfIcons!==yo.sdf&&ht("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yo.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var ms=ft(_n.horizontal)||_n.vertical;o.iconsInText=!!ms&&ms.iconsInText,(ms||vs)&&function(Ui,Sa,fa,qi,cu,Bs,Va,Uo,Fs,na,pf){var fu=Bs.textMaxSize.evaluate(Sa,{});fu===void 0&&(fu=Va);var df,Mo=Ui.layers[0].layout,vf=Mo.get("icon-offset").evaluate(Sa,{},pf),rc=ft(fa.horizontal),$p=Va/24,dp=Ui.tilePixelRatio*$p,Yp=Ui.tilePixelRatio*fu/24,Qf=Ui.tilePixelRatio*Uo,qp=Ui.tilePixelRatio*Mo.get("symbol-spacing"),em=Mo.get("text-padding")*Ui.tilePixelRatio,Kp=Mo.get("icon-padding")*Ui.tilePixelRatio,Yd=Mo.get("text-max-angle")/180*Math.PI,tm=Mo.get("text-rotation-alignment")==="map"&&Mo.get("symbol-placement")!=="point",vp=Mo.get("icon-rotation-alignment")==="map"&&Mo.get("symbol-placement")!=="point",mf=Mo.get("symbol-placement"),mp=qp/2,Ih=Mo.get("icon-text-fit");qi&&Ih!=="none"&&(Ui.allowVerticalPlacement&&fa.vertical&&(df=po(qi,fa.vertical,Ih,Mo.get("icon-text-fit-padding"),vf,$p)),rc&&(qi=po(qi,rc,Ih,Mo.get("icon-text-fit-padding"),vf,$p)));var ml=function(Fg,od){od.x<0||od.x>=8192||od.y<0||od.y>=8192||function(_o,ic,Ng,Jf,Y,bp,sd,ac,ud,Ep,ld,cd,Qd,eh,Sp,am,om,sm,um,S0,Gu,fd,lm,oc,A0){var cm,sc,kh,Dh,Lh,gf=_o.addToLineVertexArray(ic,Ng),T0=0,fm=0,w0=0,C0=0,Jd=-1,hm=-1,gs={},R0=Fe(""),pm=0,dm=0;if(ac._unevaluatedLayout.getValue("text-radial-offset")===void 0?(pm=(cm=ac.layout.get("text-offset").evaluate(Gu,{},oc).map(function(pd){return 24*pd}))[0],dm=cm[1]):(pm=24*ac.layout.get("text-radial-offset").evaluate(Gu,{},oc),dm=ut),_o.allowVerticalPlacement&&Jf.vertical){var M0=ac.layout.get("text-rotate").evaluate(Gu,{},oc)+90;Dh=new la(ud,ic,Ep,ld,cd,Jf.vertical,Qd,eh,Sp,M0),sd&&(Lh=new la(ud,ic,Ep,ld,cd,sd,om,sm,Sp,M0))}if(Y){var Bh=ac.layout.get("icon-rotate").evaluate(Gu,{}),vm=ac.layout.get("icon-text-fit")!=="none",mm=Ge(Y,Bh,lm,vm),ev=sd?Ge(sd,Bh,lm,vm):void 0;kh=new la(ud,ic,Ep,ld,cd,Y,om,sm,!1,Bh),T0=4*mm.length;var tv=_o.iconSizeData,Ap=null;tv.kind==="source"?(Ap=[128*ac.layout.get("icon-size").evaluate(Gu,{})])[0]>32640&&ht(_o.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):tv.kind==="composite"&&((Ap=[128*fd.compositeIconSizes[0].evaluate(Gu,{},oc),128*fd.compositeIconSizes[1].evaluate(Gu,{},oc)])[0]>32640||Ap[1]>32640)&&ht(_o.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),_o.addSymbols(_o.icon,mm,Ap,S0,um,Gu,!1,ic,gf.lineStartIndex,gf.lineLength,-1,oc),Jd=_o.icon.placedSymbolArray.length-1,ev&&(fm=4*ev.length,_o.addSymbols(_o.icon,ev,Ap,S0,um,Gu,Xn.vertical,ic,gf.lineStartIndex,gf.lineLength,-1,oc),hm=_o.icon.placedSymbolArray.length-1)}for(var I0 in Jf.horizontal){var rv=Jf.horizontal[I0];if(!sc){R0=Fe(rv.text);var gm=ac.layout.get("text-rotate").evaluate(Gu,{},oc);sc=new la(ud,ic,Ep,ld,cd,rv,Qd,eh,Sp,gm)}var nv=rv.positionedLines.length===1;if(w0+=Xe(_o,ic,rv,bp,ac,Sp,Gu,am,gf,Jf.vertical?Xn.horizontal:Xn.horizontalOnly,nv?Object.keys(Jf.horizontal):[I0],gs,Jd,fd,oc),nv)break}Jf.vertical&&(C0+=Xe(_o,ic,Jf.vertical,bp,ac,Sp,Gu,am,gf,Xn.vertical,["vertical"],gs,hm,fd,oc));var ym=sc?sc.boxStartIndex:_o.collisionBoxArray.length,iv=sc?sc.boxEndIndex:_o.collisionBoxArray.length,av=Dh?Dh.boxStartIndex:_o.collisionBoxArray.length,_m=Dh?Dh.boxEndIndex:_o.collisionBoxArray.length,xm=kh?kh.boxStartIndex:_o.collisionBoxArray.length,ov=kh?kh.boxEndIndex:_o.collisionBoxArray.length,hd=Lh?Lh.boxStartIndex:_o.collisionBoxArray.length,Xu=Lh?Lh.boxEndIndex:_o.collisionBoxArray.length,Nl=-1,Tp=function(pd,P0){return pd&&pd.circleDiameter?Math.max(pd.circleDiameter,P0):P0};Nl=Tp(sc,Nl),Nl=Tp(Dh,Nl),Nl=Tp(kh,Nl);var yf=(Nl=Tp(Lh,Nl))>-1?1:0;yf&&(Nl*=A0/24),_o.glyphOffsetArray.length>=Tn.MAX_GLYPHS&&ht("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gu.sortKey!==void 0&&_o.addToSortKeyRanges(_o.symbolInstances.length,Gu.sortKey),_o.symbolInstances.emplaceBack(ic.x,ic.y,gs.right>=0?gs.right:-1,gs.center>=0?gs.center:-1,gs.left>=0?gs.left:-1,gs.vertical||-1,Jd,hm,R0,ym,iv,av,_m,xm,ov,hd,Xu,Ep,w0,C0,T0,fm,yf,0,Qd,pm,dm,Nl)}(Ui,od,Fg,fa,qi,cu,df,Ui.layers[0],Ui.collisionBoxArray,Sa.index,Sa.sourceLayerIndex,Ui.index,dp,em,tm,Fs,Qf,Kp,vp,vf,Sa,Bs,na,pf,Va)};if(mf==="line")for(var Fl=0,Qp=vl(Sa.geometry,0,0,8192,8192);Fl<Qp.length;Fl+=1)for(var Jp=Qp[Fl],gp=0,Ph=vo(Jp,qp,Yd,fa.vertical||rc,qi,24,Yp,Ui.overscaling,8192);gp<Ph.length;gp+=1){var ed=Ph[gp];rc&&Me(Ui,rc.text,mp,ed)||ml(Jp,ed)}else if(mf==="line-center")for(var td=0,rd=Sa.geometry;td<rd.length;td+=1){var yp=rd[td];if(yp.length>1){var nd=Xi(yp,Yd,fa.vertical||rc,qi,24,Yp);nd&&ml(yp,nd)}}else if(Sa.type==="Polygon")for(var _p=0,qd=Au(Sa.geometry,0);_p<qd.length;_p+=1){var xp=qd[_p],id=Ke(xp,16);ml(xp[0],new za(id.x,id.y,0))}else if(Sa.type==="LineString")for(var nc=0,ws=Sa.geometry;nc<ws.length;nc+=1){var Oh=ws[nc];ml(Oh,new za(Oh[0].x,Oh[0].y,0))}else if(Sa.type==="Point")for(var Kd=0,rm=Sa.geometry;Kd<rm.length;Kd+=1)for(var ad=0,nm=rm[Kd];ad<nm.length;ad+=1){var im=nm[ad];ml([im],new za(im.x,im.y,0))}}(o,ar,_n,vs,m,H,on,Un,En,Qs,T)},Ut=0,Kt=o.features;Ut<Kt.length;Ut+=1)Rt();E&&o.generateCollisionDebugBuffers()},_.perspective=function(o,u,f,m,x){var E,T=1/Math.tan(u/2);return o[0]=T/f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,x!=null&&x!==1/0?(o[10]=(x+m)*(E=1/(m-x)),o[14]=2*x*m*E):(o[10]=-1,o[14]=-2*m),o},_.pick=function(o,u){for(var f={},m=0;m<u.length;m++){var x=u[m];x in o&&(f[x]=o[x])}return f},_.plugin=Ys,_.polygonIntersectsPolygon=fl,_.postMapLoadEvent=Wt,_.postTurnstileEvent=xs,_.potpack=hi,_.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],_.register=An,_.registerForPluginStateChange=function(o){return o({pluginStatus:ps,pluginURL:zu}),Ff.on("pluginStateChange",o),o},_.renderColorRamp=np,_.rotate=function(o,u,f){var m=u[0],x=u[1],E=u[2],T=u[3],M=Math.sin(f),B=Math.cos(f);return o[0]=m*B+E*M,o[1]=x*B+T*M,o[2]=m*-M+E*B,o[3]=x*-M+T*B,o},_.rotateX=function(o,u,f){var m=Math.sin(f),x=Math.cos(f),E=u[4],T=u[5],M=u[6],B=u[7],H=u[8],$=u[9],q=u[10],ce=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*x+H*m,o[5]=T*x+$*m,o[6]=M*x+q*m,o[7]=B*x+ce*m,o[8]=H*x-E*m,o[9]=$*x-T*m,o[10]=q*x-M*m,o[11]=ce*x-B*m,o},_.rotateZ=function(o,u,f){var m=Math.sin(f),x=Math.cos(f),E=u[0],T=u[1],M=u[2],B=u[3],H=u[4],$=u[5],q=u[6],ce=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*x+H*m,o[1]=T*x+$*m,o[2]=M*x+q*m,o[3]=B*x+ce*m,o[4]=H*x-E*m,o[5]=$*x-T*m,o[6]=q*x-M*m,o[7]=ce*x-B*m,o},_.scale=function(o,u,f){var m=f[0],x=f[1],E=f[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*x,o[5]=u[5]*x,o[6]=u[6]*x,o[7]=u[7]*x,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},_.scale$1=function(o,u,f){return o[0]=u[0]*f,o[1]=u[1]*f,o[2]=u[2]*f,o[3]=u[3]*f,o},_.scale$2=function(o,u,f){return o[0]=u[0]*f,o[1]=u[1]*f,o[2]=u[2]*f,o},_.setCacheLimits=function(o,u){xr=o,Yr=u},_.setRTLTextPlugin=function(o,u,f){if(f===void 0&&(f=!1),ps==="deferred"||ps==="loading"||ps==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");zu=hn.resolveURL(o),ps="deferred",Bf=u,wc(),f||ds()},_.sphericalToCartesian=function(o){var u=o[0],f=o[1],m=o[2];return f+=90,f*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(f)*Math.sin(m),y:u*Math.sin(f)*Math.sin(m),z:u*Math.cos(m)}},_.sqrLen=function(o){var u=o[0],f=o[1];return u*u+f*f},_.styleSpec=he,_.sub=function(o,u,f){return o[0]=u[0]-f[0],o[1]=u[1]-f[1],o[2]=u[2]-f[2],o},_.symbolSize=Ei,_.transformMat3=function(o,u,f){var m=u[0],x=u[1],E=u[2];return o[0]=m*f[0]+x*f[3]+E*f[6],o[1]=m*f[1]+x*f[4]+E*f[7],o[2]=m*f[2]+x*f[5]+E*f[8],o},_.transformMat4=ju,_.translate=function(o,u,f){var m,x,E,T,M,B,H,$,q,ce,me,ze,He=f[0],lt=f[1],tt=f[2];return u===o?(o[12]=u[0]*He+u[4]*lt+u[8]*tt+u[12],o[13]=u[1]*He+u[5]*lt+u[9]*tt+u[13],o[14]=u[2]*He+u[6]*lt+u[10]*tt+u[14],o[15]=u[3]*He+u[7]*lt+u[11]*tt+u[15]):(x=u[1],E=u[2],T=u[3],M=u[4],B=u[5],H=u[6],$=u[7],q=u[8],ce=u[9],me=u[10],ze=u[11],o[0]=m=u[0],o[1]=x,o[2]=E,o[3]=T,o[4]=M,o[5]=B,o[6]=H,o[7]=$,o[8]=q,o[9]=ce,o[10]=me,o[11]=ze,o[12]=m*He+M*lt+q*tt+u[12],o[13]=x*He+B*lt+ce*tt+u[13],o[14]=E*He+H*lt+me*tt+u[14],o[15]=T*He+$*lt+ze*tt+u[15]),o},_.triggerPluginCompletionEvent=yh,_.uniqueId=zt,_.validateCustomStyleLayer=function(o){var u=[],f=o.id;return f===void 0&&u.push({message:"layers."+f+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+f+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),u},_.validateLight=Uu,_.validateStyle=Pf,_.values=function(o){var u=[];for(var f in o)u.push(o[f]);return u},_.vectorTile=Fc,_.version="1.13.3",_.warnOnce=ht,_.webpSupported=Vr,_.window=ne,_.wrap=Ct}),oe(["./shared"],function(_){"use strict";function de(U){var N=typeof U;if(N==="number"||N==="boolean"||N==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){for(var X="[",ee=0,Ee=U;ee<Ee.length;ee+=1)X+=de(Ee[ee])+",";return X+"]"}for(var Ue=Object.keys(U).sort(),et="{",he=0;he<Ue.length;he++)et+=JSON.stringify(Ue[he])+":"+de(U[Ue[he]])+",";return et+"}"}function j(U){for(var N="",X=0,ee=_.refProperties;X<ee.length;X+=1)N+="/"+de(U[ee[X]]);return N}var ue=function(U){this.keyCache={},U&&this.replace(U)};ue.prototype.replace=function(U){this._layerConfigs={},this._layers={},this.update(U,[])},ue.prototype.update=function(U,N){for(var X=this,ee=0,Ee=U;ee<Ee.length;ee+=1){var Ue=Ee[ee];this._layerConfigs[Ue.id]=Ue;var et=this._layers[Ue.id]=_.createStyleLayer(Ue);et._featureFilter=_.featureFilter(et.filter),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id]}for(var he=0,Q=N;he<Q.length;he+=1){var ye=Q[he];delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye]}this.familiesBySource={};for(var Je=0,_t=function(Nr,Xr){for(var si={},un=0;un<Nr.length;un++){var vi=Xr&&Xr[Nr[un].id]||j(Nr[un]);Xr&&(Xr[Nr[un].id]=vi);var Ni=si[vi];Ni||(Ni=si[vi]=[]),Ni.push(Nr[un])}var yi=[];for(var Mi in si)yi.push(si[Mi]);return yi}(_.values(this._layerConfigs),this.keyCache);Je<_t.length;Je+=1){var pe=_t[Je].map(function(Nr){return X._layers[Nr.id]}),yr=pe[0];if(yr.visibility!=="none"){var tn=yr.source||"",rn=this.familiesBySource[tn];rn||(rn=this.familiesBySource[tn]={});var Jt=yr.sourceLayer||"_geojsonTileLayer",Kr=rn[Jt];Kr||(Kr=rn[Jt]=[]),Kr.push(pe)}}};var ie=function(U){var N={},X=[];for(var ee in U){var Ee=U[ee],Ue=N[ee]={};for(var et in Ee){var he=Ee[+et];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var Q={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};X.push(Q),Ue[et]={rect:Q,metrics:he.metrics}}}}var ye=_.potpack(X),Je=new _.AlphaImage({width:ye.w||1,height:ye.h||1});for(var _t in U){var pe=U[_t];for(var yr in pe){var tn=pe[+yr];if(tn&&tn.bitmap.width!==0&&tn.bitmap.height!==0){var rn=N[_t][yr].rect;_.AlphaImage.copy(tn.bitmap,Je,{x:0,y:0},{x:rn.x+1,y:rn.y+1},tn.bitmap)}}}this.image=Je,this.positions=N};_.register("GlyphAtlas",ie);var De=function(U){this.tileID=new _.OverscaledTileID(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.uid=U.uid,this.zoom=U.zoom,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.collectResourceTiming,this.returnDependencies=!!U.returnDependencies,this.promoteId=U.promoteId};function ne(U,N,X){for(var ee=new _.EvaluationParameters(N),Ee=0,Ue=U;Ee<Ue.length;Ee+=1)Ue[Ee].recalculate(ee,X)}function Ze(U,N){var X=_.getArrayBuffer(U.request,function(ee,Ee,Ue,et){ee?N(ee):Ee&&N(null,{vectorTile:new _.vectorTile.VectorTile(new _.pbf(Ee)),rawData:Ee,cacheControl:Ue,expires:et})});return function(){X.cancel(),N()}}De.prototype.parse=function(U,N,X,ee,Ee){var Ue=this;this.status="parsing",this.data=U,this.collisionBoxArray=new _.CollisionBoxArray;var et=new _.DictionaryCoder(Object.keys(U.layers).sort()),he=new _.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var Q,ye,Je,_t,pe={},yr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:X},tn=N.familiesBySource[this.source];for(var rn in tn){var Jt=U.layers[rn];if(Jt){Jt.version===1&&_.warnOnce('Vector tile source "'+this.source+'" layer "'+rn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Kr=et.encode(rn),Nr=[],Xr=0;Xr<Jt.length;Xr++){var si=Jt.feature(Xr),un=he.getId(si,rn);Nr.push({feature:si,id:un,index:Xr,sourceLayerIndex:Kr})}for(var vi=0,Ni=tn[rn];vi<Ni.length;vi+=1){var yi=Ni[vi],Mi=yi[0];Mi.minzoom&&this.zoom<Math.floor(Mi.minzoom)||Mi.maxzoom&&this.zoom>=Mi.maxzoom||Mi.visibility!=="none"&&(ne(yi,this.zoom,X),(pe[Mi.id]=Mi.createBucket({index:he.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kr,sourceID:this.source})).populate(Nr,yr,this.tileID.canonical),he.bucketLayerIDs.push(yi.map(function(Pi){return Pi.id})))}}}var Ii=_.mapObject(yr.glyphDependencies,function(Pi){return Object.keys(Pi).map(Number)});Object.keys(Ii).length?ee.send("getGlyphs",{uid:this.uid,stacks:Ii},function(Pi,_i){Q||(Q=Pi,ye=_i,xa.call(Ue))}):ye={};var xo=Object.keys(yr.iconDependencies);xo.length?ee.send("getImages",{icons:xo,source:this.source,tileID:this.tileID,type:"icons"},function(Pi,_i){Q||(Q=Pi,Je=_i,xa.call(Ue))}):Je={};var Qi=Object.keys(yr.patternDependencies);function xa(){if(Q)return Ee(Q);if(ye&&Je&&_t){var Pi=new ie(ye),_i=new _.ImageAtlas(Je,_t);for(var Ti in pe){var Ca=pe[Ti];Ca instanceof _.SymbolBucket?(ne(Ca.layers,this.zoom,X),_.performSymbolLayout(Ca,ye,Pi.positions,Je,_i.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ca.hasPattern&&(Ca instanceof _.LineBucket||Ca instanceof _.FillBucket||Ca instanceof _.FillExtrusionBucket)&&(ne(Ca.layers,this.zoom,X),Ca.addFeatures(yr,this.tileID.canonical,_i.patternPositions))}this.status="done",Ee(null,{buckets:_.values(pe).filter(function(Vs){return!Vs.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,imageAtlas:_i,glyphMap:this.returnDependencies?ye:null,iconMap:this.returnDependencies?Je:null,glyphPositions:this.returnDependencies?Pi.positions:null})}}Qi.length?ee.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(Pi,_i){Q||(Q=Pi,_t=_i,xa.call(Ue))}):_t={},xa.call(this)};var nt=function(U,N,X,ee){this.actor=U,this.layerIndex=N,this.availableImages=X,this.loadVectorData=ee||Ze,this.loading={},this.loaded={}};nt.prototype.loadTile=function(U,N){var X=this,ee=U.uid;this.loading||(this.loading={});var Ee=!!(U&&U.request&&U.request.collectResourceTiming)&&new _.RequestPerformance(U.request),Ue=this.loading[ee]=new De(U);Ue.abort=this.loadVectorData(U,function(et,he){if(delete X.loading[ee],et||!he)return Ue.status="done",X.loaded[ee]=Ue,N(et);var Q=he.rawData,ye={};he.expires&&(ye.expires=he.expires),he.cacheControl&&(ye.cacheControl=he.cacheControl);var Je={};if(Ee){var _t=Ee.finish();_t&&(Je.resourceTiming=JSON.parse(JSON.stringify(_t)))}Ue.vectorTile=he.vectorTile,Ue.parse(he.vectorTile,X.layerIndex,X.availableImages,X.actor,function(pe,yr){if(pe||!yr)return N(pe);N(null,_.extend({rawTileData:Q.slice(0)},yr,ye,Je))}),X.loaded=X.loaded||{},X.loaded[ee]=Ue})},nt.prototype.reloadTile=function(U,N){var X=this,ee=this.loaded,Ee=U.uid,Ue=this;if(ee&&ee[Ee]){var et=ee[Ee];et.showCollisionBoxes=U.showCollisionBoxes;var he=function(Q,ye){var Je=et.reloadCallback;Je&&(delete et.reloadCallback,et.parse(et.vectorTile,Ue.layerIndex,X.availableImages,Ue.actor,Je)),N(Q,ye)};et.status==="parsing"?et.reloadCallback=he:et.status==="done"&&(et.vectorTile?et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},nt.prototype.abortTile=function(U,N){var X=this.loading,ee=U.uid;X&&X[ee]&&X[ee].abort&&(X[ee].abort(),delete X[ee]),N()},nt.prototype.removeTile=function(U,N){var X=this.loaded,ee=U.uid;X&&X[ee]&&delete X[ee],N()};var rt=_.window.ImageBitmap,Pt=function(){this.loaded={}};function Ct(U,N){if(U.length!==0){$t(U[0],N);for(var X=1;X<U.length;X++)$t(U[X],!N)}}function $t(U,N){for(var X=0,ee=0,Ee=0,Ue=U.length,et=Ue-1;Ee<Ue;et=Ee++){var he=(U[Ee][0]-U[et][0])*(U[et][1]+U[Ee][1]),Q=X+he;ee+=Math.abs(X)>=Math.abs(he)?X-Q+he:he-Q+X,X=Q}X+ee>=0!=!!N&&U.reverse()}Pt.prototype.loadTile=function(U,N){var X=U.uid,ee=U.encoding,Ee=U.rawImageData,Ue=rt&&Ee instanceof rt?this.getImageData(Ee):Ee,et=new _.DEMData(X,Ue,ee);this.loaded=this.loaded||{},this.loaded[X]=et,N(null,et)},Pt.prototype.getImageData=function(U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);var N=this.offscreenCanvasContext.getImageData(-1,-1,U.width+2,U.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new _.RGBAImage({width:N.width,height:N.height},N.data)},Pt.prototype.removeTile=function(U){var N=this.loaded,X=U.uid;N&&N[X]&&delete N[X]};var rr=_.vectorTile.VectorTileFeature.prototype.toGeoJSON,zt=function(U){this._feature=U,this.extent=_.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))};zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var U=[],N=0,X=this._feature.geometry;N<X.length;N+=1){var ee=X[N];U.push([new _.Point$1(ee[0],ee[1])])}return U}for(var Ee=[],Ue=0,et=this._feature.geometry;Ue<et.length;Ue+=1){for(var he=[],Q=0,ye=et[Ue];Q<ye.length;Q+=1){var Je=ye[Q];he.push(new _.Point$1(Je[0],Je[1]))}Ee.push(he)}return Ee},zt.prototype.toGeoJSON=function(U,N,X){return rr.call(this,U,N,X)};var Mt=function(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.EXTENT,this.length=U.length,this._features=U};Mt.prototype.feature=function(U){return new zt(this._features[U])};var Et=_.vectorTile.VectorTileFeature,Fr=Ar;function Ar(U,N){this.options=N||{},this.features=U,this.length=U.length}function dr(U,N){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=N||4096}Ar.prototype.feature=function(U){return new dr(this.features[U],this.options.extent)},dr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var N=0;N<U.length;N++){for(var X=U[N],ee=[],Ee=0;Ee<X.length;Ee++)ee.push(new _.Point$1(X[Ee][0],X[Ee][1]));this.geometry.push(ee)}return this.geometry},dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,N=1/0,X=-1/0,ee=1/0,Ee=-1/0,Ue=0;Ue<U.length;Ue++)for(var et=U[Ue],he=0;he<et.length;he++){var Q=et[he];N=Math.min(N,Q.x),X=Math.max(X,Q.x),ee=Math.min(ee,Q.y),Ee=Math.max(Ee,Q.y)}return[N,ee,X,Ee]},dr.prototype.toGeoJSON=Et.prototype.toGeoJSON;var It=Ft,ct=Fr;function Ft(U){var N=new _.pbf;return function(X,ee){for(var Ee in X.layers)ee.writeMessage(3,ht,X.layers[Ee])}(U,N),N.finish()}function ht(U,N){var X;N.writeVarintField(15,U.version||1),N.writeStringField(1,U.name||""),N.writeVarintField(5,U.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<U.length;X++)ee.feature=U.feature(X),N.writeMessage(2,sr,ee);var Ee=ee.keys;for(X=0;X<Ee.length;X++)N.writeStringField(3,Ee[X]);var Ue=ee.values;for(X=0;X<Ue.length;X++)N.writeMessage(4,Pe,Ue[X])}function sr(U,N){var X=U.feature;X.id!==void 0&&N.writeVarintField(1,X.id),N.writeMessage(2,br,U),N.writeVarintField(3,X.type),N.writeMessage(4,O,X)}function br(U,N){var X=U.feature,ee=U.keys,Ee=U.values,Ue=U.keycache,et=U.valuecache;for(var he in X.properties){var Q=Ue[he];Q===void 0&&(ee.push(he),Ue[he]=Q=ee.length-1),N.writeVarint(Q);var ye=X.properties[he],Je=typeof ye;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(ye=JSON.stringify(ye));var _t=Je+":"+ye,pe=et[_t];pe===void 0&&(Ee.push(ye),et[_t]=pe=Ee.length-1),N.writeVarint(pe)}}function te(U,N){return(N<<3)+(7&U)}function Ne(U){return U<<1^U>>31}function O(U,N){for(var X=U.loadGeometry(),ee=U.type,Ee=0,Ue=0,et=X.length,he=0;he<et;he++){var Q=X[he],ye=1;ee===1&&(ye=Q.length),N.writeVarint(te(1,ye));for(var Je=ee===3?Q.length-1:Q.length,_t=0;_t<Je;_t++){_t===1&&ee!==1&&N.writeVarint(te(2,Je-1));var pe=Q[_t].x-Ee,yr=Q[_t].y-Ue;N.writeVarint(Ne(pe)),N.writeVarint(Ne(yr)),Ee+=pe,Ue+=yr}ee===3&&N.writeVarint(te(7,1))}}function Pe(U,N){var X=typeof U;X==="string"?N.writeStringField(1,U):X==="boolean"?N.writeBooleanField(7,U):X==="number"&&(U%1!=0?N.writeDoubleField(3,U):U<0?N.writeSVarintField(6,U):N.writeVarintField(5,U))}function Ce(U,N,X,ee){pt(U,X,ee),pt(N,2*X,2*ee),pt(N,2*X+1,2*ee+1)}function pt(U,N,X){var ee=U[N];U[N]=U[X],U[X]=ee}function Ye(U,N,X,ee){var Ee=U-X,Ue=N-ee;return Ee*Ee+Ue*Ue}It.fromVectorTileJs=Ft,It.fromGeojsonVt=function(U,N){N=N||{};var X={};for(var ee in U)X[ee]=new Fr(U[ee].features,N),X[ee].name=ee,X[ee].version=N.version,X[ee].extent=N.extent;return Ft({layers:X})},It.GeoJSONWrapper=ct;var We=function(U){return U[0]},ot=function(U){return U[1]},Tt=function(U,N,X,ee,Ee){N===void 0&&(N=We),X===void 0&&(X=ot),ee===void 0&&(ee=64),Ee===void 0&&(Ee=Float64Array),this.nodeSize=ee,this.points=U;for(var Ue=U.length<65536?Uint16Array:Uint32Array,et=this.ids=new Ue(U.length),he=this.coords=new Ee(2*U.length),Q=0;Q<U.length;Q++)et[Q]=Q,he[2*Q]=N(U[Q]),he[2*Q+1]=X(U[Q]);(function ye(Je,_t,pe,yr,tn,rn){if(!(tn-yr<=pe)){var Jt=yr+tn>>1;(function Kr(Nr,Xr,si,un,vi,Ni){for(;vi>un;){if(vi-un>600){var yi=vi-un+1,Mi=si-un+1,Ii=Math.log(yi),xo=.5*Math.exp(2*Ii/3),Qi=.5*Math.sqrt(Ii*xo*(yi-xo)/yi)*(Mi-yi/2<0?-1:1);Kr(Nr,Xr,si,Math.max(un,Math.floor(si-Mi*xo/yi+Qi)),Math.min(vi,Math.floor(si+(yi-Mi)*xo/yi+Qi)),Ni)}var xa=Xr[2*si+Ni],Pi=un,_i=vi;for(Ce(Nr,Xr,un,si),Xr[2*vi+Ni]>xa&&Ce(Nr,Xr,un,vi);Pi<_i;){for(Ce(Nr,Xr,Pi,_i),Pi++,_i--;Xr[2*Pi+Ni]<xa;)Pi++;for(;Xr[2*_i+Ni]>xa;)_i--}Xr[2*un+Ni]===xa?Ce(Nr,Xr,un,_i):Ce(Nr,Xr,++_i,vi),_i<=si&&(un=_i+1),si<=_i&&(vi=_i-1)}})(Je,_t,Jt,yr,tn,rn%2),ye(Je,_t,pe,yr,Jt-1,rn+1),ye(Je,_t,pe,Jt+1,tn,rn+1)}})(et,he,ee,0,et.length-1,0)};Tt.prototype.range=function(U,N,X,ee){return function(Ee,Ue,et,he,Q,ye,Je){for(var _t,pe,yr=[0,Ee.length-1,0],tn=[];yr.length;){var rn=yr.pop(),Jt=yr.pop(),Kr=yr.pop();if(Jt-Kr<=Je)for(var Nr=Kr;Nr<=Jt;Nr++)pe=Ue[2*Nr+1],(_t=Ue[2*Nr])>=et&&_t<=Q&&pe>=he&&pe<=ye&&tn.push(Ee[Nr]);else{var Xr=Math.floor((Kr+Jt)/2);pe=Ue[2*Xr+1],(_t=Ue[2*Xr])>=et&&_t<=Q&&pe>=he&&pe<=ye&&tn.push(Ee[Xr]);var si=(rn+1)%2;(rn===0?et<=_t:he<=pe)&&(yr.push(Kr),yr.push(Xr-1),yr.push(si)),(rn===0?Q>=_t:ye>=pe)&&(yr.push(Xr+1),yr.push(Jt),yr.push(si))}}return tn}(this.ids,this.coords,U,N,X,ee,this.nodeSize)},Tt.prototype.within=function(U,N,X){return function(ee,Ee,Ue,et,he,Q){for(var ye=[0,ee.length-1,0],Je=[],_t=he*he;ye.length;){var pe=ye.pop(),yr=ye.pop(),tn=ye.pop();if(yr-tn<=Q)for(var rn=tn;rn<=yr;rn++)Ye(Ee[2*rn],Ee[2*rn+1],Ue,et)<=_t&&Je.push(ee[rn]);else{var Jt=Math.floor((tn+yr)/2),Kr=Ee[2*Jt],Nr=Ee[2*Jt+1];Ye(Kr,Nr,Ue,et)<=_t&&Je.push(ee[Jt]);var Xr=(pe+1)%2;(pe===0?Ue-he<=Kr:et-he<=Nr)&&(ye.push(tn),ye.push(Jt-1),ye.push(Xr)),(pe===0?Ue+he>=Kr:et+he>=Nr)&&(ye.push(Jt+1),ye.push(yr),ye.push(Xr))}}return Je}(this.ids,this.coords,U,N,X,this.nodeSize)};var gr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(U){return U}},wt=function(U){this.options=Ci(Object.create(gr),U),this.trees=new Array(this.options.maxZoom+1)};function hn(U,N,X,ee,Ee){return{x:U,y:N,zoom:1/0,id:X,parentId:-1,numPoints:ee,properties:Ee}}function Hr(U,N){var X=U.geometry.coordinates,ee=X[1];return{x:Nn(X[0]),y:dn(ee),zoom:1/0,index:N,parentId:-1}}function Vr(U){return{type:"Feature",id:U.id,properties:qn(U),geometry:{type:"Point",coordinates:[(ee=U.x,360*(ee-.5)),(N=U.y,X=(180-360*N)*Math.PI/180,360*Math.atan(Math.exp(X))/Math.PI-90)]}};var N,X,ee}function qn(U){var N=U.numPoints,X=N>=1e4?Math.round(N/1e3)+"k":N>=1e3?Math.round(N/100)/10+"k":N;return Ci(Ci({},U.properties),{cluster:!0,cluster_id:U.id,point_count:N,point_count_abbreviated:X})}function Nn(U){return U/360+.5}function dn(U){var N=Math.sin(U*Math.PI/180),X=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return X<0?0:X>1?1:X}function Ci(U,N){for(var X in N)U[X]=N[X];return U}function di(U){return U.x}function ta(U){return U.y}function Rn(U,N,X,ee,Ee,Ue){var et=Ee-X,he=Ue-ee;if(et!==0||he!==0){var Q=((U-X)*et+(N-ee)*he)/(et*et+he*he);Q>1?(X=Ee,ee=Ue):Q>0&&(X+=et*Q,ee+=he*Q)}return(et=U-X)*et+(he=N-ee)*he}function Bn(U,N,X,ee){var Ee={id:U===void 0?null:U,type:N,geometry:X,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var et=Ue.geometry,he=Ue.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")_a(Ue,et);else if(he==="Polygon"||he==="MultiLineString")for(var Q=0;Q<et.length;Q++)_a(Ue,et[Q]);else if(he==="MultiPolygon")for(Q=0;Q<et.length;Q++)for(var ye=0;ye<et[Q].length;ye++)_a(Ue,et[Q][ye])}(Ee),Ee}function _a(U,N){for(var X=0;X<N.length;X+=3)U.minX=Math.min(U.minX,N[X]),U.minY=Math.min(U.minY,N[X+1]),U.maxX=Math.max(U.maxX,N[X]),U.maxY=Math.max(U.maxY,N[X+1])}function Hi(U,N,X,ee){if(N.geometry){var Ee=N.geometry.coordinates,Ue=N.geometry.type,et=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),he=[],Q=N.id;if(X.promoteId?Q=N.properties[X.promoteId]:X.generateId&&(Q=ee||0),Ue==="Point")Wa(Ee,he);else if(Ue==="MultiPoint")for(var ye=0;ye<Ee.length;ye++)Wa(Ee[ye],he);else if(Ue==="LineString")Ga(Ee,he,et,!1);else if(Ue==="MultiLineString"){if(X.lineMetrics){for(ye=0;ye<Ee.length;ye++)Ga(Ee[ye],he=[],et,!1),U.push(Bn(Q,"LineString",he,N.properties));return}Re(Ee,he,et,!1)}else if(Ue==="Polygon")Re(Ee,he,et,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(ye=0;ye<N.geometry.geometries.length;ye++)Hi(U,{id:Q,geometry:N.geometry.geometries[ye],properties:N.properties},X,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<Ee.length;ye++){var Je=[];Re(Ee[ye],Je,et,!0),he.push(Je)}}U.push(Bn(Q,Ue,he,N.properties))}}function Wa(U,N){N.push(Xa(U[0])),N.push(ua(U[1])),N.push(0)}function Ga(U,N,X,ee){for(var Ee,Ue,et=0,he=0;he<U.length;he++){var Q=Xa(U[he][0]),ye=ua(U[he][1]);N.push(Q),N.push(ye),N.push(0),he>0&&(et+=ee?(Ee*ye-Q*Ue)/2:Math.sqrt(Math.pow(Q-Ee,2)+Math.pow(ye-Ue,2))),Ee=Q,Ue=ye}var Je=N.length-3;N[2]=1,function _t(pe,yr,tn,rn){for(var Jt,Kr=rn,Nr=tn-yr>>1,Xr=tn-yr,si=pe[yr],un=pe[yr+1],vi=pe[tn],Ni=pe[tn+1],yi=yr+3;yi<tn;yi+=3){var Mi=Rn(pe[yi],pe[yi+1],si,un,vi,Ni);if(Mi>Kr)Jt=yi,Kr=Mi;else if(Mi===Kr){var Ii=Math.abs(yi-Nr);Ii<Xr&&(Jt=yi,Xr=Ii)}}Kr>rn&&(Jt-yr>3&&_t(pe,yr,Jt,rn),pe[Jt+2]=Kr,tn-Jt>3&&_t(pe,Jt,tn,rn))}(N,0,Je,X),N[Je+2]=1,N.size=Math.abs(et),N.start=0,N.end=N.size}function Re(U,N,X,ee){for(var Ee=0;Ee<U.length;Ee++){var Ue=[];Ga(U[Ee],Ue,X,ee),N.push(Ue)}}function Xa(U){return U/360+.5}function ua(U){var N=Math.sin(U*Math.PI/180),X=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return X<0?0:X>1?1:X}function to(U,N,X,ee,Ee,Ue,et,he){if(ee/=N,Ue>=(X/=N)&&et<ee)return U;if(et<X||Ue>=ee)return null;for(var Q=[],ye=0;ye<U.length;ye++){var Je=U[ye],_t=Je.geometry,pe=Je.type,yr=Ee===0?Je.minX:Je.minY,tn=Ee===0?Je.maxX:Je.maxY;if(yr>=X&&tn<ee)Q.push(Je);else if(!(tn<X||yr>=ee)){var rn=[];if(pe==="Point"||pe==="MultiPoint")Zs(_t,rn,X,ee,Ee);else if(pe==="LineString")xs(_t,rn,X,ee,Ee,!1,he.lineMetrics);else if(pe==="MultiLineString")Wt(_t,rn,X,ee,Ee,!1);else if(pe==="Polygon")Wt(_t,rn,X,ee,Ee,!0);else if(pe==="MultiPolygon")for(var Jt=0;Jt<_t.length;Jt++){var Kr=[];Wt(_t[Jt],Kr,X,ee,Ee,!0),Kr.length&&rn.push(Kr)}if(rn.length){if(he.lineMetrics&&pe==="LineString"){for(Jt=0;Jt<rn.length;Jt++)Q.push(Bn(Je.id,pe,rn[Jt],Je.tags));continue}pe!=="LineString"&&pe!=="MultiLineString"||(rn.length===1?(pe="LineString",rn=rn[0]):pe="MultiLineString"),pe!=="Point"&&pe!=="MultiPoint"||(pe=rn.length===3?"Point":"MultiPoint"),Q.push(Bn(Je.id,pe,rn,Je.tags))}}}return Q.length?Q:null}function Zs(U,N,X,ee,Ee){for(var Ue=0;Ue<U.length;Ue+=3){var et=U[Ue+Ee];et>=X&&et<=ee&&(N.push(U[Ue]),N.push(U[Ue+1]),N.push(U[Ue+2]))}}function xs(U,N,X,ee,Ee,Ue,et){for(var he,Q,ye=bs(U),Je=Ee===0?Yr:sn,_t=U.start,pe=0;pe<U.length-3;pe+=3){var yr=U[pe],tn=U[pe+1],rn=U[pe+2],Jt=U[pe+3],Kr=U[pe+4],Nr=Ee===0?yr:tn,Xr=Ee===0?Jt:Kr,si=!1;et&&(he=Math.sqrt(Math.pow(yr-Jt,2)+Math.pow(tn-Kr,2))),Nr<X?Xr>X&&(Q=Je(ye,yr,tn,Jt,Kr,X),et&&(ye.start=_t+he*Q)):Nr>ee?Xr<ee&&(Q=Je(ye,yr,tn,Jt,Kr,ee),et&&(ye.start=_t+he*Q)):xr(ye,yr,tn,rn),Xr<X&&Nr>=X&&(Q=Je(ye,yr,tn,Jt,Kr,X),si=!0),Xr>ee&&Nr<=ee&&(Q=Je(ye,yr,tn,Jt,Kr,ee),si=!0),!Ue&&si&&(et&&(ye.end=_t+he*Q),N.push(ye),ye=bs(U)),et&&(_t+=he)}var un=U.length-3;yr=U[un],tn=U[un+1],rn=U[un+2],(Nr=Ee===0?yr:tn)>=X&&Nr<=ee&&xr(ye,yr,tn,rn),un=ye.length-3,Ue&&un>=3&&(ye[un]!==ye[0]||ye[un+1]!==ye[1])&&xr(ye,ye[0],ye[1],ye[2]),ye.length&&N.push(ye)}function bs(U){var N=[];return N.size=U.size,N.start=U.start,N.end=U.end,N}function Wt(U,N,X,ee,Ee,Ue){for(var et=0;et<U.length;et++)xs(U[et],N,X,ee,Ee,Ue,!1)}function xr(U,N,X,ee){U.push(N),U.push(X),U.push(ee)}function Yr(U,N,X,ee,Ee,Ue){var et=(Ue-N)/(ee-N);return U.push(Ue),U.push(X+(Ee-X)*et),U.push(1),et}function sn(U,N,X,ee,Ee,Ue){var et=(Ue-X)/(Ee-X);return U.push(N+(ee-N)*et),U.push(Ue),U.push(1),et}function Vn(U,N){for(var X=[],ee=0;ee<U.length;ee++){var Ee,Ue=U[ee],et=Ue.type;if(et==="Point"||et==="MultiPoint"||et==="LineString")Ee=Wi(Ue.geometry,N);else if(et==="MultiLineString"||et==="Polygon"){Ee=[];for(var he=0;he<Ue.geometry.length;he++)Ee.push(Wi(Ue.geometry[he],N))}else if(et==="MultiPolygon")for(Ee=[],he=0;he<Ue.geometry.length;he++){for(var Q=[],ye=0;ye<Ue.geometry[he].length;ye++)Q.push(Wi(Ue.geometry[he][ye],N));Ee.push(Q)}X.push(Bn(Ue.id,et,Ee,Ue.tags))}return X}function Wi(U,N){var X=[];X.size=U.size,U.start!==void 0&&(X.start=U.start,X.end=U.end);for(var ee=0;ee<U.length;ee+=3)X.push(U[ee]+N,U[ee+1],U[ee+2]);return X}function fe(U,N){if(U.transformed)return U;var X,ee,Ee,Ue=1<<U.z,et=U.x,he=U.y;for(X=0;X<U.features.length;X++){var Q=U.features[X],ye=Q.geometry,Je=Q.type;if(Q.geometry=[],Je===1)for(ee=0;ee<ye.length;ee+=2)Q.geometry.push(D(ye[ee],ye[ee+1],N,Ue,et,he));else for(ee=0;ee<ye.length;ee++){var _t=[];for(Ee=0;Ee<ye[ee].length;Ee+=2)_t.push(D(ye[ee][Ee],ye[ee][Ee+1],N,Ue,et,he));Q.geometry.push(_t)}}return U.transformed=!0,U}function D(U,N,X,ee,Ee,Ue){return[Math.round(X*(U*ee-Ee)),Math.round(X*(N*ee-Ue))]}function z(U,N,X,ee,Ee){for(var Ue=N===Ee.maxZoom?0:Ee.tolerance/((1<<N)*Ee.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ee,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<U.length;he++){et.numFeatures++,ae(et,U[he],Ue,Ee);var Q=U[he].minX,ye=U[he].minY,Je=U[he].maxX,_t=U[he].maxY;Q<et.minX&&(et.minX=Q),ye<et.minY&&(et.minY=ye),Je>et.maxX&&(et.maxX=Je),_t>et.maxY&&(et.maxY=_t)}return et}function ae(U,N,X,ee){var Ee=N.geometry,Ue=N.type,et=[];if(Ue==="Point"||Ue==="MultiPoint")for(var he=0;he<Ee.length;he+=3)et.push(Ee[he]),et.push(Ee[he+1]),U.numPoints++,U.numSimplified++;else if(Ue==="LineString")Se(et,Ee,U,X,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(he=0;he<Ee.length;he++)Se(et,Ee[he],U,X,Ue==="Polygon",he===0);else if(Ue==="MultiPolygon")for(var Q=0;Q<Ee.length;Q++){var ye=Ee[Q];for(he=0;he<ye.length;he++)Se(et,ye[he],U,X,!0,he===0)}if(et.length){var Je=N.tags||null;if(Ue==="LineString"&&ee.lineMetrics){for(var _t in Je={},N.tags)Je[_t]=N.tags[_t];Je.mapbox_clip_start=Ee.start/Ee.size,Je.mapbox_clip_end=Ee.end/Ee.size}var pe={geometry:et,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:Je};N.id!==null&&(pe.id=N.id),U.features.push(pe)}}function Se(U,N,X,ee,Ee,Ue){var et=ee*ee;if(ee>0&&N.size<(Ee?et:ee))X.numPoints+=N.length/3;else{for(var he=[],Q=0;Q<N.length;Q+=3)(ee===0||N[Q+2]>et)&&(X.numSimplified++,he.push(N[Q]),he.push(N[Q+1])),X.numPoints++;Ee&&function(ye,Je){for(var _t=0,pe=0,yr=ye.length,tn=yr-2;pe<yr;tn=pe,pe+=2)_t+=(ye[pe]-ye[tn])*(ye[pe+1]+ye[tn+1]);if(_t>0===Je)for(pe=0,yr=ye.length;pe<yr/2;pe+=2){var rn=ye[pe],Jt=ye[pe+1];ye[pe]=ye[yr-2-pe],ye[pe+1]=ye[yr-1-pe],ye[yr-2-pe]=rn,ye[yr-1-pe]=Jt}}(he,Ue),U.push(he)}}function Le(U,N){var X=(N=this.options=function(Ee,Ue){for(var et in Ue)Ee[et]=Ue[et];return Ee}(Object.create(this.options),N)).debug;if(X&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(Ee,Ue){var et=[];if(Ee.type==="FeatureCollection")for(var he=0;he<Ee.features.length;he++)Hi(et,Ee.features[he],Ue,he);else Hi(et,Ee.type==="Feature"?Ee:{geometry:Ee},Ue);return et}(U,N);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ee=function(Ee,Ue){var et=Ue.buffer/Ue.extent,he=Ee,Q=to(Ee,1,-1-et,et,0,-1,2,Ue),ye=to(Ee,1,1-et,2+et,0,-1,2,Ue);return(Q||ye)&&(he=to(Ee,1,-et,1+et,0,-1,2,Ue)||[],Q&&(he=Vn(Q,1).concat(he)),ye&&(he=he.concat(Vn(ye,-1)))),he}(ee,N)).length&&this.splitTile(ee,0,0,0),X&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ht(U,N,X){return 32*((1<<U)*X+N)+U}function Ot(U,N){var X=U.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);var ee=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ee)return N(null,null);var Ee=new Mt(ee.features),Ue=It(Ee);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),N(null,{vectorTile:Ee,rawData:Ue.buffer})}wt.prototype.load=function(U){var N=this.options,X=N.log,ee=N.minZoom,Ee=N.maxZoom,Ue=N.nodeSize;X&&console.time("total time");var et="prepare "+U.length+" points";X&&console.time(et),this.points=U;for(var he=[],Q=0;Q<U.length;Q++)U[Q].geometry&&he.push(Hr(U[Q],Q));this.trees[Ee+1]=new Tt(he,di,ta,Ue,Float32Array),X&&console.timeEnd(et);for(var ye=Ee;ye>=ee;ye--){var Je=+Date.now();he=this._cluster(he,ye),this.trees[ye]=new Tt(he,di,ta,Ue,Float32Array),X&&console.log("z%d: %d clusters in %dms",ye,he.length,+Date.now()-Je)}return X&&console.timeEnd("total time"),this},wt.prototype.getClusters=function(U,N){var X=((U[0]+180)%360+360)%360-180,ee=Math.max(-90,Math.min(90,U[1])),Ee=U[2]===180?180:((U[2]+180)%360+360)%360-180,Ue=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)X=-180,Ee=180;else if(X>Ee){var et=this.getClusters([X,ee,180,Ue],N),he=this.getClusters([-180,ee,Ee,Ue],N);return et.concat(he)}for(var Q=this.trees[this._limitZoom(N)],ye=[],Je=0,_t=Q.range(Nn(X),dn(Ue),Nn(Ee),dn(ee));Je<_t.length;Je+=1){var pe=Q.points[_t[Je]];ye.push(pe.numPoints?Vr(pe):this.points[pe.index])}return ye},wt.prototype.getChildren=function(U){var N=this._getOriginId(U),X=this._getOriginZoom(U),ee="No cluster with the specified id.",Ee=this.trees[X];if(!Ee)throw new Error(ee);var Ue=Ee.points[N];if(!Ue)throw new Error(ee);for(var et=this.options.radius/(this.options.extent*Math.pow(2,X-1)),he=[],Q=0,ye=Ee.within(Ue.x,Ue.y,et);Q<ye.length;Q+=1){var Je=Ee.points[ye[Q]];Je.parentId===U&&he.push(Je.numPoints?Vr(Je):this.points[Je.index])}if(he.length===0)throw new Error(ee);return he},wt.prototype.getLeaves=function(U,N,X){var ee=[];return this._appendLeaves(ee,U,N=N||10,X=X||0,0),ee},wt.prototype.getTile=function(U,N,X){var ee=this.trees[this._limitZoom(U)],Ee=Math.pow(2,U),Ue=this.options,et=Ue.radius/Ue.extent,he=(X-et)/Ee,Q=(X+1+et)/Ee,ye={features:[]};return this._addTileFeatures(ee.range((N-et)/Ee,he,(N+1+et)/Ee,Q),ee.points,N,X,Ee,ye),N===0&&this._addTileFeatures(ee.range(1-et/Ee,he,1,Q),ee.points,Ee,X,Ee,ye),N===Ee-1&&this._addTileFeatures(ee.range(0,he,et/Ee,Q),ee.points,-1,X,Ee,ye),ye.features.length?ye:null},wt.prototype.getClusterExpansionZoom=function(U){for(var N=this._getOriginZoom(U)-1;N<=this.options.maxZoom;){var X=this.getChildren(U);if(N++,X.length!==1)break;U=X[0].properties.cluster_id}return N},wt.prototype._appendLeaves=function(U,N,X,ee,Ee){for(var Ue=0,et=this.getChildren(N);Ue<et.length;Ue+=1){var he=et[Ue],Q=he.properties;if(Q&&Q.cluster?Ee+Q.point_count<=ee?Ee+=Q.point_count:Ee=this._appendLeaves(U,Q.cluster_id,X,ee,Ee):Ee<ee?Ee++:U.push(he),U.length===X)break}return Ee},wt.prototype._addTileFeatures=function(U,N,X,ee,Ee,Ue){for(var et=0,he=U;et<he.length;et+=1){var Q=N[he[et]],ye=Q.numPoints,Je={type:1,geometry:[[Math.round(this.options.extent*(Q.x*Ee-X)),Math.round(this.options.extent*(Q.y*Ee-ee))]],tags:ye?qn(Q):this.points[Q.index].properties},_t=void 0;ye?_t=Q.id:this.options.generateId?_t=Q.index:this.points[Q.index].id&&(_t=this.points[Q.index].id),_t!==void 0&&(Je.id=_t),Ue.features.push(Je)}},wt.prototype._limitZoom=function(U){return Math.max(this.options.minZoom,Math.min(+U,this.options.maxZoom+1))},wt.prototype._cluster=function(U,N){for(var X=[],ee=this.options,Ee=ee.reduce,Ue=ee.minPoints,et=ee.radius/(ee.extent*Math.pow(2,N)),he=0;he<U.length;he++){var Q=U[he];if(!(Q.zoom<=N)){Q.zoom=N;for(var ye=this.trees[N+1],Je=ye.within(Q.x,Q.y,et),_t=Q.numPoints||1,pe=_t,yr=0,tn=Je;yr<tn.length;yr+=1){var rn=ye.points[tn[yr]];rn.zoom>N&&(pe+=rn.numPoints||1)}if(pe>=Ue){for(var Jt=Q.x*_t,Kr=Q.y*_t,Nr=Ee&&_t>1?this._map(Q,!0):null,Xr=(he<<5)+(N+1)+this.points.length,si=0,un=Je;si<un.length;si+=1){var vi=ye.points[un[si]];if(!(vi.zoom<=N)){vi.zoom=N;var Ni=vi.numPoints||1;Jt+=vi.x*Ni,Kr+=vi.y*Ni,vi.parentId=Xr,Ee&&(Nr||(Nr=this._map(Q,!0)),Ee(Nr,this._map(vi)))}}Q.parentId=Xr,X.push(hn(Jt/pe,Kr/pe,Xr,pe,Nr))}else if(X.push(Q),pe>1)for(var yi=0,Mi=Je;yi<Mi.length;yi+=1){var Ii=ye.points[Mi[yi]];Ii.zoom<=N||(Ii.zoom=N,X.push(Ii))}}}return X},wt.prototype._getOriginId=function(U){return U-this.points.length>>5},wt.prototype._getOriginZoom=function(U){return(U-this.points.length)%32},wt.prototype._map=function(U,N){if(U.numPoints)return N?Ci({},U.properties):U.properties;var X=this.points[U.index].properties,ee=this.options.map(X);return N&&ee===X?Ci({},ee):ee},Le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Le.prototype.splitTile=function(U,N,X,ee,Ee,Ue,et){for(var he=[U,N,X,ee],Q=this.options,ye=Q.debug;he.length;){ee=he.pop(),X=he.pop(),N=he.pop(),U=he.pop();var Je=1<<N,_t=Ht(N,X,ee),pe=this.tiles[_t];if(!pe&&(ye>1&&console.time("creation"),pe=this.tiles[_t]=z(U,N,X,ee,Q),this.tileCoords.push({z:N,x:X,y:ee}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,X,ee,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));var yr="z"+N;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(pe.source=U,Ee){if(N===Q.maxZoom||N===Ee)continue;var tn=1<<Ee-N;if(X!==Math.floor(Ue/tn)||ee!==Math.floor(et/tn))continue}else if(N===Q.indexMaxZoom||pe.numPoints<=Q.indexMaxPoints)continue;if(pe.source=null,U.length!==0){ye>1&&console.time("clipping");var rn,Jt,Kr,Nr,Xr,si,un=.5*Q.buffer/Q.extent,vi=.5-un,Ni=.5+un,yi=1+un;rn=Jt=Kr=Nr=null,Xr=to(U,Je,X-un,X+Ni,0,pe.minX,pe.maxX,Q),si=to(U,Je,X+vi,X+yi,0,pe.minX,pe.maxX,Q),U=null,Xr&&(rn=to(Xr,Je,ee-un,ee+Ni,1,pe.minY,pe.maxY,Q),Jt=to(Xr,Je,ee+vi,ee+yi,1,pe.minY,pe.maxY,Q),Xr=null),si&&(Kr=to(si,Je,ee-un,ee+Ni,1,pe.minY,pe.maxY,Q),Nr=to(si,Je,ee+vi,ee+yi,1,pe.minY,pe.maxY,Q),si=null),ye>1&&console.timeEnd("clipping"),he.push(rn||[],N+1,2*X,2*ee),he.push(Jt||[],N+1,2*X,2*ee+1),he.push(Kr||[],N+1,2*X+1,2*ee),he.push(Nr||[],N+1,2*X+1,2*ee+1)}}},Le.prototype.getTile=function(U,N,X){var ee=this.options,Ee=ee.extent,Ue=ee.debug;if(U<0||U>24)return null;var et=1<<U,he=Ht(U,N=(N%et+et)%et,X);if(this.tiles[he])return fe(this.tiles[he],Ee);Ue>1&&console.log("drilling down to z%d-%d-%d",U,N,X);for(var Q,ye=U,Je=N,_t=X;!Q&&ye>0;)ye--,Je=Math.floor(Je/2),_t=Math.floor(_t/2),Q=this.tiles[Ht(ye,Je,_t)];return Q&&Q.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",ye,Je,_t),Ue>1&&console.time("drilling down"),this.splitTile(Q.source,ye,Je,_t,U,N,X),Ue>1&&console.timeEnd("drilling down"),this.tiles[he]?fe(this.tiles[he],Ee):null):null};var kt=function(U){function N(X,ee,Ee,Ue){U.call(this,X,ee,Ee,Ot),Ue&&(this.loadGeoJSON=Ue)}return U&&(N.__proto__=U),(N.prototype=Object.create(U&&U.prototype)).constructor=N,N.prototype.loadData=function(X,ee){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ee,this._pendingLoadDataParams=X,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},N.prototype._loadData=function(){var X=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ee=this._pendingCallback,Ee=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ue=!!(Ee&&Ee.request&&Ee.request.collectResourceTiming)&&new _.RequestPerformance(Ee.request);this.loadGeoJSON(Ee,function(et,he){if(et||!he)return ee(et);if(typeof he!="object")return ee(new Error("Input data given to '"+Ee.source+"' is not a valid GeoJSON object."));(function pe(yr,tn){var rn,Jt=yr&&yr.type;if(Jt==="FeatureCollection")for(rn=0;rn<yr.features.length;rn++)pe(yr.features[rn],tn);else if(Jt==="GeometryCollection")for(rn=0;rn<yr.geometries.length;rn++)pe(yr.geometries[rn],tn);else if(Jt==="Feature")pe(yr.geometry,tn);else if(Jt==="Polygon")Ct(yr.coordinates,tn);else if(Jt==="MultiPolygon")for(rn=0;rn<yr.coordinates.length;rn++)Ct(yr.coordinates[rn],tn);return yr})(he,!0);try{if(Ee.filter){var Q=_.createExpression(Ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(function(pe){return pe.key+": "+pe.message}).join(", "));var ye=he.features.filter(function(pe){return Q.value.evaluate({zoom:0},pe)});he={type:"FeatureCollection",features:ye}}X._geoJSONIndex=Ee.cluster?new wt(function(pe){var yr=pe.superclusterOptions,tn=pe.clusterProperties;if(!tn||!yr)return yr;for(var rn={},Jt={},Kr={accumulated:null,zoom:0},Nr={properties:null},Xr=Object.keys(tn),si=0,un=Xr;si<un.length;si+=1){var vi=un[si],Ni=tn[vi],yi=Ni[0],Mi=_.createExpression(Ni[1]),Ii=_.createExpression(typeof yi=="string"?[yi,["accumulated"],["get",vi]]:yi);rn[vi]=Mi.value,Jt[vi]=Ii.value}return yr.map=function(xo){Nr.properties=xo;for(var Qi={},xa=0,Pi=Xr;xa<Pi.length;xa+=1){var _i=Pi[xa];Qi[_i]=rn[_i].evaluate(Kr,Nr)}return Qi},yr.reduce=function(xo,Qi){Nr.properties=Qi;for(var xa=0,Pi=Xr;xa<Pi.length;xa+=1){var _i=Pi[xa];Kr.accumulated=xo[_i],xo[_i]=Jt[_i].evaluate(Kr,Nr)}},yr}(Ee)).load(he.features):function(pe,yr){return new Le(pe,yr)}(he,Ee.geojsonVtOptions)}catch(pe){return ee(pe)}X.loaded={};var Je={};if(Ue){var _t=Ue.finish();_t&&(Je.resourceTiming={},Je.resourceTiming[Ee.source]=JSON.parse(JSON.stringify(_t)))}ee(null,Je)})}},N.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},N.prototype.reloadTile=function(X,ee){var Ee=this.loaded;return Ee&&Ee[X.uid]?U.prototype.reloadTile.call(this,X,ee):this.loadTile(X,ee)},N.prototype.loadGeoJSON=function(X,ee){if(X.request)_.getJSON(X.request,ee);else{if(typeof X.data!="string")return ee(new Error("Input data given to '"+X.source+"' is not a valid GeoJSON object."));try{return ee(null,JSON.parse(X.data))}catch(Ee){return ee(new Error("Input data given to '"+X.source+"' is not a valid GeoJSON object."))}}},N.prototype.removeSource=function(X,ee){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ee()},N.prototype.getClusterExpansionZoom=function(X,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(Ee){ee(Ee)}},N.prototype.getClusterChildren=function(X,ee){try{ee(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(Ee){ee(Ee)}},N.prototype.getClusterLeaves=function(X,ee){try{ee(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(Ee){ee(Ee)}},N}(nt),yt=function(U){var N=this;this.self=U,this.actor=new _.Actor(U,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:nt,geojson:kt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(X,ee){if(N.workerSourceTypes[X])throw new Error('Worker source with name "'+X+'" already registered.');N.workerSourceTypes[X]=ee},this.self.registerRTLTextPlugin=function(X){if(_.plugin.isParsed())throw new Error("RTL text plugin already registered.");_.plugin.applyArabicShaping=X.applyArabicShaping,_.plugin.processBidirectionalText=X.processBidirectionalText,_.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}};return yt.prototype.setReferrer=function(U,N){this.referrer=N},yt.prototype.setImages=function(U,N,X){for(var ee in this.availableImages[U]=N,this.workerSources[U]){var Ee=this.workerSources[U][ee];for(var Ue in Ee)Ee[Ue].availableImages=N}X()},yt.prototype.setLayers=function(U,N,X){this.getLayerIndex(U).replace(N),X()},yt.prototype.updateLayers=function(U,N,X){this.getLayerIndex(U).update(N.layers,N.removedIds),X()},yt.prototype.loadTile=function(U,N,X){this.getWorkerSource(U,N.type,N.source).loadTile(N,X)},yt.prototype.loadDEMTile=function(U,N,X){this.getDEMWorkerSource(U,N.source).loadTile(N,X)},yt.prototype.reloadTile=function(U,N,X){this.getWorkerSource(U,N.type,N.source).reloadTile(N,X)},yt.prototype.abortTile=function(U,N,X){this.getWorkerSource(U,N.type,N.source).abortTile(N,X)},yt.prototype.removeTile=function(U,N,X){this.getWorkerSource(U,N.type,N.source).removeTile(N,X)},yt.prototype.removeDEMTile=function(U,N){this.getDEMWorkerSource(U,N.source).removeTile(N)},yt.prototype.removeSource=function(U,N,X){if(this.workerSources[U]&&this.workerSources[U][N.type]&&this.workerSources[U][N.type][N.source]){var ee=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],ee.removeSource!==void 0?ee.removeSource(N,X):X()}},yt.prototype.loadWorkerSource=function(U,N,X){try{this.self.importScripts(N.url),X()}catch(ee){X(ee.toString())}},yt.prototype.syncRTLPluginState=function(U,N,X){try{_.plugin.setState(N);var ee=_.plugin.getPluginURL();if(_.plugin.isLoaded()&&!_.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);var Ee=_.plugin.isParsed();X(Ee?void 0:new Error("RTL Text Plugin failed to import scripts from "+ee),Ee)}}catch(Ue){X(Ue.toString())}},yt.prototype.getAvailableImages=function(U){var N=this.availableImages[U];return N||(N=[]),N},yt.prototype.getLayerIndex=function(U){var N=this.layerIndexes[U];return N||(N=this.layerIndexes[U]=new ue),N},yt.prototype.getWorkerSource=function(U,N,X){var ee=this;return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][N]||(this.workerSources[U][N]={}),this.workerSources[U][N][X]||(this.workerSources[U][N][X]=new this.workerSourceTypes[N]({send:function(Ee,Ue,et){ee.actor.send(Ee,Ue,et,U)}},this.getLayerIndex(U),this.getAvailableImages(U))),this.workerSources[U][N][X]},yt.prototype.getDEMWorkerSource=function(U,N){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][N]||(this.demWorkerSources[U][N]=new Pt),this.demWorkerSources[U][N]},yt.prototype.enforceCacheSizeLimit=function(U,N){_.enforceCacheSizeLimit(N)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new yt(self)),yt}),oe(["./shared"],function(_){"use strict";var de=_.createCommonjsModule(function(h){function v(S){return!d(S)}function d(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,k,G=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(G);try{k=new Worker(J),R=!0}catch(_e){R=!1}return k&&k.terminate(),URL.revokeObjectURL(J),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var k=R.getContext("2d");if(!k)return!1;var G=k.getImageData(0,0,1,1);return G&&G.width===R.width}()?(g[C=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(R){var k=function(J){var _e=document.createElement("canvas"),be=Object.create(v.webGLContextAttributes);return be.failIfMajorPerformanceCaveat=J,_e.probablySupportsContext?_e.probablySupportsContext("webgl",be)||_e.probablySupportsContext("experimental-webgl",be):_e.supportsContext?_e.supportsContext("webgl",be)||_e.supportsContext("experimental-webgl",be):_e.getContext("webgl",be)||_e.getContext("experimental-webgl",be)}(R);if(!k)return!1;var G=k.createShader(k.VERTEX_SHADER);return!(!G||k.isContextLost())&&(k.shaderSource(G,"void main() {}"),k.compileShader(G),k.getShaderParameter(G,k.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=d);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),j={create:function(h,v,d){var g=_.window.document.createElement(h);return v!==void 0&&(g.className=v),d&&d.appendChild(g),g},createNS:function(h,v){return _.window.document.createElementNS(h,v)}},ue=_.window.document&&_.window.document.documentElement.style;function ie(h){if(!ue)return h[0];for(var v=0;v<h.length;v++)if(h[v]in ue)return h[v];return h[0]}var De,ne=ie(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);j.disableDrag=function(){ue&&ne&&(De=ue[ne],ue[ne]="none")},j.enableDrag=function(){ue&&ne&&(ue[ne]=De)};var Ze=ie(["transform","WebkitTransform"]);j.setTransform=function(h,v){h.style[Ze]=v};var nt=!1;try{var rt=Object.defineProperty({},"passive",{get:function(){nt=!0}});_.window.addEventListener("test",rt,rt),_.window.removeEventListener("test",rt,rt)}catch(h){nt=!1}j.addEventListener=function(h,v,d,g){g===void 0&&(g={}),h.addEventListener(v,d,"passive"in g&&nt?g:g.capture)},j.removeEventListener=function(h,v,d,g){g===void 0&&(g={}),h.removeEventListener(v,d,"passive"in g&&nt?g:g.capture)};var Pt=function(h){h.preventDefault(),h.stopPropagation(),_.window.removeEventListener("click",Pt,!0)};function Ct(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}j.suppressClick=function(){_.window.addEventListener("click",Pt,!0),_.window.setTimeout(function(){_.window.removeEventListener("click",Pt,!0)},0)},j.mousePos=function(h,v){var d=h.getBoundingClientRect();return new _.Point(v.clientX-d.left-h.clientLeft,v.clientY-d.top-h.clientTop)},j.touchPos=function(h,v){for(var d=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new _.Point(v[S].clientX-d.left-h.clientLeft,v[S].clientY-d.top-h.clientTop));return g},j.mouseButton=function(h){return _.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&_.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},j.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var $t=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new _.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(d){if(this.loaded!==d&&(this.loaded=d,d)){for(var g=0,S=this.requestors;g<S.length;g+=1){var C=S[g];this._notify(C.ids,C.callback)}this.requestors=[]}},v.prototype.getImage=function(d){return this.images[d]},v.prototype.addImage=function(d,g){this._validate(d,g)&&(this.images[d]=g)},v.prototype._validate=function(d,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new _.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new _.ErrorEvent(new Error('Image "'+d+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new _.ErrorEvent(new Error('Image "'+d+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(d,g){if(!d)return!0;for(var S=0,C=0,R=d;C<R.length;C+=1){var k=R[C];if(k[0]<S||k[1]<k[0]||g<k[1])return!1;S=k[1]}return!0},v.prototype._validateContent=function(d,g){return!(d&&(d.length!==4||d[0]<0||g.data.width<d[0]||d[1]<0||g.data.height<d[1]||d[2]<0||g.data.width<d[2]||d[3]<0||g.data.height<d[3]||d[2]<d[0]||d[3]<d[1]))},v.prototype.updateImage=function(d,g){g.version=this.images[d].version+1,this.images[d]=g,this.updatedImages[d]=!0},v.prototype.removeImage=function(d){var g=this.images[d];delete this.images[d],delete this.patterns[d],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(d,g){var S=!0;if(!this.isLoaded())for(var C=0,R=d;C<R.length;C+=1)this.images[R[C]]||(S=!1);this.isLoaded()||S?this._notify(d,g):this.requestors.push({ids:d,callback:g})},v.prototype._notify=function(d,g){for(var S={},C=0,R=d;C<R.length;C+=1){var k=R[C];this.images[k]||this.fire(new _.Event("styleimagemissing",{id:k}));var G=this.images[k];G?S[k]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:_.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var d=this.atlasImage;return{width:d.width,height:d.height}},v.prototype.getPattern=function(d){var g=this.patterns[d],S=this.getImage(d);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var C={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new _.ImagePosition(C,S);this.patterns[d]={bin:C,position:R}}return this._updatePatternAtlas(),this.patterns[d].position},v.prototype.bind=function(d){var g=d.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _.Texture(d,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var d=[];for(var g in this.patterns)d.push(this.patterns[g].bin);var S=_.potpack(d),C=S.w,R=S.h,k=this.atlasImage;for(var G in k.resize({width:C||1,height:R||1}),this.patterns){var J=this.patterns[G].bin,_e=J.x+1,be=J.y+1,Te=this.images[G].data,$e=Te.width,Ve=Te.height;_.RGBAImage.copy(Te,k,{x:0,y:0},{x:_e,y:be},{width:$e,height:Ve}),_.RGBAImage.copy(Te,k,{x:0,y:Ve-1},{x:_e,y:be-1},{width:$e,height:1}),_.RGBAImage.copy(Te,k,{x:0,y:0},{x:_e,y:be+Ve},{width:$e,height:1}),_.RGBAImage.copy(Te,k,{x:$e-1,y:0},{x:_e-1,y:be},{width:1,height:Ve}),_.RGBAImage.copy(Te,k,{x:0,y:0},{x:_e+$e,y:be},{width:1,height:Ve})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(d){for(var g=0,S=d;g<S.length;g+=1){var C=S[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var R=this.images[C];Ct(R)&&this.updateImage(C,R)}}},v}(_.Evented),rr=Et,zt=Et,Mt=1e20;function Et(h,v,d,g,S,C){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=C||"normal",this.radius=d||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Fr(h,v,d,g,S,C,R){for(var k=0;k<v;k++){for(var G=0;G<d;G++)g[G]=h[G*v+k];for(Ar(g,S,C,R,d),G=0;G<d;G++)h[G*v+k]=S[G]}for(G=0;G<d;G++){for(k=0;k<v;k++)g[k]=h[G*v+k];for(Ar(g,S,C,R,v),k=0;k<v;k++)h[G*v+k]=Math.sqrt(S[k])}}function Ar(h,v,d,g,S){d[0]=0,g[0]=-Mt,g[1]=+Mt;for(var C=1,R=0;C<S;C++){for(var k=(h[C]+C*C-(h[d[R]]+d[R]*d[R]))/(2*C-2*d[R]);k<=g[R];)R--,k=(h[C]+C*C-(h[d[R]]+d[R]*d[R]))/(2*C-2*d[R]);d[++R]=C,g[R]=k,g[R+1]=+Mt}for(C=0,R=0;C<S;C++){for(;g[R+1]<C;)R++;v[C]=(C-d[R])*(C-d[R])+h[d[R]]}}Et.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),d=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?Mt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?Mt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Fr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Fr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)d[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return d},rr.default=zt;var dr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};dr.prototype.setURL=function(h){this.url=h},dr.prototype.getGlyphs=function(h,v){var d=this,g=[];for(var S in h)for(var C=0,R=h[S];C<R.length;C+=1)g.push({stack:S,id:R[C]});_.asyncAll(g,function(k,G){var J=k.stack,_e=k.id,be=d.entries[J];be||(be=d.entries[J]={glyphs:{},requests:{},ranges:{}});var Te=be.glyphs[_e];if(Te===void 0){if(Te=d._tinySDF(be,J,_e))return be.glyphs[_e]=Te,void G(null,{stack:J,id:_e,glyph:Te});var $e=Math.floor(_e/256);if(256*$e>65535)G(new Error("glyphs > 65535 not supported"));else if(be.ranges[$e])G(null,{stack:J,id:_e,glyph:Te});else{var Ve=be.requests[$e];Ve||(Ve=be.requests[$e]=[],dr.loadGlyphRange(J,$e,d.url,d.requestManager,function(st,Fe){if(Fe){for(var at in Fe)d._doesCharSupportLocalGlyph(+at)||(be.glyphs[+at]=Fe[+at]);be.ranges[$e]=!0}for(var bt=0,Nt=Ve;bt<Nt.length;bt+=1)(0,Nt[bt])(st,Fe);delete be.requests[$e]})),Ve.push(function(st,Fe){st?G(st):Fe&&G(null,{stack:J,id:_e,glyph:Fe[_e]||null})})}}else G(null,{stack:J,id:_e,glyph:Te})},function(k,G){if(k)v(k);else if(G){for(var J={},_e=0,be=G;_e<be.length;_e+=1){var Te=be[_e],$e=Te.stack,Ve=Te.id,st=Te.glyph;(J[$e]||(J[$e]={}))[Ve]=st&&{id:st.id,bitmap:st.bitmap.clone(),metrics:st.metrics}}v(null,J)}})},dr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(_.isChar["CJK Unified Ideographs"](h)||_.isChar["Hangul Syllables"](h)||_.isChar.Hiragana(h)||_.isChar.Katakana(h))},dr.prototype._tinySDF=function(h,v,d){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(d)){var S=h.tinySDF;if(!S){var C="400";/bold/i.test(v)?C="900":/medium/i.test(v)?C="500":/light/i.test(v)&&(C="200"),S=h.tinySDF=new dr.TinySDF(24,3,8,.25,g,C)}return{id:d,bitmap:new _.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(d))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},dr.loadGlyphRange=function(h,v,d,g,S){var C=256*v,R=C+255,k=g.transformRequest(g.normalizeGlyphsURL(d).replace("{fontstack}",h).replace("{range}",C+"-"+R),_.ResourceType.Glyphs);_.getArrayBuffer(k,function(G,J){if(G)S(G);else if(J){for(var _e={},be=0,Te=_.parseGlyphPBF(J);be<Te.length;be+=1){var $e=Te[be];_e[$e.id]=$e}S(null,_e)}})},dr.TinySDF=rr;var It=function(){this.specification=_.styleSpec.light.position};It.prototype.possiblyEvaluate=function(h,v){return _.sphericalToCartesian(h.expression.evaluate(v))},It.prototype.interpolate=function(h,v,d){return{x:_.number(h.x,v.x,d),y:_.number(h.y,v.y,d),z:_.number(h.z,v.z,d)}};var ct=new _.Properties({anchor:new _.DataConstantProperty(_.styleSpec.light.anchor),position:new It,color:new _.DataConstantProperty(_.styleSpec.light.color),intensity:new _.DataConstantProperty(_.styleSpec.light.intensity)}),Ft=function(h){function v(d){h.call(this),this._transitionable=new _.Transitionable(ct),this.setLight(d),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(d,g){if(g===void 0&&(g={}),!this._validate(_.validateLight,d,g))for(var S in d){var C=d[S];_.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),C):this._transitionable.setValue(S,C)}},v.prototype.updateTransitions=function(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(d){this.properties=this._transitioning.possiblyEvaluate(d)},v.prototype._validate=function(d,g,S){return(!S||S.validate!==!1)&&_.emitValidationErrors(this,d.call(_.validateStyle,_.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:_.styleSpec})))},v}(_.Evented),ht=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ht.prototype.getDash=function(h,v){var d=h.join(",")+String(v);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(h,v)),this.dashEntry[d]},ht.prototype.getDashRanges=function(h,v,d){var g=[],S=h.length%2==1?-h[h.length-1]*d:0,C=h[0]*d,R=!0;g.push({left:S,right:C,isDash:R,zeroLength:h[0]===0});for(var k=h[0],G=1;G<h.length;G++){var J=h[G];g.push({left:S=k*d,right:C=(k+=J)*d,isDash:R=!R,zeroLength:J===0})}return g},ht.prototype.addRoundDash=function(h,v,d){for(var g=v/2,S=-d;S<=d;S++)for(var C=this.width*(this.nextRow+d+S),R=0,k=h[R],G=0;G<this.width;G++){G/k.right>1&&(k=h[++R]);var J=Math.abs(G-k.left),_e=Math.abs(G-k.right),be=Math.min(J,_e),Te=void 0,$e=S/d*(g+1);if(k.isDash){var Ve=g-Math.abs($e);Te=Math.sqrt(be*be+Ve*Ve)}else Te=g-Math.sqrt(be*be+$e*$e);this.data[C+G]=Math.max(0,Math.min(255,Te+128))}},ht.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var d=h[v],g=h[v+1];d.zeroLength?h.splice(v,1):g&&g.isDash===d.isDash&&(g.left=d.left,h.splice(v,1))}var S=h[0],C=h[h.length-1];S.isDash===C.isDash&&(S.left=C.left-this.width,C.right=S.right+this.width);for(var R=this.width*this.nextRow,k=0,G=h[k],J=0;J<this.width;J++){J/G.right>1&&(G=h[++k]);var _e=Math.abs(J-G.left),be=Math.abs(J-G.right),Te=Math.min(_e,be);this.data[R+J]=Math.max(0,Math.min(255,(G.isDash?Te:-Te)+128))}},ht.prototype.addDash=function(h,v){var d=v?7:0,g=2*d+1;if(this.nextRow+g>this.height)return _.warnOnce("LineAtlas out of space"),null;for(var S=0,C=0;C<h.length;C++)S+=h[C];if(S!==0){var R=this.width/S,k=this.getDashRanges(h,this.width,R);v?this.addRoundDash(k,R,d):this.addRegularDash(k)}var G={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:S};return this.nextRow+=g,this.dirty=!0,G},ht.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var sr=function h(v,d){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=_.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var C=new h.Actor(g[S],d,this.id);C.name="Worker "+S,this.actors.push(C)}};function br(h,v,d){var g=function(S,C){if(S)return d(S);if(C){var R=_.pick(_.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(R.vectorLayers=C.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(k){return k.id})),R.tiles=v.canonicalizeTileset(R,h.url),d(null,R)}};return h.url?_.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),_.ResourceType.Source),g):_.browser.frame(function(){return g(null,h)})}sr.prototype.broadcast=function(h,v,d){_.asyncAll(this.actors,function(g,S){g.send(h,v,S)},d=d||function(){})},sr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},sr.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},sr.Actor=_.Actor;var te=function(h,v,d){this.bounds=_.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=d||24};te.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},te.prototype.contains=function(h){var v=Math.pow(2,h.z),d=Math.floor(_.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(_.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(_.mercatorXfromLng(this.bounds.getEast())*v),C=Math.ceil(_.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=d&&h.x<S&&h.y>=g&&h.y<C};var Ne=function(h){function v(d,g,S,C){if(h.call(this),this.id=d,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,_.extend(this,_.pick(g,["url","scheme","tileSize","promoteId"])),this._options=_.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(g,S){d._tileJSONRequest=null,d._loaded=!0,g?d.fire(new _.ErrorEvent(g)):S&&(_.extend(d,S),S.bounds&&(d.tileBounds=new te(S.bounds,d.minzoom,d.maxzoom)),_.postTurnstileEvent(S.tiles,d.map._requestManager._customAccessToken),_.postMapLoadEvent(S.tiles,d.map._getMapId(),d.map._requestManager._skuToken,d.map._requestManager._customAccessToken),d.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setSourceProperty=function(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(d){var g=this;return this.setSourceProperty(function(){g._options.tiles=d}),this},v.prototype.setUrl=function(d){var g=this;return this.setSourceProperty(function(){g.url=d,g._options.url=d}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return _.extend({},this._options)},v.prototype.loadTile=function(d,g){var S=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(S,_.ResourceType.Tile),uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(k,G){return delete d.request,d.aborted?g(null):k&&k.status!==404?g(k):(G&&G.resourceTiming&&(d.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&d.setExpiryData(G),d.loadVectorData(G,this.map.painter),_.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired"?d.state==="loading"?d.reloadCallback=g:d.request=d.actor.send("reloadTile",C,R.bind(this)):(d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",C,R.bind(this)))},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(_.Evented),O=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.dispatcher=S,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_.extend({type:"raster"},g),_.extend(this,_.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=br(this._options,this.map._requestManager,function(g,S){d._tileJSONRequest=null,d._loaded=!0,g?d.fire(new _.ErrorEvent(g)):S&&(_.extend(d,S),S.bounds&&(d.tileBounds=new te(S.bounds,d.minzoom,d.maxzoom)),_.postTurnstileEvent(S.tiles),_.postMapLoadEvent(S.tiles,d.map._getMapId(),d.map._requestManager._skuToken),d.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),d.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return _.extend({},this._options)},v.prototype.hasTile=function(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)},v.prototype.loadTile=function(d,g){var S=this,C=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);d.request=_.getImage(this.map._requestManager.transformRequest(C,_.ResourceType.Tile),function(R,k){if(delete d.request,d.aborted)d.state="unloaded",g(null);else if(R)d.state="errored",g(R);else if(k){S.map._refreshExpiredTiles&&d.setExpiryData(k),delete k.cacheControl,delete k.expires;var G=S.map.painter.context,J=G.gl;d.texture=S.map.painter.getTileTexture(k.width),d.texture?d.texture.update(k,{useMipmap:!0}):(d.texture=new _.Texture(G,k,J.RGBA,{useMipmap:!0}),d.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),d.state="loaded",_.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(d,g){d.request&&(d.request.cancel(),delete d.request),g()},v.prototype.unloadTile=function(d,g){d.texture&&this.map.painter.saveTileTexture(d.texture),g()},v.prototype.hasTransition=function(){return!1},v}(_.Evented),Pe=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),this.type="raster-dem",this.maxzoom=22,this._options=_.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(d,g){var S=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(R,k){R&&(d.state="errored",g(R)),k&&(d.dem=k,d.needsHillshadePrepare=!0,d.state="loaded",g(null))}d.request=_.getImage(this.map._requestManager.transformRequest(S,_.ResourceType.Tile),function(R,k){if(delete d.request,d.aborted)d.state="unloaded",g(null);else if(R)d.state="errored",g(R);else if(k){this.map._refreshExpiredTiles&&d.setExpiryData(k),delete k.cacheControl,delete k.expires;var G=_.window.ImageBitmap&&k instanceof _.window.ImageBitmap&&_.offscreenCanvasSupported()?k:_.browser.getImageData(k,1),J={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:G,encoding:this.encoding};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",J,C.bind(this)))}}.bind(this)),d.neighboringTiles=this._getNeighboringTiles(d.tileID)},v.prototype._getNeighboringTiles=function(d){var g=d.canonical,S=Math.pow(2,g.z),C=(g.x-1+S)%S,R=g.x===0?d.wrap-1:d.wrap,k=(g.x+1+S)%S,G=g.x+1===S?d.wrap+1:d.wrap,J={};return J[new _.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y).key]={backfilled:!1},J[new _.OverscaledTileID(d.overscaledZ,G,g.z,k,g.y).key]={backfilled:!1},g.y>0&&(J[new _.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y-1).key]={backfilled:!1},J[new _.OverscaledTileID(d.overscaledZ,d.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},J[new _.OverscaledTileID(d.overscaledZ,G,g.z,k,g.y-1).key]={backfilled:!1}),g.y+1<S&&(J[new _.OverscaledTileID(d.overscaledZ,R,g.z,C,g.y+1).key]={backfilled:!1},J[new _.OverscaledTileID(d.overscaledZ,d.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},J[new _.OverscaledTileID(d.overscaledZ,G,g.z,k,g.y+1).key]={backfilled:!1}),J},v.prototype.unloadTile=function(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded",d.actor&&d.actor.send("removeDEMTile",{uid:d.uid,source:this.id})},v}(O),Ce=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(C),this._data=g.data,this._options=_.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=_.EXTENT/this.tileSize;this.workerOptions=_.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:_.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:_.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)d.fire(new _.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(S.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new _.Event("data",S))}})},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setData=function(d){var g=this;return this._data=d,this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new _.ErrorEvent(S));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new _.Event("data",C))}}),this},v.prototype.getClusterExpansionZoom=function(d,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},g),this},v.prototype.getClusterChildren=function(d,g){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},g),this},v.prototype.getClusterLeaves=function(d,g,S,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:g,offset:S},C),this},v.prototype._updateWorkerData=function(d){var g=this;this._loaded=!1;var S=_.extend({},this.workerOptions),C=this._data;typeof C=="string"?(S.request=this.map._requestManager.transformRequest(_.browser.resolveURL(C),_.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(C),this.actor.send(this.type+".loadData",S,function(R,k){g._removed||k&&k.abandoned||(g._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[g.id]&&(g._resourceTiming=k.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),d(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(d,g){var S=this,C=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(C,{type:this.type,uid:d.uid,tileID:d.tileID,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,k){return delete d.request,d.unloadVectorData(),d.aborted?g(null):R?g(R):(d.loadVectorData(k,S.map.painter,C==="reloadTile"),g(null))})},v.prototype.abortTile=function(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0},v.prototype.unloadTile=function(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return _.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(_.Evented),pt=_.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ye=function(h){function v(d,g,S,C){h.call(this),this.id=d,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(d,g){var S=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this.url=this.options.url,_.getImage(this.map._requestManager.transformRequest(this.url,_.ResourceType.Image),function(C,R){S._loaded=!0,C?S.fire(new _.ErrorEvent(C)):R&&(S.image=R,d&&(S.coordinates=d),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(d){var g=this;return this.image&&d.url?(this.options.url=d.url,this.load(d.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(d){this.map=d,this.load()},v.prototype.setCoordinates=function(d){var g=this;this.coordinates=d;var S=d.map(_.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var k=1/0,G=1/0,J=-1/0,_e=-1/0,be=0,Te=R;be<Te.length;be+=1){var $e=Te[be];k=Math.min(k,$e.x),G=Math.min(G,$e.y),J=Math.max(J,$e.x),_e=Math.max(_e,$e.y)}var Ve=Math.max(J-k,_e-G),st=Math.max(0,Math.floor(-Math.log(Ve)/Math.LN2)),Fe=Math.pow(2,st);return new _.CanonicalTileID(st,Math.floor((k+J)/2*Fe),Math.floor((G+_e)/2*Fe))}(S),this.minzoom=this.maxzoom=this.tileID.z;var C=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new _.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,_.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,_.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,_.EXTENT,_.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var d=this.map.painter.context,g=d.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,pt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _.Texture(d,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.loadTile=function(d,g){this.tileID&&this.tileID.equals(d.tileID.canonical)?(this.tiles[String(d.tileID.wrap)]=d,d.buckets={},g(null)):(d.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(_.Evented),We=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var d=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,C=g.urls;S<C.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(C[S],_.ResourceType.Source).url);_.getVideo(this.urls,function(R,k){d._loaded=!0,R?d.fire(new _.ErrorEvent(R)):k&&(d.video=k,d.video.loop=!0,d.video.setAttribute("playsinline",""),d.video.addEventListener("playing",function(){d.map.triggerRepaint()}),d.map&&d.video.play(),d._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(d){if(this.video){var g=this.video.seekable;d<g.start(0)||d>g.end(0)?this.fire(new _.ErrorEvent(new _.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=d}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var d=this.map.painter.context,g=d.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,pt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new _.Texture(d,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(Ye),ot=function(h){function v(d,g,S,C){h.call(this,d,g,S,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(k){return typeof k!="number"})})||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+d,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+d,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new _.ErrorEvent(new _.ValidationError("sources."+d,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof _.window.HTMLCanvasElement||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+d,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+d,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof _.window.HTMLCanvasElement?this.options.canvas:_.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new _.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,pt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[C];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var d=0,g=[this.canvas.width,this.canvas.height];d<g.length;d+=1){var S=g[d];if(isNaN(S)||S<=0)return!0}return!1},v}(Ye),Tt={vector:Ne,raster:O,"raster-dem":Pe,geojson:Ce,video:We,image:Ye,canvas:ot};function gr(h,v){var d=_.identity([]);return _.translate(d,d,[1,1,0]),_.scale(d,d,[.5*h.width,.5*h.height,1]),_.multiply(d,d,h.calculatePosMatrix(v.toUnwrapped()))}function wt(h,v,d,g,S,C){var R=function(st,Fe,at){if(st)for(var bt=0,Nt=st;bt<Nt.length;bt+=1){var nr=Fe[Nt[bt]];if(nr&&nr.source===at&&nr.type==="fill-extrusion")return!0}else for(var qt in Fe){var fr=Fe[qt];if(fr.source===at&&fr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),k=C.maxPitchScaleFactor(),G=h.tilesIn(g,k,R);G.sort(hn);for(var J=[],_e=0,be=G;_e<be.length;_e+=1){var Te=be[_e];J.push({wrappedTileID:Te.tileID.wrapped().key,queryResults:Te.tile.queryRenderedFeatures(v,d,h._state,Te.queryGeometry,Te.cameraQueryGeometry,Te.scale,S,C,k,gr(h.transform,Te.tileID))})}var $e=function(st){for(var Fe={},at={},bt=0,Nt=st;bt<Nt.length;bt+=1){var nr=Nt[bt],qt=nr.queryResults,fr=nr.wrappedTileID,Er=at[fr]=at[fr]||{};for(var Gr in qt)for(var Zr=qt[Gr],vn=Er[Gr]=Er[Gr]||{},zn=Fe[Gr]=Fe[Gr]||[],Hn=0,Fn=Zr;Hn<Fn.length;Hn+=1){var Bi=Fn[Hn];vn[Bi.featureIndex]||(vn[Bi.featureIndex]=!0,zn.push(Bi))}}return Fe}(J);for(var Ve in $e)$e[Ve].forEach(function(st){var Fe=st.feature,at=h.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=at});return $e}function hn(h,v){var d=h.tileID,g=v.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}var Hr=function(h,v){this.max=h,this.onRemove=v,this.reset()};Hr.prototype.reset=function(){for(var h in this.data)for(var v=0,d=this.data[h];v<d.length;v+=1){var g=d[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Hr.prototype.add=function(h,v,d){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var C={value:v,timeout:void 0};if(d!==void 0&&(C.timeout=setTimeout(function(){g.remove(h,C)},d)),this.data[S].push(C),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Hr.prototype.has=function(h){return h.wrapped().key in this.data},Hr.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},Hr.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},Hr.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},Hr.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},Hr.prototype.remove=function(h,v){if(!this.has(h))return this;var d=h.wrapped().key,g=v===void 0?0:this.data[d].indexOf(v),S=this.data[d][g];return this.data[d].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(S.value),this.order.splice(this.order.indexOf(d),1),this},Hr.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},Hr.prototype.filter=function(h){var v=[];for(var d in this.data)for(var g=0,S=this.data[d];g<S.length;g+=1){var C=S[g];h(C.value)||v.push(C)}for(var R=0,k=v;R<k.length;R+=1){var G=k[R];this.remove(G.value.tileID,G)}};var Vr=function(h,v,d){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Vr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Vr.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},Vr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Nn=function(h,v,d,g){this.length=v.length,this.attributes=d,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Nn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Nn.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},Nn.prototype.enableAttributes=function(h,v){for(var d=0;d<this.attributes.length;d++){var g=v.attributes[this.attributes[d].name];g!==void 0&&h.enableVertexAttribArray(g)}},Nn.prototype.setVertexAttribPointers=function(h,v,d){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],C=v.attributes[S.name];C!==void 0&&h.vertexAttribPointer(C,S.components,h[qn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(d||0))}},Nn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var dn=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};dn.prototype.get=function(){return this.current},dn.prototype.set=function(h){},dn.prototype.getDefault=function(){return this.default},dn.prototype.setDefault=function(){this.set(this.default)};var Ci=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return _.Color.transparent},v.prototype.set=function(d){var g=this.current;(d.r!==g.r||d.g!==g.g||d.b!==g.b||d.a!==g.a||this.dirty)&&(this.gl.clearColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(dn),di=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearDepth(d),this.current=d,this.dirty=!1)},v}(dn),ta=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.clearStencil(d),this.current=d,this.dirty=!1)},v}(dn),Rn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||d[3]!==g[3]||this.dirty)&&(this.gl.colorMask(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(dn),Bn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthMask(d),this.current=d,this.dirty=!1)},v}(dn),_a=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.stencilMask(d),this.current=d,this.dirty=!1)},v}(dn),Hi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(d){var g=this.current;(d.func!==g.func||d.ref!==g.ref||d.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(d.func,d.ref,d.mask),this.current=d,this.dirty=!1)},v}(dn),Wa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.KEEP,d.KEEP,d.KEEP]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(d[0],d[1],d[2]),this.current=d,this.dirty=!1)},v}(dn),Ga=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=d,this.dirty=!1}},v}(dn),Re=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||this.dirty)&&(this.gl.depthRange(d[0],d[1]),this.current=d,this.dirty=!1)},v}(dn),Xa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=d,this.dirty=!1}},v}(dn),ua=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.depthFunc(d),this.current=d,this.dirty=!1)},v}(dn),to=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.BLEND):g.disable(g.BLEND),this.current=d,this.dirty=!1}},v}(dn),Zs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[d.ONE,d.ZERO]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(d[0],d[1]),this.current=d,this.dirty=!1)},v}(dn),xs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return _.Color.transparent},v.prototype.set=function(d){var g=this.current;(d.r!==g.r||d.g!==g.g||d.b!==g.b||d.a!==g.a||this.dirty)&&(this.gl.blendColor(d.r,d.g,d.b,d.a),this.current=d,this.dirty=!1)},v}(dn),bs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.blendEquation(d),this.current=d,this.dirty=!1)},v}(dn),Wt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;d?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=d,this.dirty=!1}},v}(dn),xr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.cullFace(d),this.current=d,this.dirty=!1)},v}(dn),Yr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.frontFace(d),this.current=d,this.dirty=!1)},v}(dn),sn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)},v}(dn),Vn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(d){(d!==this.current||this.dirty)&&(this.gl.activeTexture(d),this.current=d,this.dirty=!1)},v}(dn),Wi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var d=this.gl;return[0,0,d.drawingBufferWidth,d.drawingBufferHeight]},v.prototype.set=function(d){var g=this.current;(d[0]!==g[0]||d[1]!==g[1]||d[2]!==g[2]||d[3]!==g[3]||this.dirty)&&(this.gl.viewport(d[0],d[1],d[2],d[3]),this.current=d,this.dirty=!1)},v}(dn),fe=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,d),this.current=d,this.dirty=!1}},v}(dn),D=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(dn),z=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,d),this.current=d,this.dirty=!1}},v}(dn),ae=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,d),this.current=d,this.dirty=!1}},v}(dn),Se=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,d),this.current=d,this.dirty=!1},v}(dn),Le=function(h){function v(d){h.call(this,d),this.vao=d.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(d){this.vao&&(d!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(d),this.current=d,this.dirty=!1)},v}(dn),Ht=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,d),this.current=d,this.dirty=!1}},v}(dn),Ot=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),this.current=d,this.dirty=!1}},v}(dn),kt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(d){if(d!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,d),this.current=d,this.dirty=!1}},v}(dn),yt=function(h){function v(d,g){h.call(this,d),this.context=d,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(dn),U=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,d,0),this.current=d,this.dirty=!1}},v}(yt),N=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(d){if(d!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,d),this.current=d,this.dirty=!1}},v}(yt),X=function(h,v,d,g){this.context=h,this.width=v,this.height=d;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new U(h,S),g&&(this.depthAttachment=new N(h,S))};X.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var d=this.depthAttachment.get();d&&h.deleteRenderbuffer(d)}h.deleteFramebuffer(this.framebuffer)};var ee=function(h,v,d){this.func=h,this.mask=v,this.range=d};ee.ReadOnly=!1,ee.ReadWrite=!0,ee.disabled=new ee(519,ee.ReadOnly,[0,1]);var Ee=function(h,v,d,g,S,C){this.test=h,this.ref=v,this.mask=d,this.fail=g,this.depthFail=S,this.pass=C};Ee.disabled=new Ee({func:519,mask:0},0,0,7680,7680,7680);var Ue=function(h,v,d){this.blendFunction=h,this.blendColor=v,this.mask=d};Ue.disabled=new Ue(Ue.Replace=[1,0],_.Color.transparent,[!1,!1,!1,!1]),Ue.unblended=new Ue(Ue.Replace,_.Color.transparent,[!0,!0,!0,!0]),Ue.alphaBlended=new Ue([1,771],_.Color.transparent,[!0,!0,!0,!0]);var et=function(h,v,d){this.enable=h,this.mode=v,this.frontFace=d};et.disabled=new et(!1,1029,2305),et.backCCW=new et(!0,1029,2305);var he=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ci(this),this.clearDepth=new di(this),this.clearStencil=new ta(this),this.colorMask=new Rn(this),this.depthMask=new Bn(this),this.stencilMask=new _a(this),this.stencilFunc=new Hi(this),this.stencilOp=new Wa(this),this.stencilTest=new Ga(this),this.depthRange=new Re(this),this.depthTest=new Xa(this),this.depthFunc=new ua(this),this.blend=new to(this),this.blendFunc=new Zs(this),this.blendColor=new xs(this),this.blendEquation=new bs(this),this.cullFace=new Wt(this),this.cullFaceSide=new xr(this),this.frontFace=new Yr(this),this.program=new sn(this),this.activeTexture=new Vn(this),this.viewport=new Wi(this),this.bindFramebuffer=new fe(this),this.bindRenderbuffer=new D(this),this.bindTexture=new z(this),this.bindVertexBuffer=new ae(this),this.bindElementBuffer=new Se(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Le(this),this.pixelStoreUnpack=new Ht(this),this.pixelStoreUnpackPremultiplyAlpha=new Ot(this),this.pixelStoreUnpackFlipY=new kt(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(h,v){return new Vr(this,h,v)},he.prototype.createVertexBuffer=function(h,v,d){return new Nn(this,h,v,d)},he.prototype.createRenderbuffer=function(h,v,d){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,d),this.bindRenderbuffer.set(null),S},he.prototype.createFramebuffer=function(h,v,d){return new X(this,h,v,d)},he.prototype.clear=function(h){var v=h.color,d=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g.clear(S)},he.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},he.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(h){_.deepEqual(h.blendFunction,Ue.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Q=function(h){function v(d,g,S){var C=this;h.call(this),this.id=d,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(R,k,G,J){var _e=new Tt[k.type](R,k,G,J);if(_e.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+_e.id);return _.bindAll(["load","abort","unload","serialize","prepare"],_e),_e}(d,g,S,this),this._tiles={},this._cache=new Hr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(d){this.map=d,this._maxTileCacheSize=d?d._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(d)},v.prototype.onRemove=function(d){this._source&&this._source.onRemove&&this._source.onRemove(d)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var d in this._tiles){var g=this._tiles[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var d=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,d&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(d,g){return this._source.loadTile(d,g)},v.prototype._unloadTile=function(d){if(this._source.unloadTile)return this._source.unloadTile(d,function(){})},v.prototype._abortTile=function(d){if(this._source.abortTile)return this._source.abortTile(d,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(d){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(d),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return _.values(this._tiles).map(function(d){return d.tileID}).sort(ye).map(function(d){return d.key})},v.prototype.getRenderableIds=function(d){var g=this,S=[];for(var C in this._tiles)this._isIdRenderable(C,d)&&S.push(this._tiles[C]);return d?S.sort(function(R,k){var G=R.tileID,J=k.tileID,_e=new _.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),be=new _.Point(J.canonical.x,J.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-J.overscaledZ||be.y-_e.y||be.x-_e.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(ye).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(d){var g=this.findLoadedParent(d,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(d,g){return this._tiles[d]&&this._tiles[d].hasData()&&!this._coveredTiles[d]&&(g||!this._tiles[d].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var d in this._cache.reset(),this._tiles)this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")},v.prototype._reloadTile=function(d,g){var S=this._tiles[d];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,d,g)))},v.prototype._tileLoaded=function(d,g,S,C){if(C)return d.state="errored",void(C.status!==404?this._source.fire(new _.ErrorEvent(C,{tile:d})):this.update(this.transform));d.timeAdded=_.browser.now(),S==="expired"&&(d.refreshedUponExpiration=!0),this._setTileReloadTimer(g,d),this.getSource().type==="raster-dem"&&d.dem&&this._backfillDEM(d),this._state.initializeTileState(d,this.map?this.map.painter:null),this._source.fire(new _.Event("data",{dataType:"source",tile:d,coord:d.tileID}))},v.prototype._backfillDEM=function(d){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var C=g[S];if(d.neighboringTiles&&d.neighboringTiles[C]){var R=this.getTileByID(C);k(d,R),k(R,d)}}function k(G,J){G.needsHillshadePrepare=!0;var _e=J.tileID.canonical.x-G.tileID.canonical.x,be=J.tileID.canonical.y-G.tileID.canonical.y,Te=Math.pow(2,G.tileID.canonical.z),$e=J.tileID.key;_e===0&&be===0||Math.abs(be)>1||(Math.abs(_e)>1&&(Math.abs(_e+Te)===1?_e+=Te:Math.abs(_e-Te)===1&&(_e-=Te)),J.dem&&G.dem&&(G.dem.backfillBorder(J.dem,_e,be),G.neighboringTiles&&G.neighboringTiles[$e]&&(G.neighboringTiles[$e].backfilled=!0)))}},v.prototype.getTile=function(d){return this.getTileByID(d.key)},v.prototype.getTileByID=function(d){return this._tiles[d]},v.prototype._retainLoadedChildren=function(d,g,S,C){for(var R in this._tiles){var k=this._tiles[R];if(!(C[R]||!k.hasData()||k.tileID.overscaledZ<=g||k.tileID.overscaledZ>S)){for(var G=k.tileID;k&&k.tileID.overscaledZ>g+1;){var J=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[J.key])&&k.hasData()&&(G=J)}for(var _e=G;_e.overscaledZ>g;)if(d[(_e=_e.scaledTo(_e.overscaledZ-1)).key]){C[G.key]=G;break}}}},v.prototype.findLoadedParent=function(d,g){if(d.key in this._loadedParentTiles){var S=this._loadedParentTiles[d.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var C=d.overscaledZ-1;C>=g;C--){var R=d.scaledTo(C),k=this._getLoadedTile(R);if(k)return k}},v.prototype._getLoadedTile=function(d){var g=this._tiles[d.key];return g&&g.hasData()?g:this._cache.getByKey(d.wrapped().key)},v.prototype.updateCacheSize=function(d){var g=Math.ceil(d.width/this._source.tileSize)+1,S=Math.ceil(d.height/this._source.tileSize)+1,C=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(d){var g=Math.round((d-(this._prevLng===void 0?d:this._prevLng))/360);if(this._prevLng=d,g){var S={};for(var C in this._tiles){var R=this._tiles[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var k in this._tiles=S,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},v.prototype.update=function(d){var g=this;if(this.transform=d,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(d),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=d.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Er){return new _.OverscaledTileID(Er.canonical.z,Er.wrap,Er.canonical.z,Er.canonical.x,Er.canonical.y)}):(S=d.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Er){return g._source.hasTile(Er)}))):S=[];var C=d.coveringZoomLevel(this._source),R=Math.max(C-v.maxOverzooming,this._source.minzoom),k=Math.max(C+v.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(S,C);if(Je(this._source.type)){for(var J={},_e={},be=0,Te=Object.keys(G);be<Te.length;be+=1){var $e=Te[be],Ve=G[$e],st=this._tiles[$e];if(st&&!(st.fadeEndTime&&st.fadeEndTime<=_.browser.now())){var Fe=this.findLoadedParent(Ve,R);Fe&&(this._addTile(Fe.tileID),J[Fe.tileID.key]=Fe.tileID),_e[$e]=Ve}}for(var at in this._retainLoadedChildren(_e,C,k,G),J)G[at]||(this._coveredTiles[at]=!0,G[at]=J[at])}for(var bt in G)this._tiles[bt].clearFadeHold();for(var Nt=0,nr=_.keysDifference(this._tiles,G);Nt<nr.length;Nt+=1){var qt=nr[Nt],fr=this._tiles[qt];fr.hasSymbolBuckets&&!fr.holdingForFade()?fr.setHoldDuration(this.map._fadeDuration):fr.hasSymbolBuckets&&!fr.symbolFadeFinished()||this._removeTile(qt)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var d in this._tiles)this._tiles[d].holdingForFade()&&this._removeTile(d)},v.prototype._updateRetainedTiles=function(d,g){for(var S={},C={},R=Math.max(g-v.maxOverzooming,this._source.minzoom),k=Math.max(g+v.maxUnderzooming,this._source.minzoom),G={},J=0,_e=d;J<_e.length;J+=1){var be=_e[J],Te=this._addTile(be);S[be.key]=be,Te.hasData()||g<this._source.maxzoom&&(G[be.key]=be)}this._retainLoadedChildren(G,g,k,S);for(var $e=0,Ve=d;$e<Ve.length;$e+=1){var st=Ve[$e],Fe=this._tiles[st.key];if(!Fe.hasData()){if(g+1>this._source.maxzoom){var at=st.children(this._source.maxzoom)[0],bt=this.getTile(at);if(bt&&bt.hasData()){S[at.key]=at;continue}}else{var Nt=st.children(this._source.maxzoom);if(S[Nt[0].key]&&S[Nt[1].key]&&S[Nt[2].key]&&S[Nt[3].key])continue}for(var nr=Fe.wasRequested(),qt=st.overscaledZ-1;qt>=R;--qt){var fr=st.scaledTo(qt);if(C[fr.key]||(C[fr.key]=!0,!(Fe=this.getTile(fr))&&nr&&(Fe=this._addTile(fr)),Fe&&(S[fr.key]=fr,nr=Fe.wasRequested(),Fe.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var d in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,C=this._tiles[d].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){S=this._loadedParentTiles[C.key];break}g.push(C.key);var R=C.scaledTo(C.overscaledZ-1);if(S=this._getLoadedTile(R))break;C=R}for(var k=0,G=g;k<G.length;k+=1)this._loadedParentTiles[G[k]]=S}},v.prototype._addTile=function(d){var g=this._tiles[d.key];if(g)return g;(g=this._cache.getAndRemove(d))&&(this._setTileReloadTimer(d.key,g),g.tileID=d,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[d.key]&&(clearTimeout(this._cacheTimers[d.key]),delete this._cacheTimers[d.key],this._setTileReloadTimer(d.key,g)));var S=Boolean(g);return S||(g=new _.Tile(d,this._source.tileSize*d.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,d.key,g.state))),g?(g.uses++,this._tiles[d.key]=g,S||this._source.fire(new _.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(d,g){var S=this;d in this._timers&&(clearTimeout(this._timers[d]),delete this._timers[d]);var C=g.getExpiryTimeout();C&&(this._timers[d]=setTimeout(function(){S._reloadTile(d,"expired"),delete S._timers[d]},C))},v.prototype._removeTile=function(d){var g=this._tiles[d];g&&(g.uses--,delete this._tiles[d],this._timers[d]&&(clearTimeout(this._timers[d]),delete this._timers[d]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var d in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(d);this._cache.reset()},v.prototype.tilesIn=function(d,g,S){var C=this,R=[],k=this.transform;if(!k)return R;for(var G=S?k.getCameraQueryGeometry(d):d,J=d.map(function(qt){return k.pointCoordinate(qt)}),_e=G.map(function(qt){return k.pointCoordinate(qt)}),be=this.getIds(),Te=1/0,$e=1/0,Ve=-1/0,st=-1/0,Fe=0,at=_e;Fe<at.length;Fe+=1){var bt=at[Fe];Te=Math.min(Te,bt.x),$e=Math.min($e,bt.y),Ve=Math.max(Ve,bt.x),st=Math.max(st,bt.y)}for(var Nt=function(qt){var fr=C._tiles[be[qt]];if(!fr.holdingForFade()){var Er=fr.tileID,Gr=Math.pow(2,k.zoom-fr.tileID.overscaledZ),Zr=g*fr.queryPadding*_.EXTENT/fr.tileSize/Gr,vn=[Er.getTilePoint(new _.MercatorCoordinate(Te,$e)),Er.getTilePoint(new _.MercatorCoordinate(Ve,st))];if(vn[0].x-Zr<_.EXTENT&&vn[0].y-Zr<_.EXTENT&&vn[1].x+Zr>=0&&vn[1].y+Zr>=0){var zn=J.map(function(Fn){return Er.getTilePoint(Fn)}),Hn=_e.map(function(Fn){return Er.getTilePoint(Fn)});R.push({tile:fr,tileID:Er,queryGeometry:zn,cameraQueryGeometry:Hn,scale:Gr})}}},nr=0;nr<be.length;nr++)Nt(nr);return R},v.prototype.getVisibleCoordinates=function(d){for(var g=this,S=this.getRenderableIds(d).map(function(G){return g._tiles[G].tileID}),C=0,R=S;C<R.length;C+=1){var k=R[C];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Je(this._source.type))for(var d in this._tiles){var g=this._tiles[d];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=_.browser.now())return!0}return!1},v.prototype.setFeatureState=function(d,g,S){this._state.updateState(d=d||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(d,g,S){this._state.removeFeatureState(d=d||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(d,g){return this._state.getState(d=d||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(d,g,S){var C=this._tiles[d];C&&C.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(d,g){for(var S in this._tiles)this._tiles[S].hasDependency(d,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(C){return!C.hasDependency(d,g)})},v}(_.Evented);function ye(h,v){var d=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-d||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function Je(h){return h==="raster"||h==="image"||h==="video"}function _t(){return new _.window.Worker(Vf.workerUrl)}Q.maxOverzooming=10,Q.maxUnderzooming=3;var pe="mapboxgl_preloaded_worker_pool",yr=function(){this.active={}};yr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<yr.workerCount;)this.workers.push(new _t);return this.active[h]=!0,this.workers.slice()},yr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},yr.prototype.isPreloaded=function(){return!!this.active[pe]},yr.prototype.numActive=function(){return Object.keys(this.active).length};var tn,rn=Math.floor(_.browser.hardwareConcurrency/2);function Jt(){return tn||(tn=new yr),tn}function Kr(h,v){var d={};for(var g in h)g!=="ref"&&(d[g]=h[g]);return _.refProperties.forEach(function(S){S in v&&(d[S]=v[S])}),d}function Nr(h){h=h.slice();for(var v=Object.create(null),d=0;d<h.length;d++)v[h[d].id]=h[d];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=Kr(h[g],v[h[g].ref]));return h}yr.workerCount=Math.max(Math.min(rn,6),1);var Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function si(h,v,d){d.push({command:Xr.addSource,args:[h,v[h]]})}function un(h,v,d){v.push({command:Xr.removeSource,args:[h]}),d[h]=!0}function vi(h,v,d,g){un(h,d,g),si(h,v,d)}function Ni(h,v,d){var g;for(g in h[d])if(h[d].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[d][g],v[d][g]))return!1;for(g in v[d])if(v[d].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[d][g],v[d][g]))return!1;return!0}function yi(h,v,d,g,S,C){var R;for(R in v=v||{},h=h||{})h.hasOwnProperty(R)&&(_.deepEqual(h[R],v[R])||d.push({command:C,args:[g,R,v[R],S]}));for(R in v)v.hasOwnProperty(R)&&!h.hasOwnProperty(R)&&(_.deepEqual(h[R],v[R])||d.push({command:C,args:[g,R,v[R],S]}))}function Mi(h){return h.id}function Ii(h,v){return h[v.id]=v,h}var xo=function(h,v){this.reset(h,v)};xo.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},xo.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=_.clamp(h,0,1);for(var v=1,d=this._distances[v],g=h*this.paddedLength+this.padding;d<g&&v<this._distances.length;)d=this._distances[++v];var S=v-1,C=this._distances[S],R=d-C,k=R>0?(g-C)/R:0;return this.points[S].mult(1-k).add(this.points[v].mult(k))};var Qi=function(h,v,d){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/d),this.yCellCount=Math.ceil(v/d);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function xa(h,v,d,g,S){var C=_.create();return v?(_.scale(C,C,[1/S,1/S,1]),d||_.rotateZ(C,C,g.angle)):_.multiply(C,g.labelPlaneMatrix,h),C}function Pi(h,v,d,g,S){if(v){var C=_.clone(h);return _.scale(C,C,[S,S,1]),d||_.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function _i(h,v){var d=[h.x,h.y,0,1];ia(d,d,v);var g=d[3];return{point:new _.Point(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function Ti(h,v){return .5+h/v*.5}function Ca(h,v){var d=h[0]/h[3],g=h[1]/h[3];return d>=-v[0]&&d<=v[0]&&g>=-v[1]&&g<=v[1]}function Vs(h,v,d,g,S,C,R,k){var G=g?h.textSizeData:h.iconSizeData,J=_.evaluateSizeForZoom(G,d.transform.zoom),_e=[256/d.width*2+1,256/d.height*2+1],be=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;be.clear();for(var Te=h.lineVertexArray,$e=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,Ve=d.transform.width/d.transform.height,st=!1,Fe=0;Fe<$e.length;Fe++){var at=$e.get(Fe);if(at.hidden||at.writingMode===_.WritingMode.vertical&&!st)fi(at.numGlyphs,be);else{st=!1;var bt=[at.anchorX,at.anchorY,0,1];if(_.transformMat4(bt,bt,v),Ca(bt,_e)){var Nt=Ti(d.transform.cameraToCenterDistance,bt[3]),nr=_.evaluateSizeForFeature(G,J,at),qt=R?nr/Nt:nr*Nt,fr=new _.Point(at.anchorX,at.anchorY),Er=_i(fr,S).point,Gr={},Zr=qu(at,qt,!1,k,v,S,C,h.glyphOffsetArray,Te,be,Er,fr,Gr,Ve);st=Zr.useVertical,(Zr.notEnoughRoom||st||Zr.needsFlipping&&qu(at,qt,!0,k,v,S,C,h.glyphOffsetArray,Te,be,Er,fr,Gr,Ve).notEnoughRoom)&&fi(at.numGlyphs,be)}else fi(at.numGlyphs,be)}}g?h.text.dynamicLayoutVertexBuffer.updateData(be):h.icon.dynamicLayoutVertexBuffer.updateData(be)}function ca(h,v,d,g,S,C,R,k,G,J,_e){var be=k.glyphStartIndex+k.numGlyphs,Te=k.lineStartIndex,$e=k.lineStartIndex+k.lineLength,Ve=v.getoffsetX(k.glyphStartIndex),st=v.getoffsetX(be-1),Fe=va(h*Ve,d,g,S,C,R,k.segment,Te,$e,G,J,_e);if(!Fe)return null;var at=va(h*st,d,g,S,C,R,k.segment,Te,$e,G,J,_e);return at?{first:Fe,last:at}:null}function Ra(h,v,d,g){return h===_.WritingMode.horizontal&&Math.abs(d.y-v.y)>Math.abs(d.x-v.x)*g?{useVertical:!0}:(h===_.WritingMode.vertical?v.y<d.y:v.x>d.x)?{needsFlipping:!0}:null}function qu(h,v,d,g,S,C,R,k,G,J,_e,be,Te,$e){var Ve,st=v/24,Fe=h.lineOffsetX*st,at=h.lineOffsetY*st;if(h.numGlyphs>1){var bt=h.glyphStartIndex+h.numGlyphs,Nt=h.lineStartIndex,nr=h.lineStartIndex+h.lineLength,qt=ca(st,k,Fe,at,d,_e,be,h,G,C,Te);if(!qt)return{notEnoughRoom:!0};var fr=_i(qt.first.point,R).point,Er=_i(qt.last.point,R).point;if(g&&!d){var Gr=Ra(h.writingMode,fr,Er,$e);if(Gr)return Gr}Ve=[qt.first];for(var Zr=h.glyphStartIndex+1;Zr<bt-1;Zr++)Ve.push(va(st*k.getoffsetX(Zr),Fe,at,d,_e,be,h.segment,Nt,nr,G,C,Te));Ve.push(qt.last)}else{if(g&&!d){var vn=_i(be,S).point,zn=h.lineStartIndex+h.segment+1,Hn=new _.Point(G.getx(zn),G.gety(zn)),Fn=_i(Hn,S),Bi=Fn.signedDistanceFromCamera>0?Fn.point:tu(be,Hn,vn,1,S),bn=Ra(h.writingMode,vn,Bi,$e);if(bn)return bn}var ui=va(st*k.getoffsetX(h.glyphStartIndex),Fe,at,d,_e,be,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,G,C,Te);if(!ui)return{notEnoughRoom:!0};Ve=[ui]}for(var bi=0,ti=Ve;bi<ti.length;bi+=1){var ii=ti[bi];_.addDynamicAttributes(J,ii.point,ii.angle)}return{}}function tu(h,v,d,g,S){var C=_i(h.add(h.sub(v)._unit()),S).point,R=d.sub(C);return d.add(R._mult(g/R.mag()))}function va(h,v,d,g,S,C,R,k,G,J,_e,be){var Te=g?h-v:h+v,$e=Te>0?1:-1,Ve=0;g&&($e*=-1,Ve=Math.PI),$e<0&&(Ve+=Math.PI);for(var st=$e>0?k+R:k+R+1,Fe=S,at=S,bt=0,Nt=0,nr=Math.abs(Te),qt=[];bt+Nt<=nr;){if((st+=$e)<k||st>=G)return null;if(at=Fe,qt.push(Fe),(Fe=be[st])===void 0){var fr=new _.Point(J.getx(st),J.gety(st)),Er=_i(fr,_e);if(Er.signedDistanceFromCamera>0)Fe=be[st]=Er.point;else{var Gr=st-$e;Fe=tu(bt===0?C:new _.Point(J.getx(Gr),J.gety(Gr)),fr,at,nr-bt+1,_e)}}bt+=Nt,Nt=at.dist(Fe)}var Zr=(nr-bt)/Nt,vn=Fe.sub(at),zn=vn.mult(Zr)._add(at);zn._add(vn._unit()._perp()._mult(d*$e));var Hn=Ve+Math.atan2(Fe.y-at.y,Fe.x-at.x);return qt.push(zn),{point:zn,angle:Hn,path:qt}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(h,v,d,g,S){this._forEachCell(v,d,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(S)},Qi.prototype.insertCircle=function(h,v,d,g){this._forEachCell(v-g,d-g,v+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(d),this.circles.push(g)},Qi.prototype._insertBoxCell=function(h,v,d,g,S,C){this.boxCells[S].push(C)},Qi.prototype._insertCircleCell=function(h,v,d,g,S,C){this.circleCells[S].push(C)},Qi.prototype._query=function(h,v,d,g,S,C){if(d<0||h>this.width||g<0||v>this.height)return!S&&[];var R=[];if(h<=0&&v<=0&&this.width<=d&&this.height<=g){if(S)return!0;for(var k=0;k<this.boxKeys.length;k++)R.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var G=0;G<this.circleKeys.length;G++){var J=this.circles[3*G],_e=this.circles[3*G+1],be=this.circles[3*G+2];R.push({key:this.circleKeys[G],x1:J-be,y1:_e-be,x2:J+be,y2:_e+be})}return C?R.filter(C):R}return this._forEachCell(h,v,d,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},C),S?R.length>0:R},Qi.prototype._queryCircle=function(h,v,d,g,S){var C=h-d,R=h+d,k=v-d,G=v+d;if(R<0||C>this.width||G<0||k>this.height)return!g&&[];var J=[];return this._forEachCell(C,k,R,G,this._queryCellCircle,J,{hitTest:g,circle:{x:h,y:v,radius:d},seenUids:{box:{},circle:{}}},S),g?J.length>0:J},Qi.prototype.query=function(h,v,d,g,S){return this._query(h,v,d,g,!1,S)},Qi.prototype.hitTest=function(h,v,d,g,S){return this._query(h,v,d,g,!0,S)},Qi.prototype.hitTestCircle=function(h,v,d,g){return this._queryCircle(h,v,d,!0,g)},Qi.prototype._queryCell=function(h,v,d,g,S,C,R,k){var G=R.seenUids,J=this.boxCells[S];if(J!==null)for(var _e=this.bboxes,be=0,Te=J;be<Te.length;be+=1){var $e=Te[be];if(!G.box[$e]){G.box[$e]=!0;var Ve=4*$e;if(h<=_e[Ve+2]&&v<=_e[Ve+3]&&d>=_e[Ve+0]&&g>=_e[Ve+1]&&(!k||k(this.boxKeys[$e]))){if(R.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[$e],x1:_e[Ve],y1:_e[Ve+1],x2:_e[Ve+2],y2:_e[Ve+3]})}}}var st=this.circleCells[S];if(st!==null)for(var Fe=this.circles,at=0,bt=st;at<bt.length;at+=1){var Nt=bt[at];if(!G.circle[Nt]){G.circle[Nt]=!0;var nr=3*Nt;if(this._circleAndRectCollide(Fe[nr],Fe[nr+1],Fe[nr+2],h,v,d,g)&&(!k||k(this.circleKeys[Nt]))){if(R.hitTest)return C.push(!0),!0;var qt=Fe[nr],fr=Fe[nr+1],Er=Fe[nr+2];C.push({key:this.circleKeys[Nt],x1:qt-Er,y1:fr-Er,x2:qt+Er,y2:fr+Er})}}}},Qi.prototype._queryCellCircle=function(h,v,d,g,S,C,R,k){var G=R.circle,J=R.seenUids,_e=this.boxCells[S];if(_e!==null)for(var be=this.bboxes,Te=0,$e=_e;Te<$e.length;Te+=1){var Ve=$e[Te];if(!J.box[Ve]){J.box[Ve]=!0;var st=4*Ve;if(this._circleAndRectCollide(G.x,G.y,G.radius,be[st+0],be[st+1],be[st+2],be[st+3])&&(!k||k(this.boxKeys[Ve])))return C.push(!0),!0}}var Fe=this.circleCells[S];if(Fe!==null)for(var at=this.circles,bt=0,Nt=Fe;bt<Nt.length;bt+=1){var nr=Nt[bt];if(!J.circle[nr]){J.circle[nr]=!0;var qt=3*nr;if(this._circlesCollide(at[qt],at[qt+1],at[qt+2],G.x,G.y,G.radius)&&(!k||k(this.circleKeys[nr])))return C.push(!0),!0}}},Qi.prototype._forEachCell=function(h,v,d,g,S,C,R,k){for(var G=this._convertToXCellCoord(h),J=this._convertToYCellCoord(v),_e=this._convertToXCellCoord(d),be=this._convertToYCellCoord(g),Te=G;Te<=_e;Te++)for(var $e=J;$e<=be;$e++)if(S.call(this,h,v,d,g,this.xCellCount*$e+Te,C,R,k))return},Qi.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},Qi.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},Qi.prototype._circlesCollide=function(h,v,d,g,S,C){var R=g-h,k=S-v,G=d+C;return G*G>R*R+k*k},Qi.prototype._circleAndRectCollide=function(h,v,d,g,S,C,R){var k=(C-g)/2,G=Math.abs(h-(g+k));if(G>k+d)return!1;var J=(R-S)/2,_e=Math.abs(v-(S+J));if(_e>J+d)return!1;if(G<=k||_e<=J)return!0;var be=G-k,Te=_e-J;return be*be+Te*Te<=d*d};var ls=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fi(h,v){for(var d=0;d<h;d++){var g=v.length;v.resize(g+4),v.float32.set(ls,3*g)}}function ia(h,v,d){var g=v[0],S=v[1];return h[0]=d[0]*g+d[4]*S+d[12],h[1]=d[1]*g+d[5]*S+d[13],h[3]=d[3]*g+d[7]*S+d[15],h}var Ma=function(h,v,d){v===void 0&&(v=new Qi(h.width+200,h.height+200,25)),d===void 0&&(d=new Qi(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=d,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function aa(h,v,d){return v*(_.EXTENT/(h.tileSize*Math.pow(2,d-h.tileID.overscaledZ)))}Ma.prototype.placeCollisionBox=function(h,v,d,g,S){var C=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),R=d*C.perspectiveRatio,k=h.x1*R+C.point.x,G=h.y1*R+C.point.y,J=h.x2*R+C.point.x,_e=h.y2*R+C.point.y;return!this.isInsideGrid(k,G,J,_e)||!v&&this.grid.hitTest(k,G,J,_e,S)?{box:[],offscreen:!1}:{box:[k,G,J,_e],offscreen:this.isOffscreen(k,G,J,_e)}},Ma.prototype.placeCollisionCircles=function(h,v,d,g,S,C,R,k,G,J,_e,be,Te){var $e=[],Ve=new _.Point(v.anchorX,v.anchorY),st=_i(Ve,C),Fe=Ti(this.transform.cameraToCenterDistance,st.signedDistanceFromCamera),at=(J?S/Fe:S*Fe)/_.ONE_EM,bt=_i(Ve,R).point,Nt=ca(at,g,v.lineOffsetX*at,v.lineOffsetY*at,!1,bt,Ve,v,d,R,{}),nr=!1,qt=!1,fr=!0;if(Nt){for(var Er=.5*be*Fe+Te,Gr=new _.Point(-100,-100),Zr=new _.Point(this.screenRightBoundary,this.screenBottomBoundary),vn=new xo,zn=Nt.first,Hn=Nt.last,Fn=[],Bi=zn.path.length-1;Bi>=1;Bi--)Fn.push(zn.path[Bi]);for(var bn=1;bn<Hn.path.length;bn++)Fn.push(Hn.path[bn]);var ui=2.5*Er;if(k){var bi=Fn.map(function(ks){return _i(ks,k)});Fn=bi.some(function(ks){return ks.signedDistanceFromCamera<=0})?[]:bi.map(function(ks){return ks.point})}var ti=[];if(Fn.length>0){for(var ii=Fn[0].clone(),gi=Fn[0].clone(),Jn=1;Jn<Fn.length;Jn++)ii.x=Math.min(ii.x,Fn[Jn].x),ii.y=Math.min(ii.y,Fn[Jn].y),gi.x=Math.max(gi.x,Fn[Jn].x),gi.y=Math.max(gi.y,Fn[Jn].y);ti=ii.x>=Gr.x&&gi.x<=Zr.x&&ii.y>=Gr.y&&gi.y<=Zr.y?[Fn]:gi.x<Gr.x||ii.x>Zr.x||gi.y<Gr.y||ii.y>Zr.y?[]:_.clipLine([Fn],Gr.x,Gr.y,Zr.x,Zr.y)}for(var ei=0,uo=ti;ei<uo.length;ei+=1){var qa;vn.reset(uo[ei],.25*Er),qa=vn.length<=.5*Er?1:Math.ceil(vn.paddedLength/ui)+1;for(var $o=0;$o<qa;$o++){var lo=$o/Math.max(qa-1,1),Ta=vn.lerp(lo),Ka=Ta.x+100,Ss=Ta.y+100;$e.push(Ka,Ss,Er,0);var ts=Ka-Er,fl=Ss-Er,As=Ka+Er,ou=Ss+Er;if(fr=fr&&this.isOffscreen(ts,fl,As,ou),qt=qt||this.isInsideGrid(ts,fl,As,ou),!h&&this.grid.hitTestCircle(Ka,Ss,Er,_e)&&(nr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:nr}}}}return{circles:!G&&nr||!qt?[]:$e,offscreen:fr,collisionDetected:nr}},Ma.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],d=1/0,g=1/0,S=-1/0,C=-1/0,R=0,k=h;R<k.length;R+=1){var G=k[R],J=new _.Point(G.x+100,G.y+100);d=Math.min(d,J.x),g=Math.min(g,J.y),S=Math.max(S,J.x),C=Math.max(C,J.y),v.push(J)}for(var _e={},be={},Te=0,$e=this.grid.query(d,g,S,C).concat(this.ignoredGrid.query(d,g,S,C));Te<$e.length;Te+=1){var Ve=$e[Te],st=Ve.key;if(_e[st.bucketInstanceId]===void 0&&(_e[st.bucketInstanceId]={}),!_e[st.bucketInstanceId][st.featureIndex]){var Fe=[new _.Point(Ve.x1,Ve.y1),new _.Point(Ve.x2,Ve.y1),new _.Point(Ve.x2,Ve.y2),new _.Point(Ve.x1,Ve.y2)];_.polygonIntersectsPolygon(v,Fe)&&(_e[st.bucketInstanceId][st.featureIndex]=!0,be[st.bucketInstanceId]===void 0&&(be[st.bucketInstanceId]=[]),be[st.bucketInstanceId].push(st.featureIndex))}}return be},Ma.prototype.insertCollisionBox=function(h,v,d,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},Ma.prototype.insertCollisionCircles=function(h,v,d,g,S){for(var C=v?this.ignoredGrid:this.grid,R={bucketInstanceId:d,featureIndex:g,collisionGroupID:S},k=0;k<h.length;k+=4)C.insertCircle(R,h[k],h[k+1],h[k+2])},Ma.prototype.projectAndGetPerspectiveRatio=function(h,v,d){var g=[v,d,0,1];return ia(g,g,h),{point:new _.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ma.prototype.isOffscreen=function(h,v,d,g){return d<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},Ma.prototype.isInsideGrid=function(h,v,d,g){return d>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},Ma.prototype.getViewportMatrix=function(){var h=_.identity([]);return _.translate(h,h,[-100,-100,0]),h};var Jo=function(h,v,d,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&d?1:0,this.placed=d};Jo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var jo=function(h,v,d,g,S){this.text=new Jo(h?h.text:null,v,d,S),this.icon=new Jo(h?h.icon:null,v,g,S)};jo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Pu=function(h,v,d){this.text=h,this.icon=v,this.skipFade=d},Rs=function(){this.invProjMatrix=_.create(),this.viewportMatrix=_.create(),this.circles=[]},pc=function(h,v,d,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=S},Fa=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function zi(h,v,d,g,S){var C=_.getAnchorAlignment(h),R=-(C.horizontalAlign-.5)*v,k=-(C.verticalAlign-.5)*d,G=_.evaluateVariableOffset(h,g);return new _.Point(R+G[0]*S,k+G[1]*S)}function Ho(h,v,d,g,S,C){var R=h.x1,k=h.x2,G=h.y1,J=h.y2,_e=h.anchorPointX,be=h.anchorPointY,Te=new _.Point(v,d);return g&&Te._rotate(S?C:-C),{x1:R+Te.x,y1:G+Te.y,x2:k+Te.x,y2:J+Te.y,anchorPointX:_e,anchorPointY:be}}Fa.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(d){return d.collisionGroupID===v}}}return this.collisionGroups[h]};var Yt=function(h,v,d,g){this.transform=h.clone(),this.collisionIndex=new Ma(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Fa(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function re(h,v,d,g,S){h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0),h.emplaceBack(v?1:0,d?1:0,g||0,S||0)}Yt.prototype.getBucketParts=function(h,v,d,g){var S=d.getBucket(v),C=d.latestFeatureIndex;if(S&&C&&v.id===S.layerIds[0]){var R=d.collisionBoxArray,k=S.layers[0].layout,G=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),J=d.tileSize/_.EXTENT,_e=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),be=k.get("text-pitch-alignment")==="map",Te=k.get("text-rotation-alignment")==="map",$e=aa(d,1,this.transform.zoom),Ve=xa(_e,be,Te,this.transform,$e),st=null;if(be){var Fe=Pi(_e,be,Te,this.transform,$e);st=_.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[S.bucketInstanceId]=new pc(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,d.tileID);var at={bucket:S,layout:k,posMatrix:_e,textLabelPlaneMatrix:Ve,labelToScreenMatrix:st,scale:G,textPixelRatio:J,holdingForFade:d.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:_.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var bt=0,Nt=S.sortKeyRanges;bt<Nt.length;bt+=1){var nr=Nt[bt];h.push({sortKey:nr.sortKey,symbolInstanceStart:nr.symbolInstanceStart,symbolInstanceEnd:nr.symbolInstanceEnd,parameters:at})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:at})}},Yt.prototype.attemptAnchorPlacement=function(h,v,d,g,S,C,R,k,G,J,_e,be,Te,$e,Ve){var st,Fe=[be.textOffset0,be.textOffset1],at=zi(h,d,g,Fe,S),bt=this.collisionIndex.placeCollisionBox(Ho(v,at.x,at.y,C,R,this.transform.angle),_e,k,G,J.predicate);if(!Ve||this.collisionIndex.placeCollisionBox(Ho(Ve,at.x,at.y,C,R,this.transform.angle),_e,k,G,J.predicate).box.length!==0)return bt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID].text&&(st=this.prevPlacement.variableOffsets[be.crossTileID].anchor),this.variableOffsets[be.crossTileID]={textOffset:Fe,width:d,height:g,anchor:h,textBoxScale:S,prevAnchor:st},this.markUsedJustification(Te,h,be,$e),Te.allowVerticalPlacement&&(this.markUsedOrientation(Te,$e,be),this.placedOrientations[be.crossTileID]=$e),{shift:at,placedGlyphBoxes:bt}):void 0},Yt.prototype.placeLayerBucketPart=function(h,v,d){var g=this,S=h.parameters,C=S.bucket,R=S.layout,k=S.posMatrix,G=S.textLabelPlaneMatrix,J=S.labelToScreenMatrix,_e=S.textPixelRatio,be=S.holdingForFade,Te=S.collisionBoxArray,$e=S.partiallyEvaluatedTextSize,Ve=S.collisionGroup,st=R.get("text-optional"),Fe=R.get("icon-optional"),at=R.get("text-allow-overlap"),bt=R.get("icon-allow-overlap"),Nt=R.get("text-rotation-alignment")==="map",nr=R.get("text-pitch-alignment")==="map",qt=R.get("icon-text-fit")!=="none",fr=R.get("symbol-z-order")==="viewport-y",Er=at&&(bt||!C.hasIconData()||Fe),Gr=bt&&(at||!C.hasTextData()||st);!C.collisionArrays&&Te&&C.deserializeCollisionBoxes(Te);var Zr=function(bn,ui){if(!v[bn.crossTileID])if(be)g.placements[bn.crossTileID]=new Pu(!1,!1,!1);else{var bi,ti=!1,ii=!1,gi=!0,Jn=null,ei={box:null,offscreen:null},uo={box:null,offscreen:null},qa=null,$o=null,lo=0,Ta=0,Ka=0;ui.textFeatureIndex?lo=ui.textFeatureIndex:bn.useRuntimeCollisionCircles&&(lo=bn.featureIndex),ui.verticalTextFeatureIndex&&(Ta=ui.verticalTextFeatureIndex);var Ss=ui.textBox;if(Ss){var ts=function(Li){var Yo=_.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Li&&g.prevPlacement){var So=g.prevPlacement.placedOrientations[bn.crossTileID];So&&(g.placedOrientations[bn.crossTileID]=So,g.markUsedOrientation(C,Yo=So,bn))}return Yo},fl=function(Li,Yo){if(C.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&ui.verticalTextBox)for(var So=0,uu=C.writingModes;So<uu.length&&(uu[So]===_.WritingMode.vertical?(ei=Yo(),uo=ei):ei=Li(),!(ei&&ei.box&&ei.box.length));So+=1);else ei=Li()};if(R.get("text-variable-anchor")){var As=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[bn.crossTileID]){var ou=g.prevPlacement.variableOffsets[bn.crossTileID];As.indexOf(ou.anchor)>0&&(As=As.filter(function(Li){return Li!==ou.anchor})).unshift(ou.anchor)}var ks=function(Li,Yo,So){for(var uu=Li.x2-Li.x1,Mc=Li.y2-Li.y1,ju=bn.textBoxScale,nf=qt&&!bt?Yo:null,Kl={box:[],offscreen:!1},Ao=at?2*As.length:As.length,Mr=0;Mr<Ao;++Mr){var Ql=g.attemptAnchorPlacement(As[Mr%As.length],Li,uu,Mc,ju,Nt,nr,_e,k,Ve,Mr>=As.length,bn,C,So,nf);if(Ql&&(Kl=Ql.placedGlyphBoxes)&&Kl.box&&Kl.box.length){ti=!0,Jn=Ql.shift;break}}return Kl};fl(function(){return ks(Ss,ui.iconBox,_.WritingMode.horizontal)},function(){var Li=ui.verticalTextBox;return C.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&bn.numVerticalGlyphVertices>0&&Li?ks(Li,ui.verticalIconBox,_.WritingMode.vertical):{box:null,offscreen:null}}),ei&&(ti=ei.box,gi=ei.offscreen);var Rc=ts(ei&&ei.box);if(!ti&&g.prevPlacement){var ql=g.prevPlacement.variableOffsets[bn.crossTileID];ql&&(g.variableOffsets[bn.crossTileID]=ql,g.markUsedJustification(C,ql.anchor,bn,Rc))}}else{var qs=function(Li,Yo){var So=g.collisionIndex.placeCollisionBox(Li,at,_e,k,Ve.predicate);return So&&So.box&&So.box.length&&(g.markUsedOrientation(C,Yo,bn),g.placedOrientations[bn.crossTileID]=Yo),So};fl(function(){return qs(Ss,_.WritingMode.horizontal)},function(){var Li=ui.verticalTextBox;return C.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&Li?qs(Li,_.WritingMode.vertical):{box:null,offscreen:null}}),ts(ei&&ei.box&&ei.box.length)}}if(ti=(bi=ei)&&bi.box&&bi.box.length>0,gi=bi&&bi.offscreen,bn.useRuntimeCollisionCircles){var hl=C.text.placedSymbolArray.get(bn.centerJustifiedTextSymbolIndex),kl=_.evaluateSizeForFeature(C.textSizeData,$e,hl),bu=R.get("text-padding");qa=g.collisionIndex.placeCollisionCircles(at,hl,C.lineVertexArray,C.glyphOffsetArray,kl,k,G,J,d,nr,Ve.predicate,bn.collisionCircleDiameter,bu),ti=at||qa.circles.length>0&&!qa.collisionDetected,gi=gi&&qa.offscreen}if(ui.iconFeatureIndex&&(Ka=ui.iconFeatureIndex),ui.iconBox){var pl=function(Li){var Yo=qt&&Jn?Ho(Li,Jn.x,Jn.y,Nt,nr,g.transform.angle):Li;return g.collisionIndex.placeCollisionBox(Yo,bt,_e,k,Ve.predicate)};ii=uo&&uo.box&&uo.box.length&&ui.verticalIconBox?($o=pl(ui.verticalIconBox)).box.length>0:($o=pl(ui.iconBox)).box.length>0,gi=gi&&$o.offscreen}var Lo=st||bn.numHorizontalGlyphVertices===0&&bn.numVerticalGlyphVertices===0,ka=Fe||bn.numIconVertices===0;if(Lo||ka?ka?Lo||(ii=ii&&ti):ti=ii&&ti:ii=ti=ii&&ti,ti&&bi&&bi.box&&g.collisionIndex.insertCollisionBox(bi.box,R.get("text-ignore-placement"),C.bucketInstanceId,uo&&uo.box&&Ta?Ta:lo,Ve.ID),ii&&$o&&g.collisionIndex.insertCollisionBox($o.box,R.get("icon-ignore-placement"),C.bucketInstanceId,Ka,Ve.ID),qa&&(ti&&g.collisionIndex.insertCollisionCircles(qa.circles,R.get("text-ignore-placement"),C.bucketInstanceId,lo,Ve.ID),d)){var Ds=C.bucketInstanceId,su=g.collisionCircleArrays[Ds];su===void 0&&(su=g.collisionCircleArrays[Ds]=new Rs);for(var Eu=0;Eu<qa.circles.length;Eu+=4)su.circles.push(qa.circles[Eu+0]),su.circles.push(qa.circles[Eu+1]),su.circles.push(qa.circles[Eu+2]),su.circles.push(qa.collisionDetected?1:0)}g.placements[bn.crossTileID]=new Pu(ti||Er,ii||Gr,gi||C.justReloaded),v[bn.crossTileID]=!0}};if(fr)for(var vn=C.getSortedSymbolIndexes(this.transform.angle),zn=vn.length-1;zn>=0;--zn){var Hn=vn[zn];Zr(C.symbolInstances.get(Hn),C.collisionArrays[Hn])}else for(var Fn=h.symbolInstanceStart;Fn<h.symbolInstanceEnd;Fn++)Zr(C.symbolInstances.get(Fn),C.collisionArrays[Fn]);if(d&&C.bucketInstanceId in this.collisionCircleArrays){var Bi=this.collisionCircleArrays[C.bucketInstanceId];_.invert(Bi.invProjMatrix,k),Bi.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Yt.prototype.markUsedJustification=function(h,v,d,g){var S;S=g===_.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[_.getAnchorJustification(v)];for(var C=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];C<R.length;C+=1){var k=R[C];k>=0&&(h.text.placedSymbolArray.get(k).crossTileID=S>=0&&k!==S?0:d.crossTileID)}},Yt.prototype.markUsedOrientation=function(h,v,d){for(var g=v===_.WritingMode.horizontal||v===_.WritingMode.horizontalOnly?v:0,S=v===_.WritingMode.vertical?v:0,C=0,R=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];C<R.length;C+=1)h.text.placedSymbolArray.get(R[C]).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=S)},Yt.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,d=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},C=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var k in this.placements){var G=this.placements[k],J=S[k];J?(this.opacities[k]=new jo(J,g,G.text,G.icon),d=d||G.text!==J.text.placed||G.icon!==J.icon.placed):(this.opacities[k]=new jo(null,g,G.text,G.icon,G.skipFade),d=d||G.text||G.icon)}for(var _e in S){var be=S[_e];if(!this.opacities[_e]){var Te=new jo(be,g,!1,!1);Te.isHidden()||(this.opacities[_e]=Te,d=d||be.text.placed||be.icon.placed)}}for(var $e in C)this.variableOffsets[$e]||!this.opacities[$e]||this.opacities[$e].isHidden()||(this.variableOffsets[$e]=C[$e]);for(var Ve in R)this.placedOrientations[Ve]||!this.opacities[Ve]||this.opacities[Ve].isHidden()||(this.placedOrientations[Ve]=R[Ve]);d?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},Yt.prototype.updateLayerOpacities=function(h,v){for(var d={},g=0,S=v;g<S.length;g+=1){var C=S[g],R=C.getBucket(h);R&&C.latestFeatureIndex&&h.id===R.layerIds[0]&&this.updateBucketOpacities(R,d,C.collisionBoxArray)}},Yt.prototype.updateBucketOpacities=function(h,v,d){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,C=new jo(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),k=S.get("icon-allow-overlap"),G=S.get("text-variable-anchor"),J=S.get("text-rotation-alignment")==="map",_e=S.get("text-pitch-alignment")==="map",be=S.get("icon-text-fit")!=="none",Te=new jo(null,0,R&&(k||!h.hasIconData()||S.get("icon-optional")),k&&(R||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&d&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(d);for(var $e=function(at,bt,Nt){for(var nr=0;nr<bt/4;nr++)at.opacityVertexArray.emplaceBack(Nt)},Ve=function(at){var bt=h.symbolInstances.get(at),Nt=bt.numHorizontalGlyphVertices,nr=bt.numVerticalGlyphVertices,qt=bt.crossTileID,fr=g.opacities[qt];v[qt]?fr=C:fr||(g.opacities[qt]=fr=Te),v[qt]=!0;var Er=bt.numIconVertices>0,Gr=g.placedOrientations[bt.crossTileID],Zr=Gr===_.WritingMode.vertical,vn=Gr===_.WritingMode.horizontal||Gr===_.WritingMode.horizontalOnly;if(Nt>0||nr>0){var zn=bo(fr.text);$e(h.text,Nt,Zr?io:zn),$e(h.text,nr,vn?io:zn);var Hn=fr.text.isHidden();[bt.rightJustifiedTextSymbolIndex,bt.centerJustifiedTextSymbolIndex,bt.leftJustifiedTextSymbolIndex].forEach(function(ei){ei>=0&&(h.text.placedSymbolArray.get(ei).hidden=Hn||Zr?1:0)}),bt.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(bt.verticalPlacedTextSymbolIndex).hidden=Hn||vn?1:0);var Fn=g.variableOffsets[bt.crossTileID];Fn&&g.markUsedJustification(h,Fn.anchor,bt,Gr);var Bi=g.placedOrientations[bt.crossTileID];Bi&&(g.markUsedJustification(h,"left",bt,Bi),g.markUsedOrientation(h,Bi,bt))}if(Er){var bn=bo(fr.icon),ui=!(be&&bt.verticalPlacedIconSymbolIndex&&Zr);bt.placedIconSymbolIndex>=0&&($e(h.icon,bt.numIconVertices,ui?bn:io),h.icon.placedSymbolArray.get(bt.placedIconSymbolIndex).hidden=fr.icon.isHidden()),bt.verticalPlacedIconSymbolIndex>=0&&($e(h.icon,bt.numVerticalIconVertices,ui?io:bn),h.icon.placedSymbolArray.get(bt.verticalPlacedIconSymbolIndex).hidden=fr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var bi=h.collisionArrays[at];if(bi){var ti=new _.Point(0,0);if(bi.textBox||bi.verticalTextBox){var ii=!0;if(G){var gi=g.variableOffsets[qt];gi?(ti=zi(gi.anchor,gi.width,gi.height,gi.textOffset,gi.textBoxScale),J&&ti._rotate(_e?g.transform.angle:-g.transform.angle)):ii=!1}bi.textBox&&re(h.textCollisionBox.collisionVertexArray,fr.text.placed,!ii||Zr,ti.x,ti.y),bi.verticalTextBox&&re(h.textCollisionBox.collisionVertexArray,fr.text.placed,!ii||vn,ti.x,ti.y)}var Jn=Boolean(!vn&&bi.verticalIconBox);bi.iconBox&&re(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,Jn,be?ti.x:0,be?ti.y:0),bi.verticalIconBox&&re(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,!Jn,be?ti.x:0,be?ti.y:0)}}},st=0;st<h.symbolInstances.length;st++)Ve(st);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Fe.invProjMatrix,h.placementViewportMatrix=Fe.viewportMatrix,h.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Yt.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Yt.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Yt.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Yt.prototype.stillRecent=function(h,v){var d=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*d>h},Yt.prototype.setStale=function(){this.stale=!0};var Oe=Math.pow(2,25),gt=Math.pow(2,24),ur=Math.pow(2,17),Jr=Math.pow(2,16),Ln=Math.pow(2,9),Zi=Math.pow(2,8),so=Math.pow(2,1);function bo(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,d=Math.floor(127*h.opacity);return d*Oe+v*gt+d*ur+v*Jr+d*Ln+v*Zi+d*so+v}var io=0,Ms=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ms.prototype.continuePlacement=function(h,v,d,g,S){for(var C=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(C,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(R,k){return R.sortKey-k.sortKey}));this._currentPartIndex<C.length;)if(v.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,S())return!0;return!1};var Zc=function(h,v,d,g,S,C,R){this.placement=new Yt(h,S,C,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1};Zc.prototype.isDone=function(){return this._done},Zc.prototype.continuePlacement=function(h,v,d){for(var g=this,S=_.browser.now(),C=function(){var G=_.browser.now()-S;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var R=v[h[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=k)&&(!R.maxzoom||R.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Ms(R)),this._inProgressLayer.continuePlacement(d[R.source],this.placement,this._showCollisionBoxes,R,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Zc.prototype.commit=function(h){return this.placement.commit(h),this.placement};var ru=512/_.EXTENT/2,Ef=function(h,v,d){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(var g=0;g<v.length;g++){var S=v.get(g),C=S.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};Ef.prototype.getScaledCoordinates=function(h,v){var d=ru/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*_.EXTENT+h.anchorX)*d),y:Math.floor((v.canonical.y*_.EXTENT+h.anchorY)*d)}},Ef.prototype.findMatches=function(h,v,d){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var C=h.get(S);if(!C.crossTileID){var R=this.indexedSymbolInstances[C.key];if(R)for(var k=this.getScaledCoordinates(C,v),G=0,J=R;G<J.length;G+=1){var _e=J[G];if(Math.abs(_e.coord.x-k.x)<=g&&Math.abs(_e.coord.y-k.y)<=g&&!d[_e.crossTileID]){d[_e.crossTileID]=!0,C.crossTileID=_e.crossTileID;break}}}}};var Wo=function(){this.maxCrossTileID=0};Wo.prototype.generate=function(){return++this.maxCrossTileID};var bl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};bl.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var d in this.indexes){var g=this.indexes[d],S={};for(var C in g){var R=g[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),S[R.tileID.key]=R}this.indexes[d]=S}this.lng=h},bl.prototype.addBucket=function(h,v,d){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var C in this.indexes){var R=this.indexes[C];if(Number(C)>h.overscaledZ)for(var k in R){var G=R[k];G.tileID.isChildOf(h)&&G.findMatches(v.symbolInstances,h,S)}else{var J=R[h.scaledTo(Number(C)).key];J&&J.findMatches(v.symbolInstances,h,S)}}for(var _e=0;_e<v.symbolInstances.length;_e++){var be=v.symbolInstances.get(_e);be.crossTileID||(be.crossTileID=d.generate(),S[be.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Ef(h,v.symbolInstances,v.bucketInstanceId),!0},bl.prototype.removeBucketCrossTileIDs=function(h,v){for(var d in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[d];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},bl.prototype.removeStaleBuckets=function(h){var v=!1;for(var d in this.indexes){var g=this.indexes[d];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[S]),delete g[S],v=!0)}return v};var El=function(){this.layerIndexes={},this.crossTileIDs=new Wo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};El.prototype.addLayer=function(h,v,d){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new bl);var S=!1,C={};g.handleWrapJump(d);for(var R=0,k=v;R<k.length;R+=1){var G=k[R],J=G.getBucket(h);J&&h.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,J,this.crossTileIDs)&&(S=!0),C[J.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(S=!0),S},El.prototype.pruneUnusedLayers=function(h){var v={};for(var d in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[d]||delete this.layerIndexes[d]};var Ou=function(h,v){return _.emitValidationErrors(h,v&&v.filter(function(d){return d.identifier!=="source.canvas"}))},ku=_.pick(Xr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ku=_.pick(Xr,["setCenter","setZoom","setBearing","setPitch"]),Vc=function(){var h={},v=_.styleSpec.$version;for(var d in _.styleSpec.$root){var g,S=_.styleSpec.$root[d];S.required&&(g=d==="version"?v:S.type==="array"?[]:{})!=null&&(h[d]=g)}return h}(),Is=function(h){function v(d,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=d,this.dispatcher=new sr(Jt(),this),this.imageManager=new $t,this.imageManager.setEventedParent(this),this.glyphManager=new dr(d._requestManager,g.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new El,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new _.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",_.getReferrer());var C=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(k,G){if(_.triggerPluginCompletionEvent(k),G&&G.every(function(_e){return _e}))for(var J in C.sourceCaches)C.sourceCaches[J].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var k=S.sourceCaches[R.sourceId];if(k){var G=k.getSource();if(G&&G.vectorLayerIds)for(var J in S._layers){var _e=S._layers[J];_e.source===G.id&&S._validateLayer(_e)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(d,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!_.isMapboxURL(d);d=this.map._requestManager.normalizeStyleURL(d,g.accessToken);var R=this.map._requestManager.transformRequest(d,_.ResourceType.Style);this._request=_.getJSON(R,function(k,G){S._request=null,k?S.fire(new _.ErrorEvent(k)):G&&S._load(G,C)})},v.prototype.loadJSON=function(d,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"})),this._request=_.browser.frame(function(){S._request=null,S._load(d,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new _.Event("dataloading",{dataType:"style"})),this._load(Vc,!1)},v.prototype._load=function(d,g){if(!g||!Ou(this,_.validateStyle(d))){for(var S in this._loaded=!0,this.stylesheet=d,d.sources)this.addSource(S,d.sources[S],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs);var C=Nr(this.stylesheet.layers);this._order=C.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var R=0,k=C;R<k.length;R+=1){var G=k[R];(G=_.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ft(this.stylesheet.light),this.fire(new _.Event("data",{dataType:"style"})),this.fire(new _.Event("style.load"))}},v.prototype._loadSprite=function(d){var g=this;this._spriteRequest=function(S,C,R){var k,G,J,_e=_.browser.devicePixelRatio>1?"@2x":"",be=_.getJSON(C.transformRequest(C.normalizeSpriteURL(S,_e,".json"),_.ResourceType.SpriteJSON),function(Ve,st){be=null,J||(J=Ve,k=st,$e())}),Te=_.getImage(C.transformRequest(C.normalizeSpriteURL(S,_e,".png"),_.ResourceType.SpriteImage),function(Ve,st){Te=null,J||(J=Ve,G=st,$e())});function $e(){if(J)R(J);else if(k&&G){var Ve=_.browser.getImageData(G),st={};for(var Fe in k){var at=k[Fe],bt=at.width,Nt=at.height,nr=at.x,qt=at.y,fr=at.sdf,Er=at.pixelRatio,Gr=at.stretchX,Zr=at.stretchY,vn=at.content,zn=new _.RGBAImage({width:bt,height:Nt});_.RGBAImage.copy(Ve,zn,{x:nr,y:qt},{x:0,y:0},{width:bt,height:Nt}),st[Fe]={data:zn,pixelRatio:Er,sdf:fr,stretchX:Gr,stretchY:Zr,content:vn}}R(null,st)}}return{cancel:function(){be&&(be.cancel(),be=null),Te&&(Te.cancel(),Te=null)}}}(d,this.map._requestManager,function(S,C){if(g._spriteRequest=null,S)g.fire(new _.ErrorEvent(S));else if(C)for(var R in C)g.imageManager.addImage(R,C[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new _.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(d){var g=this.sourceCaches[d.source];if(g){var S=d.sourceLayer;if(S){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(S)===-1)&&this.fire(new _.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+C.id+'" as specified by style layer "'+d.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var d in this.sourceCaches)if(!this.sourceCaches[d].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(d){for(var g=[],S=0,C=d;S<C.length;S+=1){var R=this._layers[C[S]];R.type!=="custom"&&g.push(R.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(d){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var R in(S.length||C.length)&&this._updateWorkerLayers(S,C),this._updatedSources){var k=this._updatedSources[R];k==="reload"?this._reloadSource(R):k==="clear"&&this._clearSource(R)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(d);this.light.updateTransitions(d),this._resetUpdates()}var J={};for(var _e in this.sourceCaches){var be=this.sourceCaches[_e];J[_e]=be.used,be.used=!1}for(var Te=0,$e=this._order;Te<$e.length;Te+=1){var Ve=this._layers[$e[Te]];Ve.recalculate(d,this._availableImages),!Ve.isHidden(d.zoom)&&Ve.source&&(this.sourceCaches[Ve.source].used=!0)}for(var st in J){var Fe=this.sourceCaches[st];J[st]!==Fe.used&&Fe.fire(new _.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:st}))}this.light.recalculate(d),this.z=d.zoom,g&&this.fire(new _.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var d=Object.keys(this._changedImages);if(d.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],d);this._changedImages={}}},v.prototype._updateWorkerLayers=function(d,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(d),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(d){var g=this;if(this._checkLoaded(),Ou(this,_.validateStyle(d)))return!1;(d=_.clone$1(d)).layers=Nr(d.layers);var S=function(R,k){if(!R)return[{command:Xr.setStyle,args:[k]}];var G=[];try{if(!_.deepEqual(R.version,k.version))return[{command:Xr.setStyle,args:[k]}];_.deepEqual(R.center,k.center)||G.push({command:Xr.setCenter,args:[k.center]}),_.deepEqual(R.zoom,k.zoom)||G.push({command:Xr.setZoom,args:[k.zoom]}),_.deepEqual(R.bearing,k.bearing)||G.push({command:Xr.setBearing,args:[k.bearing]}),_.deepEqual(R.pitch,k.pitch)||G.push({command:Xr.setPitch,args:[k.pitch]}),_.deepEqual(R.sprite,k.sprite)||G.push({command:Xr.setSprite,args:[k.sprite]}),_.deepEqual(R.glyphs,k.glyphs)||G.push({command:Xr.setGlyphs,args:[k.glyphs]}),_.deepEqual(R.transition,k.transition)||G.push({command:Xr.setTransition,args:[k.transition]}),_.deepEqual(R.light,k.light)||G.push({command:Xr.setLight,args:[k.light]});var J={},_e=[];(function(Te,$e,Ve,st){var Fe;for(Fe in $e=$e||{},Te=Te||{})Te.hasOwnProperty(Fe)&&($e.hasOwnProperty(Fe)||un(Fe,Ve,st));for(Fe in $e)$e.hasOwnProperty(Fe)&&(Te.hasOwnProperty(Fe)?_.deepEqual(Te[Fe],$e[Fe])||(Te[Fe].type==="geojson"&&$e[Fe].type==="geojson"&&Ni(Te,$e,Fe)?Ve.push({command:Xr.setGeoJSONSourceData,args:[Fe,$e[Fe].data]}):vi(Fe,$e,Ve,st)):si(Fe,$e,Ve))})(R.sources,k.sources,_e,J);var be=[];R.layers&&R.layers.forEach(function(Te){J[Te.source]?G.push({command:Xr.removeLayer,args:[Te.id]}):be.push(Te)}),G=G.concat(_e),function(Te,$e,Ve){$e=$e||[];var st,Fe,at,bt,Nt,nr,qt,fr=(Te=Te||[]).map(Mi),Er=$e.map(Mi),Gr=Te.reduce(Ii,{}),Zr=$e.reduce(Ii,{}),vn=fr.slice(),zn=Object.create(null);for(st=0,Fe=0;st<fr.length;st++)Zr.hasOwnProperty(at=fr[st])?Fe++:(Ve.push({command:Xr.removeLayer,args:[at]}),vn.splice(vn.indexOf(at,Fe),1));for(st=0,Fe=0;st<Er.length;st++)vn[vn.length-1-st]!==(at=Er[Er.length-1-st])&&(Gr.hasOwnProperty(at)?(Ve.push({command:Xr.removeLayer,args:[at]}),vn.splice(vn.lastIndexOf(at,vn.length-Fe),1)):Fe++,Ve.push({command:Xr.addLayer,args:[Zr[at],nr=vn[vn.length-st]]}),vn.splice(vn.length-st,0,at),zn[at]=!0);for(st=0;st<Er.length;st++)if(bt=Gr[at=Er[st]],Nt=Zr[at],!zn[at]&&!_.deepEqual(bt,Nt))if(_.deepEqual(bt.source,Nt.source)&&_.deepEqual(bt["source-layer"],Nt["source-layer"])&&_.deepEqual(bt.type,Nt.type)){for(qt in yi(bt.layout,Nt.layout,Ve,at,null,Xr.setLayoutProperty),yi(bt.paint,Nt.paint,Ve,at,null,Xr.setPaintProperty),_.deepEqual(bt.filter,Nt.filter)||Ve.push({command:Xr.setFilter,args:[at,Nt.filter]}),_.deepEqual(bt.minzoom,Nt.minzoom)&&_.deepEqual(bt.maxzoom,Nt.maxzoom)||Ve.push({command:Xr.setLayerZoomRange,args:[at,Nt.minzoom,Nt.maxzoom]}),bt)bt.hasOwnProperty(qt)&&qt!=="layout"&&qt!=="paint"&&qt!=="filter"&&qt!=="metadata"&&qt!=="minzoom"&&qt!=="maxzoom"&&(qt.indexOf("paint.")===0?yi(bt[qt],Nt[qt],Ve,at,qt.slice(6),Xr.setPaintProperty):_.deepEqual(bt[qt],Nt[qt])||Ve.push({command:Xr.setLayerProperty,args:[at,qt,Nt[qt]]}));for(qt in Nt)Nt.hasOwnProperty(qt)&&!bt.hasOwnProperty(qt)&&qt!=="layout"&&qt!=="paint"&&qt!=="filter"&&qt!=="metadata"&&qt!=="minzoom"&&qt!=="maxzoom"&&(qt.indexOf("paint.")===0?yi(bt[qt],Nt[qt],Ve,at,qt.slice(6),Xr.setPaintProperty):_.deepEqual(bt[qt],Nt[qt])||Ve.push({command:Xr.setLayerProperty,args:[at,qt,Nt[qt]]}))}else Ve.push({command:Xr.removeLayer,args:[at]}),nr=vn[vn.lastIndexOf(at)+1],Ve.push({command:Xr.addLayer,args:[Nt,nr]})}(be,k.layers,G)}catch(Te){console.warn("Unable to compute style diff:",Te),G=[{command:Xr.setStyle,args:[k]}]}return G}(this.serialize(),d).filter(function(R){return!(R.command in Ku)});if(S.length===0)return!1;var C=S.filter(function(R){return!(R.command in ku)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=d,!0},v.prototype.addImage=function(d,g){if(this.getImage(d))return this.fire(new _.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(d,g),this._afterImageUpdated(d)},v.prototype.updateImage=function(d,g){this.imageManager.updateImage(d,g)},v.prototype.getImage=function(d){return this.imageManager.getImage(d)},v.prototype.removeImage=function(d){if(!this.getImage(d))return this.fire(new _.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(d),this._afterImageUpdated(d)},v.prototype._afterImageUpdated=function(d){this._availableImages=this.imageManager.listImages(),this._changedImages[d]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(d,g,S){var C=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[d]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(_.validateStyle.source,"sources."+d,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[d]=new Q(d,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:R.serialize(),sourceId:d}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(d){if(this._checkLoaded(),this.sourceCaches[d]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===d)return this.fire(new _.ErrorEvent(new Error('Source "'+d+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[d];delete this.sourceCaches[d],delete this._updatedSources[d],S.fire(new _.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(d,g){this._checkLoaded(),this.sourceCaches[d].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(d){return this.sourceCaches[d]&&this.sourceCaches[d].getSource()},v.prototype.addLayer=function(d,g,S){S===void 0&&(S={}),this._checkLoaded();var C=d.id;if(this.getLayer(C))this.fire(new _.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var R;if(d.type==="custom"){if(Ou(this,_.validateCustomStyleLayer(d)))return;R=_.createStyleLayer(d)}else{if(typeof d.source=="object"&&(this.addSource(C,d.source),d=_.clone$1(d),d=_.extend(d,{source:C})),this._validate(_.validateStyle.layer,"layers."+C,d,{arrayIndex:-1},S))return;R=_.createStyleLayer(d),this._validateLayer(R),R.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[R.id]=R.serialize()}var k=g?this._order.indexOf(g):this._order.length;if(g&&k===-1)this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(k,0,C),this._layerOrderChanged=!0,this._layers[C]=R,this._removedLayers[C]&&R.source&&R.type!=="custom"){var G=this._removedLayers[C];delete this._removedLayers[C],G.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(d,g){if(this._checkLoaded(),this._changed=!0,this._layers[d]){if(d!==g){var S=this._order.indexOf(d);this._order.splice(S,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,d),this._layerOrderChanged=!0)}}else this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(d){this._checkLoaded();var g=this._layers[d];if(g){g.setEventedParent(null);var S=this._order.indexOf(d);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[d]=g,delete this._layers[d],delete this._serializedLayers[d],delete this._updatedLayers[d],delete this._updatedPaintProps[d],g.onRemove&&g.onRemove(this.map)}else this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(d){return this._layers[d]},v.prototype.hasLayer=function(d){return d in this._layers},v.prototype.setLayerZoomRange=function(d,g,S){this._checkLoaded();var C=this.getLayer(d);C?C.minzoom===g&&C.maxzoom===S||(g!=null&&(C.minzoom=g),S!=null&&(C.maxzoom=S),this._updateLayer(C)):this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(d,g,S){S===void 0&&(S={}),this._checkLoaded();var C=this.getLayer(d);if(C){if(!_.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(_.validateStyle.filter,"layers."+C.id+".filter",g,null,S)||(C.filter=_.clone$1(g),this._updateLayer(C)))}else this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(d){return _.clone$1(this.getLayer(d).filter)},v.prototype.setLayoutProperty=function(d,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(d);R?_.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,C),this._updateLayer(R)):this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(d,g){var S=this.getLayer(d);if(S)return S.getLayoutProperty(g);this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(d,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(d);R?_.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,C)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[d]=!0):this.fire(new _.ErrorEvent(new Error("The layer '"+d+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(d,g){return this.getLayer(d).getPaintProperty(g)},v.prototype.setFeatureState=function(d,g){this._checkLoaded();var S=d.source,C=d.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var k=R.getSource().type;k==="geojson"&&C?this.fire(new _.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||C?(d.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(C,d.id,g)):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(d,g){this._checkLoaded();var S=d.source,C=this.sourceCaches[S];if(C!==void 0){var R=C.getSource().type,k=R==="vector"?d.sourceLayer:void 0;R!=="vector"||k?g&&typeof d.id!="string"&&typeof d.id!="number"?this.fire(new _.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(k,d.id,g):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(d){this._checkLoaded();var g=d.source,S=d.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||S)return d.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(S,d.id);this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return _.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return _.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:_.mapObject(this.sourceCaches,function(d){return d.serialize()}),layers:this._serializeLayers(this._order)},function(d){return d!==void 0})},v.prototype._updateLayer=function(d){this._updatedLayers[d.id]=!0,d.source&&!this._updatedSources[d.source]&&this.sourceCaches[d.source].getSource().type!=="raster"&&(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(d){for(var g=this,S=function(Gr){return g._layers[Gr].type==="fill-extrusion"},C={},R=[],k=this._order.length-1;k>=0;k--){var G=this._order[k];if(S(G)){C[G]=k;for(var J=0,_e=d;J<_e.length;J+=1){var be=_e[J][G];if(be)for(var Te=0,$e=be;Te<$e.length;Te+=1)R.push($e[Te])}}}R.sort(function(Gr,Zr){return Zr.intersectionZ-Gr.intersectionZ});for(var Ve=[],st=this._order.length-1;st>=0;st--){var Fe=this._order[st];if(S(Fe))for(var at=R.length-1;at>=0;at--){var bt=R[at].feature;if(C[bt.layer.id]<st)break;Ve.push(bt),R.pop()}else for(var Nt=0,nr=d;Nt<nr.length;Nt+=1){var qt=nr[Nt][Fe];if(qt)for(var fr=0,Er=qt;fr<Er.length;fr+=1)Ve.push(Er[fr].feature)}}return Ve},v.prototype.queryRenderedFeatures=function(d,g,S){g&&g.filter&&this._validate(_.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new _.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,k=g.layers;R<k.length;R+=1){var G=k[R],J=this._layers[G];if(!J)return this.fire(new _.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];C[J.source]=!0}}var _e=[];for(var be in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[be]||_e.push(wt(this.sourceCaches[be],this._layers,this._serializedLayers,d,g,S));return this.placement&&_e.push(function(Te,$e,Ve,st,Fe,at,bt){for(var Nt={},nr=at.queryRenderedSymbols(st),qt=[],fr=0,Er=Object.keys(nr).map(Number);fr<Er.length;fr+=1)qt.push(bt[Er[fr]]);qt.sort(hn);for(var Gr=function(){var Fn=vn[Zr],Bi=Fn.featureIndex.lookupSymbolFeatures(nr[Fn.bucketInstanceId],$e,Fn.bucketIndex,Fn.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Te);for(var bn in Bi){var ui=Nt[bn]=Nt[bn]||[],bi=Bi[bn];bi.sort(function(gi,Jn){var ei=Fn.featureSortOrder;if(ei){var uo=ei.indexOf(gi.featureIndex);return ei.indexOf(Jn.featureIndex)-uo}return Jn.featureIndex-gi.featureIndex});for(var ti=0,ii=bi;ti<ii.length;ti+=1)ui.push(ii[ti])}},Zr=0,vn=qt;Zr<vn.length;Zr+=1)Gr();var zn=function(Fn){Nt[Fn].forEach(function(Bi){var bn=Bi.feature,ui=Ve[Te[Fn].source].getFeatureState(bn.layer["source-layer"],bn.id);bn.source=bn.layer.source,bn.layer["source-layer"]&&(bn.sourceLayer=bn.layer["source-layer"]),bn.state=ui})};for(var Hn in Nt)zn(Hn);return Nt}(this._layers,this._serializedLayers,this.sourceCaches,d,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_e)},v.prototype.querySourceFeatures=function(d,g){g&&g.filter&&this._validate(_.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[d];return S?function(C,R){for(var k=C.getRenderableIds().map(function($e){return C.getTileByID($e)}),G=[],J={},_e=0;_e<k.length;_e++){var be=k[_e],Te=be.tileID.canonical.key;J[Te]||(J[Te]=!0,be.querySourceFeatures(G,R))}return G}(S,g):[]},v.prototype.addSourceType=function(d,g,S){return v.getSourceType(d)?S(new Error('A source type called "'+d+'" already exists.')):(v.setSourceType(d,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:d,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(d,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),C=!1;for(var R in d)if(!_.deepEqual(d[R],S[R])){C=!0;break}if(C){var k={now:_.browser.now(),transition:_.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(d,g),this.light.updateTransitions(k)}},v.prototype._validate=function(d,g,S,C,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Ou(this,d.call(_.validateStyle,_.extend({key:g,style:this.serialize(),value:S,styleSpec:_.styleSpec},C)))},v.prototype._remove=function(){for(var d in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[d].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(d){this.sourceCaches[d].clearTiles()},v.prototype._reloadSource=function(d){this.sourceCaches[d].resume(),this.sourceCaches[d].reload()},v.prototype._updateSources=function(d){for(var g in this.sourceCaches)this.sourceCaches[g].update(d)},v.prototype._generateCollisionBoxes=function(){for(var d in this.sourceCaches)this._reloadSource(d)},v.prototype._updatePlacement=function(d,g,S,C,R){R===void 0&&(R=!1);for(var k=!1,G=!1,J={},_e=0,be=this._order;_e<be.length;_e+=1){var Te=this._layers[be[_e]];if(Te.type==="symbol"){if(!J[Te.source]){var $e=this.sourceCaches[Te.source];J[Te.source]=$e.getRenderableIds(!0).map(function(bt){return $e.getTileByID(bt)}).sort(function(bt,Nt){return Nt.tileID.overscaledZ-bt.tileID.overscaledZ||(bt.tileID.isLessThan(Nt.tileID)?-1:1)})}var Ve=this.crossTileSymbolIndex.addLayer(Te,J[Te.source],d.center.lng);k=k||Ve}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.browser.now(),d.zoom))&&(this.pauseablePlacement=new Zc(d,this._order,R,g,S,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.browser.now()),G=!0),k&&this.pauseablePlacement.placement.setStale()),G||k)for(var st=0,Fe=this._order;st<Fe.length;st+=1){var at=this._layers[Fe[st]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,J[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var d in this.sourceCaches)this.sourceCaches[d].releaseSymbolFadeTiles()},v.prototype.getImages=function(d,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(d,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(d,g,S){return _.makeRequest(g,S)},v}(_.Evented);Is.getSourceType=function(h){return Tt[h]},Is.setSourceType=function(h,v){Tt[h]=v},Is.registerForPluginStateChange=_.registerForPluginStateChange;var $a=_.createLayout([{name:"a_pos",type:"Int16",components:2}]),Sl=On(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Qu=On(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Sf=On(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Wh=On(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Af=On("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ch=On(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),fh=On(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),hh=On("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Gh=On("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Xh=On("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Np=On(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),jc=On(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Du=On(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),$h=On(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Go=On(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Hl=On(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Al=On(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),js=On(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Tl=On(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),nu=On(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),mi=On(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Hs=On(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Lu=On(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ju=On(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ph=On(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Yh=On(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function On(h,v){var d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=C?C.concat(S):S,k={};return{fragmentSource:h=h.replace(d,function(G,J,_e,be,Te){return k[Te]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
varying `+_e+" "+be+" "+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`}),vertexSource:v=v.replace(d,function(G,J,_e,be,Te){var $e=be==="float"?"vec2":"vec4",Ve=Te.match(/color/)?"color":$e;return k[Te]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+_e+" "+$e+" a_"+Te+`;
varying `+_e+" "+be+" "+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = a_"+Te+`;
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+Te+" = unpack_mix_"+Ve+"(a_"+Te+", u_"+Te+`_t);
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+Te+`
uniform lowp float u_`+Te+`_t;
attribute `+_e+" "+$e+" a_"+Te+`;
#else
uniform `+_e+" "+be+" u_"+Te+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = a_"+Te+`;
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Te+`
    `+_e+" "+be+" "+Te+" = unpack_mix_"+Ve+"(a_"+Te+", u_"+Te+`_t);
#else
    `+_e+" "+be+" "+Te+" = u_"+Te+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var Ws=Object.freeze({__proto__:null,prelude:Sl,background:Qu,backgroundPattern:Sf,circle:Wh,clippingMask:Af,heatmap:ch,heatmapTexture:fh,collisionBox:hh,collisionCircle:Gh,debug:Xh,fill:Np,fillOutline:jc,fillOutlinePattern:Du,fillPattern:$h,fillExtrusion:Go,fillExtrusionPattern:Hl,hillshadePrepare:Al,hillshade:js,line:Tl,lineGradient:nu,linePattern:mi,lineSDF:Hs,raster:Lu,symbolIcon:Ju,symbolSDF:ph,symbolTextAndIcon:Yh}),cs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function du(h){for(var v=[],d=0;d<h.length;d++)if(h[d]!==null){var g=h[d].split(" ");v.push(g.pop())}return v}cs.prototype.bind=function(h,v,d,g,S,C,R,k){this.context=h;for(var G=this.boundPaintVertexBuffers.length!==g.length,J=0;!G&&J<g.length;J++)this.boundPaintVertexBuffers[J]!==g[J]&&(G=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===d&&!G&&this.boundIndexBuffer===S&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===k?(h.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),k&&k.bind()):this.freshBind(v,d,g,S,C,R,k)},cs.prototype.freshBind=function(h,v,d,g,S,C,R){var k,G=h.numAttributes,J=this.context,_e=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R;else{k=J.currentNumAttributes||0;for(var be=G;be<k;be++)_e.disableVertexAttribArray(be)}v.enableAttributes(_e,h);for(var Te=0,$e=d;Te<$e.length;Te+=1)$e[Te].enableAttributes(_e,h);C&&C.enableAttributes(_e,h),R&&R.enableAttributes(_e,h),v.bind(),v.setVertexAttribPointers(_e,h,S);for(var Ve=0,st=d;Ve<st.length;Ve+=1){var Fe=st[Ve];Fe.bind(),Fe.setVertexAttribPointers(_e,h,S)}C&&(C.bind(),C.setVertexAttribPointers(_e,h,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(_e,h,S)),J.currentNumAttributes=G},cs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Na=function(h,v,d,g,S,C){var R=h.gl;this.program=R.createProgram();for(var k=du(d.staticAttributes),G=g?g.getBinderAttributes():[],J=k.concat(G),_e=d.staticUniforms?du(d.staticUniforms):[],be=g?g.getBinderUniforms():[],Te=[],$e=0,Ve=_e.concat(be);$e<Ve.length;$e+=1){var st=Ve[$e];Te.indexOf(st)<0&&Te.push(st)}var Fe=g?g.defines():[];C&&Fe.push("#define OVERDRAW_INSPECTOR;");var at=Fe.concat(Sl.fragmentSource,d.fragmentSource).join(`
`),bt=Fe.concat(Sl.vertexSource,d.vertexSource).join(`
`),Nt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Nt,at),R.compileShader(Nt),R.attachShader(this.program,Nt);var nr=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(nr,bt),R.compileShader(nr),R.attachShader(this.program,nr),this.attributes={};var qt={};this.numAttributes=J.length;for(var fr=0;fr<this.numAttributes;fr++)J[fr]&&(R.bindAttribLocation(this.program,fr,J[fr]),this.attributes[J[fr]]=fr);R.linkProgram(this.program),R.deleteShader(nr),R.deleteShader(Nt);for(var Er=0;Er<Te.length;Er++){var Gr=Te[Er];if(Gr&&!qt[Gr]){var Zr=R.getUniformLocation(this.program,Gr);Zr&&(qt[Gr]=Zr)}}this.fixedUniforms=S(h,qt),this.binderUniforms=g?g.getUniforms(h,qt):[]}}};function Tf(h,v,d){var g=1/aa(d,1,v.transform.tileZoom),S=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,v.transform.tileZoom)/S,R=C*(d.tileID.canonical.x+d.tileID.wrap*S),k=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[R>>16,k>>16],u_pixel_coord_lower:[65535&R,65535&k]}}Na.prototype.draw=function(h,v,d,g,S,C,R,k,G,J,_e,be,Te,$e,Ve,st){var Fe,at=h.gl;if(!this.failedToCreate){for(var bt in h.program.set(this.program),h.setDepthMode(d),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(C),this.fixedUniforms)this.fixedUniforms[bt].set(R[bt]);$e&&$e.setUniforms(h,this.binderUniforms,be,{zoom:Te});for(var Nt=(Fe={},Fe[at.LINES]=2,Fe[at.TRIANGLES]=3,Fe[at.LINE_STRIP]=1,Fe)[v],nr=0,qt=_e.get();nr<qt.length;nr+=1){var fr=qt[nr],Er=fr.vaos||(fr.vaos={});(Er[k]||(Er[k]=new cs)).bind(h,this,G,$e?$e.getPaintVertexBuffers():[],J,fr.vertexOffset,Ve,st),at.drawElements(v,fr.primitiveLength*Nt,at.UNSIGNED_SHORT,fr.primitiveOffset*Nt*2)}}};var qh=function(h,v,d,g){var S=v.style.light,C=S.properties.get("position"),R=[C.x,C.y,C.z],k=_.create$1();S.properties.get("anchor")==="viewport"&&_.fromRotation(k,-v.transform.angle),_.transformMat3(R,R,k);var G=S.properties.get("color");return{u_matrix:h,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+d,u_opacity:g}},es=function(h,v,d,g,S,C,R){return _.extend(qh(h,v,d,g),Tf(C,v,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},wl=function(h){return{u_matrix:h}},Bu=function(h,v,d,g){return _.extend(wl(h),Tf(d,v,g))},el=function(h,v){return{u_matrix:h,u_world:v}},wf=function(h,v,d,g,S){return _.extend(Bu(h,v,d,g),{u_world:S})},Hc=function(h,v,d,g){var S,C,R=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var k=aa(d,1,R.zoom);S=!0,C=[k,k]}else S=!1,C=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,d,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:_.browser.devicePixelRatio,u_extrude_scale:C}},vu=function(h,v,d){var g=aa(d,1,v.zoom),S=Math.pow(2,v.zoom-d.tileID.overscaledZ),C=d.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:C}},Aa=function(h,v,d){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}},tl=function(h,v,d){return d===void 0&&(d=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:d}},Fu=function(h){return{u_matrix:h}},Kh=function(h,v,d,g){return{u_matrix:h,u_extrude_scale:aa(v,1,d),u_intensity:g}},Wc=function(h,v,d){var g=h.transform;return{u_matrix:mu(h,v,d),u_ratio:1/aa(v,1,g.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ma=function(h,v,d,g){return _.extend(Wc(h,v,d),{u_image:0,u_image_height:g})},dc=function(h,v,d,g){var S=h.transform,C=rl(v,S);return{u_matrix:mu(h,v,d),u_texsize:v.imageAtlasTexture.size,u_ratio:1/aa(v,1,S.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Gc=function(h,v,d,g,S){var C=h.lineAtlas,R=rl(v,h.transform),k=d.layout.get("line-cap")==="round",G=C.getDash(g.from,k),J=C.getDash(g.to,k),_e=G.width*S.fromScale,be=J.width*S.toScale;return _.extend(Wc(h,v,d),{u_patternscale_a:[R/_e,-G.height/2],u_patternscale_b:[R/be,-J.height/2],u_sdfgamma:C.width/(256*Math.min(_e,be)*_.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:J.y,u_mix:S.t})};function rl(h,v){return 1/aa(h,1,v.tileZoom)}function mu(h,v,d){return h.translatePosMatrix(v.tileID.posMatrix,v,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}var dh=function(h,v,d,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:d,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(C=S.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:vc(S.paint.get("raster-hue-rotate"))};var C,R};function vc(h){h*=Math.PI/180;var v=Math.sin(h),d=Math.cos(h);return[(2*d+1)/3,(-Math.sqrt(3)*v-d+1)/3,(Math.sqrt(3)*v-d+1)/3]}var nl,Cl=function(h,v,d,g,S,C,R,k,G,J){var _e=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_pitch:_e.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:_e.width/_e.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:R,u_coord_matrix:k,u_is_text:+G,u_pitch_with_map:+g,u_texsize:J,u_texture:0}},mc=function(h,v,d,g,S,C,R,k,G,J,_e){var be=S.transform;return _.extend(Cl(h,v,d,g,S,C,R,k,G,J),{u_gamma_scale:g?Math.cos(be._pitch)*be.cameraToCenterDistance:1,u_device_pixel_ratio:_.browser.devicePixelRatio,u_is_halo:+_e})},il=function(h,v,d,g,S,C,R,k,G,J){return _.extend(mc(h,v,d,g,S,C,R,k,!0,G,!0),{u_texsize_icon:J,u_texture_icon:1})},gc=function(h,v,d){return{u_matrix:h,u_opacity:v,u_color:d}},yc=function(h,v,d,g,S,C){return _.extend(function(R,k,G,J){var _e=G.imageManager.getPattern(R.from.toString()),be=G.imageManager.getPattern(R.to.toString()),Te=G.imageManager.getPixelSize(),$e=Te.width,Ve=Te.height,st=Math.pow(2,J.tileID.overscaledZ),Fe=J.tileSize*Math.pow(2,G.transform.tileZoom)/st,at=Fe*(J.tileID.canonical.x+J.tileID.wrap*st),bt=Fe*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:_e.tl,u_pattern_br_a:_e.br,u_pattern_tl_b:be.tl,u_pattern_br_b:be.br,u_texsize:[$e,Ve],u_mix:k.t,u_pattern_size_a:_e.displaySize,u_pattern_size_b:be.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/aa(J,1,G.transform.tileZoom),u_pixel_coord_upper:[at>>16,bt>>16],u_pixel_coord_lower:[65535&at,65535&bt]}}(g,C,d,S),{u_matrix:h,u_opacity:v})},vh={fillExtrusion:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_lightpos:new _.Uniform3f(h,v.u_lightpos),u_lightintensity:new _.Uniform1f(h,v.u_lightintensity),u_lightcolor:new _.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,v.u_vertical_gradient),u_opacity:new _.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_lightpos:new _.Uniform3f(h,v.u_lightpos),u_lightintensity:new _.Uniform1f(h,v.u_lightintensity),u_lightcolor:new _.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new _.Uniform1f(h,v.u_height_factor),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade),u_opacity:new _.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new _.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new _.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new _.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new _.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new _.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new _.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new _.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new _.UniformColor(h,v.u_color),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_overlay:new _.Uniform1i(h,v.u_overlay),u_overlay_scale:new _.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new _.Uniform1f(h,v.u_extrude_scale),u_intensity:new _.Uniform1f(h,v.u_intensity),u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world),u_image:new _.Uniform1i(h,v.u_image),u_color_ramp:new _.Uniform1i(h,v.u_color_ramp),u_opacity:new _.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_latrange:new _.Uniform2f(h,v.u_latrange),u_light:new _.Uniform2f(h,v.u_light),u_shadow:new _.UniformColor(h,v.u_shadow),u_highlight:new _.UniformColor(h,v.u_highlight),u_accent:new _.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_dimension:new _.Uniform2f(h,v.u_dimension),u_zoom:new _.Uniform1f(h,v.u_zoom),u_unpack:new _.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_image:new _.Uniform1i(h,v.u_image),u_image_height:new _.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_texsize:new _.Uniform2f(h,v.u_texsize),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_image:new _.Uniform1i(h,v.u_image),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new _.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new _.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new _.Uniform1f(h,v.u_sdfgamma),u_image:new _.Uniform1i(h,v.u_image),u_tex_y_a:new _.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new _.Uniform1f(h,v.u_tex_y_b),u_mix:new _.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new _.Uniform2f(h,v.u_tl_parent),u_scale_parent:new _.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new _.Uniform1f(h,v.u_buffer_scale),u_fade_t:new _.Uniform1f(h,v.u_fade_t),u_opacity:new _.Uniform1f(h,v.u_opacity),u_image0:new _.Uniform1i(h,v.u_image0),u_image1:new _.Uniform1i(h,v.u_image1),u_brightness_low:new _.Uniform1f(h,v.u_brightness_low),u_brightness_high:new _.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new _.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new _.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new _.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texture:new _.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texture:new _.Uniform1i(h,v.u_texture),u_gamma_scale:new _.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texsize_icon:new _.Uniform2f(h,v.u_texsize_icon),u_texture:new _.Uniform1i(h,v.u_texture),u_texture_icon:new _.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new _.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_opacity:new _.Uniform1f(h,v.u_opacity),u_color:new _.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_opacity:new _.Uniform1f(h,v.u_opacity),u_image:new _.Uniform1i(h,v.u_image),u_pattern_tl_a:new _.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new _.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new _.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new _.Uniform2f(h,v.u_pattern_br_b),u_texsize:new _.Uniform2f(h,v.u_texsize),u_mix:new _.Uniform1f(h,v.u_mix),u_pattern_size_a:new _.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new _.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new _.Uniform1f(h,v.u_scale_a),u_scale_b:new _.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new _.Uniform1f(h,v.u_tile_units_to_pixels)}}};function Rl(h,v,d,g,S,C,R){for(var k=h.context,G=k.gl,J=h.useProgram("collisionBox"),_e=[],be=0,Te=0,$e=0;$e<g.length;$e++){var Ve=g[$e],st=v.getTile(Ve),Fe=st.getBucket(d);if(Fe){var at=Ve.posMatrix;S[0]===0&&S[1]===0||(at=h.translatePosMatrix(Ve.posMatrix,st,S,C));var bt=R?Fe.textCollisionBox:Fe.iconCollisionBox,Nt=Fe.collisionCircleArray;if(Nt.length>0){var nr=_.create(),qt=at;_.mul(nr,Fe.placementInvProjMatrix,h.transform.glCoordMatrix),_.mul(nr,nr,Fe.placementViewportMatrix),_e.push({circleArray:Nt,circleOffset:Te,transform:qt,invTransform:nr}),Te=be+=Nt.length/4}bt&&J.draw(k,G.LINES,ee.disabled,Ee.disabled,h.colorModeForRenderPass(),et.disabled,vu(at,h.transform,st),d.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,h.transform.zoom,null,null,bt.collisionVertexBuffer)}}if(R&&_e.length){var fr=h.useProgram("collisionCircle"),Er=new _.StructArrayLayout2f1f2i16;Er.resize(4*be),Er._trim();for(var Gr=0,Zr=0,vn=_e;Zr<vn.length;Zr+=1)for(var zn=vn[Zr],Hn=0;Hn<zn.circleArray.length/4;Hn++){var Fn=4*Hn,Bi=zn.circleArray[Fn+0],bn=zn.circleArray[Fn+1],ui=zn.circleArray[Fn+2],bi=zn.circleArray[Fn+3];Er.emplace(Gr++,Bi,bn,ui,bi,0),Er.emplace(Gr++,Bi,bn,ui,bi,1),Er.emplace(Gr++,Bi,bn,ui,bi,2),Er.emplace(Gr++,Bi,bn,ui,bi,3)}(!nl||nl.length<2*be)&&(nl=function(qa){var $o=2*qa,lo=new _.StructArrayLayout3ui6;lo.resize($o),lo._trim();for(var Ta=0;Ta<$o;Ta++){var Ka=6*Ta;lo.uint16[Ka+0]=4*Ta+0,lo.uint16[Ka+1]=4*Ta+1,lo.uint16[Ka+2]=4*Ta+2,lo.uint16[Ka+3]=4*Ta+2,lo.uint16[Ka+4]=4*Ta+3,lo.uint16[Ka+5]=4*Ta+0}return lo}(be));for(var ti=k.createIndexBuffer(nl,!0),ii=k.createVertexBuffer(Er,_.collisionCircleLayout.members,!0),gi=0,Jn=_e;gi<Jn.length;gi+=1){var ei=Jn[gi],uo=Aa(ei.transform,ei.invTransform,h.transform);fr.draw(k,G.TRIANGLES,ee.disabled,Ee.disabled,h.colorModeForRenderPass(),et.disabled,uo,d.id,ii,ti,_.SegmentVector.simpleSegment(0,2*ei.circleOffset,ei.circleArray.length,ei.circleArray.length/2),null,h.transform.zoom,null,null,null)}ii.destroy(),ti.destroy()}}var gu=_.identity(new Float32Array(16));function Xc(h,v,d,g,S,C){var R=_.getAnchorAlignment(h),k=-(R.horizontalAlign-.5)*v,G=-(R.verticalAlign-.5)*d,J=_.evaluateVariableOffset(h,g);return new _.Point((k/S+J[0])*C,(G/S+J[1])*C)}function mh(h,v,d,g,S,C,R,k,G,J,_e){var be=h.text.placedSymbolArray,Te=h.text.dynamicLayoutVertexArray,$e=h.icon.dynamicLayoutVertexArray,Ve={};Te.clear();for(var st=0;st<be.length;st++){var Fe=be.get(st),at=Fe.hidden||!Fe.crossTileID||h.allowVerticalPlacement&&!Fe.placedOrientation?null:g[Fe.crossTileID];if(at){var bt=new _.Point(Fe.anchorX,Fe.anchorY),Nt=_i(bt,d?k:R),nr=Ti(C.cameraToCenterDistance,Nt.signedDistanceFromCamera),qt=S.evaluateSizeForFeature(h.textSizeData,J,Fe)*nr/_.ONE_EM;d&&(qt*=h.tilePixelRatio/G);for(var fr=Xc(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,qt),Er=d?_i(bt.add(fr),R).point:Nt.point.add(v?fr.rotate(-C.angle):fr),Gr=h.allowVerticalPlacement&&Fe.placedOrientation===_.WritingMode.vertical?Math.PI/2:0,Zr=0;Zr<Fe.numGlyphs;Zr++)_.addDynamicAttributes(Te,Er,Gr);_e&&Fe.associatedIconIndex>=0&&(Ve[Fe.associatedIconIndex]={shiftedAnchor:Er,angle:Gr})}else fi(Fe.numGlyphs,Te)}if(_e){$e.clear();for(var vn=h.icon.placedSymbolArray,zn=0;zn<vn.length;zn++){var Hn=vn.get(zn);if(Hn.hidden)fi(Hn.numGlyphs,$e);else{var Fn=Ve[zn];if(Fn)for(var Bi=0;Bi<Hn.numGlyphs;Bi++)_.addDynamicAttributes($e,Fn.shiftedAnchor,Fn.angle);else fi(Hn.numGlyphs,$e)}}h.icon.dynamicLayoutVertexBuffer.updateData($e)}h.text.dynamicLayoutVertexBuffer.updateData(Te)}function $c(h,v,d){return d.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function yu(h,v,d,g,S,C,R,k,G,J,_e,be){for(var Te=h.context,$e=Te.gl,Ve=h.transform,st=k==="map",Fe=G==="map",at=st&&d.layout.get("symbol-placement")!=="point",bt=st&&!Fe&&!at,Nt=d.layout.get("symbol-sort-key").constantOr(1)!==void 0,nr=!1,qt=h.depthModeForSublayer(0,ee.ReadOnly),fr=d.layout.get("text-variable-anchor"),Er=[],Gr=0,Zr=g;Gr<Zr.length;Gr+=1){var vn=Zr[Gr],zn=v.getTile(vn),Hn=zn.getBucket(d);if(Hn){var Fn=S?Hn.text:Hn.icon;if(Fn&&Fn.segments.get().length){var Bi=Fn.programConfigurations.get(d.id),bn=S||Hn.sdfIcons,ui=S?Hn.textSizeData:Hn.iconSizeData,bi=Fe||Ve.pitch!==0,ti=h.useProgram($c(bn,S,Hn),Bi),ii=_.evaluateSizeForZoom(ui,Ve.zoom),gi=void 0,Jn=[0,0],ei=void 0,uo=void 0,qa=null,$o=void 0;if(S)ei=zn.glyphAtlasTexture,uo=$e.LINEAR,gi=zn.glyphAtlasTexture.size,Hn.iconsInText&&(Jn=zn.imageAtlasTexture.size,qa=zn.imageAtlasTexture,$o=bi||h.options.rotating||h.options.zooming||ui.kind==="composite"||ui.kind==="camera"?$e.LINEAR:$e.NEAREST);else{var lo=d.layout.get("icon-size").constantOr(0)!==1||Hn.iconsNeedLinear;ei=zn.imageAtlasTexture,uo=bn||h.options.rotating||h.options.zooming||lo||bi?$e.LINEAR:$e.NEAREST,gi=zn.imageAtlasTexture.size}var Ta=aa(zn,1,h.transform.zoom),Ka=xa(vn.posMatrix,Fe,st,h.transform,Ta),Ss=Pi(vn.posMatrix,Fe,st,h.transform,Ta),ts=fr&&Hn.hasTextData(),fl=d.layout.get("icon-text-fit")!=="none"&&ts&&Hn.hasIconData();at&&Vs(Hn,vn.posMatrix,h,S,Ka,Ss,Fe,J);var As=h.translatePosMatrix(vn.posMatrix,zn,C,R),ou=at||S&&fr||fl?gu:Ka,ks=h.translatePosMatrix(Ss,zn,C,R,!0),Rc=bn&&d.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ql={program:ti,buffers:Fn,uniformValues:bn?Hn.iconsInText?il(ui.kind,ii,bt,Fe,h,As,ou,ks,gi,Jn):mc(ui.kind,ii,bt,Fe,h,As,ou,ks,S,gi,!0):Cl(ui.kind,ii,bt,Fe,h,As,ou,ks,S,gi),atlasTexture:ei,atlasTextureIcon:qa,atlasInterpolation:uo,atlasInterpolationIcon:$o,isSDF:bn,hasHalo:Rc};if(Nt&&Hn.canOverlap){nr=!0;for(var qs=0,hl=Fn.segments.get();qs<hl.length;qs+=1){var kl=hl[qs];Er.push({segments:new _.SegmentVector([kl]),sortKey:kl.sortKey,state:ql})}}else Er.push({segments:Fn.segments,sortKey:0,state:ql})}}}nr&&Er.sort(function(su,Eu){return su.sortKey-Eu.sortKey});for(var bu=0,pl=Er;bu<pl.length;bu+=1){var Lo=pl[bu],ka=Lo.state;if(Te.activeTexture.set($e.TEXTURE0),ka.atlasTexture.bind(ka.atlasInterpolation,$e.CLAMP_TO_EDGE),ka.atlasTextureIcon&&(Te.activeTexture.set($e.TEXTURE1),ka.atlasTextureIcon&&ka.atlasTextureIcon.bind(ka.atlasInterpolationIcon,$e.CLAMP_TO_EDGE)),ka.isSDF){var Ds=ka.uniformValues;ka.hasHalo&&(Ds.u_is_halo=1,Nu(ka.buffers,Lo.segments,d,h,ka.program,qt,_e,be,Ds)),Ds.u_is_halo=0}Nu(ka.buffers,Lo.segments,d,h,ka.program,qt,_e,be,ka.uniformValues)}}function Nu(h,v,d,g,S,C,R,k,G){var J=g.context;S.draw(J,J.gl.TRIANGLES,C,R,k,et.disabled,G,d.id,h.layoutVertexBuffer,h.indexBuffer,v,d.paint,g.transform.zoom,h.programConfigurations.get(d.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function _c(h,v,d,g,S,C,R){var k,G,J,_e,be,Te=h.context.gl,$e=d.paint.get("fill-pattern"),Ve=$e&&$e.constantOr(1),st=d.getCrossfadeParameters();R?(G=Ve&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=Te.LINES):(G=Ve?"fillPattern":"fill",k=Te.TRIANGLES);for(var Fe=0,at=g;Fe<at.length;Fe+=1){var bt=at[Fe],Nt=v.getTile(bt);if(!Ve||Nt.patternsLoaded()){var nr=Nt.getBucket(d);if(nr){var qt=nr.programConfigurations.get(d.id),fr=h.useProgram(G,qt);Ve&&(h.context.activeTexture.set(Te.TEXTURE0),Nt.imageAtlasTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),qt.updatePaintBuffers(st));var Er=$e.constantOr(null);if(Er&&Nt.imageAtlas){var Gr=Nt.imageAtlas,Zr=Gr.patternPositions[Er.to.toString()],vn=Gr.patternPositions[Er.from.toString()];Zr&&vn&&qt.setConstantPatternPositions(Zr,vn)}var zn=h.translatePosMatrix(bt.posMatrix,Nt,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(R){_e=nr.indexBuffer2,be=nr.segments2;var Hn=[Te.drawingBufferWidth,Te.drawingBufferHeight];J=G==="fillOutlinePattern"&&Ve?wf(zn,h,st,Nt,Hn):el(zn,Hn)}else _e=nr.indexBuffer,be=nr.segments,J=Ve?Bu(zn,h,st,Nt):wl(zn);fr.draw(h.context,k,S,h.stencilModeForClipping(bt),C,et.disabled,J,d.id,nr.layoutVertexBuffer,_e,be,d.paint,h.transform.zoom,qt)}}}}function xc(h,v,d,g,S,C,R){for(var k=h.context,G=k.gl,J=d.paint.get("fill-extrusion-pattern"),_e=J.constantOr(1),be=d.getCrossfadeParameters(),Te=d.paint.get("fill-extrusion-opacity"),$e=0,Ve=g;$e<Ve.length;$e+=1){var st=Ve[$e],Fe=v.getTile(st),at=Fe.getBucket(d);if(at){var bt=at.programConfigurations.get(d.id),Nt=h.useProgram(_e?"fillExtrusionPattern":"fillExtrusion",bt);_e&&(h.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),bt.updatePaintBuffers(be));var nr=J.constantOr(null);if(nr&&Fe.imageAtlas){var qt=Fe.imageAtlas,fr=qt.patternPositions[nr.to.toString()],Er=qt.patternPositions[nr.from.toString()];fr&&Er&&bt.setConstantPatternPositions(fr,Er)}var Gr=h.translatePosMatrix(st.posMatrix,Fe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Zr=d.paint.get("fill-extrusion-vertical-gradient"),vn=_e?es(Gr,h,Zr,Te,st,be,Fe):qh(Gr,h,Zr,Te);Nt.draw(k,k.gl.TRIANGLES,S,C,R,et.backCCW,vn,d.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,d.paint,h.transform.zoom,bt)}}}function Wl(h,v,d,g,S,C){var R=h.context,k=R.gl,G=v.fbo;if(G){var J=h.useProgram("hillshade");R.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,G.colorAttachment.get());var _e=function(be,Te,$e){var Ve=$e.paint.get("hillshade-shadow-color"),st=$e.paint.get("hillshade-highlight-color"),Fe=$e.paint.get("hillshade-accent-color"),at=$e.paint.get("hillshade-illumination-direction")*(Math.PI/180);$e.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=be.transform.angle);var bt,Nt,nr,qt=!be.options.moving;return{u_matrix:be.transform.calculatePosMatrix(Te.tileID.toUnwrapped(),qt),u_image:0,u_latrange:(bt=Te.tileID,Nt=Math.pow(2,bt.canonical.z),nr=bt.canonical.y,[new _.MercatorCoordinate(0,nr/Nt).toLngLat().lat,new _.MercatorCoordinate(0,(nr+1)/Nt).toLngLat().lat]),u_light:[$e.paint.get("hillshade-exaggeration"),at],u_shadow:Ve,u_highlight:st,u_accent:Fe}}(h,v,d);J.draw(R,k.TRIANGLES,g,S,C,et.disabled,_e,d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function Qh(h,v,d,g,S,C){var R=h.context,k=R.gl,G=v.dem;if(G&&G.data){var J=G.dim,_e=G.stride,be=G.getPixels();if(R.activeTexture.set(k.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(_e),v.demTexture){var Te=v.demTexture;Te.update(be,{premultiply:!1}),Te.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else v.demTexture=new _.Texture(R,be,k.RGBA,{premultiply:!1}),v.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);R.activeTexture.set(k.TEXTURE0);var $e=v.fbo;if(!$e){var Ve=new _.Texture(R,{width:J,height:J,data:null},k.RGBA);Ve.bind(k.LINEAR,k.CLAMP_TO_EDGE),($e=v.fbo=R.createFramebuffer(J,J,!0)).colorAttachment.set(Ve.texture)}R.bindFramebuffer.set($e.framebuffer),R.viewport.set([0,0,J,J]),h.useProgram("hillshadePrepare").draw(R,k.TRIANGLES,g,S,C,et.disabled,function(st,Fe){var at=Fe.stride,bt=_.create();return _.ortho(bt,0,_.EXTENT,-_.EXTENT,0,0,1),_.translate(bt,bt,[0,-_.EXTENT,0]),{u_matrix:bt,u_image:1,u_dimension:[at,at],u_zoom:st.overscaledZ,u_unpack:Fe.getUnpackVector()}}(v.tileID,G),d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function bc(h,v,d,g,S){var C=g.paint.get("raster-fade-duration");if(C>0){var R=_.browser.now(),k=(R-h.timeAdded)/C,G=v?(R-v.timeAdded)/C:-1,J=d.getSource(),_e=S.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),be=!v||Math.abs(v.tileID.overscaledZ-_e)>Math.abs(h.tileID.overscaledZ-_e),Te=be&&h.refreshedUponExpiration?1:_.clamp(be?k:1-G,0,1);return h.refreshedUponExpiration&&k>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Te}:{opacity:Te,mix:0}}return{opacity:1,mix:0}}var Jh=new _.Color(1,0,0,1),Cf=new _.Color(0,1,0,1),ep=new _.Color(0,0,1,1),Rf=new _.Color(1,0,1,1),Ya=new _.Color(0,1,1,1);function Mf(h,v,d,g){Ec(h,0,v+d/2,h.transform.width,d,g)}function tp(h,v,d,g){Ec(h,v-d/2,0,d,h.transform.height,g)}function Ec(h,v,d,g,S,C){var R=h.context,k=R.gl;k.enable(k.SCISSOR_TEST),k.scissor(v*_.browser.devicePixelRatio,d*_.browser.devicePixelRatio,g*_.browser.devicePixelRatio,S*_.browser.devicePixelRatio),R.clear({color:C}),k.disable(k.SCISSOR_TEST)}function gh(h,v,d){var g=h.context,S=g.gl,C=d.posMatrix,R=h.useProgram("debug"),k=ee.disabled,G=Ee.disabled,J=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,k,G,J,et.disabled,tl(C,_.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var _e=v.getTileByID(d.key).latestRawTileData,be=Math.floor((_e&&_e.byteLength||0)/1024),Te=v.getTile(d).tileSize,$e=512/Math.min(Te,512)*(d.overscaledZ/h.transform.zoom)*.5,Ve=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ve+=" => "+d.overscaledZ),function(st,Fe){st.initDebugOverlayCanvas();var at=st.debugOverlayCanvas,bt=st.context.gl,Nt=st.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,at.width,at.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Fe,5,5),Nt.strokeText(Fe,5,5),st.debugOverlayTexture.update(at),st.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(h,Ve+" "+be+"kb"),R.draw(g,S.TRIANGLES,k,G,Ue.alphaBlended,et.disabled,tl(C,_.Color.transparent,$e),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var Gl={symbol:function(h,v,d,g,S){if(h.renderPass==="translucent"){var C=Ee.disabled,R=h.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(k,G,J,_e,be,Te,$e){for(var Ve=G.transform,st=be==="map",Fe=Te==="map",at=0,bt=k;at<bt.length;at+=1){var Nt=bt[at],nr=_e.getTile(Nt),qt=nr.getBucket(J);if(qt&&qt.text&&qt.text.segments.get().length){var fr=_.evaluateSizeForZoom(qt.textSizeData,Ve.zoom),Er=aa(nr,1,G.transform.zoom),Gr=xa(Nt.posMatrix,Fe,st,G.transform,Er),Zr=J.layout.get("icon-text-fit")!=="none"&&qt.hasIconData();if(fr){var vn=Math.pow(2,Ve.zoom-nr.tileID.overscaledZ);mh(qt,st,Fe,$e,_.symbolSize,Ve,Gr,Nt.posMatrix,vn,fr,Zr)}}}}(g,h,d,v,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),S),d.paint.get("icon-opacity").constantOr(1)!==0&&yu(h,v,d,g,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),C,R),d.paint.get("text-opacity").constantOr(1)!==0&&yu(h,v,d,g,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),C,R),v.map.showCollisionBoxes&&(Rl(h,v,d,g,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Rl(h,v,d,g,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,d,g){if(h.renderPass==="translucent"){var S=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),R=d.paint.get("circle-stroke-opacity"),k=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||C.constantOr(1)!==0&&R.constantOr(1)!==0){for(var G=h.context,J=G.gl,_e=h.depthModeForSublayer(0,ee.ReadOnly),be=Ee.disabled,Te=h.colorModeForRenderPass(),$e=[],Ve=0;Ve<g.length;Ve++){var st=g[Ve],Fe=v.getTile(st),at=Fe.getBucket(d);if(at){var bt=at.programConfigurations.get(d.id),Nt={programConfiguration:bt,program:h.useProgram("circle",bt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:Hc(h,st,Fe,d)};if(k)for(var nr=0,qt=at.segments.get();nr<qt.length;nr+=1){var fr=qt[nr];$e.push({segments:new _.SegmentVector([fr]),sortKey:fr.sortKey,state:Nt})}else $e.push({segments:at.segments,sortKey:0,state:Nt})}}k&&$e.sort(function(zn,Hn){return zn.sortKey-Hn.sortKey});for(var Er=0,Gr=$e;Er<Gr.length;Er+=1){var Zr=Gr[Er],vn=Zr.state;vn.program.draw(G,J.TRIANGLES,_e,be,Te,et.disabled,vn.uniformValues,d.id,vn.layoutVertexBuffer,vn.indexBuffer,Zr.segments,d.paint,h.transform.zoom,vn.programConfiguration)}}}},heatmap:function(h,v,d,g){if(d.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,C=S.gl,R=Ee.disabled,k=new Ue([C.ONE,C.ONE],_.Color.transparent,[!0,!0,!0,!0]);(function($e,Ve,st){var Fe=$e.gl;$e.activeTexture.set(Fe.TEXTURE1),$e.viewport.set([0,0,Ve.width/4,Ve.height/4]);var at=st.heatmapFbo;if(at)Fe.bindTexture(Fe.TEXTURE_2D,at.colorAttachment.get()),$e.bindFramebuffer.set(at.framebuffer);else{var bt=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,bt),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),at=st.heatmapFbo=$e.createFramebuffer(Ve.width/4,Ve.height/4,!1),function(Nt,nr,qt,fr){var Er=Nt.gl;Er.texImage2D(Er.TEXTURE_2D,0,Er.RGBA,nr.width/4,nr.height/4,0,Er.RGBA,Nt.extRenderToTextureHalfFloat?Nt.extTextureHalfFloat.HALF_FLOAT_OES:Er.UNSIGNED_BYTE,null),fr.colorAttachment.set(qt)}($e,Ve,bt,at)}})(S,h,d),S.clear({color:_.Color.transparent});for(var G=0;G<g.length;G++){var J=g[G];if(!v.hasRenderableParent(J)){var _e=v.getTile(J),be=_e.getBucket(d);if(be){var Te=be.programConfigurations.get(d.id);h.useProgram("heatmap",Te).draw(S,C.TRIANGLES,ee.disabled,R,k,et.disabled,Kh(J.posMatrix,_e,h.transform.zoom,d.paint.get("heatmap-intensity")),d.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,d.paint,h.transform.zoom,Te)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function($e,Ve){var st=$e.context,Fe=st.gl,at=Ve.heatmapFbo;if(at){st.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,at.colorAttachment.get()),st.activeTexture.set(Fe.TEXTURE1);var bt=Ve.colorRampTexture;bt||(bt=Ve.colorRampTexture=new _.Texture(st,Ve.colorRamp,Fe.RGBA)),bt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),$e.useProgram("heatmapTexture").draw(st,Fe.TRIANGLES,ee.disabled,Ee.disabled,$e.colorModeForRenderPass(),et.disabled,function(Nt,nr,qt,fr){var Er=_.create();_.ortho(Er,0,Nt.width,Nt.height,0,0,1);var Gr=Nt.context.gl;return{u_matrix:Er,u_world:[Gr.drawingBufferWidth,Gr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:nr.paint.get("heatmap-opacity")}}($e,Ve),Ve.id,$e.viewportBuffer,$e.quadTriangleIndexBuffer,$e.viewportSegments,Ve.paint,$e.transform.zoom)}}(h,d))},line:function(h,v,d,g){if(h.renderPass==="translucent"){var S=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(S.constantOr(1)!==0&&C.constantOr(1)!==0)for(var R=h.depthModeForSublayer(0,ee.ReadOnly),k=h.colorModeForRenderPass(),G=d.paint.get("line-dasharray"),J=d.paint.get("line-pattern"),_e=J.constantOr(1),be=d.paint.get("line-gradient"),Te=d.getCrossfadeParameters(),$e=_e?"linePattern":G?"lineSDF":be?"lineGradient":"line",Ve=h.context,st=Ve.gl,Fe=!0,at=0,bt=g;at<bt.length;at+=1){var Nt=bt[at],nr=v.getTile(Nt);if(!_e||nr.patternsLoaded()){var qt=nr.getBucket(d);if(qt){var fr=qt.programConfigurations.get(d.id),Er=h.context.program.get(),Gr=h.useProgram($e,fr),Zr=Fe||Gr.program!==Er,vn=J.constantOr(null);if(vn&&nr.imageAtlas){var zn=nr.imageAtlas,Hn=zn.patternPositions[vn.to.toString()],Fn=zn.patternPositions[vn.from.toString()];Hn&&Fn&&fr.setConstantPatternPositions(Hn,Fn)}var Bi=_e?dc(h,nr,d,Te):G?Gc(h,nr,d,G,Te):be?ma(h,nr,d,qt.lineClipsArray.length):Wc(h,nr,d);if(_e)Ve.activeTexture.set(st.TEXTURE0),nr.imageAtlasTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE),fr.updatePaintBuffers(Te);else if(G&&(Zr||h.lineAtlas.dirty))Ve.activeTexture.set(st.TEXTURE0),h.lineAtlas.bind(Ve);else if(be){var bn=qt.gradients[d.id],ui=bn.texture;if(d.gradientVersion!==bn.version){var bi=256;if(d.stepInterpolant){var ti=v.getSource().maxzoom,ii=Nt.canonical.z===ti?Math.ceil(1<<h.transform.maxZoom-Nt.canonical.z):1;bi=_.clamp(_.nextPowerOfTwo(qt.maxLineLength/_.EXTENT*1024*ii),256,Ve.maxTextureSize)}bn.gradient=_.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:bn.gradient||void 0,clips:qt.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new _.Texture(Ve,bn.gradient,st.RGBA),bn.version=d.gradientVersion,ui=bn.texture}Ve.activeTexture.set(st.TEXTURE0),ui.bind(d.stepInterpolant?st.NEAREST:st.LINEAR,st.CLAMP_TO_EDGE)}Gr.draw(Ve,st.TRIANGLES,R,h.stencilModeForClipping(Nt),k,et.disabled,Bi,d.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,d.paint,h.transform.zoom,fr,qt.layoutVertexBuffer2),Fe=!1}}}}},fill:function(h,v,d,g){var S=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(C.constantOr(1)!==0){var R=h.colorModeForRenderPass(),k=d.paint.get("fill-pattern"),G=h.opaquePassEnabledForLayer()&&!k.constantOr(1)&&S.constantOr(_.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===G){var J=h.depthModeForSublayer(1,h.renderPass==="opaque"?ee.ReadWrite:ee.ReadOnly);_c(h,v,d,g,J,R,!1)}if(h.renderPass==="translucent"&&d.paint.get("fill-antialias")){var _e=h.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ee.ReadOnly);_c(h,v,d,g,_e,R,!0)}}},"fill-extrusion":function(h,v,d,g){var S=d.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var C=new ee(h.context.gl.LEQUAL,ee.ReadWrite,h.depthRangeFor3D);if(S!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))xc(h,v,d,g,C,Ee.disabled,Ue.disabled),xc(h,v,d,g,C,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var R=h.colorModeForRenderPass();xc(h,v,d,g,C,Ee.disabled,R)}}},hillshade:function(h,v,d,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,C=h.depthModeForSublayer(0,ee.ReadOnly),R=h.colorModeForRenderPass(),k=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],G=k[0],J=0,_e=k[1];J<_e.length;J+=1){var be=_e[J],Te=v.getTile(be);Te.needsHillshadePrepare&&h.renderPass==="offscreen"?Qh(h,Te,d,C,Ee.disabled,R):h.renderPass==="translucent"&&Wl(h,Te,d,C,G[be.overscaledZ],R)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,d,g){if(h.renderPass==="translucent"&&d.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,C=S.gl,R=v.getSource(),k=h.useProgram("raster"),G=h.colorModeForRenderPass(),J=R instanceof Ye?[{},g]:h.stencilConfigForOverlap(g),_e=J[0],be=J[1],Te=be[be.length-1].overscaledZ,$e=!h.options.moving,Ve=0,st=be;Ve<st.length;Ve+=1){var Fe=st[Ve],at=h.depthModeForSublayer(Fe.overscaledZ-Te,d.paint.get("raster-opacity")===1?ee.ReadWrite:ee.ReadOnly,C.LESS),bt=v.getTile(Fe),Nt=h.transform.calculatePosMatrix(Fe.toUnwrapped(),$e);bt.registerFadeDuration(d.paint.get("raster-fade-duration"));var nr=v.findLoadedParent(Fe,0),qt=bc(bt,nr,v,d,h.transform),fr=void 0,Er=void 0,Gr=d.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;S.activeTexture.set(C.TEXTURE0),bt.texture.bind(Gr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(C.TEXTURE1),nr?(nr.texture.bind(Gr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),fr=Math.pow(2,nr.tileID.overscaledZ-bt.tileID.overscaledZ),Er=[bt.tileID.canonical.x*fr%1,bt.tileID.canonical.y*fr%1]):bt.texture.bind(Gr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Zr=dh(Nt,Er||[0,0],fr||1,qt,d);R instanceof Ye?k.draw(S,C.TRIANGLES,at,Ee.disabled,G,et.disabled,Zr,d.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):k.draw(S,C.TRIANGLES,at,_e[Fe.overscaledZ],G,et.disabled,Zr,d.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,d){var g=d.paint.get("background-color"),S=d.paint.get("background-opacity");if(S!==0){var C=h.context,R=C.gl,k=h.transform,G=k.tileSize,J=d.paint.get("background-pattern");if(!h.isPatternMissing(J)){var _e=!J&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===_e){var be=Ee.disabled,Te=h.depthModeForSublayer(0,_e==="opaque"?ee.ReadWrite:ee.ReadOnly),$e=h.colorModeForRenderPass(),Ve=h.useProgram(J?"backgroundPattern":"background"),st=k.coveringTiles({tileSize:G});J&&(C.activeTexture.set(R.TEXTURE0),h.imageManager.bind(h.context));for(var Fe=d.getCrossfadeParameters(),at=0,bt=st;at<bt.length;at+=1){var Nt=bt[at],nr=h.transform.calculatePosMatrix(Nt.toUnwrapped()),qt=J?yc(nr,S,h,J,{tileID:Nt,tileSize:G},Fe):gc(nr,S,g);Ve.draw(C,R.TRIANGLES,Te,be,$e,et.disabled,qt,d.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,d){for(var g=0;g<d.length;g++)gh(h,v,d[g])},custom:function(h,v,d){var g=h.context,S=d.implementation;if(h.renderPass==="offscreen"){var C=S.prerender;C&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),C.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Ee.disabled);var R=S.renderingMode==="3d"?new ee(h.context.gl.LEQUAL,ee.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ee.ReadOnly);g.setDepthMode(R),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},oa=function(h,v){this.context=new he(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=Q.maxUnderzooming+Q.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new El,this.gpuTimers={}};oa.prototype.resize=function(h,v){if(this.width=h*_.browser.devicePixelRatio,this.height=v*_.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var d=0,g=this.style._order;d<g.length;d+=1)this.style._layers[g[d]].resize()},oa.prototype.setup=function(){var h=this.context,v=new _.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(_.EXTENT,0),v.emplaceBack(0,_.EXTENT),v.emplaceBack(_.EXTENT,_.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,$a.members),this.tileExtentSegments=_.SegmentVector.simpleSegment(0,0,4,2);var d=new _.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(_.EXTENT,0),d.emplaceBack(0,_.EXTENT),d.emplaceBack(_.EXTENT,_.EXTENT),this.debugBuffer=h.createVertexBuffer(d,$a.members),this.debugSegments=_.SegmentVector.simpleSegment(0,0,4,5);var g=new _.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(_.EXTENT,0,_.EXTENT,0),g.emplaceBack(0,_.EXTENT,0,_.EXTENT),g.emplaceBack(_.EXTENT,_.EXTENT,_.EXTENT,_.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,pt.members),this.rasterBoundsSegments=_.SegmentVector.simpleSegment(0,0,4,2);var S=new _.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,$a.members),this.viewportSegments=_.SegmentVector.simpleSegment(0,0,4,2);var C=new _.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(C);var R=new _.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R),this.emptyTexture=new _.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Ee({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},oa.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var d=_.create();_.ortho(d,0,this.width,this.height,0,0,1),_.scale(d,d,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,ee.disabled,this.stencilClearMode,Ue.disabled,et.disabled,Fu(d),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},oa.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var d=this.context,g=d.gl;this.nextStencilID+v.length>256&&this.clearStencil(),d.setColorMode(Ue.disabled),d.setDepthMode(ee.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,R=v;C<R.length;C+=1){var k=R[C],G=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;S.draw(d,g.TRIANGLES,ee.disabled,new Ee({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),Ue.disabled,et.disabled,Fu(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},oa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new Ee({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},oa.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new Ee({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},oa.prototype.stencilConfigForOverlap=function(h){var v,d=this.context.gl,g=h.sort(function(G,J){return J.overscaledZ-G.overscaledZ}),S=g[g.length-1].overscaledZ,C=g[0].overscaledZ-S+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var R={},k=0;k<C;k++)R[k+S]=new Ee({func:d.GEQUAL,mask:255},k+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[R,g]}return[(v={},v[S]=Ee.disabled,v),g]},oa.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Ue([h.CONSTANT_COLOR,h.ONE],new _.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ue.unblended:Ue.alphaBlended},oa.prototype.depthModeForSublayer=function(h,v,d){if(!this.opaquePassEnabledForLayer())return ee.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ee(d||this.context.gl.LEQUAL,v,[g,g])},oa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},oa.prototype.render=function(h,v){var d=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(_.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var C in S){var R=S[C];R.used&&R.prepare(this.context)}var k,G,J={},_e={},be={};for(var Te in S){var $e=S[Te];J[Te]=$e.getVisibleCoordinates(),_e[Te]=J[Te].slice().reverse(),be[Te]=$e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ve=0;Ve<g.length;Ve++)if(this.style._layers[g[Ve]].is3D()){this.opaquePassCutoff=Ve;break}this.renderPass="offscreen";for(var st=0,Fe=g;st<Fe.length;st+=1){var at=this.style._layers[Fe[st]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var bt=_e[at.source];(at.type==="custom"||bt.length)&&this.renderLayer(this,S[at.source],at,bt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?_.Color.black:_.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Nt=this.style._layers[g[this.currentLayer]],nr=S[Nt.source],qt=J[Nt.source];this._renderTileClippingMasks(Nt,qt),this.renderLayer(this,nr,Nt,qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var fr=this.style._layers[g[this.currentLayer]],Er=S[fr.source],Gr=(fr.type==="symbol"?be:_e)[fr.source];this._renderTileClippingMasks(fr,J[fr.source]),this.renderLayer(this,Er,fr,Gr)}this.options.showTileBoundaries&&(_.values(this.style._layers).forEach(function(Zr){Zr.source&&!Zr.isHidden(d.transform.zoom)&&(Zr.source!==(G&&G.id)&&(G=d.style.sourceCaches[Zr.source]),(!k||k.getSource().maxzoom<G.getSource().maxzoom)&&(k=G))}),k&&Gl.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(Zr){var vn=Zr.transform.padding;Mf(Zr,Zr.transform.height-(vn.top||0),3,Jh),Mf(Zr,vn.bottom||0,3,Cf),tp(Zr,vn.left||0,3,ep),tp(Zr,Zr.transform.width-(vn.right||0),3,Rf);var zn=Zr.transform.centerPoint;(function(Hn,Fn,Bi,bn){Ec(Hn,Fn-1,Bi-10,2,20,bn),Ec(Hn,Fn-10,Bi-1,20,2,bn)})(Zr,zn.x,Zr.transform.height-zn.y,Ya)}(this),this.context.setDefault()},oa.prototype.renderLayer=function(h,v,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||g.length)&&(this.id=d.id,this.gpuTimingStart(d),Gl[d.type](h,v,d,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},oa.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,d=this.gpuTimers[h.id];d||(d=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),d.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,d.query)}},oa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},oa.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},oa.prototype.queryGpuTimers=function(h){var v={};for(var d in h){var g=h[d],S=this.context.extTimerQuery,C=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[d]=C}return v},oa.prototype.translatePosMatrix=function(h,v,d,g,S){if(!d[0]&&!d[1])return h;var C=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var R=Math.sin(C),k=Math.cos(C);d=[d[0]*k-d[1]*R,d[0]*R+d[1]*k]}var G=[S?d[0]:aa(v,d[0],this.transform.zoom),S?d[1]:aa(v,d[1],this.transform.zoom),0],J=new Float32Array(16);return _.translate(J,h,G),J},oa.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},oa.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},oa.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),d=this.imageManager.getPattern(h.to.toString());return!v||!d},oa.prototype.useProgram=function(h,v){this.cache=this.cache||{};var d=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[d]||(this.cache[d]=new Na(this.context,h,Ws[h],v,vh[h],this._showOverdrawInspector)),this.cache[d]},oa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},oa.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},oa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=_.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},oa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Sc=function(h,v){this.points=h,this.planes=v};Sc.fromInvProjectionMatrix=function(h,v,d){var g=Math.pow(2,d),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return _.transformMat4([],R,h)}).map(function(R){return _.scale$1([],R,1/R[3]/v*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var k=_.sub([],S[R[0]],S[R[1]]),G=_.sub([],S[R[2]],S[R[1]]),J=_.normalize([],_.cross([],k,G)),_e=-_.dot(J,S[R[1]]);return J.concat(_e)});return new Sc(S,C)};var Gs=function(h,v){this.min=h,this.max=v,this.center=_.scale$2([],_.add([],this.min,this.max),.5)};Gs.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],d=_.clone$2(this.min),g=_.clone$2(this.max),S=0;S<v.length;S++)d[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Gs(d,g)},Gs.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},Gs.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},Gs.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],d=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],C=0,R=0;R<v.length;R++)C+=_.dot$1(S,v[R])>=0;if(C===0)return 0;C!==v.length&&(d=!1)}if(d)return 2;for(var k=0;k<3;k++){for(var G=Number.MAX_VALUE,J=-Number.MAX_VALUE,_e=0;_e<h.points.length;_e++){var be=h.points[_e][k]-this.min[k];G=Math.min(G,be),J=Math.max(J,be)}if(J<0||G>this.max[k]-this.min[k])return 0}return 1};var Ml=function(h,v,d,g){if(h===void 0&&(h=0),v===void 0&&(v=0),d===void 0&&(d=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=d,this.right=g};Ml.prototype.interpolate=function(h,v,d){return v.top!=null&&h.top!=null&&(this.top=_.number(h.top,v.top,d)),v.bottom!=null&&h.bottom!=null&&(this.bottom=_.number(h.bottom,v.bottom,d)),v.left!=null&&h.left!=null&&(this.left=_.number(h.left,v.left,d)),v.right!=null&&h.right!=null&&(this.right=_.number(h.right,v.right,d)),this},Ml.prototype.getCenter=function(h,v){var d=_.clamp((this.left+h-this.right)/2,0,h),g=_.clamp((this.top+v-this.bottom)/2,0,v);return new _.Point(d,g)},Ml.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},Ml.prototype.clone=function(){return new Ml(this.top,this.bottom,this.left,this.right)},Ml.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Di=function(h,v,d,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=d==null?0:d,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ml,this._posMatrixCache={},this._alignedPosMatrixCache={}},ga={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Di.prototype.clone=function(){var h=new Di(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},ga.minZoom.get=function(){return this._minZoom},ga.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},ga.maxZoom.get=function(){return this._maxZoom},ga.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},ga.minPitch.get=function(){return this._minPitch},ga.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},ga.maxPitch.get=function(){return this._maxPitch},ga.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},ga.renderWorldCopies.get=function(){return this._renderWorldCopies},ga.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},ga.worldSize.get=function(){return this.tileSize*this.scale},ga.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ga.size.get=function(){return new _.Point(this.width,this.height)},ga.bearing.get=function(){return-this.angle/Math.PI*180},ga.bearing.set=function(h){var v=-_.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=_.create$2(),_.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ga.pitch.get=function(){return this._pitch/Math.PI*180},ga.pitch.set=function(h){var v=_.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},ga.fov.get=function(){return this._fov/Math.PI*180},ga.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},ga.zoom.get=function(){return this._zoom},ga.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},ga.center.get=function(){return this._center},ga.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},ga.padding.get=function(){return this._edgeInsets.toJSON()},ga.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},ga.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Di.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Di.prototype.interpolatePadding=function(h,v,d){this._unmodified=!1,this._edgeInsets.interpolate(h,v,d),this._constrain(),this._calcMatrices()},Di.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},Di.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new _.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var d=this.pointCoordinate(new _.Point(0,0)),g=this.pointCoordinate(new _.Point(this.width,0)),S=this.pointCoordinate(new _.Point(this.width,this.height)),C=this.pointCoordinate(new _.Point(0,this.height)),R=Math.floor(Math.min(d.x,g.x,S.x,C.x)),k=Math.floor(Math.max(d.x,g.x,S.x,C.x)),G=R-1;G<=k+1;G++)G!==0&&v.push(new _.UnwrappedTileID(G,h));return v},Di.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),d=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=_.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),C=[S*g.x,S*g.y,0],R=Sc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),k=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=v);var G=function(Zr){return{aabb:new Gs([Zr*S,0,0],[(Zr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Zr,fullyVisible:!1}},J=[],_e=[],be=v,Te=h.reparseOverscaled?d:v;if(this._renderWorldCopies)for(var $e=1;$e<=3;$e++)J.push(G(-$e)),J.push(G($e));for(J.push(G(0));J.length>0;){var Ve=J.pop(),st=Ve.x,Fe=Ve.y,at=Ve.fullyVisible;if(!at){var bt=Ve.aabb.intersects(R);if(bt===0)continue;at=bt===2}var Nt=Ve.aabb.distanceX(C),nr=Ve.aabb.distanceY(C),qt=Math.max(Math.abs(Nt),Math.abs(nr));if(Ve.zoom===be||qt>3+(1<<be-Ve.zoom)-2&&Ve.zoom>=k)_e.push({tileID:new _.OverscaledTileID(Ve.zoom===be?Te:Ve.zoom,Ve.wrap,Ve.zoom,st,Fe),distanceSq:_.sqrLen([C[0]-.5-st,C[1]-.5-Fe])});else for(var fr=0;fr<4;fr++){var Er=(st<<1)+fr%2,Gr=(Fe<<1)+(fr>>1);J.push({aabb:Ve.aabb.quadrant(fr),zoom:Ve.zoom+1,x:Er,y:Gr,wrap:Ve.wrap,fullyVisible:at})}}return _e.sort(function(Zr,vn){return Zr.distanceSq-vn.distanceSq}).map(function(Zr){return Zr.tileID})},Di.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},ga.unmodified.get=function(){return this._unmodified},Di.prototype.zoomScale=function(h){return Math.pow(2,h)},Di.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Di.prototype.project=function(h){var v=_.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _.Point(_.mercatorXfromLng(h.lng)*this.worldSize,_.mercatorYfromLat(v)*this.worldSize)},Di.prototype.unproject=function(h){return new _.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},ga.point.get=function(){return this.project(this.center)},Di.prototype.setLocationAtPoint=function(h,v){var d=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),C=new _.MercatorCoordinate(S.x-(d.x-g.x),S.y-(d.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Di.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Di.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Di.prototype.locationCoordinate=function(h){return _.MercatorCoordinate.fromLngLat(h)},Di.prototype.coordinateLocation=function(h){return h.toLngLat()},Di.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],d=[h.x,h.y,1,1];_.transformMat4(v,v,this.pixelMatrixInverse),_.transformMat4(d,d,this.pixelMatrixInverse);var g=v[3],S=d[3],C=v[1]/g,R=d[1]/S,k=v[2]/g,G=d[2]/S,J=k===G?0:(0-k)/(G-k);return new _.MercatorCoordinate(_.number(v[0]/g,d[0]/S,J)/this.worldSize,_.number(C,R,J)/this.worldSize)},Di.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(v,v,this.pixelMatrix),new _.Point(v[0]/v[3],v[1]/v[3])},Di.prototype.getBounds=function(){return new _.LngLatBounds().extend(this.pointLocation(new _.Point(0,0))).extend(this.pointLocation(new _.Point(this.width,0))).extend(this.pointLocation(new _.Point(this.width,this.height))).extend(this.pointLocation(new _.Point(0,this.height)))},Di.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Di.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Di.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var d=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];var S=h.canonical,C=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*h.wrap,k=_.identity(new Float64Array(16));return _.translate(k,k,[R*C,S.y*C,0]),_.scale(k,k,[C/_.EXTENT,C/_.EXTENT,1]),_.multiply(k,v?this.alignedProjMatrix:this.projMatrix,k),g[d]=new Float32Array(k),g[d]},Di.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Di.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,d,g,S=-90,C=90,R=-180,k=180,G=this.size,J=this._unmodified;if(this.latRange){var _e=this.latRange;S=_.mercatorYfromLat(_e[1])*this.worldSize,h=(C=_.mercatorYfromLat(_e[0])*this.worldSize)-S<G.y?G.y/(C-S):0}if(this.lngRange){var be=this.lngRange;R=_.mercatorXfromLng(be[0])*this.worldSize,v=(k=_.mercatorXfromLng(be[1])*this.worldSize)-R<G.x?G.x/(k-R):0}var Te=this.point,$e=Math.max(v||0,h||0);if($e)return this.center=this.unproject(new _.Point(v?(k+R)/2:Te.x,h?(C+S)/2:Te.y)),this.zoom+=this.scaleZoom($e),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var Ve=Te.y,st=G.y/2;Ve-st<S&&(g=S+st),Ve+st>C&&(g=C-st)}if(this.lngRange){var Fe=Te.x,at=G.x/2;Fe-at<R&&(d=R+at),Fe+at>k&&(d=k-at)}d===void 0&&g===void 0||(this.center=this.unproject(new _.Point(d!==void 0?d:Te.x,g!==void 0?g:Te.y))),this._unmodified=J,this._constraining=!1}},Di.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,d=this._fov*(.5+h.y/this.height),g=Math.sin(d)*this.cameraToCenterDistance/Math.sin(_.clamp(Math.PI-v-d,.01,Math.PI-.01)),S=this.point,C=S.x,R=S.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,J=new Float64Array(16);_.perspective(J,this._fov,this.width/this.height,G,k),J[8]=2*-h.x/this.width,J[9]=2*h.y/this.height,_.scale(J,J,[1,-1,1]),_.translate(J,J,[0,0,-this.cameraToCenterDistance]),_.rotateX(J,J,this._pitch),_.rotateZ(J,J,this.angle),_.translate(J,J,[-C,-R,0]),this.mercatorMatrix=_.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),_.scale(J,J,[1,1,_.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=_.invert([],this.projMatrix);var _e=this.width%2/2,be=this.height%2/2,Te=Math.cos(this.angle),$e=Math.sin(this.angle),Ve=C-Math.round(C)+Te*_e+$e*be,st=R-Math.round(R)+Te*be+$e*_e,Fe=new Float64Array(J);if(_.translate(Fe,Fe,[Ve>.5?Ve-1:Ve,st>.5?st-1:st,0]),this.alignedProjMatrix=Fe,J=_.create(),_.scale(J,J,[this.width/2,-this.height/2,1]),_.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=_.create(),_.scale(J,J,[1,-1,1]),_.translate(J,J,[-1,-1,0]),_.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=_.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=_.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Di.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new _.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Di.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _.Point(0,h))},Di.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var d=v.x,g=v.y,S=v.x,C=v.y,R=0,k=h;R<k.length;R+=1){var G=k[R];d=Math.min(d,G.x),g=Math.min(g,G.y),S=Math.max(S,G.x),C=Math.max(C,G.y)}return[new _.Point(d,g),new _.Point(S,g),new _.Point(S,C),new _.Point(d,C),new _.Point(d,g)]},Object.defineProperties(Di.prototype,ga);var Ps=function(h){var v,d,g,S;this._hashName=h&&encodeURIComponent(h),_.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),d=!1,g=null,S=function(){g=null,d&&(v(),g=setTimeout(S,300),d=!1)},function(){return d=!0,g||S(),g})};Ps.prototype.addTo=function(h){return this._map=h,_.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ps.prototype.remove=function(){return _.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ps.prototype.getHashString=function(h){var v=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),C=Math.round(v.lng*S)/S,R=Math.round(v.lat*S)/S,k=this._map.getBearing(),G=this._map.getPitch(),J="";if(J+=h?"/"+C+"/"+R+"/"+d:d+"/"+R+"/"+C,(k||G)&&(J+="/"+Math.round(10*k)/10),G&&(J+="/"+Math.round(G)),this._hashName){var _e=this._hashName,be=!1,Te=_.window.location.hash.slice(1).split("&").map(function($e){var Ve=$e.split("=")[0];return Ve===_e?(be=!0,Ve+"="+J):$e}).filter(function($e){return $e});return be||Te.push(_e+"="+J),"#"+Te.join("&")}return"#"+J},Ps.prototype._getCurrentHash=function(){var h,v=this,d=_.window.location.hash.replace("#","");return this._hashName?(d.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):d.split("/")},Ps.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(d){return isNaN(d)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},Ps.prototype._updateHashUnthrottled=function(){var h=_.window.location.href.replace(/(#.+)?$/,this.getHashString());try{_.window.history.replaceState(_.window.history.state,null,h)}catch(v){}};var If={linearity:.3,easing:_.bezier(0,0,.3,1)},Ac=_.extend({deceleration:2500,maxSpeed:1400},If),Pf=_.extend({deceleration:20,maxSpeed:1400},If),Uu=_.extend({deceleration:1e3,maxSpeed:360},If),Of=_.extend({deceleration:1e3,maxSpeed:90},If),Yc=function(h){this._map=h,this.clear()};function Xl(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function Po(h,v,d){var g=d.maxSpeed,S=d.linearity,C=d.deceleration,R=_.clamp(h*S/(v/1e3),-g,g),k=Math.abs(R)/(C*S);return{easing:d.easing,duration:1e3*k,amount:R*(k/2)}}Yc.prototype.clear=function(){this._inertiaBuffer=[]},Yc.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.browser.now(),settings:h})},Yc.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=_.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},Yc.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new _.Point(0,0),pinchAround:void 0,around:void 0},d=0,g=this._inertiaBuffer;d<g.length;d+=1){var S=g[d].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var k=Po(v.pan.mag(),C,_.extend({},Ac,h||{}));R.offset=v.pan.mult(k.amount/v.pan.mag()),R.center=this._map.transform.center,Xl(R,k)}if(v.zoom){var G=Po(v.zoom,C,Pf);R.zoom=this._map.transform.zoom+G.amount,Xl(R,G)}if(v.bearing){var J=Po(v.bearing,C,Uu);R.bearing=this._map.transform.bearing+_.clamp(J.amount,-179,179),Xl(R,J)}if(v.pitch){var _e=Po(v.pitch,C,Of);R.pitch=this._map.transform.pitch+_e.amount,Xl(R,_e)}if(R.zoom||R.bearing){var be=v.pinchAround===void 0?v.around:v.pinchAround;R.around=be?this._map.unproject(be):this._map.getCenter()}return this.clear(),_.extend(R,{noMoveStart:!0})}};var Ia=function(h){function v(g,S,C,R){R===void 0&&(R={});var k=j.mousePos(S.getCanvasContainer(),C),G=S.unproject(k);h.call(this,g,_.extend({point:k,lngLat:G,originalEvent:C},R)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(_.Event),qc=function(h){function v(g,S,C){var R=g==="touchend"?C.changedTouches:C.touches,k=j.touchPos(S.getCanvasContainer(),R),G=k.map(function(be){return S.unproject(be)}),J=k.reduce(function(be,Te,$e,Ve){return be.add(Te.div(Ve.length))},new _.Point(0,0)),_e=S.unproject(J);h.call(this,g,{points:k,point:J,lngLats:G,lngLat:_e,originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(_.Event),rp=function(h){function v(g,S,C){h.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},d.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,d),v}(_.Event),Pa=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};Pa.prototype.reset=function(){delete this._mousedownPos},Pa.prototype.wheel=function(h){return this._firePreventable(new rp(h.type,this._map,h))},Pa.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new Ia(h.type,this._map,h))},Pa.prototype.mouseup=function(h){this._map.fire(new Ia(h.type,this._map,h))},Pa.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new Ia(h.type,this._map,h))},Pa.prototype.dblclick=function(h){return this._firePreventable(new Ia(h.type,this._map,h))},Pa.prototype.mouseover=function(h){this._map.fire(new Ia(h.type,this._map,h))},Pa.prototype.mouseout=function(h){this._map.fire(new Ia(h.type,this._map,h))},Pa.prototype.touchstart=function(h){return this._firePreventable(new qc(h.type,this._map,h))},Pa.prototype.touchmove=function(h){this._map.fire(new qc(h.type,this._map,h))},Pa.prototype.touchend=function(h){this._map.fire(new qc(h.type,this._map,h))},Pa.prototype.touchcancel=function(h){this._map.fire(new qc(h.type,this._map,h))},Pa.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},Pa.prototype.isEnabled=function(){return!0},Pa.prototype.isActive=function(){return!1},Pa.prototype.enable=function(){},Pa.prototype.disable=function(){};var An=function(h){this._map=h};An.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},An.prototype.mousemove=function(h){this._map.fire(new Ia(h.type,this._map,h))},An.prototype.mousedown=function(){this._delayContextMenu=!0},An.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ia("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},An.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new Ia(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},An.prototype.isEnabled=function(){return!0},An.prototype.isActive=function(){return!1},An.prototype.enable=function(){},An.prototype.disable=function(){};var fs=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function Tc(h,v){for(var d={},g=0;g<h.length;g++)d[h[g].identifier]=v[g];return d}fs.prototype.isEnabled=function(){return!!this._enabled},fs.prototype.isActive=function(){return!!this._active},fs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fs.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(j.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},fs.prototype.mousemoveWindow=function(h,v){if(this._active){var d=v;if(!(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=d,this._box||(this._box=j.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,d.x),C=Math.max(g.x,d.x),R=Math.min(g.y,d.y),k=Math.max(g.y,d.y);j.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=C-S+"px",this._box.style.height=k-R+"px"}}},fs.prototype.mouseupWindow=function(h,v){var d=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),j.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new _.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,S,d._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},fs.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},fs.prototype.blur=function(){this.reset()},fs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos},fs.prototype._fireEvent=function(h,v){return this._map.fire(new _.Event(h,{originalEvent:v}))};var Kc=function(h){this.reset(),this.numTouches=h.numTouches};Kc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Kc.prototype.touchstart=function(h,v,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){for(var S=new _.Point(0,0),C=0,R=g;C<R.length;C+=1)S._add(R[C]);return S.div(g.length)}(v),this.touches=Tc(d,v)))},Kc.prototype.touchmove=function(h,v,d){if(!this.aborted&&this.centroid){var g=Tc(d,v);for(var S in this.touches){var C=g[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Kc.prototype.touchend=function(h,v,d){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var hs=function(h){this.singleTap=new Kc(h),this.numTaps=h.numTaps,this.reset()};hs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},hs.prototype.touchstart=function(h,v,d){this.singleTap.touchstart(h,v,d)},hs.prototype.touchmove=function(h,v,d){this.singleTap.touchmove(h,v,d)},hs.prototype.touchend=function(h,v,d){var g=this.singleTap.touchend(h,v,d);if(g){var S=h.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(S&&C||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var sa=function(){this._zoomIn=new hs({numTouches:1,numTaps:2}),this._zoomOut=new hs({numTouches:2,numTaps:1}),this.reset()};sa.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},sa.prototype.touchstart=function(h,v,d){this._zoomIn.touchstart(h,v,d),this._zoomOut.touchstart(h,v,d)},sa.prototype.touchmove=function(h,v,d){this._zoomIn.touchmove(h,v,d),this._zoomOut.touchmove(h,v,d)},sa.prototype.touchend=function(h,v,d){var g=this,S=this._zoomIn.touchend(h,v,d),C=this._zoomOut.touchend(h,v,d);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:h})}}):C?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(C)},{originalEvent:h})}}):void 0},sa.prototype.touchcancel=function(){this.reset()},sa.prototype.enable=function(){this._enabled=!0},sa.prototype.disable=function(){this._enabled=!1,this.reset()},sa.prototype.isEnabled=function(){return this._enabled},sa.prototype.isActive=function(){return this._active};var kf={0:1,2:2},ln=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};ln.prototype.blur=function(){this.reset()},ln.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},ln.prototype._correctButton=function(h,v){return!1},ln.prototype._move=function(h,v){return{}},ln.prototype.mousedown=function(h,v){if(!this._lastPoint){var d=j.mouseButton(h);this._correctButton(h,d)&&(this._lastPoint=v,this._eventButton=d)}},ln.prototype.mousemoveWindow=function(h,v){var d=this._lastPoint;if(d){if(h.preventDefault(),function(g,S){var C=kf[S];return g.buttons===void 0||(g.buttons&C)!==C}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(d,v)}},ln.prototype.mouseupWindow=function(h){this._lastPoint&&j.mouseButton(h)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())},ln.prototype.enable=function(){this._enabled=!0},ln.prototype.disable=function(){this._enabled=!1,this.reset()},ln.prototype.isEnabled=function(){return this._enabled},ln.prototype.isActive=function(){return this._active};var Il=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(d,g){h.prototype.mousedown.call(this,d,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(d,g){return g===0&&!d.ctrlKey},v.prototype._move=function(d,g){return{around:g,panDelta:g.sub(d)}},v}(ln),Qc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(d,g){return g===0&&d.ctrlKey||g===2},v.prototype._move=function(d,g){var S=.8*(g.x-d.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(ln),Df=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(d,g){return g===0&&d.ctrlKey||g===2},v.prototype._move=function(d,g){var S=-.5*(g.y-d.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(d){d.preventDefault()},v}(ln),Xs=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};Xs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new _.Point(0,0)},Xs.prototype.touchstart=function(h,v,d){return this._calculateTransform(h,v,d)},Xs.prototype.touchmove=function(h,v,d){if(this._active&&!(d.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,d)},Xs.prototype.touchend=function(h,v,d){this._calculateTransform(h,v,d),this._active&&d.length<this._minTouches&&this.reset()},Xs.prototype.touchcancel=function(){this.reset()},Xs.prototype._calculateTransform=function(h,v,d){d.length>0&&(this._active=!0);var g=Tc(d,v),S=new _.Point(0,0),C=new _.Point(0,0),R=0;for(var k in g){var G=g[k],J=this._touches[k];J&&(S._add(G),C._add(G.sub(J)),R++,g[k]=G)}if(this._touches=g,!(R<this._minTouches)&&C.mag()){var _e=C.div(R);if(this._sum._add(_e),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:_e}}},Xs.prototype.enable=function(){this._enabled=!0},Xs.prototype.disable=function(){this._enabled=!1,this.reset()},Xs.prototype.isEnabled=function(){return this._enabled},Xs.prototype.isActive=function(){return this._active};var $s=function(){this.reset()};function Lf(h,v,d){for(var g=0;g<h.length;g++)if(h[g].identifier===d)return v[g]}function Bf(h,v){return Math.log(h/v)/Math.LN2}$s.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},$s.prototype._start=function(h){},$s.prototype._move=function(h,v,d){return{}},$s.prototype.touchstart=function(h,v,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([v[0],v[1]]))},$s.prototype.touchmove=function(h,v,d){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],C=Lf(d,v,g[0]),R=Lf(d,v,S);if(C&&R){var k=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],k,h)}}},$s.prototype.touchend=function(h,v,d){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],C=Lf(d,v,g[0]),R=Lf(d,v,S);C&&R||(this._active&&j.suppressClick(),this.reset())}},$s.prototype.touchcancel=function(){this.reset()},$s.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},$s.prototype.disable=function(){this._enabled=!1,this.reset()},$s.prototype.isEnabled=function(){return this._enabled},$s.prototype.isActive=function(){return this._active};var ps=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(d){this._startDistance=this._distance=d[0].dist(d[1])},v.prototype._move=function(d,g){var S=this._distance;if(this._distance=d[0].dist(d[1]),this._active||!(Math.abs(Bf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bf(this._distance,S),pinchAround:g}},v}($s);function zu(h,v){return 180*h.angleWith(v)/Math.PI}var yh=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(d){this._startVector=this._vector=d[0].sub(d[1]),this._minDiameter=d[0].dist(d[1])},v.prototype._move=function(d,g){var S=this._vector;if(this._vector=d[0].sub(d[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zu(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(d){this._minDiameter=Math.min(this._minDiameter,d.mag());var g=25/(Math.PI*this._minDiameter)*360,S=zu(d,this._startVector);return Math.abs(S)<g},v}($s);function wc(h){return Math.abs(h.y)>Math.abs(h.x)}var Ff=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(d){this._lastPoints=d,wc(d[0].sub(d[1]))&&(this._valid=!1)},v.prototype._move=function(d,g,S){var C=d[0].sub(this._lastPoints[0]),R=d[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,R,S.timeStamp),this._valid)return this._lastPoints=d,this._active=!0,{pitchDelta:(C.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(d,g,S){if(this._valid!==void 0)return this._valid;var C=d.mag()>=2,R=g.mag()>=2;if(C||R){if(!C||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var k=d.y>0==g.y>0;return wc(d)&&wc(g)&&k}},v}($s),Jc={panStep:100,bearingStep:15,pitchStep:10},ds=function(){var h=Jc;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Ys(h){return h*(2-h)}ds.prototype.blur=function(){this.reset()},ds.prototype.reset=function(){this._active=!1},ds.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var d=0,g=0,S=0,C=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),C=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),C=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(k){var G=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Ys,zoom:d?Math.round(G)+d*(h.shiftKey?2:1):G,bearing:k.getBearing()+g*v._bearingStep,pitch:k.getPitch()+S*v._pitchStep,offset:[-C*v._panStep,-R*v._panStep],center:k.getCenter()},{originalEvent:h})}}}},ds.prototype.enable=function(){this._enabled=!0},ds.prototype.disable=function(){this._enabled=!1,this.reset()},ds.prototype.isEnabled=function(){return this._enabled},ds.prototype.isActive=function(){return this._active},ds.prototype.disableRotation=function(){this._rotationDisabled=!0},ds.prototype.enableRotation=function(){this._rotationDisabled=!1};var St=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,_.bindAll(["_onTimeout"],this)};St.prototype.setZoomRate=function(h){this._defaultZoomRate=h},St.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},St.prototype.isEnabled=function(){return!!this._enabled},St.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},St.prototype.isZooming=function(){return!!this._zooming},St.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},St.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},St.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===_.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,d=_.browser.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},St.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},St.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=j.mousePos(this._el,h);this._around=_.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},St.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var d=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,k=this._startZoom,G=this._easing,J=!1;if(this._type==="wheel"&&k&&G){var _e=Math.min((_.browser.now()-this._lastWheelEventTime)/200,1),be=G(_e);C=_.number(k,R,be),_e<1?this._frameId||(this._frameId=!0):J=!0}else C=R,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:C-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},St.prototype._smoothOutEasing=function(h){var v=_.ease;if(this._prevEase){var d=this._prevEase,g=(_.browser.now()-d.start)/d.duration,S=d.easing(g+.01)-d.easing(g),C=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-C*C);v=_.bezier(C,R,.25,1)}return this._prevEase={start:_.browser.now(),duration:h,easing:v},v},St.prototype.blur=function(){this.reset()},St.prototype.reset=function(){this._active=!1};var Be=function(h,v){this._clickZoom=h,this._tapZoom=v};Be.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Be.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Be.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Be.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var F=function(){this.reset()};F.prototype.reset=function(){this._active=!1},F.prototype.blur=function(){this.reset()},F.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(d){d.easeTo({duration:300,zoom:d.getZoom()+(h.shiftKey?-1:1),around:d.unproject(v)},{originalEvent:h})}}},F.prototype.enable=function(){this._enabled=!0},F.prototype.disable=function(){this._enabled=!1,this.reset()},F.prototype.isEnabled=function(){return this._enabled},F.prototype.isActive=function(){return this._active};var Oo=function(){this._tap=new hs({numTouches:1,numTaps:1}),this.reset()};Oo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Oo.prototype.touchstart=function(h,v,d){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=v[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(h,v,d))},Oo.prototype.touchmove=function(h,v,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,d)},Oo.prototype.touchend=function(h,v,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(h,v,d)&&(this._tapTime=h.timeStamp)},Oo.prototype.touchcancel=function(){this.reset()},Oo.prototype.enable=function(){this._enabled=!0},Oo.prototype.disable=function(){this._enabled=!1,this.reset()},Oo.prototype.isEnabled=function(){return this._enabled},Oo.prototype.isActive=function(){return this._active};var Ae=function(h,v,d){this._el=h,this._mousePan=v,this._touchPan=d};Ae.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ae.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ae.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ae.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var al=function(h,v,d){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=d};al.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},al.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},al.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},al.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ba=function(h,v,d,g){this._el=h,this._touchZoom=v,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};ba.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ba.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ba.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ba.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ba.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ba.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ko=function(h){return h.zoom||h.drag||h.pitch||h.rotate},ol=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(_.Event);function wn(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var Cn=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yc(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),_.bindAll(["handleEvent","handleWindowEvent"],this);var d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[_.window.document,"mousemove",{capture:!0}],[_.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[_.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var C=S[g],R=C[0];j.addEventListener(R,C[1],R===_.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};Cn.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var d=v[h],g=d[0];j.removeEventListener(g,d[1],g===_.window.document?this.handleWindowEvent:this.handleEvent,d[2])}},Cn.prototype._addDefaultHandlers=function(h){var v=this._map,d=v.getCanvasContainer();this._add("mapEvent",new Pa(v,h));var g=v.boxZoom=new fs(v,h);this._add("boxZoom",g);var S=new sa,C=new F;v.doubleClickZoom=new Be(C,S),this._add("tapZoom",S),this._add("clickZoom",C);var R=new Oo;this._add("tapDragZoom",R);var k=v.touchPitch=new Ff;this._add("touchPitch",k);var G=new Qc(h),J=new Df(h);v.dragRotate=new al(h,G,J),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var _e=new Il(h),be=new Xs(h);v.dragPan=new Ae(d,_e,be),this._add("mousePan",_e),this._add("touchPan",be,["touchZoom","touchRotate"]);var Te=new yh,$e=new ps;v.touchZoomRotate=new ba(d,$e,Te,R),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",$e,["touchPan","touchRotate"]);var Ve=v.scrollZoom=new St(v,this);this._add("scrollZoom",Ve,["mousePan"]);var st=v.keyboard=new ds;this._add("keyboard",st),this._add("blockableMapEvent",new An(v));for(var Fe=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<at.length;Fe+=1){var bt=at[Fe];h.interactive&&h[bt]&&v[bt].enable(h[bt])}},Cn.prototype._add=function(h,v,d){this._handlers.push({handlerName:h,handler:v,allowed:d}),this._handlersById[h]=v},Cn.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,d=this._handlers;v<d.length;v+=1)d[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},Cn.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(ko(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(h,v,d){for(var g in h)if(g!==d&&(!v||v.indexOf(g)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},Cn.prototype._getMapTouches=function(h){for(var v=[],d=0,g=h;d<g.length;d+=1){var S=g[d];this._el.contains(S.target)&&v.push(S)}return v},Cn.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var d=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},C={},R=h.touches?this._getMapTouches(h.touches):void 0,k=R?j.touchPos(this._el,R):j.mousePos(this._el,h),G=0,J=this._handlers;G<J.length;G+=1){var _e=J[G],be=_e.handlerName,Te=_e.handler,$e=_e.allowed;if(Te.isEnabled()){var Ve=void 0;this._blockedByActive(C,$e,be)?Te.reset():Te[v||h.type]&&(Ve=Te[v||h.type](h,k,R),this.mergeHandlerResult(g,S,Ve,be,d),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Te.isActive())&&(C[be]=Te)}}var st={};for(var Fe in this._previousActiveHandlers)C[Fe]||(st[Fe]=d);this._previousActiveHandlers=C,(Object.keys(st).length||wn(g))&&(this._changes.push([g,S,st]),this._triggerRenderFrame()),(Object.keys(C).length||wn(g))&&this._map._stop(!0),this._updatingCamera=!1;var at=g.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},Cn.prototype.mergeHandlerResult=function(h,v,d,g,S){if(d){_.extend(h,d);var C={handlerName:g,originalEvent:d.originalEvent||S};d.zoomDelta!==void 0&&(v.zoom=C),d.panDelta!==void 0&&(v.drag=C),d.pitchDelta!==void 0&&(v.pitch=C),d.bearingDelta!==void 0&&(v.rotate=C)}},Cn.prototype._applyChanges=function(){for(var h={},v={},d={},g=0,S=this._changes;g<S.length;g+=1){var C=S[g],R=C[0],k=C[1],G=C[2];R.panDelta&&(h.panDelta=(h.panDelta||new _.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(h.around=R.around),R.pinchAround!==void 0&&(h.pinchAround=R.pinchAround),R.noInertia&&(h.noInertia=R.noInertia),_.extend(v,k),_.extend(d,G)}this._updateMapTransform(h,v,d),this._changes=[]},Cn.prototype._updateMapTransform=function(h,v,d){var g=this._map,S=g.transform;if(!wn(h))return this._fireEvents(v,d,!0);var C=h.panDelta,R=h.zoomDelta,k=h.bearingDelta,G=h.pitchDelta,J=h.around,_e=h.pinchAround;_e!==void 0&&(J=_e),g._stop(!0),J=J||g.transform.centerPoint;var be=S.pointLocation(C?J.sub(C):J);k&&(S.bearing+=k),G&&(S.pitch+=G),R&&(S.zoom+=R),S.setLocationAtPoint(be,J),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,d,!0)},Cn.prototype._fireEvents=function(h,v,d){var g=this,S=ko(this._eventsInProgress),C=ko(h),R={};for(var k in h)this._eventsInProgress[k]||(R[k+"start"]=h[k].originalEvent),this._eventsInProgress[k]=h[k];for(var G in!S&&C&&this._fireEvent("movestart",C.originalEvent),R)this._fireEvent(G,R[G]);for(var J in C&&this._fireEvent("move",C.originalEvent),h)this._fireEvent(J,h[J].originalEvent);var _e,be={};for(var Te in this._eventsInProgress){var $e=this._eventsInProgress[Te],Ve=$e.handlerName,st=$e.originalEvent;this._handlersById[Ve].isActive()||(delete this._eventsInProgress[Te],be[Te+"end"]=_e=v[Ve]||st)}for(var Fe in be)this._fireEvent(Fe,be[Fe]);var at=ko(this._eventsInProgress);if(d&&(S||C)&&!at){this._updatingCamera=!0;var bt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Nt=function(nr){return nr!==0&&-g._bearingSnap<nr&&nr<g._bearingSnap};bt?(Nt(bt.bearing||this._map.getBearing())&&(bt.bearing=0),this._map.easeTo(bt,{originalEvent:_e})):(this._map.fire(new _.Event("moveend",{originalEvent:_e})),Nt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(h,v){this._map.fire(new _.Event(h,v?{originalEvent:v}:{}))},Cn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new ol("renderFrame",{timeStamp:v})),h._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Es=function(h){function v(d,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=d,this._bearingSnap=g.bearingSnap,_.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new _.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(d,g){return this.jumpTo({center:d},g)},v.prototype.panBy=function(d,g,S){return d=_.Point.convert(d).mult(-1),this.panTo(this.transform.center,_.extend({offset:d},g),S)},v.prototype.panTo=function(d,g,S){return this.easeTo(_.extend({center:d},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(d,g){return this.jumpTo({zoom:d},g),this},v.prototype.zoomTo=function(d,g,S){return this.easeTo(_.extend({zoom:d},g),S)},v.prototype.zoomIn=function(d,g){return this.zoomTo(this.getZoom()+1,d,g),this},v.prototype.zoomOut=function(d,g){return this.zoomTo(this.getZoom()-1,d,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(d,g){return this.jumpTo({bearing:d},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(d,g){return this.jumpTo({padding:d},g),this},v.prototype.rotateTo=function(d,g,S){return this.easeTo(_.extend({bearing:d},g),S)},v.prototype.resetNorth=function(d,g){return this.rotateTo(0,_.extend({duration:1e3},d),g),this},v.prototype.resetNorthPitch=function(d,g){return this.easeTo(_.extend({bearing:0,pitch:0,duration:1e3},d),g),this},v.prototype.snapToNorth=function(d,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(d,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(d,g){return this.jumpTo({pitch:d},g),this},v.prototype.cameraForBounds=function(d,g){d=_.LngLatBounds.convert(d);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(d.getNorthWest(),d.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(d,g,S,C){var R={top:0,bottom:0,right:0,left:0};if(typeof(C=_.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var k=C.padding;C.padding={top:k,bottom:k,right:k,left:k}}C.padding=_.extend(R,C.padding);var G=this.transform,J=G.padding,_e=G.project(_.LngLat.convert(d)),be=G.project(_.LngLat.convert(g)),Te=_e.rotate(-S*Math.PI/180),$e=be.rotate(-S*Math.PI/180),Ve=new _.Point(Math.max(Te.x,$e.x),Math.max(Te.y,$e.y)),st=new _.Point(Math.min(Te.x,$e.x),Math.min(Te.y,$e.y)),Fe=Ve.sub(st),at=(G.width-(J.left+J.right+C.padding.left+C.padding.right))/Fe.x,bt=(G.height-(J.top+J.bottom+C.padding.top+C.padding.bottom))/Fe.y;if(!(bt<0||at<0)){var Nt=Math.min(G.scaleZoom(G.scale*Math.min(at,bt)),C.maxZoom),nr=typeof C.offset.x=="number"?new _.Point(C.offset.x,C.offset.y):_.Point.convert(C.offset),qt=new _.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(S*Math.PI/180),fr=nr.add(qt).mult(G.scale/G.zoomScale(Nt));return{center:G.unproject(_e.add(be).div(2).sub(fr)),zoom:Nt,bearing:S}}_.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(d,g,S){return this._fitInternal(this.cameraForBounds(d,g),g,S)},v.prototype.fitScreenCoordinates=function(d,g,S,C,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(_.Point.convert(d)),this.transform.pointLocation(_.Point.convert(g)),S,C),C,R)},v.prototype._fitInternal=function(d,g,S){return d?(delete(g=_.extend(d,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(d,g){this.stop();var S=this.transform,C=!1,R=!1,k=!1;return"zoom"in d&&S.zoom!==+d.zoom&&(C=!0,S.zoom=+d.zoom),d.center!==void 0&&(S.center=_.LngLat.convert(d.center)),"bearing"in d&&S.bearing!==+d.bearing&&(R=!0,S.bearing=+d.bearing),"pitch"in d&&S.pitch!==+d.pitch&&(k=!0,S.pitch=+d.pitch),d.padding==null||S.isPaddingEqual(d.padding)||(S.padding=d.padding),this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),C&&this.fire(new _.Event("zoomstart",g)).fire(new _.Event("zoom",g)).fire(new _.Event("zoomend",g)),R&&this.fire(new _.Event("rotatestart",g)).fire(new _.Event("rotate",g)).fire(new _.Event("rotateend",g)),k&&this.fire(new _.Event("pitchstart",g)).fire(new _.Event("pitch",g)).fire(new _.Event("pitchend",g)),this.fire(new _.Event("moveend",g))},v.prototype.easeTo=function(d,g){var S=this;this._stop(!1,d.easeId),((d=_.extend({offset:[0,0],duration:500,easing:_.ease},d)).animate===!1||!d.essential&&_.browser.prefersReducedMotion)&&(d.duration=0);var C=this.transform,R=this.getZoom(),k=this.getBearing(),G=this.getPitch(),J=this.getPadding(),_e="zoom"in d?+d.zoom:R,be="bearing"in d?this._normalizeBearing(d.bearing,k):k,Te="pitch"in d?+d.pitch:G,$e="padding"in d?d.padding:C.padding,Ve=_.Point.convert(d.offset),st=C.centerPoint.add(Ve),Fe=C.pointLocation(st),at=_.LngLat.convert(d.center||Fe);this._normalizeCenter(at);var bt,Nt,nr=C.project(Fe),qt=C.project(at).sub(nr),fr=C.zoomScale(_e-R);d.around&&(bt=_.LngLat.convert(d.around),Nt=C.locationPoint(bt));var Er={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_e!==R,this._rotating=this._rotating||k!==be,this._pitching=this._pitching||Te!==G,this._padding=!C.isPaddingEqual($e),this._easeId=d.easeId,this._prepareEase(g,d.noMoveStart,Er),this._ease(function(Gr){if(S._zooming&&(C.zoom=_.number(R,_e,Gr)),S._rotating&&(C.bearing=_.number(k,be,Gr)),S._pitching&&(C.pitch=_.number(G,Te,Gr)),S._padding&&(C.interpolatePadding(J,$e,Gr),st=C.centerPoint.add(Ve)),bt)C.setLocationAtPoint(bt,Nt);else{var Zr=C.zoomScale(C.zoom-R),vn=_e>R?Math.min(2,fr):Math.max(.5,fr),zn=Math.pow(vn,1-Gr),Hn=C.unproject(nr.add(qt.mult(Gr*zn)).mult(Zr));C.setLocationAtPoint(C.renderWorldCopies?Hn.wrap():Hn,st)}S._fireMoveEvents(g)},function(Gr){S._afterEase(g,Gr)},d),this},v.prototype._prepareEase=function(d,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new _.Event("movestart",d)),this._zooming&&!S.zooming&&this.fire(new _.Event("zoomstart",d)),this._rotating&&!S.rotating&&this.fire(new _.Event("rotatestart",d)),this._pitching&&!S.pitching&&this.fire(new _.Event("pitchstart",d))},v.prototype._fireMoveEvents=function(d){this.fire(new _.Event("move",d)),this._zooming&&this.fire(new _.Event("zoom",d)),this._rotating&&this.fire(new _.Event("rotate",d)),this._pitching&&this.fire(new _.Event("pitch",d))},v.prototype._afterEase=function(d,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,C=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new _.Event("zoomend",d)),C&&this.fire(new _.Event("rotateend",d)),R&&this.fire(new _.Event("pitchend",d)),this.fire(new _.Event("moveend",d))}},v.prototype.flyTo=function(d,g){var S=this;if(!d.essential&&_.browser.prefersReducedMotion){var C=_.pick(d,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),d=_.extend({offset:[0,0],speed:1.2,curve:1.42,easing:_.ease},d);var R=this.transform,k=this.getZoom(),G=this.getBearing(),J=this.getPitch(),_e=this.getPadding(),be="zoom"in d?_.clamp(+d.zoom,R.minZoom,R.maxZoom):k,Te="bearing"in d?this._normalizeBearing(d.bearing,G):G,$e="pitch"in d?+d.pitch:J,Ve="padding"in d?d.padding:R.padding,st=R.zoomScale(be-k),Fe=_.Point.convert(d.offset),at=R.centerPoint.add(Fe),bt=R.pointLocation(at),Nt=_.LngLat.convert(d.center||bt);this._normalizeCenter(Nt);var nr=R.project(bt),qt=R.project(Nt).sub(nr),fr=d.curve,Er=Math.max(R.width,R.height),Gr=Er/st,Zr=qt.mag();if("minZoom"in d){var vn=_.clamp(Math.min(d.minZoom,k,be),R.minZoom,R.maxZoom),zn=Er/R.zoomScale(vn-k);fr=Math.sqrt(zn/Zr*2)}var Hn=fr*fr;function Fn(Jn){var ei=(Gr*Gr-Er*Er+(Jn?-1:1)*Hn*Hn*Zr*Zr)/(2*(Jn?Gr:Er)*Hn*Zr);return Math.log(Math.sqrt(ei*ei+1)-ei)}function Bi(Jn){return(Math.exp(Jn)-Math.exp(-Jn))/2}function bn(Jn){return(Math.exp(Jn)+Math.exp(-Jn))/2}var ui=Fn(0),bi=function(Jn){return bn(ui)/bn(ui+fr*Jn)},ti=function(Jn){return Er*((bn(ui)*(Bi(ei=ui+fr*Jn)/bn(ei))-Bi(ui))/Hn)/Zr;var ei},ii=(Fn(1)-ui)/fr;if(Math.abs(Zr)<1e-6||!isFinite(ii)){if(Math.abs(Er-Gr)<1e-6)return this.easeTo(d,g);var gi=Gr<Er?-1:1;ii=Math.abs(Math.log(Gr/Er))/fr,ti=function(){return 0},bi=function(Jn){return Math.exp(gi*fr*Jn)}}return d.duration="duration"in d?+d.duration:1e3*ii/("screenSpeed"in d?+d.screenSpeed/fr:+d.speed),d.maxDuration&&d.duration>d.maxDuration&&(d.duration=0),this._zooming=!0,this._rotating=G!==Te,this._pitching=$e!==J,this._padding=!R.isPaddingEqual(Ve),this._prepareEase(g,!1),this._ease(function(Jn){var ei=Jn*ii,uo=1/bi(ei);R.zoom=Jn===1?be:k+R.scaleZoom(uo),S._rotating&&(R.bearing=_.number(G,Te,Jn)),S._pitching&&(R.pitch=_.number(J,$e,Jn)),S._padding&&(R.interpolatePadding(_e,Ve,Jn),at=R.centerPoint.add(Fe));var qa=Jn===1?Nt:R.unproject(nr.add(qt.mult(ti(ei))).mult(uo));R.setLocationAtPoint(R.renderWorldCopies?qa.wrap():qa,at),S._fireMoveEvents(g)},function(){return S._afterEase(g)},d),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(d,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!d){var C=this.handlers;C&&C.stop(!1)}return this},v.prototype._ease=function(d,g,S){S.animate===!1||S.duration===0?(d(1),g()):(this._easeStart=_.browser.now(),this._easeOptions=S,this._onEaseFrame=d,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var d=Math.min((_.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(d,g){d=_.wrap(d,-180,180);var S=Math.abs(d-g);return Math.abs(d-360-g)<S&&(d-=360),Math.abs(d+360-g)<S&&(d+=360),d},v.prototype._normalizeCenter=function(d){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=d.lng-g.center.lng;d.lng+=S>180?-360:S<-180?360:0}},v}(_.Evented),Eo=function(h){h===void 0&&(h={}),this.options=h,_.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Eo.prototype.getDefaultPosition=function(){return"bottom-right"},Eo.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Eo.prototype.onRemove=function(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Eo.prototype._setElementTitle=function(h,v){var d=this._map._getUIString("AttributionControl."+v);h.title=d,h.setAttribute("aria-label",d)},Eo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Eo.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||_.config.ACCESS_TOKEN}];if(h){var d=v.reduce(function(g,S,C){return S.value&&(g+=S.key+"="+S.value+(C<v.length-1?"&":"")),g},"?");h.href=_.config.FEEDBACK_URL+"/"+d+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},Eo.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Eo.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var d=this._map.style.sourceCaches;for(var g in d){var S=d[g];if(S.used){var C=S.getSource();C.attribution&&h.indexOf(C.attribution)<0&&h.push(C.attribution)}}h.sort(function(k,G){return k.length-G.length});var R=(h=h.filter(function(k,G){for(var J=G+1;J<h.length;J++)if(h[J].indexOf(k)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,h.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Eo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var _u=function(){_.bindAll(["_updateLogo"],this),_.bindAll(["_updateCompact"],this)};_u.prototype.onAdd=function(h){this._map=h,this._container=j.create("div","mapboxgl-ctrl");var v=j.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},_u.prototype.onRemove=function(){j.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},_u.prototype.getDefaultPosition=function(){return"bottom-left"},_u.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},_u.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},_u.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Oa=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Oa.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Oa.prototype.remove=function(h){for(var v=this._currentlyRunning,d=0,g=v?this._queue.concat(v):this._queue;d<g.length;d+=1){var S=g[d];if(S.id===h)return void(S.cancelled=!0)}},Oa.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var d=0,g=v;d<g.length;d+=1){var S=g[d];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Oa.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var iu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Zu=_.window.HTMLImageElement,sl=_.window.HTMLElement,Vi=_.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Nf=function(h){function v(g){var S=this;if((g=_.extend({},Do,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Di(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Oa,this._controls=[],this._mapId=_.uniqueId(),this._locale=_.extend({},iu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new _.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=_.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof sl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),_.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),_.window!==void 0&&(_.window.addEventListener("online",this._onWindowOnline,!1),_.window.addEventListener("resize",this._onWindowResize,!1),_.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,g),this._hash=g.hash&&new Ps(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,_.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Eo({customAttribution:g.customAttribution})),this.addControl(new _u,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new _.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new _.Event(R.dataType+"dataloading",R))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var d={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(C,R.firstChild):R.appendChild(C),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),C=S[0],R=S[1];if(C===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(C,R),this.transform.resize(C,R),this.painter.resize(C,R);var k=!this._moving;return k&&this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),this.fire(new _.Event("resize",g)),k&&this.fire(new _.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(_.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(_.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(_.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,C){var R,k=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:S,listener:C,delegates:{mousemove:function(_e){var be=k.getLayer(S)?k.queryRenderedFeatures(_e.point,{layers:[S]}):[];be.length?G||(G=!0,C.call(k,new Ia(g,k,_e.originalEvent,{features:be}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var J=!1;return{layer:S,listener:C,delegates:{mousemove:function(_e){(k.getLayer(S)?k.queryRenderedFeatures(_e.point,{layers:[S]}):[]).length?J=!0:J&&(J=!1,C.call(k,new Ia(g,k,_e.originalEvent)))},mouseout:function(_e){J&&(J=!1,C.call(k,new Ia(g,k,_e.originalEvent)))}}}}return{layer:S,listener:C,delegates:(R={},R[g]=function(_e){var be=k.getLayer(S)?k.queryRenderedFeatures(_e.point,{layers:[S]}):[];be.length&&(_e.features=be,C.call(k,_e),delete _e.features)},R)}},v.prototype.on=function(g,S,C){if(C===void 0)return h.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(k,R.delegates[k]);return this},v.prototype.once=function(g,S,C){if(C===void 0)return h.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var k in R.delegates)this.once(k,R.delegates[k]);return this},v.prototype.off=function(g,S,C){var R=this;return C===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(k){for(var G=k[g],J=0;J<G.length;J++){var _e=G[J];if(_e.layer===S&&_e.listener===C){for(var be in _e.delegates)R.off(be,_e.delegates[be]);return G.splice(J,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var C;if(S!==void 0||g===void 0||g instanceof _.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof _.Point||typeof g[0]=="number")C=[_.Point.convert(g)];else{var R=_.Point.convert(g[0]),k=_.Point.convert(g[1]);C=[R,new _.Point(k.x,R.y),k,new _.Point(R.x,k.y),R]}return this.style.queryRenderedFeatures(C,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=_.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Is(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Is(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var C=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),k=this._requestManager.transformRequest(R,_.ResourceType.Style);_.getJSON(k,function(G,J){G?C.fire(new _.ErrorEvent(G)):J&&C._updateDiff(J,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(C){_.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():_.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new _.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var C=g[S]._tiles;for(var R in C){var k=C[R];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,C)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,C){C===void 0&&(C={});var R=C.pixelRatio;R===void 0&&(R=1);var k=C.sdf;k===void 0&&(k=!1);var G=C.stretchX,J=C.stretchY,_e=C.content;if(this._lazyInitEmptyStyle(),S instanceof Zu||Vi&&S instanceof Vi){var be=_.browser.getImageData(S);this.style.addImage(g,{data:new _.RGBAImage({width:be.width,height:be.height},be.data),pixelRatio:R,stretchX:G,stretchY:J,content:_e,sdf:k,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Te=S;this.style.addImage(g,{data:new _.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:G,stretchY:J,content:_e,sdf:k,version:0,userImage:Te}),Te.onAdd&&Te.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var C=this.style.getImage(g);if(!C)return this.fire(new _.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof Zu||Vi&&S instanceof Vi?_.browser.getImageData(S):S,k=R.width,G=R.height,J=R.data;return k===void 0||G===void 0?this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==C.data.width||G!==C.data.height?this.fire(new _.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(J,!(S instanceof Zu||Vi&&S instanceof Vi)),void this.style.updateImage(g,C))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new _.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){_.getImage(this._requestManager.transformRequest(g,_.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,C){return this.style.setLayerZoomRange(g,S,C),this._update(!0)},v.prototype.setFilter=function(g,S,C){return C===void 0&&(C={}),this.style.setFilter(g,S,C),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,C,R),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,C,R),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){_.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&_.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=j.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=j.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=j.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var R=this._controlContainer=j.create("div","mapboxgl-control-container",g),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){k[G]=j.create("div","mapboxgl-ctrl-"+G,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var C=_.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=_.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new oa(S,this.transform),_.webpSupported.testSupport(S)):this.fire(new _.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new _.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new _.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,C=this,R=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,S),R=_.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,_e=_.browser.now();this.style.zoomHistory.update(J,_e);var be=new _.EvaluationParameters(J,{now:_e,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Te=be.crossFadingFactor();Te===1&&Te===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Te),this.style.update(be)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new _.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new _.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var $e=_.browser.now()-R;k.endQueryEXT(k.TIME_ELAPSED_EXT,S),setTimeout(function(){var Fe=k.getQueryObjectEXT(S,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(S),C.fire(new _.Event("gpu-timing-frame",{cpuTime:$e,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var Ve=this.painter.collectGpuTimers();setTimeout(function(){var Fe=C.painter.queryGpuTimers(Ve);C.fire(new _.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var st=this._sourcesDirty||this._styleDirty||this._placementDirty;return st||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new _.Event("idle")),!this._loaded||this._fullyLoaded||st||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),_.window!==void 0&&(_.window.removeEventListener("resize",this._onWindowResize,!1),_.window.removeEventListener("orientationchange",this._onWindowResize,!1),_.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Pl(this._canvasContainer),Pl(this._controlContainer),Pl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new _.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=_.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},d.showTileBoundaries.get=function(){return!!this._showTileBoundaries},d.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},d.showPadding.get=function(){return!!this._showPadding},d.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},d.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},d.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},d.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},d.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},d.repaint.get=function(){return!!this._repaint},d.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},d.vertices.get=function(){return!!this._vertices},d.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){_.setCacheLimits(g,S)},d.version.get=function(){return _.version},Object.defineProperties(v.prototype,d),v}(Es);function Pl(h){h.parentNode&&h.parentNode.removeChild(h)}var Uf={showCompass:!0,showZoom:!0,visualizePitch:!1},ul=function(h){var v=this;this.options=_.extend({},Uf,h),this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(d){return d.preventDefault()}),this.options.showZoom&&(_.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(d){return v._map.zoomIn({},{originalEvent:d})}),j.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(d){return v._map.zoomOut({},{originalEvent:d})}),j.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(_.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(d){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:d}):v._map.resetNorth({},{originalEvent:d})}),this._compassIcon=j.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ul.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),d=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},ul.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},ul.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Os(this._map,this._compass,this.options.visualizePitch)),this._container},ul.prototype.onRemove=function(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ul.prototype._createButton=function(h,v){var d=j.create("button",h,this._container);return d.type="button",d.addEventListener("click",v),d},ul.prototype._setButtonTitle=function(h,v){var d=this._map._getUIString("NavigationControl."+v);h.title=d,h.setAttribute("aria-label",d)};var Os=function(h,v,d){d===void 0&&(d=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new Qc({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,d&&(this.mousePitch=new Df({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),_.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(v,"mousedown",this.mousedown),j.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(v,"touchmove",this.touchmove),j.addEventListener(v,"touchend",this.touchend),j.addEventListener(v,"touchcancel",this.reset)};function Ol(h,v,d){if(h=new _.LngLat(h.lng,h.lat),v){var g=new _.LngLat(h.lng-360,h.lat),S=new _.LngLat(h.lng+360,h.lat),C=d.locationPoint(h).distSqr(v);d.locationPoint(g).distSqr(v)<C?h=g:d.locationPoint(S).distSqr(v)<C&&(h=S)}for(;Math.abs(h.lng-d.center.lng)>180;){var R=d.locationPoint(h);if(R.x>=0&&R.y>=0&&R.x<=d.width&&R.y<=d.height)break;h.lng>d.center.lng?h.lng-=360:h.lng+=360}return h}Os.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),j.disableDrag()},Os.prototype.move=function(h,v){var d=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&d.setBearing(d.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&d.setPitch(d.getPitch()+S.pitchDelta)}},Os.prototype.off=function(){var h=this.element;j.removeEventListener(h,"mousedown",this.mousedown),j.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(h,"touchmove",this.touchmove),j.removeEventListener(h,"touchend",this.touchend),j.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},Os.prototype.offTemp=function(){j.enableDrag(),j.removeEventListener(_.window,"mousemove",this.mousemove),j.removeEventListener(_.window,"mouseup",this.mouseup)},Os.prototype.mousedown=function(h){this.down(_.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),j.mousePos(this.element,h)),j.addEventListener(_.window,"mousemove",this.mousemove),j.addEventListener(_.window,"mouseup",this.mouseup)},Os.prototype.mousemove=function(h){this.move(h,j.mousePos(this.element,h))},Os.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},Os.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},Os.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},Os.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ef(h,v,d){var g=h.classList;for(var S in xu)g.remove("mapboxgl-"+d+"-anchor-"+S);g.add("mapboxgl-"+d+"-anchor-"+v)}var Cc,tf=function(h){function v(d,g){if(h.call(this),(d instanceof _.window.HTMLElement||g)&&(d=_.extend({element:d},g)),_.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=d&&d.anchor||"center",this._color=d&&d.color||"#3FB1CE",this._scale=d&&d.scale||1,this._draggable=d&&d.draggable||!1,this._clickTolerance=d&&d.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=d&&d.rotation||0,this._rotationAlignment=d&&d.rotationAlignment||"auto",this._pitchAlignment=d&&d.pitchAlignment&&d.pitchAlignment!=="auto"?d.pitchAlignment:this._rotationAlignment,d&&d.element)this._element=d.element,this._offset=_.Point.convert(d&&d.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");var S=j.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var C=j.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var R=j.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var k=j.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var G=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<J.length;G+=1){var _e=J[G],be=j.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",_e.rx),be.setAttributeNS(null,"ry",_e.ry),k.appendChild(be)}var Te=j.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"fill",this._color);var $e=j.createNS("http://www.w3.org/2000/svg","path");$e.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Te.appendChild($e);var Ve=j.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"fill","#000000");var st=j.createNS("http://www.w3.org/2000/svg","path");st.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ve.appendChild(st);var Fe=j.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var at=j.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var bt=j.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#000000"),bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962");var Nt=j.createNS("http://www.w3.org/2000/svg","circle");Nt.setAttributeNS(null,"fill","#FFFFFF"),Nt.setAttributeNS(null,"cx","5.5"),Nt.setAttributeNS(null,"cy","5.5"),Nt.setAttributeNS(null,"r","5.4999962"),at.appendChild(bt),at.appendChild(Nt),R.appendChild(k),R.appendChild(Te),R.appendChild(Ve),R.appendChild(Fe),R.appendChild(at),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=_.Point.convert(d&&d.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(nr){nr.preventDefault()}),this._element.addEventListener("mousedown",function(nr){nr.preventDefault()}),ef(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(d){return this.remove(),this._map=d,d.getCanvasContainer().appendChild(this._element),d.on("move",this._update),d.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=_.LngLat.convert(d),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(d){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),d){if(!("offset"in d.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);d.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=d,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(d){var g=d.code,S=d.charCode||d.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(d){var g=d.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var d=this._popup;return d?(d.isOpen()?d.remove():d.addTo(this._map),this):this},v.prototype._update=function(d){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ol(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),d&&d.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,xu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(d){return this._offset=_.Point.convert(d),this._update(),this},v.prototype._onMove=function(d){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new _.Event("dragstart"))),this.fire(new _.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new _.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(d){this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(d){return this._draggable=!!d,this._map&&(d?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(d){return this._rotation=d||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(d){return this._rotationAlignment=d||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(d){return this._pitchAlignment=d&&d!=="auto"?d:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(_.Evented),zf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},$l=0,Yl=!1,_h=function(h){function v(d){h.call(this),this.options=_.extend({},zf,d),_.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(d){var g;return this._map=d,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Cc!==void 0?g(Cc):_.window.navigator.permissions!==void 0?_.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Cc=S.state!=="denied")}):g(Cc=!!_.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$l=0,Yl=!1},v.prototype._isOutOfMapMaxBounds=function(d){var g=this._map.getMaxBounds(),S=d.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new _.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("geolocate",d)),this._finish()}},v.prototype._updateCamera=function(d){var g=new _.LngLat(d.coords.longitude,d.coords.latitude),S=d.coords.accuracy,C=this._map.getBearing(),R=_.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},v.prototype._updateMarker=function(d){if(d){var g=new _.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var d=this._map._container.clientHeight/2,g=this._map.unproject([0,d]),S=this._map.unproject([1,d]),C=g.distanceTo(S),R=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("error",d)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(d){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=j.create("button","mapboxgl-ctrl-geolocate",this._container),j.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){_.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new tf(this._dotElement),this._circleElement=j.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new _.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return _.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new _.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$l--,Yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new _.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new _.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++$l>1?(d={maximumAge:6e5,timeout:0},Yl=!0):(d=this.options.positionOptions,Yl=!1),this._geolocationWatchID=_.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else _.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(_.Evented),Vu={maxWidth:100,unit:"metric"},Xo=function(h){this.options=_.extend({},Vu,h),_.bindAll(["_onMove","setUnit"],this)};function Zf(h,v,d){var g=d&&d.maxWidth||100,S=h._container.clientHeight/2,C=h.unproject([0,S]),R=h.unproject([g,S]),k=C.distanceTo(R);if(d&&d.unit==="imperial"){var G=3.2808*k;G>5280?ll(v,g,G/5280,h._getUIString("ScaleControl.Miles")):ll(v,g,G,h._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ll(v,g,k/1852,h._getUIString("ScaleControl.NauticalMiles")):k>=1e3?ll(v,g,k/1e3,h._getUIString("ScaleControl.Kilometers")):ll(v,g,k,h._getUIString("ScaleControl.Meters"))}function ll(h,v,d,g){var S,C,R,k=(S=d,(C=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/C)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(G){var J=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*J)/J}(R)));h.style.width=v*(k/d)+"px",h.innerHTML=k+"&nbsp;"+g}Xo.prototype.getDefaultPosition=function(){return"bottom-left"},Xo.prototype._onMove=function(){Zf(this._map,this._container,this.options)},Xo.prototype.onAdd=function(h){return this._map=h,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Xo.prototype.onRemove=function(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Xo.prototype.setUnit=function(h){this.options.unit=h,Zf(this._map,this._container,this.options)};var au=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof _.window.HTMLElement?this._container=h.container:_.warnOnce("Full screen control 'container' must be a DOM element.")),_.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in _.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in _.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in _.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in _.window.document&&(this._fullscreenchange="MSFullscreenChange")};au.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",_.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},au.prototype.onRemove=function(){j.remove(this._controlContainer),this._map=null,_.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},au.prototype._checkFullscreenSupport=function(){return!!(_.window.document.fullscreenEnabled||_.window.document.mozFullScreenEnabled||_.window.document.msFullscreenEnabled||_.window.document.webkitFullscreenEnabled)},au.prototype._setupUI=function(){var h=this._fullscreenButton=j.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),_.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},au.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},au.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},au.prototype._isFullscreen=function(){return this._fullscreen},au.prototype._changeIcon=function(){(_.window.document.fullscreenElement||_.window.document.mozFullScreenElement||_.window.document.webkitFullscreenElement||_.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},au.prototype._onClickFullscreen=function(){this._isFullscreen()?_.window.document.exitFullscreen?_.window.document.exitFullscreen():_.window.document.mozCancelFullScreen?_.window.document.mozCancelFullScreen():_.window.document.msExitFullscreen?_.window.document.msExitFullscreen():_.window.document.webkitCancelFullScreen&&_.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var xh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),cl=function(h){function v(d){h.call(this),this.options=_.extend(Object.create(xh),d),_.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new _.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new _.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(d){return this._lngLat=_.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(d){return this.setDOMContent(_.window.document.createTextNode(d))},v.prototype.setHTML=function(d){var g,S=_.window.document.createDocumentFragment(),C=_.window.document.createElement("body");for(C.innerHTML=d;g=C.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(d){return this.options.maxWidth=d,this._update(),this},v.prototype.setDOMContent=function(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(d){this._container&&this._container.classList.add(d)},v.prototype.removeClassName=function(d){this._container&&this._container.classList.remove(d)},v.prototype.setOffset=function(d){return this.options.offset=d,this._update(),this},v.prototype.toggleClassName=function(d){if(this._container)return this._container.classList.toggle(d)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=j.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(d){this._update(d.point)},v.prototype._onMouseMove=function(d){this._update(d.point)},v.prototype._onDrag=function(d){this._update(d.point)},v.prototype._update=function(d){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=j.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(be){return g._container.classList.add(be)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ol(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d)){var S=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),C=this.options.anchor,R=function be(Te){if(Te){if(typeof Te=="number"){var $e=Math.round(Math.sqrt(.5*Math.pow(Te,2)));return{center:new _.Point(0,0),top:new _.Point(0,Te),"top-left":new _.Point($e,$e),"top-right":new _.Point(-$e,$e),bottom:new _.Point(0,-Te),"bottom-left":new _.Point($e,-$e),"bottom-right":new _.Point(-$e,-$e),left:new _.Point(Te,0),right:new _.Point(-Te,0)}}if(Te instanceof _.Point||Array.isArray(Te)){var Ve=_.Point.convert(Te);return{center:Ve,top:Ve,"top-left":Ve,"top-right":Ve,bottom:Ve,"bottom-left":Ve,"bottom-right":Ve,left:Ve,right:Ve}}return{center:_.Point.convert(Te.center||[0,0]),top:_.Point.convert(Te.top||[0,0]),"top-left":_.Point.convert(Te["top-left"]||[0,0]),"top-right":_.Point.convert(Te["top-right"]||[0,0]),bottom:_.Point.convert(Te.bottom||[0,0]),"bottom-left":_.Point.convert(Te["bottom-left"]||[0,0]),"bottom-right":_.Point.convert(Te["bottom-right"]||[0,0]),left:_.Point.convert(Te.left||[0,0]),right:_.Point.convert(Te.right||[0,0])}}return be(new _.Point(0,0))}(this.options.offset);if(!C){var k,G=this._container.offsetWidth,J=this._container.offsetHeight;k=S.y+R.bottom.y<J?["top"]:S.y>this._map.transform.height-J?["bottom"]:[],S.x<G/2?k.push("left"):S.x>this._map.transform.width-G/2&&k.push("right"),C=k.length===0?"bottom":k.join("-")}var _e=S.add(R[C]).round();j.setTransform(this._container,xu[C]+" translate("+_e.x+"px,"+_e.y+"px)"),ef(this._container,C,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var d=this._container.querySelector(rf);d&&d.focus()}},v.prototype._onClose=function(){this.remove()},v}(_.Evented),Vf={version:_.version,supported:de,setRTLTextPlugin:_.setRTLTextPlugin,getRTLTextPluginStatus:_.getRTLTextPluginStatus,Map:Nf,NavigationControl:ul,GeolocateControl:_h,AttributionControl:Eo,ScaleControl:Xo,FullscreenControl:au,Popup:cl,Marker:tf,Style:Is,LngLat:_.LngLat,LngLatBounds:_.LngLatBounds,Point:_.Point,MercatorCoordinate:_.MercatorCoordinate,Evented:_.Evented,config:_.config,prewarm:function(){Jt().acquire(pe)},clearPrewarmedResources:function(){var h=tn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(pe),tn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return _.config.ACCESS_TOKEN},set accessToken(h){_.config.ACCESS_TOKEN=h},get baseApiUrl(){return _.config.API_URL},set baseApiUrl(h){_.config.API_URL=h},get workerCount(){return yr.workerCount},set workerCount(h){yr.workerCount=h},get maxParallelImageRequests(){return _.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){_.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){_.clearTileCache(h)},workerUrl:""};return Vf}),ge})},3614:function(vr,se,Z){"use strict";vr.exports=oe;var ge=Z(80645);function oe(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}oe.Varint=0,oe.Fixed64=1,oe.Bytes=2,oe.Fixed32=5;var _=(1<<16)*(1<<16),de=1/_,j=12,ue=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");oe.prototype={destroy:function(){this.buf=null},readFields:function(te,Ne,O){for(O=O||this.length;this.pos<O;){var Pe=this.readVarint(),Ce=Pe>>3,pt=this.pos;this.type=Pe&7,te(Ce,Ne,this),this.pos===pt&&this.skip(Pe)}return Ne},readMessage:function(te,Ne){return this.readFields(te,Ne,this.readVarint()+this.pos)},readFixed32:function(){var te=It(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=Ft(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=It(this.buf,this.pos)+It(this.buf,this.pos+4)*_;return this.pos+=8,te},readSFixed64:function(){var te=It(this.buf,this.pos)+Ft(this.buf,this.pos+4)*_;return this.pos+=8,te},readFloat:function(){var te=ge.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=ge.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var Ne=this.buf,O,Pe;return Pe=Ne[this.pos++],O=Pe&127,Pe<128||(Pe=Ne[this.pos++],O|=(Pe&127)<<7,Pe<128)||(Pe=Ne[this.pos++],O|=(Pe&127)<<14,Pe<128)||(Pe=Ne[this.pos++],O|=(Pe&127)<<21,Pe<128)?O:(Pe=Ne[this.pos],O|=(Pe&15)<<28,ie(O,te,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2==1?(te+1)/-2:te/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var te=this.readVarint()+this.pos,Ne=this.pos;return this.pos=te,te-Ne>=j&&ue?sr(this.buf,Ne,te):ht(this.buf,Ne,te)},readBytes:function(){var te=this.readVarint()+this.pos,Ne=this.buf.subarray(this.pos,te);return this.pos=te,Ne},readPackedVarint:function(te,Ne){if(this.type!==oe.Bytes)return te.push(this.readVarint(Ne));var O=De(this);for(te=te||[];this.pos<O;)te.push(this.readVarint(Ne));return te},readPackedSVarint:function(te){if(this.type!==oe.Bytes)return te.push(this.readSVarint());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==oe.Bytes)return te.push(this.readBoolean());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==oe.Bytes)return te.push(this.readFloat());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==oe.Bytes)return te.push(this.readDouble());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==oe.Bytes)return te.push(this.readFixed32());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==oe.Bytes)return te.push(this.readSFixed32());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==oe.Bytes)return te.push(this.readFixed64());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==oe.Bytes)return te.push(this.readSFixed64());var Ne=De(this);for(te=te||[];this.pos<Ne;)te.push(this.readSFixed64());return te},skip:function(te){var Ne=te&7;if(Ne===oe.Varint)for(;this.buf[this.pos++]>127;);else if(Ne===oe.Bytes)this.pos=this.readVarint()+this.pos;else if(Ne===oe.Fixed32)this.pos+=4;else if(Ne===oe.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ne)},writeTag:function(te,Ne){this.writeVarint(te<<3|Ne)},realloc:function(te){for(var Ne=this.length||16;Ne<this.pos+te;)Ne*=2;if(Ne!==this.length){var O=new Uint8Array(Ne);O.set(this.buf),this.buf=O,this.length=Ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),ct(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),ct(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),ct(this.buf,te&-1,this.pos),ct(this.buf,Math.floor(te*de),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),ct(this.buf,te&-1,this.pos),ct(this.buf,Math.floor(te*de),this.pos+4),this.pos+=8},writeVarint:function(te){if(te=+te||0,te>268435455||te<0){Ze(te,this);return}this.realloc(4),this.buf[this.pos++]=te&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=te>>>7&127)))},writeSVarint:function(te){this.writeVarint(te<0?-te*2-1:te*2)},writeBoolean:function(te){this.writeVarint(Boolean(te))},writeString:function(te){te=String(te),this.realloc(te.length*4),this.pos++;var Ne=this.pos;this.pos=br(this.buf,te,this.pos);var O=this.pos-Ne;O>=128&&Pt(Ne,O,this),this.pos=Ne-1,this.writeVarint(O),this.pos+=O},writeFloat:function(te){this.realloc(4),ge.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),ge.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var Ne=te.length;this.writeVarint(Ne),this.realloc(Ne);for(var O=0;O<Ne;O++)this.buf[this.pos++]=te[O]},writeRawMessage:function(te,Ne){this.pos++;var O=this.pos;te(Ne,this);var Pe=this.pos-O;Pe>=128&&Pt(O,Pe,this),this.pos=O-1,this.writeVarint(Pe),this.pos+=Pe},writeMessage:function(te,Ne,O){this.writeTag(te,oe.Bytes),this.writeRawMessage(Ne,O)},writePackedVarint:function(te,Ne){Ne.length&&this.writeMessage(te,Ct,Ne)},writePackedSVarint:function(te,Ne){Ne.length&&this.writeMessage(te,$t,Ne)},writePackedBoolean:function(te,Ne){Ne.length&&this.writeMessage(te,Mt,Ne)},writePackedFloat:function(te,Ne){Ne.length&&this.writeMessage(te,rr,Ne)},writePackedDouble:function(te,Ne){Ne.length&&this.writeMessage(te,zt,Ne)},writePackedFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,Et,Ne)},writePackedSFixed32:function(te,Ne){Ne.length&&this.writeMessage(te,Fr,Ne)},writePackedFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,Ar,Ne)},writePackedSFixed64:function(te,Ne){Ne.length&&this.writeMessage(te,dr,Ne)},writeBytesField:function(te,Ne){this.writeTag(te,oe.Bytes),this.writeBytes(Ne)},writeFixed32Field:function(te,Ne){this.writeTag(te,oe.Fixed32),this.writeFixed32(Ne)},writeSFixed32Field:function(te,Ne){this.writeTag(te,oe.Fixed32),this.writeSFixed32(Ne)},writeFixed64Field:function(te,Ne){this.writeTag(te,oe.Fixed64),this.writeFixed64(Ne)},writeSFixed64Field:function(te,Ne){this.writeTag(te,oe.Fixed64),this.writeSFixed64(Ne)},writeVarintField:function(te,Ne){this.writeTag(te,oe.Varint),this.writeVarint(Ne)},writeSVarintField:function(te,Ne){this.writeTag(te,oe.Varint),this.writeSVarint(Ne)},writeStringField:function(te,Ne){this.writeTag(te,oe.Bytes),this.writeString(Ne)},writeFloatField:function(te,Ne){this.writeTag(te,oe.Fixed32),this.writeFloat(Ne)},writeDoubleField:function(te,Ne){this.writeTag(te,oe.Fixed64),this.writeDouble(Ne)},writeBooleanField:function(te,Ne){this.writeVarintField(te,Boolean(Ne))}};function ie(te,Ne,O){var Pe=O.buf,Ce,pt;if(pt=Pe[O.pos++],Ce=(pt&112)>>4,pt<128||(pt=Pe[O.pos++],Ce|=(pt&127)<<3,pt<128)||(pt=Pe[O.pos++],Ce|=(pt&127)<<10,pt<128)||(pt=Pe[O.pos++],Ce|=(pt&127)<<17,pt<128)||(pt=Pe[O.pos++],Ce|=(pt&127)<<24,pt<128)||(pt=Pe[O.pos++],Ce|=(pt&1)<<31,pt<128))return ne(te,Ce,Ne);throw new Error("Expected varint not more than 10 bytes")}function De(te){return te.type===oe.Bytes?te.readVarint()+te.pos:te.pos+1}function ne(te,Ne,O){return O?Ne*4294967296+(te>>>0):(Ne>>>0)*4294967296+(te>>>0)}function Ze(te,Ne){var O,Pe;if(te>=0?(O=te%4294967296|0,Pe=te/4294967296|0):(O=~(-te%4294967296),Pe=~(-te/4294967296),O^4294967295?O=O+1|0:(O=0,Pe=Pe+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ne.realloc(10),nt(O,Pe,Ne),rt(Pe,Ne)}function nt(te,Ne,O){O.buf[O.pos++]=te&127|128,te>>>=7,O.buf[O.pos++]=te&127|128,te>>>=7,O.buf[O.pos++]=te&127|128,te>>>=7,O.buf[O.pos++]=te&127|128,te>>>=7,O.buf[O.pos]=te&127}function rt(te,Ne){var O=(te&7)<<4;Ne.buf[Ne.pos++]|=O|((te>>>=3)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127|((te>>>=7)?128:0),!!te&&(Ne.buf[Ne.pos++]=te&127)))))}function Pt(te,Ne,O){var Pe=Ne<=16383?1:Ne<=2097151?2:Ne<=268435455?3:Math.floor(Math.log(Ne)/(Math.LN2*7));O.realloc(Pe);for(var Ce=O.pos-1;Ce>=te;Ce--)O.buf[Ce+Pe]=O.buf[Ce]}function Ct(te,Ne){for(var O=0;O<te.length;O++)Ne.writeVarint(te[O])}function $t(te,Ne){for(var O=0;O<te.length;O++)Ne.writeSVarint(te[O])}function rr(te,Ne){for(var O=0;O<te.length;O++)Ne.writeFloat(te[O])}function zt(te,Ne){for(var O=0;O<te.length;O++)Ne.writeDouble(te[O])}function Mt(te,Ne){for(var O=0;O<te.length;O++)Ne.writeBoolean(te[O])}function Et(te,Ne){for(var O=0;O<te.length;O++)Ne.writeFixed32(te[O])}function Fr(te,Ne){for(var O=0;O<te.length;O++)Ne.writeSFixed32(te[O])}function Ar(te,Ne){for(var O=0;O<te.length;O++)Ne.writeFixed64(te[O])}function dr(te,Ne){for(var O=0;O<te.length;O++)Ne.writeSFixed64(te[O])}function It(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+te[Ne+3]*16777216}function ct(te,Ne,O){te[O]=Ne,te[O+1]=Ne>>>8,te[O+2]=Ne>>>16,te[O+3]=Ne>>>24}function Ft(te,Ne){return(te[Ne]|te[Ne+1]<<8|te[Ne+2]<<16)+(te[Ne+3]<<24)}function ht(te,Ne,O){for(var Pe="",Ce=Ne;Ce<O;){var pt=te[Ce],Ye=null,We=pt>239?4:pt>223?3:pt>191?2:1;if(Ce+We>O)break;var ot,Tt,gr;We===1?pt<128&&(Ye=pt):We===2?(ot=te[Ce+1],(ot&192)==128&&(Ye=(pt&31)<<6|ot&63,Ye<=127&&(Ye=null))):We===3?(ot=te[Ce+1],Tt=te[Ce+2],(ot&192)==128&&(Tt&192)==128&&(Ye=(pt&15)<<12|(ot&63)<<6|Tt&63,(Ye<=2047||Ye>=55296&&Ye<=57343)&&(Ye=null))):We===4&&(ot=te[Ce+1],Tt=te[Ce+2],gr=te[Ce+3],(ot&192)==128&&(Tt&192)==128&&(gr&192)==128&&(Ye=(pt&15)<<18|(ot&63)<<12|(Tt&63)<<6|gr&63,(Ye<=65535||Ye>=1114112)&&(Ye=null))),Ye===null?(Ye=65533,We=1):Ye>65535&&(Ye-=65536,Pe+=String.fromCharCode(Ye>>>10&1023|55296),Ye=56320|Ye&1023),Pe+=String.fromCharCode(Ye),Ce+=We}return Pe}function sr(te,Ne,O){return ue.decode(te.subarray(Ne,O))}function br(te,Ne,O){for(var Pe=0,Ce,pt;Pe<Ne.length;Pe++){if(Ce=Ne.charCodeAt(Pe),Ce>55295&&Ce<57344)if(pt)if(Ce<56320){te[O++]=239,te[O++]=191,te[O++]=189,pt=Ce;continue}else Ce=pt-55296<<10|Ce-56320|65536,pt=null;else{Ce>56319||Pe+1===Ne.length?(te[O++]=239,te[O++]=191,te[O++]=189):pt=Ce;continue}else pt&&(te[O++]=239,te[O++]=191,te[O++]=189,pt=null);Ce<128?te[O++]=Ce:(Ce<2048?te[O++]=Ce>>6|192:(Ce<65536?te[O++]=Ce>>12|224:(te[O++]=Ce>>18|240,te[O++]=Ce>>12&63|128),te[O++]=Ce>>6&63|128),te[O++]=Ce&63|128)}return O}},32676:function(vr,se,Z){var ge=Z(34155);(function(oe,_){vr.exports=_()})(this,function(){"use strict";/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function oe(fe,D){var z={label:0,sent:function(){if(Le[0]&1)throw Le[1];return Le[1]},trys:[],ops:[]},ae,Se,Le,Ht;return Ht={next:Ot(0),throw:Ot(1),return:Ot(2)},typeof Symbol=="function"&&(Ht[Symbol.iterator]=function(){return this}),Ht;function Ot(yt){return function(U){return kt([yt,U])}}function kt(yt){if(ae)throw new TypeError("Generator is already executing.");for(;z;)try{if(ae=1,Se&&(Le=yt[0]&2?Se.return:yt[0]?Se.throw||((Le=Se.return)&&Le.call(Se),0):Se.next)&&!(Le=Le.call(Se,yt[1])).done)return Le;switch(Se=0,Le&&(yt=[yt[0]&2,Le.value]),yt[0]){case 0:case 1:Le=yt;break;case 4:return z.label++,{value:yt[1],done:!1};case 5:z.label++,Se=yt[1],yt=[0];continue;case 7:yt=z.ops.pop(),z.trys.pop();continue;default:if(Le=z.trys,!(Le=Le.length>0&&Le[Le.length-1])&&(yt[0]===6||yt[0]===2)){z=0;continue}if(yt[0]===3&&(!Le||yt[1]>Le[0]&&yt[1]<Le[3])){z.label=yt[1];break}if(yt[0]===6&&z.label<Le[1]){z.label=Le[1],Le=yt;break}if(Le&&z.label<Le[2]){z.label=Le[2],z.ops.push(yt);break}Le[2]&&z.ops.pop(),z.trys.pop();continue}yt=D.call(fe,z)}catch(U){yt=[6,U],Se=0}finally{ae=Le=0}if(yt[0]&5)throw yt[1];return{value:yt[0]?yt[1]:void 0,done:!0}}}var _=function(){function fe(D,z){this.next=null,this.key=D,this.data=z,this.left=null,this.right=null}return fe}();function de(fe,D){return fe>D?1:fe<D?-1:0}function j(fe,D,z){for(var ae=new _(null,null),Se=ae,Le=ae;;){var Ht=z(fe,D.key);if(Ht<0){if(D.left===null)break;if(z(fe,D.left.key)<0){var Ot=D.left;if(D.left=Ot.right,Ot.right=D,D=Ot,D.left===null)break}Le.left=D,Le=D,D=D.left}else if(Ht>0){if(D.right===null)break;if(z(fe,D.right.key)>0){var Ot=D.right;if(D.right=Ot.left,Ot.left=D,D=Ot,D.right===null)break}Se.right=D,Se=D,D=D.right}else break}return Se.right=D.left,Le.left=D.right,D.left=ae.right,D.right=ae.left,D}function ue(fe,D,z,ae){var Se=new _(fe,D);if(z===null)return Se.left=Se.right=null,Se;z=j(fe,z,ae);var Le=ae(fe,z.key);return Le<0?(Se.left=z.left,Se.right=z,z.left=null):Le>=0&&(Se.right=z.right,Se.left=z,z.right=null),Se}function ie(fe,D,z){var ae=null,Se=null;if(D){D=j(fe,D,z);var Le=z(D.key,fe);Le===0?(ae=D.left,Se=D.right):Le<0?(Se=D.right,D.right=null,ae=D):(ae=D.left,D.left=null,Se=D)}return{left:ae,right:Se}}function De(fe,D,z){return D===null?fe:(fe===null||(D=j(fe.key,D,z),D.left=fe),D)}function ne(fe,D,z,ae,Se){if(fe){ae(""+D+(z?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Se(fe)+`
`);var Le=D+(z?"    ":"\u2502   ");fe.left&&ne(fe.left,Le,!1,ae,Se),fe.right&&ne(fe.right,Le,!0,ae,Se)}}var Ze=function(){function fe(D){D===void 0&&(D=de),this._root=null,this._size=0,this._comparator=D}return fe.prototype.insert=function(D,z){return this._size++,this._root=ue(D,z,this._root,this._comparator)},fe.prototype.add=function(D,z){var ae=new _(D,z);this._root===null&&(ae.left=ae.right=null,this._size++,this._root=ae);var Se=this._comparator,Le=j(D,this._root,Se),Ht=Se(D,Le.key);return Ht===0?this._root=Le:(Ht<0?(ae.left=Le.left,ae.right=Le,Le.left=null):Ht>0&&(ae.right=Le.right,ae.left=Le,Le.right=null),this._size++,this._root=ae),this._root},fe.prototype.remove=function(D){this._root=this._remove(D,this._root,this._comparator)},fe.prototype._remove=function(D,z,ae){var Se;if(z===null)return null;z=j(D,z,ae);var Le=ae(D,z.key);return Le===0?(z.left===null?Se=z.right:(Se=j(D,z.left,ae),Se.right=z.right),this._size--,Se):z},fe.prototype.pop=function(){var D=this._root;if(D){for(;D.left;)D=D.left;return this._root=j(D.key,this._root,this._comparator),this._root=this._remove(D.key,this._root,this._comparator),{key:D.key,data:D.data}}return null},fe.prototype.findStatic=function(D){for(var z=this._root,ae=this._comparator;z;){var Se=ae(D,z.key);if(Se===0)return z;Se<0?z=z.left:z=z.right}return null},fe.prototype.find=function(D){return this._root&&(this._root=j(D,this._root,this._comparator),this._comparator(D,this._root.key)!==0)?null:this._root},fe.prototype.contains=function(D){for(var z=this._root,ae=this._comparator;z;){var Se=ae(D,z.key);if(Se===0)return!0;Se<0?z=z.left:z=z.right}return!1},fe.prototype.forEach=function(D,z){for(var ae=this._root,Se=[],Le=!1;!Le;)ae!==null?(Se.push(ae),ae=ae.left):Se.length!==0?(ae=Se.pop(),D.call(z,ae),ae=ae.right):Le=!0;return this},fe.prototype.range=function(D,z,ae,Se){for(var Le=[],Ht=this._comparator,Ot=this._root,kt;Le.length!==0||Ot;)if(Ot)Le.push(Ot),Ot=Ot.left;else{if(Ot=Le.pop(),kt=Ht(Ot.key,z),kt>0)break;if(Ht(Ot.key,D)>=0&&ae.call(Se,Ot))return this;Ot=Ot.right}return this},fe.prototype.keys=function(){var D=[];return this.forEach(function(z){var ae=z.key;return D.push(ae)}),D},fe.prototype.values=function(){var D=[];return this.forEach(function(z){var ae=z.data;return D.push(ae)}),D},fe.prototype.min=function(){return this._root?this.minNode(this._root).key:null},fe.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},fe.prototype.minNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.left;)D=D.left;return D},fe.prototype.maxNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.right;)D=D.right;return D},fe.prototype.at=function(D){for(var z=this._root,ae=!1,Se=0,Le=[];!ae;)if(z)Le.push(z),z=z.left;else if(Le.length>0){if(z=Le.pop(),Se===D)return z;Se++,z=z.right}else ae=!0;return null},fe.prototype.next=function(D){var z=this._root,ae=null;if(D.right){for(ae=D.right;ae.left;)ae=ae.left;return ae}for(var Se=this._comparator;z;){var Le=Se(D.key,z.key);if(Le===0)break;Le<0?(ae=z,z=z.left):z=z.right}return ae},fe.prototype.prev=function(D){var z=this._root,ae=null;if(D.left!==null){for(ae=D.left;ae.right;)ae=ae.right;return ae}for(var Se=this._comparator;z;){var Le=Se(D.key,z.key);if(Le===0)break;Le<0?z=z.left:(ae=z,z=z.right)}return ae},fe.prototype.clear=function(){return this._root=null,this._size=0,this},fe.prototype.toList=function(){return Pt(this._root)},fe.prototype.load=function(D,z,ae){z===void 0&&(z=[]),ae===void 0&&(ae=!1);var Se=D.length,Le=this._comparator;if(ae&&rr(D,z,0,Se-1,Le),this._root===null)this._root=nt(D,z,0,Se),this._size=Se;else{var Ht=$t(this.toList(),rt(D,z),Le);Se=this._size+Se,this._root=Ct({head:Ht},0,Se)}return this},fe.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(fe.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),fe.prototype.toString=function(D){D===void 0&&(D=function(ae){return String(ae.key)});var z=[];return ne(this._root,"",!0,function(ae){return z.push(ae)},D),z.join("")},fe.prototype.update=function(D,z,ae){var Se=this._comparator,Le=ie(D,this._root,Se),Ht=Le.left,Ot=Le.right;Se(D,z)<0?Ot=ue(z,ae,Ot,Se):Ht=ue(z,ae,Ht,Se),this._root=De(Ht,Ot,Se)},fe.prototype.split=function(D){return ie(D,this._root,this._comparator)},fe.prototype[Symbol.iterator]=function(){var D,z,ae;return oe(this,function(Se){switch(Se.label){case 0:D=this._root,z=[],ae=!1,Se.label=1;case 1:return ae?[3,6]:D===null?[3,2]:(z.push(D),D=D.left,[3,5]);case 2:return z.length===0?[3,4]:(D=z.pop(),[4,D]);case 3:return Se.sent(),D=D.right,[3,5];case 4:ae=!0,Se.label=5;case 5:return[3,1];case 6:return[2]}})},fe}();function nt(fe,D,z,ae){var Se=ae-z;if(Se>0){var Le=z+Math.floor(Se/2),Ht=fe[Le],Ot=D[Le],kt=new _(Ht,Ot);return kt.left=nt(fe,D,z,Le),kt.right=nt(fe,D,Le+1,ae),kt}return null}function rt(fe,D){for(var z=new _(null,null),ae=z,Se=0;Se<fe.length;Se++)ae=ae.next=new _(fe[Se],D[Se]);return ae.next=null,z.next}function Pt(fe){for(var D=fe,z=[],ae=!1,Se=new _(null,null),Le=Se;!ae;)D?(z.push(D),D=D.left):z.length>0?(D=Le=Le.next=z.pop(),D=D.right):ae=!0;return Le.next=null,Se.next}function Ct(fe,D,z){var ae=z-D;if(ae>0){var Se=D+Math.floor(ae/2),Le=Ct(fe,D,Se),Ht=fe.head;return Ht.left=Le,fe.head=fe.head.next,Ht.right=Ct(fe,Se+1,z),Ht}return null}function $t(fe,D,z){for(var ae=new _(null,null),Se=ae,Le=fe,Ht=D;Le!==null&&Ht!==null;)z(Le.key,Ht.key)<0?(Se.next=Le,Le=Le.next):(Se.next=Ht,Ht=Ht.next),Se=Se.next;return Le!==null?Se.next=Le:Ht!==null&&(Se.next=Ht),ae.next}function rr(fe,D,z,ae,Se){if(!(z>=ae)){for(var Le=fe[z+ae>>1],Ht=z-1,Ot=ae+1;;){do Ht++;while(Se(fe[Ht],Le)<0);do Ot--;while(Se(fe[Ot],Le)>0);if(Ht>=Ot)break;var kt=fe[Ht];fe[Ht]=fe[Ot],fe[Ot]=kt,kt=D[Ht],D[Ht]=D[Ot],D[Ot]=kt}rr(fe,D,z,Ot,Se),rr(fe,D,Ot+1,ae,Se)}}const zt=(fe,D)=>fe.ll.x<=D.x&&D.x<=fe.ur.x&&fe.ll.y<=D.y&&D.y<=fe.ur.y,Mt=(fe,D)=>{if(D.ur.x<fe.ll.x||fe.ur.x<D.ll.x||D.ur.y<fe.ll.y||fe.ur.y<D.ll.y)return null;const z=fe.ll.x<D.ll.x?D.ll.x:fe.ll.x,ae=fe.ur.x<D.ur.x?fe.ur.x:D.ur.x,Se=fe.ll.y<D.ll.y?D.ll.y:fe.ll.y,Le=fe.ur.y<D.ur.y?fe.ur.y:D.ur.y;return{ll:{x:z,y:Se},ur:{x:ae,y:Le}}};let Et=Number.EPSILON;Et===void 0&&(Et=Math.pow(2,-52));const Fr=Et*Et,Ar=(fe,D)=>{if(-Et<fe&&fe<Et&&-Et<D&&D<Et)return 0;const z=fe-D;return z*z<Fr*fe*D?0:fe<D?-1:1};class dr{constructor(){this.reset()}reset(){this.xRounder=new It,this.yRounder=new It}round(D,z){return{x:this.xRounder.round(D),y:this.yRounder.round(z)}}}class It{constructor(){this.tree=new Ze,this.round(0)}round(D){const z=this.tree.add(D),ae=this.tree.prev(z);if(ae!==null&&Ar(z.key,ae.key)===0)return this.tree.remove(D),ae.key;const Se=this.tree.next(z);return Se!==null&&Ar(z.key,Se.key)===0?(this.tree.remove(D),Se.key):D}}const ct=new dr,Ft=11102230246251565e-32,ht=134217729,sr=(3+8*Ft)*Ft;function br(fe,D,z,ae,Se){let Le,Ht,Ot,kt,yt=D[0],U=ae[0],N=0,X=0;U>yt==U>-yt?(Le=yt,yt=D[++N]):(Le=U,U=ae[++X]);let ee=0;if(N<fe&&X<z)for(U>yt==U>-yt?(Ht=yt+Le,Ot=Le-(Ht-yt),yt=D[++N]):(Ht=U+Le,Ot=Le-(Ht-U),U=ae[++X]),Le=Ht,Ot!==0&&(Se[ee++]=Ot);N<fe&&X<z;)U>yt==U>-yt?(Ht=Le+yt,kt=Ht-Le,Ot=Le-(Ht-kt)+(yt-kt),yt=D[++N]):(Ht=Le+U,kt=Ht-Le,Ot=Le-(Ht-kt)+(U-kt),U=ae[++X]),Le=Ht,Ot!==0&&(Se[ee++]=Ot);for(;N<fe;)Ht=Le+yt,kt=Ht-Le,Ot=Le-(Ht-kt)+(yt-kt),yt=D[++N],Le=Ht,Ot!==0&&(Se[ee++]=Ot);for(;X<z;)Ht=Le+U,kt=Ht-Le,Ot=Le-(Ht-kt)+(U-kt),U=ae[++X],Le=Ht,Ot!==0&&(Se[ee++]=Ot);return(Le!==0||ee===0)&&(Se[ee++]=Le),ee}function te(fe,D){let z=D[0];for(let ae=1;ae<fe;ae++)z+=D[ae];return z}function Ne(fe){return new Float64Array(fe)}const O=(3+16*Ft)*Ft,Pe=(2+12*Ft)*Ft,Ce=(9+64*Ft)*Ft*Ft,pt=Ne(4),Ye=Ne(8),We=Ne(12),ot=Ne(16),Tt=Ne(4);function gr(fe,D,z,ae,Se,Le,Ht){let Ot,kt,yt,U,N,X,ee,Ee,Ue,et,he,Q,ye,Je,_t,pe,yr,tn;const rn=fe-Se,Jt=z-Se,Kr=D-Le,Nr=ae-Le;Je=rn*Nr,X=ht*rn,ee=X-(X-rn),Ee=rn-ee,X=ht*Nr,Ue=X-(X-Nr),et=Nr-Ue,_t=Ee*et-(Je-ee*Ue-Ee*Ue-ee*et),pe=Kr*Jt,X=ht*Kr,ee=X-(X-Kr),Ee=Kr-ee,X=ht*Jt,Ue=X-(X-Jt),et=Jt-Ue,yr=Ee*et-(pe-ee*Ue-Ee*Ue-ee*et),he=_t-yr,N=_t-he,pt[0]=_t-(he+N)+(N-yr),Q=Je+he,N=Q-Je,ye=Je-(Q-N)+(he-N),he=ye-pe,N=ye-he,pt[1]=ye-(he+N)+(N-pe),tn=Q+he,N=tn-Q,pt[2]=Q-(tn-N)+(he-N),pt[3]=tn;let Xr=te(4,pt),si=Pe*Ht;if(Xr>=si||-Xr>=si||(N=fe-rn,Ot=fe-(rn+N)+(N-Se),N=z-Jt,yt=z-(Jt+N)+(N-Se),N=D-Kr,kt=D-(Kr+N)+(N-Le),N=ae-Nr,U=ae-(Nr+N)+(N-Le),Ot===0&&kt===0&&yt===0&&U===0)||(si=Ce*Ht+sr*Math.abs(Xr),Xr+=rn*U+Nr*Ot-(Kr*yt+Jt*kt),Xr>=si||-Xr>=si))return Xr;Je=Ot*Nr,X=ht*Ot,ee=X-(X-Ot),Ee=Ot-ee,X=ht*Nr,Ue=X-(X-Nr),et=Nr-Ue,_t=Ee*et-(Je-ee*Ue-Ee*Ue-ee*et),pe=kt*Jt,X=ht*kt,ee=X-(X-kt),Ee=kt-ee,X=ht*Jt,Ue=X-(X-Jt),et=Jt-Ue,yr=Ee*et-(pe-ee*Ue-Ee*Ue-ee*et),he=_t-yr,N=_t-he,Tt[0]=_t-(he+N)+(N-yr),Q=Je+he,N=Q-Je,ye=Je-(Q-N)+(he-N),he=ye-pe,N=ye-he,Tt[1]=ye-(he+N)+(N-pe),tn=Q+he,N=tn-Q,Tt[2]=Q-(tn-N)+(he-N),Tt[3]=tn;const un=br(4,pt,4,Tt,Ye);Je=rn*U,X=ht*rn,ee=X-(X-rn),Ee=rn-ee,X=ht*U,Ue=X-(X-U),et=U-Ue,_t=Ee*et-(Je-ee*Ue-Ee*Ue-ee*et),pe=Kr*yt,X=ht*Kr,ee=X-(X-Kr),Ee=Kr-ee,X=ht*yt,Ue=X-(X-yt),et=yt-Ue,yr=Ee*et-(pe-ee*Ue-Ee*Ue-ee*et),he=_t-yr,N=_t-he,Tt[0]=_t-(he+N)+(N-yr),Q=Je+he,N=Q-Je,ye=Je-(Q-N)+(he-N),he=ye-pe,N=ye-he,Tt[1]=ye-(he+N)+(N-pe),tn=Q+he,N=tn-Q,Tt[2]=Q-(tn-N)+(he-N),Tt[3]=tn;const vi=br(un,Ye,4,Tt,We);Je=Ot*U,X=ht*Ot,ee=X-(X-Ot),Ee=Ot-ee,X=ht*U,Ue=X-(X-U),et=U-Ue,_t=Ee*et-(Je-ee*Ue-Ee*Ue-ee*et),pe=kt*yt,X=ht*kt,ee=X-(X-kt),Ee=kt-ee,X=ht*yt,Ue=X-(X-yt),et=yt-Ue,yr=Ee*et-(pe-ee*Ue-Ee*Ue-ee*et),he=_t-yr,N=_t-he,Tt[0]=_t-(he+N)+(N-yr),Q=Je+he,N=Q-Je,ye=Je-(Q-N)+(he-N),he=ye-pe,N=ye-he,Tt[1]=ye-(he+N)+(N-pe),tn=Q+he,N=tn-Q,Tt[2]=Q-(tn-N)+(he-N),Tt[3]=tn;const Ni=br(vi,We,4,Tt,ot);return ot[Ni-1]}function wt(fe,D,z,ae,Se,Le){const Ht=(D-Le)*(z-Se),Ot=(fe-Se)*(ae-Le),kt=Ht-Ot,yt=Math.abs(Ht+Ot);return Math.abs(kt)>=O*yt?kt:-gr(fe,D,z,ae,Se,Le,yt)}const hn=(fe,D)=>fe.x*D.y-fe.y*D.x,Hr=(fe,D)=>fe.x*D.x+fe.y*D.y,Vr=(fe,D,z)=>{const ae=wt(fe.x,fe.y,D.x,D.y,z.x,z.y);return ae>0?-1:ae<0?1:0},qn=fe=>Math.sqrt(Hr(fe,fe)),Nn=(fe,D,z)=>{const ae={x:D.x-fe.x,y:D.y-fe.y},Se={x:z.x-fe.x,y:z.y-fe.y};return hn(Se,ae)/qn(Se)/qn(ae)},dn=(fe,D,z)=>{const ae={x:D.x-fe.x,y:D.y-fe.y},Se={x:z.x-fe.x,y:z.y-fe.y};return Hr(Se,ae)/qn(Se)/qn(ae)},Ci=(fe,D,z)=>D.y===0?null:{x:fe.x+D.x/D.y*(z-fe.y),y:z},di=(fe,D,z)=>D.x===0?null:{x:z,y:fe.y+D.y/D.x*(z-fe.x)},ta=(fe,D,z,ae)=>{if(D.x===0)return di(z,ae,fe.x);if(ae.x===0)return di(fe,D,z.x);if(D.y===0)return Ci(z,ae,fe.y);if(ae.y===0)return Ci(fe,D,z.y);const Se=hn(D,ae);if(Se==0)return null;const Le={x:z.x-fe.x,y:z.y-fe.y},Ht=hn(Le,D)/Se,Ot=hn(Le,ae)/Se,kt=fe.x+Ot*D.x,yt=z.x+Ht*ae.x,U=fe.y+Ot*D.y,N=z.y+Ht*ae.y,X=(kt+yt)/2,ee=(U+N)/2;return{x:X,y:ee}};class Rn{static compare(D,z){const ae=Rn.comparePoints(D.point,z.point);return ae!==0?ae:(D.point!==z.point&&D.link(z),D.isLeft!==z.isLeft?D.isLeft?1:-1:_a.compare(D.segment,z.segment))}static comparePoints(D,z){return D.x<z.x?-1:D.x>z.x?1:D.y<z.y?-1:D.y>z.y?1:0}constructor(D,z){D.events===void 0?D.events=[this]:D.events.push(this),this.point=D,this.isLeft=z}link(D){if(D.point===this.point)throw new Error("Tried to link already linked events");const z=D.point.events;for(let ae=0,Se=z.length;ae<Se;ae++){const Le=z[ae];this.point.events.push(Le),Le.point=this.point}this.checkForConsuming()}checkForConsuming(){const D=this.point.events.length;for(let z=0;z<D;z++){const ae=this.point.events[z];if(ae.segment.consumedBy===void 0)for(let Se=z+1;Se<D;Se++){const Le=this.point.events[Se];Le.consumedBy===void 0&&ae.otherSE.point.events===Le.otherSE.point.events&&ae.segment.consume(Le.segment)}}}getAvailableLinkedEvents(){const D=[];for(let z=0,ae=this.point.events.length;z<ae;z++){const Se=this.point.events[z];Se!==this&&!Se.segment.ringOut&&Se.segment.isInResult()&&D.push(Se)}return D}getLeftmostComparator(D){const z=new Map,ae=Se=>{const Le=Se.otherSE;z.set(Se,{sine:Nn(this.point,D.point,Le.point),cosine:dn(this.point,D.point,Le.point)})};return(Se,Le)=>{z.has(Se)||ae(Se),z.has(Le)||ae(Le);const{sine:Ht,cosine:Ot}=z.get(Se),{sine:kt,cosine:yt}=z.get(Le);return Ht>=0&&kt>=0?Ot<yt?1:Ot>yt?-1:0:Ht<0&&kt<0?Ot<yt?-1:Ot>yt?1:0:kt<Ht?-1:kt>Ht?1:0}}}let Bn=0;class _a{static compare(D,z){const ae=D.leftSE.point.x,Se=z.leftSE.point.x,Le=D.rightSE.point.x,Ht=z.rightSE.point.x;if(Ht<ae)return 1;if(Le<Se)return-1;const Ot=D.leftSE.point.y,kt=z.leftSE.point.y,yt=D.rightSE.point.y,U=z.rightSE.point.y;if(ae<Se){if(kt<Ot&&kt<yt)return 1;if(kt>Ot&&kt>yt)return-1;const N=D.comparePoint(z.leftSE.point);if(N<0)return 1;if(N>0)return-1;const X=z.comparePoint(D.rightSE.point);return X!==0?X:-1}if(ae>Se){if(Ot<kt&&Ot<U)return-1;if(Ot>kt&&Ot>U)return 1;const N=z.comparePoint(D.leftSE.point);if(N!==0)return N;const X=D.comparePoint(z.rightSE.point);return X<0?1:X>0?-1:1}if(Ot<kt)return-1;if(Ot>kt)return 1;if(Le<Ht){const N=z.comparePoint(D.rightSE.point);if(N!==0)return N}if(Le>Ht){const N=D.comparePoint(z.rightSE.point);if(N<0)return 1;if(N>0)return-1}if(Le!==Ht){const N=yt-Ot,X=Le-ae,ee=U-kt,Ee=Ht-Se;if(N>X&&ee<Ee)return 1;if(N<X&&ee>Ee)return-1}return Le>Ht?1:Le<Ht||yt<U?-1:yt>U?1:D.id<z.id?-1:D.id>z.id?1:0}constructor(D,z,ae,Se){this.id=++Bn,this.leftSE=D,D.segment=this,D.otherSE=z,this.rightSE=z,z.segment=this,z.otherSE=D,this.rings=ae,this.windings=Se}static fromRing(D,z,ae){let Se,Le,Ht;const Ot=Rn.comparePoints(D,z);if(Ot<0)Se=D,Le=z,Ht=1;else if(Ot>0)Se=z,Le=D,Ht=-1;else throw new Error(`Tried to create degenerate segment at [${D.x}, ${D.y}]`);const kt=new Rn(Se,!0),yt=new Rn(Le,!1);return new _a(kt,yt,[ae],[Ht])}replaceRightSE(D){this.rightSE=D,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const D=this.leftSE.point.y,z=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:D<z?D:z},ur:{x:this.rightSE.point.x,y:D>z?D:z}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(D){return D.x===this.leftSE.point.x&&D.y===this.leftSE.point.y||D.x===this.rightSE.point.x&&D.y===this.rightSE.point.y}comparePoint(D){if(this.isAnEndpoint(D))return 0;const z=this.leftSE.point,ae=this.rightSE.point,Se=this.vector();if(z.x===ae.x)return D.x===z.x?0:D.x<z.x?1:-1;const Le=(D.y-z.y)/Se.y,Ht=z.x+Le*Se.x;if(D.x===Ht)return 0;const Ot=(D.x-z.x)/Se.x,kt=z.y+Ot*Se.y;return D.y===kt?0:D.y<kt?-1:1}getIntersection(D){const z=this.bbox(),ae=D.bbox(),Se=Mt(z,ae);if(Se===null)return null;const Le=this.leftSE.point,Ht=this.rightSE.point,Ot=D.leftSE.point,kt=D.rightSE.point,yt=zt(z,Ot)&&this.comparePoint(Ot)===0,U=zt(ae,Le)&&D.comparePoint(Le)===0,N=zt(z,kt)&&this.comparePoint(kt)===0,X=zt(ae,Ht)&&D.comparePoint(Ht)===0;if(U&&yt)return X&&!N?Ht:!X&&N?kt:null;if(U)return N&&Le.x===kt.x&&Le.y===kt.y?null:Le;if(yt)return X&&Ht.x===Ot.x&&Ht.y===Ot.y?null:Ot;if(X&&N)return null;if(X)return Ht;if(N)return kt;const ee=ta(Le,this.vector(),Ot,D.vector());return ee===null||!zt(Se,ee)?null:ct.round(ee.x,ee.y)}split(D){const z=[],ae=D.events!==void 0,Se=new Rn(D,!0),Le=new Rn(D,!1),Ht=this.rightSE;this.replaceRightSE(Le),z.push(Le),z.push(Se);const Ot=new _a(Se,Ht,this.rings.slice(),this.windings.slice());return Rn.comparePoints(Ot.leftSE.point,Ot.rightSE.point)>0&&Ot.swapEvents(),Rn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),ae&&(Se.checkForConsuming(),Le.checkForConsuming()),z}swapEvents(){const D=this.rightSE;this.rightSE=this.leftSE,this.leftSE=D,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let z=0,ae=this.windings.length;z<ae;z++)this.windings[z]*=-1}consume(D){let z=this,ae=D;for(;z.consumedBy;)z=z.consumedBy;for(;ae.consumedBy;)ae=ae.consumedBy;const Se=_a.compare(z,ae);if(Se!==0){if(Se>0){const Le=z;z=ae,ae=Le}if(z.prev===ae){const Le=z;z=ae,ae=Le}for(let Le=0,Ht=ae.rings.length;Le<Ht;Le++){const Ot=ae.rings[Le],kt=ae.windings[Le],yt=z.rings.indexOf(Ot);yt===-1?(z.rings.push(Ot),z.windings.push(kt)):z.windings[yt]+=kt}ae.rings=null,ae.windings=null,ae.consumedBy=z,ae.leftSE.consumedBy=z.leftSE,ae.rightSE.consumedBy=z.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const D=this.prev.consumedBy||this.prev;this._beforeState=D.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const D=this.beforeState();this._afterState={rings:D.rings.slice(0),windings:D.windings.slice(0),multiPolys:[]};const z=this._afterState.rings,ae=this._afterState.windings,Se=this._afterState.multiPolys;for(let Ot=0,kt=this.rings.length;Ot<kt;Ot++){const yt=this.rings[Ot],U=this.windings[Ot],N=z.indexOf(yt);N===-1?(z.push(yt),ae.push(U)):ae[N]+=U}const Le=[],Ht=[];for(let Ot=0,kt=z.length;Ot<kt;Ot++){if(ae[Ot]===0)continue;const yt=z[Ot],U=yt.poly;if(Ht.indexOf(U)===-1)if(yt.isExterior)Le.push(U);else{Ht.indexOf(U)===-1&&Ht.push(U);const N=Le.indexOf(yt.poly);N!==-1&&Le.splice(N,1)}}for(let Ot=0,kt=Le.length;Ot<kt;Ot++){const yt=Le[Ot].multiPoly;Se.indexOf(yt)===-1&&Se.push(yt)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const D=this.beforeState().multiPolys,z=this.afterState().multiPolys;switch(Wt.type){case"union":{const ae=D.length===0,Se=z.length===0;this._isInResult=ae!==Se;break}case"intersection":{let ae,Se;D.length<z.length?(ae=D.length,Se=z.length):(ae=z.length,Se=D.length),this._isInResult=Se===Wt.numMultiPolys&&ae<Se;break}case"xor":{const ae=Math.abs(D.length-z.length);this._isInResult=ae%2==1;break}case"difference":{const ae=Se=>Se.length===1&&Se[0].isSubject;this._isInResult=ae(D)!==ae(z);break}default:throw new Error(`Unrecognized operation type found ${Wt.type}`)}return this._isInResult}}class Hi{constructor(D,z,ae){if(!Array.isArray(D)||D.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=z,this.isExterior=ae,this.segments=[],typeof D[0][0]!="number"||typeof D[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Se=ct.round(D[0][0],D[0][1]);this.bbox={ll:{x:Se.x,y:Se.y},ur:{x:Se.x,y:Se.y}};let Le=Se;for(let Ht=1,Ot=D.length;Ht<Ot;Ht++){if(typeof D[Ht][0]!="number"||typeof D[Ht][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let kt=ct.round(D[Ht][0],D[Ht][1]);kt.x===Le.x&&kt.y===Le.y||(this.segments.push(_a.fromRing(Le,kt,this)),kt.x<this.bbox.ll.x&&(this.bbox.ll.x=kt.x),kt.y<this.bbox.ll.y&&(this.bbox.ll.y=kt.y),kt.x>this.bbox.ur.x&&(this.bbox.ur.x=kt.x),kt.y>this.bbox.ur.y&&(this.bbox.ur.y=kt.y),Le=kt)}(Se.x!==Le.x||Se.y!==Le.y)&&this.segments.push(_a.fromRing(Le,Se,this))}getSweepEvents(){const D=[];for(let z=0,ae=this.segments.length;z<ae;z++){const Se=this.segments[z];D.push(Se.leftSE),D.push(Se.rightSE)}return D}}class Wa{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Hi(D[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let ae=1,Se=D.length;ae<Se;ae++){const Le=new Hi(D[ae],this,!1);Le.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Le.bbox.ll.x),Le.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Le.bbox.ll.y),Le.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Le.bbox.ur.x),Le.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Le.bbox.ur.y),this.interiorRings.push(Le)}this.multiPoly=z}getSweepEvents(){const D=this.exteriorRing.getSweepEvents();for(let z=0,ae=this.interiorRings.length;z<ae;z++){const Se=this.interiorRings[z].getSweepEvents();for(let Le=0,Ht=Se.length;Le<Ht;Le++)D.push(Se[Le])}return D}}class Ga{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof D[0][0][0]=="number"&&(D=[D])}catch(ae){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let ae=0,Se=D.length;ae<Se;ae++){const Le=new Wa(D[ae],this);Le.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Le.bbox.ll.x),Le.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Le.bbox.ll.y),Le.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Le.bbox.ur.x),Le.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Le.bbox.ur.y),this.polys.push(Le)}this.isSubject=z}getSweepEvents(){const D=[];for(let z=0,ae=this.polys.length;z<ae;z++){const Se=this.polys[z].getSweepEvents();for(let Le=0,Ht=Se.length;Le<Ht;Le++)D.push(Se[Le])}return D}}class Re{static factory(D){const z=[];for(let ae=0,Se=D.length;ae<Se;ae++){const Le=D[ae];if(!Le.isInResult()||Le.ringOut)continue;let Ht=null,Ot=Le.leftSE,kt=Le.rightSE;const yt=[Ot],U=Ot.point,N=[];for(;Ht=Ot,Ot=kt,yt.push(Ot),Ot.point!==U;)for(;;){const X=Ot.getAvailableLinkedEvents();if(X.length===0){const Ue=yt[0].point,et=yt[yt.length-1].point;throw new Error(`Unable to complete output ring starting at [${Ue.x}, ${Ue.y}]. Last matching segment found ends at [${et.x}, ${et.y}].`)}if(X.length===1){kt=X[0].otherSE;break}let ee=null;for(let Ue=0,et=N.length;Ue<et;Ue++)if(N[Ue].point===Ot.point){ee=Ue;break}if(ee!==null){const Ue=N.splice(ee)[0],et=yt.splice(Ue.index);et.unshift(et[0].otherSE),z.push(new Re(et.reverse()));continue}N.push({index:yt.length,point:Ot.point});const Ee=Ot.getLeftmostComparator(Ht);kt=X.sort(Ee)[0].otherSE;break}z.push(new Re(yt))}return z}constructor(D){this.events=D;for(let z=0,ae=D.length;z<ae;z++)D[z].segment.ringOut=this;this.poly=null}getGeom(){let D=this.events[0].point;const z=[D];for(let yt=1,U=this.events.length-1;yt<U;yt++){const N=this.events[yt].point,X=this.events[yt+1].point;Vr(N,D,X)!==0&&(z.push(N),D=N)}if(z.length===1)return null;const ae=z[0],Se=z[1];Vr(ae,D,Se)===0&&z.shift(),z.push(z[0]);const Le=this.isExteriorRing()?1:-1,Ht=this.isExteriorRing()?0:z.length-1,Ot=this.isExteriorRing()?z.length:-1,kt=[];for(let yt=Ht;yt!=Ot;yt+=Le)kt.push([z[yt].x,z[yt].y]);return kt}isExteriorRing(){if(this._isExteriorRing===void 0){const D=this.enclosingRing();this._isExteriorRing=D?!D.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let D=this.events[0];for(let Se=1,Le=this.events.length;Se<Le;Se++){const Ht=this.events[Se];Rn.compare(D,Ht)>0&&(D=Ht)}let z=D.segment.prevInResult(),ae=z?z.prevInResult():null;for(;;){if(!z)return null;if(!ae)return z.ringOut;if(ae.ringOut!==z.ringOut)return ae.ringOut.enclosingRing()!==z.ringOut?z.ringOut:z.ringOut.enclosingRing();z=ae.prevInResult(),ae=z?z.prevInResult():null}}}class Xa{constructor(D){this.exteriorRing=D,D.poly=this,this.interiorRings=[]}addInterior(D){this.interiorRings.push(D),D.poly=this}getGeom(){const D=[this.exteriorRing.getGeom()];if(D[0]===null)return null;for(let z=0,ae=this.interiorRings.length;z<ae;z++){const Se=this.interiorRings[z].getGeom();Se!==null&&D.push(Se)}return D}}class ua{constructor(D){this.rings=D,this.polys=this._composePolys(D)}getGeom(){const D=[];for(let z=0,ae=this.polys.length;z<ae;z++){const Se=this.polys[z].getGeom();Se!==null&&D.push(Se)}return D}_composePolys(D){const z=[];for(let ae=0,Se=D.length;ae<Se;ae++){const Le=D[ae];if(!Le.poly)if(Le.isExteriorRing())z.push(new Xa(Le));else{const Ht=Le.enclosingRing();Ht.poly||z.push(new Xa(Ht)),Ht.poly.addInterior(Le)}}return z}}class to{constructor(D){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_a.compare;this.queue=D,this.tree=new Ze(z),this.segments=[]}process(D){const z=D.segment,ae=[];if(D.consumedBy)return D.isLeft?this.queue.remove(D.otherSE):this.tree.remove(z),ae;const Se=D.isLeft?this.tree.add(z):this.tree.find(z);if(!Se)throw new Error(`Unable to find segment #${z.id} [${z.leftSE.point.x}, ${z.leftSE.point.y}] -> [${z.rightSE.point.x}, ${z.rightSE.point.y}] in SweepLine tree.`);let Le=Se,Ht=Se,Ot,kt;for(;Ot===void 0;)Le=this.tree.prev(Le),Le===null?Ot=null:Le.key.consumedBy===void 0&&(Ot=Le.key);for(;kt===void 0;)Ht=this.tree.next(Ht),Ht===null?kt=null:Ht.key.consumedBy===void 0&&(kt=Ht.key);if(D.isLeft){let yt=null;if(Ot){const N=Ot.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(yt=N),!Ot.isAnEndpoint(N))){const X=this._splitSafely(Ot,N);for(let ee=0,Ee=X.length;ee<Ee;ee++)ae.push(X[ee])}}let U=null;if(kt){const N=kt.getIntersection(z);if(N!==null&&(z.isAnEndpoint(N)||(U=N),!kt.isAnEndpoint(N))){const X=this._splitSafely(kt,N);for(let ee=0,Ee=X.length;ee<Ee;ee++)ae.push(X[ee])}}if(yt!==null||U!==null){let N=null;yt===null?N=U:U===null?N=yt:N=Rn.comparePoints(yt,U)<=0?yt:U,this.queue.remove(z.rightSE),ae.push(z.rightSE);const X=z.split(N);for(let ee=0,Ee=X.length;ee<Ee;ee++)ae.push(X[ee])}ae.length>0?(this.tree.remove(z),ae.push(D)):(this.segments.push(z),z.prev=Ot)}else{if(Ot&&kt){const yt=Ot.getIntersection(kt);if(yt!==null){if(!Ot.isAnEndpoint(yt)){const U=this._splitSafely(Ot,yt);for(let N=0,X=U.length;N<X;N++)ae.push(U[N])}if(!kt.isAnEndpoint(yt)){const U=this._splitSafely(kt,yt);for(let N=0,X=U.length;N<X;N++)ae.push(U[N])}}}this.tree.remove(z)}return ae}_splitSafely(D,z){this.tree.remove(D);const ae=D.rightSE;this.queue.remove(ae);const Se=D.split(z);return Se.push(ae),D.consumedBy===void 0&&this.tree.add(D),Se}}const Zs=typeof ge!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,xs=typeof ge!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class bs{run(D,z,ae){Wt.type=D,ct.reset();const Se=[new Ga(z,!0)];for(let N=0,X=ae.length;N<X;N++)Se.push(new Ga(ae[N],!1));if(Wt.numMultiPolys=Se.length,Wt.type==="difference"){const N=Se[0];let X=1;for(;X<Se.length;)Mt(Se[X].bbox,N.bbox)!==null?X++:Se.splice(X,1)}if(Wt.type==="intersection")for(let N=0,X=Se.length;N<X;N++){const ee=Se[N];for(let Ee=N+1,Ue=Se.length;Ee<Ue;Ee++)if(Mt(ee.bbox,Se[Ee].bbox)===null)return[]}const Le=new Ze(Rn.compare);for(let N=0,X=Se.length;N<X;N++){const ee=Se[N].getSweepEvents();for(let Ee=0,Ue=ee.length;Ee<Ue;Ee++)if(Le.insert(ee[Ee]),Le.size>Zs)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const Ht=new to(Le);let Ot=Le.size,kt=Le.pop();for(;kt;){const N=kt.key;if(Le.size===Ot){const ee=N.segment;throw new Error(`Unable to pop() ${N.isLeft?"left":"right"} SweepEvent [${N.point.x}, ${N.point.y}] from segment #${ee.id} [${ee.leftSE.point.x}, ${ee.leftSE.point.y}] -> [${ee.rightSE.point.x}, ${ee.rightSE.point.y}] from queue.`)}if(Le.size>Zs)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(Ht.segments.length>xs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const X=Ht.process(N);for(let ee=0,Ee=X.length;ee<Ee;ee++){const Ue=X[ee];Ue.consumedBy===void 0&&Le.insert(Ue)}Ot=Le.size,kt=Le.pop()}ct.reset();const yt=Re.factory(Ht.segments);return new ua(yt).getGeom()}}const Wt=new bs;var Wi={union:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ae=1;ae<D;ae++)z[ae-1]=arguments[ae];return Wt.run("union",fe,z)},intersection:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ae=1;ae<D;ae++)z[ae-1]=arguments[ae];return Wt.run("intersection",fe,z)},xor:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ae=1;ae<D;ae++)z[ae-1]=arguments[ae];return Wt.run("xor",fe,z)},difference:function(fe){for(var D=arguments.length,z=new Array(D>1?D-1:0),ae=1;ae<D;ae++)z[ae-1]=arguments[ae];return Wt.run("difference",fe,z)}};return Wi})},28660:function(vr,se,Z){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ge;(function(oe){(function(_){var de=typeof globalThis=="object"?globalThis:typeof Z.g=="object"?Z.g:typeof self=="object"?self:typeof this=="object"?this:ne(),j=ue(oe);typeof de.Reflect!="undefined"&&(j=ue(de.Reflect,j)),_(j,de),typeof de.Reflect=="undefined"&&(de.Reflect=oe);function ue(Ze,nt){return function(rt,Pt){Object.defineProperty(Ze,rt,{configurable:!0,writable:!0,value:Pt}),nt&&nt(rt,Pt)}}function ie(){try{return Function("return this;")()}catch(Ze){}}function De(){try{return(0,eval)("(function() { return this; })()")}catch(Ze){}}function ne(){return ie()||De()}})(function(_,de){var j=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",ie=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",De=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",Ze={__proto__:[]}instanceof Array,nt=!ne&&!Ze,rt={create:ne?function(){return Wi(Object.create(null))}:Ze?function(){return Wi({__proto__:null})}:function(){return Wi({})},has:nt?function(fe,D){return j.call(fe,D)}:function(fe,D){return D in fe},get:nt?function(fe,D){return j.call(fe,D)?fe[D]:void 0}:function(fe,D){return fe[D]}},Pt=Object.getPrototypeOf(Function),Ct=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Yr(),$t=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:sn(),rr=typeof WeakMap=="function"?WeakMap:Vn(),zt=ue?Symbol.for("@reflect-metadata:registry"):void 0,Mt=xs(),Et=bs(Mt);function Fr(fe,D,z,ae){if(wt(z)){if(!ta(fe))throw new TypeError;if(!Bn(D))throw new TypeError;return Ne(fe,D)}else{if(!ta(fe))throw new TypeError;if(!Vr(D))throw new TypeError;if(!Vr(ae)&&!wt(ae)&&!hn(ae))throw new TypeError;return hn(ae)&&(ae=void 0),z=di(z),O(fe,D,z,ae)}}_("decorate",Fr);function Ar(fe,D){function z(ae,Se){if(!Vr(ae))throw new TypeError;if(!wt(Se)&&!_a(Se))throw new TypeError;We(fe,D,ae,Se)}return z}_("metadata",Ar);function dr(fe,D,z,ae){if(!Vr(z))throw new TypeError;return wt(ae)||(ae=di(ae)),We(fe,D,z,ae)}_("defineMetadata",dr);function It(fe,D,z){if(!Vr(D))throw new TypeError;return wt(z)||(z=di(z)),Pe(fe,D,z)}_("hasMetadata",It);function ct(fe,D,z){if(!Vr(D))throw new TypeError;return wt(z)||(z=di(z)),Ce(fe,D,z)}_("hasOwnMetadata",ct);function Ft(fe,D,z){if(!Vr(D))throw new TypeError;return wt(z)||(z=di(z)),pt(fe,D,z)}_("getMetadata",Ft);function ht(fe,D,z){if(!Vr(D))throw new TypeError;return wt(z)||(z=di(z)),Ye(fe,D,z)}_("getOwnMetadata",ht);function sr(fe,D){if(!Vr(fe))throw new TypeError;return wt(D)||(D=di(D)),ot(fe,D)}_("getMetadataKeys",sr);function br(fe,D){if(!Vr(fe))throw new TypeError;return wt(D)||(D=di(D)),Tt(fe,D)}_("getOwnMetadataKeys",br);function te(fe,D,z){if(!Vr(D))throw new TypeError;if(wt(z)||(z=di(z)),!Vr(D))throw new TypeError;wt(z)||(z=di(z));var ae=xr(D,z,!1);return wt(ae)?!1:ae.OrdinaryDeleteMetadata(fe,D,z)}_("deleteMetadata",te);function Ne(fe,D){for(var z=fe.length-1;z>=0;--z){var ae=fe[z],Se=ae(D);if(!wt(Se)&&!hn(Se)){if(!Bn(Se))throw new TypeError;D=Se}}return D}function O(fe,D,z,ae){for(var Se=fe.length-1;Se>=0;--Se){var Le=fe[Se],Ht=Le(D,z,ae);if(!wt(Ht)&&!hn(Ht)){if(!Vr(Ht))throw new TypeError;ae=Ht}}return ae}function Pe(fe,D,z){var ae=Ce(fe,D,z);if(ae)return!0;var Se=to(D);return hn(Se)?!1:Pe(fe,Se,z)}function Ce(fe,D,z){var ae=xr(D,z,!1);return wt(ae)?!1:dn(ae.OrdinaryHasOwnMetadata(fe,D,z))}function pt(fe,D,z){var ae=Ce(fe,D,z);if(ae)return Ye(fe,D,z);var Se=to(D);if(!hn(Se))return pt(fe,Se,z)}function Ye(fe,D,z){var ae=xr(D,z,!1);if(!wt(ae))return ae.OrdinaryGetOwnMetadata(fe,D,z)}function We(fe,D,z,ae){var Se=xr(z,ae,!0);Se.OrdinaryDefineOwnMetadata(fe,D,z,ae)}function ot(fe,D){var z=Tt(fe,D),ae=to(fe);if(ae===null)return z;var Se=ot(ae,D);if(Se.length<=0)return z;if(z.length<=0)return Se;for(var Le=new $t,Ht=[],Ot=0,kt=z;Ot<kt.length;Ot++){var yt=kt[Ot],U=Le.has(yt);U||(Le.add(yt),Ht.push(yt))}for(var N=0,X=Se;N<X.length;N++){var yt=X[N],U=Le.has(yt);U||(Le.add(yt),Ht.push(yt))}return Ht}function Tt(fe,D){var z=xr(fe,D,!1);return z?z.OrdinaryOwnMetadataKeys(fe,D):[]}function gr(fe){if(fe===null)return 1;switch(typeof fe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return fe===null?1:6;default:return 6}}function wt(fe){return fe===void 0}function hn(fe){return fe===null}function Hr(fe){return typeof fe=="symbol"}function Vr(fe){return typeof fe=="object"?fe!==null:typeof fe=="function"}function qn(fe,D){switch(gr(fe)){case 0:return fe;case 1:return fe;case 2:return fe;case 3:return fe;case 4:return fe;case 5:return fe}var z=D===3?"string":D===5?"number":"default",ae=Wa(fe,ie);if(ae!==void 0){var Se=ae.call(fe,z);if(Vr(Se))throw new TypeError;return Se}return Nn(fe,z==="default"?"number":z)}function Nn(fe,D){if(D==="string"){var z=fe.toString;if(Rn(z)){var ae=z.call(fe);if(!Vr(ae))return ae}var Se=fe.valueOf;if(Rn(Se)){var ae=Se.call(fe);if(!Vr(ae))return ae}}else{var Se=fe.valueOf;if(Rn(Se)){var ae=Se.call(fe);if(!Vr(ae))return ae}var Le=fe.toString;if(Rn(Le)){var ae=Le.call(fe);if(!Vr(ae))return ae}}throw new TypeError}function dn(fe){return!!fe}function Ci(fe){return""+fe}function di(fe){var D=qn(fe,3);return Hr(D)?D:Ci(D)}function ta(fe){return Array.isArray?Array.isArray(fe):fe instanceof Object?fe instanceof Array:Object.prototype.toString.call(fe)==="[object Array]"}function Rn(fe){return typeof fe=="function"}function Bn(fe){return typeof fe=="function"}function _a(fe){switch(gr(fe)){case 3:return!0;case 4:return!0;default:return!1}}function Hi(fe,D){return fe===D||fe!==fe&&D!==D}function Wa(fe,D){var z=fe[D];if(z!=null){if(!Rn(z))throw new TypeError;return z}}function Ga(fe){var D=Wa(fe,De);if(!Rn(D))throw new TypeError;var z=D.call(fe);if(!Vr(z))throw new TypeError;return z}function Re(fe){return fe.value}function Xa(fe){var D=fe.next();return D.done?!1:D}function ua(fe){var D=fe.return;D&&D.call(fe)}function to(fe){var D=Object.getPrototypeOf(fe);if(typeof fe!="function"||fe===Pt||D!==Pt)return D;var z=fe.prototype,ae=z&&Object.getPrototypeOf(z);if(ae==null||ae===Object.prototype)return D;var Se=ae.constructor;return typeof Se!="function"||Se===fe?D:Se}function Zs(){var fe;!wt(zt)&&typeof de.Reflect!="undefined"&&!(zt in de.Reflect)&&typeof de.Reflect.defineMetadata=="function"&&(fe=Wt(de.Reflect));var D,z,ae,Se=new rr,Le={registerProvider:Ht,getProvider:kt,setProvider:U};return Le;function Ht(N){if(!Object.isExtensible(Le))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case fe===N:break;case wt(D):D=N;break;case D===N:break;case wt(z):z=N;break;case z===N:break;default:ae===void 0&&(ae=new $t),ae.add(N);break}}function Ot(N,X){if(!wt(D)){if(D.isProviderFor(N,X))return D;if(!wt(z)){if(z.isProviderFor(N,X))return D;if(!wt(ae))for(var ee=Ga(ae);;){var Ee=Xa(ee);if(!Ee)return;var Ue=Re(Ee);if(Ue.isProviderFor(N,X))return ua(ee),Ue}}}if(!wt(fe)&&fe.isProviderFor(N,X))return fe}function kt(N,X){var ee=Se.get(N),Ee;return wt(ee)||(Ee=ee.get(X)),wt(Ee)&&(Ee=Ot(N,X),wt(Ee)||(wt(ee)&&(ee=new Ct,Se.set(N,ee)),ee.set(X,Ee))),Ee}function yt(N){if(wt(N))throw new TypeError;return D===N||z===N||!wt(ae)&&ae.has(N)}function U(N,X,ee){if(!yt(ee))throw new Error("Metadata provider not registered.");var Ee=kt(N,X);if(Ee!==ee){if(!wt(Ee))return!1;var Ue=Se.get(N);wt(Ue)&&(Ue=new Ct,Se.set(N,Ue)),Ue.set(X,ee)}return!0}}function xs(){var fe;return!wt(zt)&&Vr(de.Reflect)&&Object.isExtensible(de.Reflect)&&(fe=de.Reflect[zt]),wt(fe)&&(fe=Zs()),!wt(zt)&&Vr(de.Reflect)&&Object.isExtensible(de.Reflect)&&Object.defineProperty(de.Reflect,zt,{enumerable:!1,configurable:!1,writable:!1,value:fe}),fe}function bs(fe){var D=new rr,z={isProviderFor:function(yt,U){var N=D.get(yt);return wt(N)?!1:N.has(U)},OrdinaryDefineOwnMetadata:Ht,OrdinaryHasOwnMetadata:Se,OrdinaryGetOwnMetadata:Le,OrdinaryOwnMetadataKeys:Ot,OrdinaryDeleteMetadata:kt};return Mt.registerProvider(z),z;function ae(yt,U,N){var X=D.get(yt),ee=!1;if(wt(X)){if(!N)return;X=new Ct,D.set(yt,X),ee=!0}var Ee=X.get(U);if(wt(Ee)){if(!N)return;if(Ee=new Ct,X.set(U,Ee),!fe.setProvider(yt,U,z))throw X.delete(U),ee&&D.delete(yt),new Error("Wrong provider for target.")}return Ee}function Se(yt,U,N){var X=ae(U,N,!1);return wt(X)?!1:dn(X.has(yt))}function Le(yt,U,N){var X=ae(U,N,!1);if(!wt(X))return X.get(yt)}function Ht(yt,U,N,X){var ee=ae(N,X,!0);ee.set(yt,U)}function Ot(yt,U){var N=[],X=ae(yt,U,!1);if(wt(X))return N;for(var ee=X.keys(),Ee=Ga(ee),Ue=0;;){var et=Xa(Ee);if(!et)return N.length=Ue,N;var he=Re(et);try{N[Ue]=he}catch(Q){try{ua(Ee)}finally{throw Q}}Ue++}}function kt(yt,U,N){var X=ae(U,N,!1);if(wt(X)||!X.delete(yt))return!1;if(X.size===0){var ee=D.get(U);wt(ee)||(ee.delete(N),ee.size===0&&D.delete(ee))}return!0}}function Wt(fe){var D=fe.defineMetadata,z=fe.hasOwnMetadata,ae=fe.getOwnMetadata,Se=fe.getOwnMetadataKeys,Le=fe.deleteMetadata,Ht=new rr,Ot={isProviderFor:function(kt,yt){var U=Ht.get(kt);return wt(U)?Se(kt,yt).length?(wt(U)&&(U=new $t,Ht.set(kt,U)),U.add(yt),!0):!1:U.has(yt)},OrdinaryDefineOwnMetadata:D,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:ae,OrdinaryOwnMetadataKeys:Se,OrdinaryDeleteMetadata:Le};return Ot}function xr(fe,D,z){var ae=Mt.getProvider(fe,D);if(!wt(ae))return ae;if(z){if(Mt.setProvider(fe,D,Et))return Et;throw new Error("Illegal state.")}}function Yr(){var fe={},D=[],z=function(){function Ot(kt,yt,U){this._index=0,this._keys=kt,this._values=yt,this._selector=U}return Ot.prototype["@@iterator"]=function(){return this},Ot.prototype[De]=function(){return this},Ot.prototype.next=function(){var kt=this._index;if(kt>=0&&kt<this._keys.length){var yt=this._selector(this._keys[kt],this._values[kt]);return kt+1>=this._keys.length?(this._index=-1,this._keys=D,this._values=D):this._index++,{value:yt,done:!1}}return{value:void 0,done:!0}},Ot.prototype.throw=function(kt){throw this._index>=0&&(this._index=-1,this._keys=D,this._values=D),kt},Ot.prototype.return=function(kt){return this._index>=0&&(this._index=-1,this._keys=D,this._values=D),{value:kt,done:!0}},Ot}(),ae=function(){function Ot(){this._keys=[],this._values=[],this._cacheKey=fe,this._cacheIndex=-2}return Object.defineProperty(Ot.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ot.prototype.has=function(kt){return this._find(kt,!1)>=0},Ot.prototype.get=function(kt){var yt=this._find(kt,!1);return yt>=0?this._values[yt]:void 0},Ot.prototype.set=function(kt,yt){var U=this._find(kt,!0);return this._values[U]=yt,this},Ot.prototype.delete=function(kt){var yt=this._find(kt,!1);if(yt>=0){for(var U=this._keys.length,N=yt+1;N<U;N++)this._keys[N-1]=this._keys[N],this._values[N-1]=this._values[N];return this._keys.length--,this._values.length--,Hi(kt,this._cacheKey)&&(this._cacheKey=fe,this._cacheIndex=-2),!0}return!1},Ot.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=fe,this._cacheIndex=-2},Ot.prototype.keys=function(){return new z(this._keys,this._values,Se)},Ot.prototype.values=function(){return new z(this._keys,this._values,Le)},Ot.prototype.entries=function(){return new z(this._keys,this._values,Ht)},Ot.prototype["@@iterator"]=function(){return this.entries()},Ot.prototype[De]=function(){return this.entries()},Ot.prototype._find=function(kt,yt){if(!Hi(this._cacheKey,kt)){this._cacheIndex=-1;for(var U=0;U<this._keys.length;U++)if(Hi(this._keys[U],kt)){this._cacheIndex=U;break}}return this._cacheIndex<0&&yt&&(this._cacheIndex=this._keys.length,this._keys.push(kt),this._values.push(void 0)),this._cacheIndex},Ot}();return ae;function Se(Ot,kt){return Ot}function Le(Ot,kt){return kt}function Ht(Ot,kt){return[Ot,kt]}}function sn(){var fe=function(){function D(){this._map=new Ct}return Object.defineProperty(D.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),D.prototype.has=function(z){return this._map.has(z)},D.prototype.add=function(z){return this._map.set(z,z),this},D.prototype.delete=function(z){return this._map.delete(z)},D.prototype.clear=function(){this._map.clear()},D.prototype.keys=function(){return this._map.keys()},D.prototype.values=function(){return this._map.keys()},D.prototype.entries=function(){return this._map.entries()},D.prototype["@@iterator"]=function(){return this.keys()},D.prototype[De]=function(){return this.keys()},D}();return fe}function Vn(){var fe=16,D=rt.create(),z=ae();return function(){function kt(){this._key=ae()}return kt.prototype.has=function(yt){var U=Se(yt,!1);return U!==void 0?rt.has(U,this._key):!1},kt.prototype.get=function(yt){var U=Se(yt,!1);return U!==void 0?rt.get(U,this._key):void 0},kt.prototype.set=function(yt,U){var N=Se(yt,!0);return N[this._key]=U,this},kt.prototype.delete=function(yt){var U=Se(yt,!1);return U!==void 0?delete U[this._key]:!1},kt.prototype.clear=function(){this._key=ae()},kt}();function ae(){var kt;do kt="@@WeakMap@@"+Ot();while(rt.has(D,kt));return D[kt]=!0,kt}function Se(kt,yt){if(!j.call(kt,z)){if(!yt)return;Object.defineProperty(kt,z,{value:rt.create()})}return kt[z]}function Le(kt,yt){for(var U=0;U<yt;++U)kt[U]=Math.random()*255|0;return kt}function Ht(kt){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(kt)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(kt)):Le(new Uint8Array(kt),kt):Le(new Array(kt),kt)}function Ot(){var kt=Ht(fe);kt[6]=kt[6]&79|64,kt[8]=kt[8]&191|128;for(var yt="",U=0;U<fe;++U){var N=kt[U];(U===4||U===6||U===8)&&(yt+="-"),N<16&&(yt+="0"),yt+=N.toString(16).toLowerCase()}return yt}}function Wi(fe){return fe.__=void 0,delete fe.__,fe}})})(ge||(ge={}))},81550:function(vr){(function(se,Z){vr.exports=Z()})(this,function(){"use strict";var se=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},Z=function(W,we){for(var Qe=Object.keys(we),Qt=0;Qt<Qe.length;++Qt)W[Qe[Qt]]=we[Qe[Qt]];return W},ge=`
`;function oe(W){return typeof atob!="undefined"?atob(W):"base64:"+W}function _(W){var we=new Error("(regl) "+W);throw console.error(we),we}function de(W,we){W||_(we)}function j(W){return W?": "+W:""}function ue(W,we,Qe){W in we||_("unknown parameter ("+W+")"+j(Qe)+". possible values: "+Object.keys(we).join())}function ie(W,we){se(W)||_("invalid parameter type"+j(we)+". must be a typed array")}function De(W,we){switch(we){case"number":return typeof W=="number";case"object":return typeof W=="object";case"string":return typeof W=="string";case"boolean":return typeof W=="boolean";case"function":return typeof W=="function";case"undefined":return typeof W=="undefined";case"symbol":return typeof W=="symbol"}}function ne(W,we,Qe){De(W,we)||_("invalid parameter type"+j(Qe)+". expected "+we+", got "+typeof W)}function Ze(W,we){W>=0&&(W|0)===W||_("invalid parameter type, ("+W+")"+j(we)+". must be a nonnegative integer")}function nt(W,we,Qe){we.indexOf(W)<0&&_("invalid value"+j(Qe)+". must be one of: "+we)}var rt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Pt(W){Object.keys(W).forEach(function(we){rt.indexOf(we)<0&&_('invalid regl constructor argument "'+we+'". must be one of '+rt)})}function Ct(W,we){for(W=W+"";W.length<we;)W=" "+W;return W}function $t(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function rr(W,we){this.number=W,this.line=we,this.errors=[]}function zt(W,we,Qe){this.file=W,this.line=we,this.message=Qe}function Mt(){var W=new Error,we=(W.stack||W).toString(),Qe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(we);if(Qe)return Qe[1];var Qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(we);return Qt?Qt[1]:"unknown"}function Et(){var W=new Error,we=(W.stack||W).toString(),Qe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(we);if(Qe)return Qe[1];var Qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(we);return Qt?Qt[1]:"unknown"}function Fr(W,we){var Qe=W.split(`
`),Qt=1,mr=0,er={unknown:new $t,0:new $t};er.unknown.name=er[0].name=we||Mt(),er.unknown.lines.push(new rr(0,""));for(var Zt=0;Zt<Qe.length;++Zt){var Ur=Qe[Zt],Or=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if(Or)switch(Or[1]){case"line":var Qr=/(\d+)(\s+\d+)?/.exec(Or[2]);Qr&&(Qt=Qr[1]|0,Qr[2]&&(mr=Qr[2]|0,mr in er||(er[mr]=new $t)));break;case"define":var jr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Or[2]);jr&&(er[mr].name=jr[1]?oe(jr[2]):jr[2]);break}er[mr].lines.push(new rr(Qt++,Ur))}return Object.keys(er).forEach(function($r){var en=er[$r];en.lines.forEach(function(kr){en.index[kr.number]=kr})}),er}function Ar(W){var we=[];return W.split(`
`).forEach(function(Qe){if(!(Qe.length<5)){var Qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Qe);Qt?we.push(new zt(Qt[1]|0,Qt[2]|0,Qt[3].trim())):Qe.length>0&&we.push(new zt("unknown",0,Qe))}}),we}function dr(W,we){we.forEach(function(Qe){var Qt=W[Qe.file];if(Qt){var mr=Qt.index[Qe.line];if(mr){mr.errors.push(Qe),Qt.hasErrors=!0;return}}W.unknown.hasErrors=!0,W.unknown.lines[0].errors.push(Qe)})}function It(W,we,Qe,Qt,mr){if(!W.getShaderParameter(we,W.COMPILE_STATUS)){var er=W.getShaderInfoLog(we),Zt=Qt===W.FRAGMENT_SHADER?"fragment":"vertex";Ne(Qe,"string",Zt+" shader source must be a string",mr);var Ur=Fr(Qe,mr),Or=Ar(er);dr(Ur,Or),Object.keys(Ur).forEach(function(Qr){var jr=Ur[Qr];if(!jr.hasErrors)return;var $r=[""],en=[""];function kr(qr,Bt){$r.push(qr),en.push(Bt||"")}kr("file number "+Qr+": "+jr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),jr.lines.forEach(function(qr){if(qr.errors.length>0){kr(Ct(qr.number,4)+"|  ","background-color:yellow; font-weight:bold"),kr(qr.line+ge,"color:red; background-color:yellow; font-weight:bold");var Bt=0;qr.errors.forEach(function(or){var zr=or.message,pn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(zr);if(pn){var Tr=pn[1];switch(zr=pn[2],Tr){case"assign":Tr="=";break}Bt=Math.max(qr.line.indexOf(Tr,Bt),0)}else Bt=0;kr(Ct("| ",6)),kr(Ct("^^^",Bt+3)+ge,"font-weight:bold"),kr(Ct("| ",6)),kr(zr+ge,"font-weight:bold")}),kr(Ct("| ",6)+ge)}else kr(Ct(qr.number,4)+"|  "),kr(qr.line+ge,"color:red")}),typeof document!="undefined"&&!window.chrome?(en[0]=$r.join("%c"),console.log.apply(console,en)):console.log($r.join(""))}),de.raise("Error compiling "+Zt+" shader, "+Ur[0].name)}}function ct(W,we,Qe,Qt,mr){if(!W.getProgramParameter(we,W.LINK_STATUS)){var er=W.getProgramInfoLog(we),Zt=Fr(Qe,mr),Ur=Fr(Qt,mr),Or='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+Zt[0].name+'"';typeof document!="undefined"?console.log("%c"+Or+ge+"%c"+er,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Or+ge+er),de.raise(Or)}}function Ft(W){W._commandRef=Mt()}function ht(W,we,Qe,Qt){Ft(W);function mr(Or){return Or?Qt.id(Or):0}W._fragId=mr(W.static.frag),W._vertId=mr(W.static.vert);function er(Or,Qr){Object.keys(Qr).forEach(function(jr){Or[Qt.id(jr)]=!0})}var Zt=W._uniformSet={};er(Zt,we.static),er(Zt,we.dynamic);var Ur=W._attributeSet={};er(Ur,Qe.static),er(Ur,Qe.dynamic),W._hasCount="count"in W.static||"count"in W.dynamic||"elements"in W.static||"elements"in W.dynamic}function sr(W,we){var Qe=Et();_(W+" in command "+(we||Mt())+(Qe==="unknown"?"":" called from "+Qe))}function br(W,we,Qe){W||sr(we,Qe||Mt())}function te(W,we,Qe,Qt){W in we||sr("unknown parameter ("+W+")"+j(Qe)+". possible values: "+Object.keys(we).join(),Qt||Mt())}function Ne(W,we,Qe,Qt){De(W,we)||sr("invalid parameter type"+j(Qe)+". expected "+we+", got "+typeof W,Qt||Mt())}function O(W){W()}function Pe(W,we,Qe){W.texture?nt(W.texture._texture.internalformat,we,"unsupported texture format for attachment"):nt(W.renderbuffer._renderbuffer.format,Qe,"unsupported renderbuffer format for attachment")}var Ce=33071,pt=9728,Ye=9984,We=9985,ot=9986,Tt=9987,gr=5120,wt=5121,hn=5122,Hr=5123,Vr=5124,qn=5125,Nn=5126,dn=32819,Ci=32820,di=33635,ta=34042,Rn=36193,Bn={};Bn[gr]=Bn[wt]=1,Bn[hn]=Bn[Hr]=Bn[Rn]=Bn[di]=Bn[dn]=Bn[Ci]=2,Bn[Vr]=Bn[qn]=Bn[Nn]=Bn[ta]=4;function _a(W,we){return W===Ci||W===dn||W===di?2:W===ta?4:Bn[W]*we}function Hi(W){return!(W&W-1)&&!!W}function Wa(W,we,Qe){var Qt,mr=we.width,er=we.height,Zt=we.channels;de(mr>0&&mr<=Qe.maxTextureSize&&er>0&&er<=Qe.maxTextureSize,"invalid texture shape"),(W.wrapS!==Ce||W.wrapT!==Ce)&&de(Hi(mr)&&Hi(er),"incompatible wrap mode for texture, both width and height must be power of 2"),we.mipmask===1?mr!==1&&er!==1&&de(W.minFilter!==Ye&&W.minFilter!==ot&&W.minFilter!==We&&W.minFilter!==Tt,"min filter requires mipmap"):(de(Hi(mr)&&Hi(er),"texture must be a square power of 2 to support mipmapping"),de(we.mipmask===(mr<<1)-1,"missing or incomplete mipmap data")),we.type===Nn&&(Qe.extensions.indexOf("oes_texture_float_linear")<0&&de(W.minFilter===pt&&W.magFilter===pt,"filter not supported, must enable oes_texture_float_linear"),de(!W.genMipmaps,"mipmap generation not supported with float textures"));var Ur=we.images;for(Qt=0;Qt<16;++Qt)if(Ur[Qt]){var Or=mr>>Qt,Qr=er>>Qt;de(we.mipmask&1<<Qt,"missing mipmap data");var jr=Ur[Qt];if(de(jr.width===Or&&jr.height===Qr,"invalid shape for mip images"),de(jr.format===we.format&&jr.internalformat===we.internalformat&&jr.type===we.type,"incompatible type for mip image"),!jr.compressed)if(jr.data){var $r=Math.ceil(_a(jr.type,Zt)*Or/jr.unpackAlignment)*jr.unpackAlignment;de(jr.data.byteLength===$r*Qr,"invalid data for image, buffer size is inconsistent with image format")}else jr.element||jr.copy}else W.genMipmaps||de((we.mipmask&1<<Qt)==0,"extra mipmap data");we.compressed&&de(!W.genMipmaps,"mipmap generation for compressed images not supported")}function Ga(W,we,Qe,Qt){var mr=W.width,er=W.height,Zt=W.channels;de(mr>0&&mr<=Qt.maxTextureSize&&er>0&&er<=Qt.maxTextureSize,"invalid texture shape"),de(mr===er,"cube map must be square"),de(we.wrapS===Ce&&we.wrapT===Ce,"wrap mode not supported by cube map");for(var Ur=0;Ur<Qe.length;++Ur){var Or=Qe[Ur];de(Or.width===mr&&Or.height===er,"inconsistent cube map face shape"),we.genMipmaps&&(de(!Or.compressed,"can not generate mipmap for compressed textures"),de(Or.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Qr=Or.images,jr=0;jr<16;++jr){var $r=Qr[jr];if($r){var en=mr>>jr,kr=er>>jr;de(Or.mipmask&1<<jr,"missing mipmap data"),de($r.width===en&&$r.height===kr,"invalid shape for mip images"),de($r.format===W.format&&$r.internalformat===W.internalformat&&$r.type===W.type,"incompatible type for mip image"),$r.compressed||($r.data?de($r.data.byteLength===en*kr*Math.max(_a($r.type,Zt),$r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):$r.element||$r.copy)}}}}var Re=Z(de,{optional:O,raise:_,commandRaise:sr,command:br,parameter:ue,commandParameter:te,constructor:Pt,type:ne,commandType:Ne,isTypedArray:ie,nni:Ze,oneOf:nt,shaderError:It,linkError:ct,callSite:Et,saveCommandRef:Ft,saveDrawInfo:ht,framebufferFormat:Pe,guessCommand:Mt,texture2D:Wa,textureCube:Ga}),Xa=0,ua=0;function to(W,we){this.id=Xa++,this.type=W,this.data=we}function Zs(W){return W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function xs(W){if(W.length===0)return[];var we=W.charAt(0),Qe=W.charAt(W.length-1);if(W.length>1&&we===Qe&&(we==='"'||we==="'"))return['"'+Zs(W.substr(1,W.length-2))+'"'];var Qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W);if(Qt)return xs(W.substr(0,Qt.index)).concat(xs(Qt[1])).concat(xs(W.substr(Qt.index+Qt[0].length)));var mr=W.split(".");if(mr.length===1)return['"'+Zs(W)+'"'];for(var er=[],Zt=0;Zt<mr.length;++Zt)er=er.concat(xs(mr[Zt]));return er}function bs(W){return"["+xs(W).join("][")+"]"}function Wt(W,we){return new to(W,bs(we+""))}function xr(W){return typeof W=="function"&&!W._reglType||W instanceof to}function Yr(W,we){return typeof W=="function"?new to(ua,W):W}var sn={DynamicVariable:to,define:Wt,isDynamic:xr,unbox:Yr,accessor:bs},Vn={next:typeof requestAnimationFrame=="function"?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:typeof cancelAnimationFrame=="function"?function(W){return cancelAnimationFrame(W)}:clearTimeout},Wi=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fe(){var W={"":0},we=[""];return{id:function(Qe){var Qt=W[Qe];return Qt||(Qt=W[Qe]=we.length,we.push(Qe),Qt)},str:function(Qe){return we[Qe]}}}function D(W,we,Qe){var Qt=document.createElement("canvas");Z(Qt.style,{border:0,margin:0,padding:0,top:0,left:0}),W.appendChild(Qt),W===document.body&&(Qt.style.position="absolute",Z(W.style,{margin:0,padding:0}));function mr(){var Ur=window.innerWidth,Or=window.innerHeight;if(W!==document.body){var Qr=W.getBoundingClientRect();Ur=Qr.right-Qr.left,Or=Qr.bottom-Qr.top}Qt.width=Qe*Ur,Qt.height=Qe*Or,Z(Qt.style,{width:Ur+"px",height:Or+"px"})}var er;W!==document.body&&typeof ResizeObserver=="function"?(er=new ResizeObserver(function(){setTimeout(mr)}),er.observe(W)):window.addEventListener("resize",mr,!1);function Zt(){er?er.disconnect():window.removeEventListener("resize",mr),W.removeChild(Qt)}return mr(),{canvas:Qt,onDestroy:Zt}}function z(W,we){function Qe(Qt){try{return W.getContext(Qt,we)}catch(mr){return null}}return Qe("webgl")||Qe("experimental-webgl")||Qe("webgl-experimental")}function ae(W){return typeof W.nodeName=="string"&&typeof W.appendChild=="function"&&typeof W.getBoundingClientRect=="function"}function Se(W){return typeof W.drawArrays=="function"||typeof W.drawElements=="function"}function Le(W){return typeof W=="string"?W.split():(Re(Array.isArray(W),"invalid extension array"),W)}function Ht(W){return typeof W=="string"?(Re(typeof document!="undefined","not supported outside of DOM"),document.querySelector(W)):W}function Ot(W){var we=W||{},Qe,Qt,mr,er,Zt={},Ur=[],Or=[],Qr=typeof window=="undefined"?1:window.devicePixelRatio,jr=!1,$r=function(qr){qr&&Re.raise(qr)},en=function(){};if(typeof we=="string"?(Re(typeof document!="undefined","selector queries only supported in DOM enviroments"),Qe=document.querySelector(we),Re(Qe,"invalid query string for element")):typeof we=="object"?ae(we)?Qe=we:Se(we)?(er=we,mr=er.canvas):(Re.constructor(we),"gl"in we?er=we.gl:"canvas"in we?mr=Ht(we.canvas):"container"in we&&(Qt=Ht(we.container)),"attributes"in we&&(Zt=we.attributes,Re.type(Zt,"object","invalid context attributes")),"extensions"in we&&(Ur=Le(we.extensions)),"optionalExtensions"in we&&(Or=Le(we.optionalExtensions)),"onDone"in we&&(Re.type(we.onDone,"function","invalid or missing onDone callback"),$r=we.onDone),"profile"in we&&(jr=!!we.profile),"pixelRatio"in we&&(Qr=+we.pixelRatio,Re(Qr>0,"invalid pixel ratio"))):Re.raise("invalid arguments to regl"),Qe&&(Qe.nodeName.toLowerCase()==="canvas"?mr=Qe:Qt=Qe),!er){if(!mr){Re(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var kr=D(Qt||document.body,$r,Qr);if(!kr)return null;mr=kr.canvas,en=kr.onDestroy}Zt.premultipliedAlpha===void 0&&(Zt.premultipliedAlpha=!0),er=z(mr,Zt)}return er?{gl:er,canvas:mr,container:Qt,extensions:Ur,optionalExtensions:Or,pixelRatio:Qr,profile:jr,onDone:$r,onDestroy:en}:(en(),$r("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function kt(W,we){var Qe={};function Qt(Zt){Re.type(Zt,"string","extension name must be string");var Ur=Zt.toLowerCase(),Or;try{Or=Qe[Ur]=W.getExtension(Ur)}catch(Qr){}return!!Or}for(var mr=0;mr<we.extensions.length;++mr){var er=we.extensions[mr];if(!Qt(er))return we.onDestroy(),we.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return we.optionalExtensions.forEach(Qt),{extensions:Qe,restore:function(){Object.keys(Qe).forEach(function(Zt){if(Qe[Zt]&&!Qt(Zt))throw new Error("(regl): error restoring extension "+Zt)})}}}function yt(W,we){for(var Qe=Array(W),Qt=0;Qt<W;++Qt)Qe[Qt]=we(Qt);return Qe}var U=5120,N=5121,X=5122,ee=5123,Ee=5124,Ue=5125,et=5126;function he(W){for(var we=16;we<=1<<28;we*=16)if(W<=we)return we;return 0}function Q(W){var we,Qe;return we=(W>65535)<<4,W>>>=we,Qe=(W>255)<<3,W>>>=Qe,we|=Qe,Qe=(W>15)<<2,W>>>=Qe,we|=Qe,Qe=(W>3)<<1,W>>>=Qe,we|=Qe,we|W>>1}function ye(){var W=yt(8,function(){return[]});function we(er){var Zt=he(er),Ur=W[Q(Zt)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(Zt)}function Qe(er){W[Q(er.byteLength)>>2].push(er)}function Qt(er,Zt){var Ur=null;switch(er){case U:Ur=new Int8Array(we(Zt),0,Zt);break;case N:Ur=new Uint8Array(we(Zt),0,Zt);break;case X:Ur=new Int16Array(we(2*Zt),0,Zt);break;case ee:Ur=new Uint16Array(we(2*Zt),0,Zt);break;case Ee:Ur=new Int32Array(we(4*Zt),0,Zt);break;case Ue:Ur=new Uint32Array(we(4*Zt),0,Zt);break;case et:Ur=new Float32Array(we(4*Zt),0,Zt);break;default:return null}return Ur.length!==Zt?Ur.subarray(0,Zt):Ur}function mr(er){Qe(er.buffer)}return{alloc:we,free:Qe,allocType:Qt,freeType:mr}}var Je=ye();Je.zero=ye();var _t=3408,pe=3410,yr=3411,tn=3412,rn=3413,Jt=3414,Kr=3415,Nr=33901,Xr=33902,si=3379,un=3386,vi=34921,Ni=36347,yi=36348,Mi=35661,Ii=35660,xo=34930,Qi=36349,xa=34076,Pi=34024,_i=7936,Ti=7937,Ca=7938,Vs=35724,ca=34047,Ra=36063,qu=34852,tu=3553,va=34067,ls=34069,fi=33984,ia=6408,Ma=5126,aa=5121,Jo=36160,jo=36053,Pu=36064,Rs=16384,pc=function(W,we){var Qe=1;we.ext_texture_filter_anisotropic&&(Qe=W.getParameter(ca));var Qt=1,mr=1;we.webgl_draw_buffers&&(Qt=W.getParameter(qu),mr=W.getParameter(Ra));var er=!!we.oes_texture_float;if(er){var Zt=W.createTexture();W.bindTexture(tu,Zt),W.texImage2D(tu,0,ia,1,1,0,ia,Ma,null);var Ur=W.createFramebuffer();if(W.bindFramebuffer(Jo,Ur),W.framebufferTexture2D(Jo,Pu,tu,Zt,0),W.bindTexture(tu,null),W.checkFramebufferStatus(Jo)!==jo)er=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(Rs);var Or=Je.allocType(Ma,4);W.readPixels(0,0,1,1,ia,Ma,Or),W.getError()?er=!1:(W.deleteFramebuffer(Ur),W.deleteTexture(Zt),er=Or[0]===1),Je.freeType(Or)}}var Qr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),jr=!0;if(!Qr){var $r=W.createTexture(),en=Je.allocType(aa,36);W.activeTexture(fi),W.bindTexture(va,$r),W.texImage2D(ls,0,ia,3,3,0,ia,aa,en),Je.freeType(en),W.bindTexture(va,null),W.deleteTexture($r),jr=!W.getError()}return{colorBits:[W.getParameter(pe),W.getParameter(yr),W.getParameter(tn),W.getParameter(rn)],depthBits:W.getParameter(Jt),stencilBits:W.getParameter(Kr),subpixelBits:W.getParameter(_t),extensions:Object.keys(we).filter(function(kr){return!!we[kr]}),maxAnisotropic:Qe,maxDrawbuffers:Qt,maxColorAttachments:mr,pointSizeDims:W.getParameter(Nr),lineWidthDims:W.getParameter(Xr),maxViewportDims:W.getParameter(un),maxCombinedTextureUnits:W.getParameter(Mi),maxCubeMapSize:W.getParameter(xa),maxRenderbufferSize:W.getParameter(Pi),maxTextureUnits:W.getParameter(xo),maxTextureSize:W.getParameter(si),maxAttributes:W.getParameter(vi),maxVertexUniforms:W.getParameter(Ni),maxVertexTextureUnits:W.getParameter(Ii),maxVaryingVectors:W.getParameter(yi),maxFragmentUniforms:W.getParameter(Qi),glsl:W.getParameter(Vs),renderer:W.getParameter(Ti),vendor:W.getParameter(_i),version:W.getParameter(Ca),readFloat:er,npotTextureCube:jr}};function Fa(W){return!!W&&typeof W=="object"&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&typeof W.offset=="number"&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||se(W.data))}var zi=function(W){return Object.keys(W).map(function(we){return W[we]})},Ho={shape:Jr,flatten:ur};function Yt(W,we,Qe){for(var Qt=0;Qt<we;++Qt)Qe[Qt]=W[Qt]}function re(W,we,Qe,Qt){for(var mr=0,er=0;er<we;++er)for(var Zt=W[er],Ur=0;Ur<Qe;++Ur)Qt[mr++]=Zt[Ur]}function Oe(W,we,Qe,Qt,mr,er){for(var Zt=er,Ur=0;Ur<we;++Ur)for(var Or=W[Ur],Qr=0;Qr<Qe;++Qr)for(var jr=Or[Qr],$r=0;$r<Qt;++$r)mr[Zt++]=jr[$r]}function gt(W,we,Qe,Qt,mr){for(var er=1,Zt=Qe+1;Zt<we.length;++Zt)er*=we[Zt];var Ur=we[Qe];if(we.length-Qe==4){var Or=we[Qe+1],Qr=we[Qe+2],jr=we[Qe+3];for(Zt=0;Zt<Ur;++Zt)Oe(W[Zt],Or,Qr,jr,Qt,mr),mr+=er}else for(Zt=0;Zt<Ur;++Zt)gt(W[Zt],we,Qe+1,Qt,mr),mr+=er}function ur(W,we,Qe,Qt){var mr=1;if(we.length)for(var er=0;er<we.length;++er)mr*=we[er];else mr=0;var Zt=Qt||Je.allocType(Qe,mr);switch(we.length){case 0:break;case 1:Yt(W,we[0],Zt);break;case 2:re(W,we[0],we[1],Zt);break;case 3:Oe(W,we[0],we[1],we[2],Zt,0);break;default:gt(W,we,0,Zt,0)}return Zt}function Jr(W){for(var we=[],Qe=W;Qe.length;Qe=Qe[0])we.push(Qe.length);return we}var Ln={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Zi=5120,so=5122,bo=5124,io=5121,Ms=5123,Zc=5125,ru=5126,Ef=5126,Wo={int8:Zi,int16:so,int32:bo,uint8:io,uint16:Ms,uint32:Zc,float:ru,float32:Ef},bl=35048,El=35040,Ou={dynamic:bl,stream:El,static:35044},ku=Ho.flatten,Ku=Ho.shape,Vc=35044,Is=35040,$a=5121,Sl=5126,Qu=[];Qu[5120]=1,Qu[5122]=2,Qu[5124]=4,Qu[5121]=1,Qu[5123]=2,Qu[5125]=4,Qu[5126]=4;function Sf(W){return Ln[Object.prototype.toString.call(W)]|0}function Wh(W,we){for(var Qe=0;Qe<we.length;++Qe)W[Qe]=we[Qe]}function Af(W,we,Qe,Qt,mr,er,Zt){for(var Ur=0,Or=0;Or<Qe;++Or)for(var Qr=0;Qr<Qt;++Qr)W[Ur++]=we[mr*Or+er*Qr+Zt]}function ch(W,we,Qe,Qt){var mr=0,er={};function Zt(Bt){this.id=mr++,this.buffer=W.createBuffer(),this.type=Bt,this.usage=Vc,this.byteLength=0,this.dimension=1,this.dtype=$a,this.persistentData=null,Qe.profile&&(this.stats={size:0})}Zt.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},Zt.prototype.destroy=function(){en(this)};var Ur=[];function Or(Bt,or){var zr=Ur.pop();return zr||(zr=new Zt(Bt)),zr.bind(),$r(zr,or,Is,0,1,!1),zr}function Qr(Bt){Ur.push(Bt)}function jr(Bt,or,zr){Bt.byteLength=or.byteLength,W.bufferData(Bt.type,or,zr)}function $r(Bt,or,zr,pn,Tr,gn){var Br;if(Bt.usage=zr,Array.isArray(or)){if(Bt.dtype=pn||Sl,or.length>0){var cn;if(Array.isArray(or[0])){Br=Ku(or);for(var Cr=1,nn=1;nn<Br.length;++nn)Cr*=Br[nn];Bt.dimension=Cr,cn=ku(or,Br,Bt.dtype),jr(Bt,cn,zr),gn?Bt.persistentData=cn:Je.freeType(cn)}else if(typeof or[0]=="number"){Bt.dimension=Tr;var Wn=Je.allocType(Bt.dtype,or.length);Wh(Wn,or),jr(Bt,Wn,zr),gn?Bt.persistentData=Wn:Je.freeType(Wn)}else se(or[0])?(Bt.dimension=or[0].length,Bt.dtype=pn||Sf(or[0])||Sl,cn=ku(or,[or.length,or[0].length],Bt.dtype),jr(Bt,cn,zr),gn?Bt.persistentData=cn:Je.freeType(cn)):Re.raise("invalid buffer data")}}else if(se(or))Bt.dtype=pn||Sf(or),Bt.dimension=Tr,jr(Bt,or,zr),gn&&(Bt.persistentData=new Uint8Array(new Uint8Array(or.buffer)));else if(Fa(or)){Br=or.shape;var hi=or.stride,an=or.offset,Lr=0,_r=0,Xn=0,pr=0;Br.length===1?(Lr=Br[0],_r=1,Xn=hi[0],pr=0):Br.length===2?(Lr=Br[0],_r=Br[1],Xn=hi[0],pr=hi[1]):Re.raise("invalid shape"),Bt.dtype=pn||Sf(or.data)||Sl,Bt.dimension=_r;var yn=Je.allocType(Bt.dtype,Lr*_r);Af(yn,or.data,Lr,_r,Xn,pr,an),jr(Bt,yn,zr),gn?Bt.persistentData=yn:Je.freeType(yn)}else or instanceof ArrayBuffer?(Bt.dtype=$a,Bt.dimension=Tr,jr(Bt,or,zr),gn&&(Bt.persistentData=new Uint8Array(new Uint8Array(or)))):Re.raise("invalid buffer data")}function en(Bt){we.bufferCount--,Qt(Bt);var or=Bt.buffer;Re(or,"buffer must not be deleted already"),W.deleteBuffer(or),Bt.buffer=null,delete er[Bt.id]}function kr(Bt,or,zr,pn){we.bufferCount++;var Tr=new Zt(or);er[Tr.id]=Tr;function gn(Cr){var nn=Vc,Wn=null,hi=0,an=0,Lr=1;return Array.isArray(Cr)||se(Cr)||Fa(Cr)||Cr instanceof ArrayBuffer?Wn=Cr:typeof Cr=="number"?hi=Cr|0:Cr&&(Re.type(Cr,"object","buffer arguments must be an object, a number or an array"),"data"in Cr&&(Re(Wn===null||Array.isArray(Wn)||se(Wn)||Fa(Wn),"invalid data for buffer"),Wn=Cr.data),"usage"in Cr&&(Re.parameter(Cr.usage,Ou,"invalid buffer usage"),nn=Ou[Cr.usage]),"type"in Cr&&(Re.parameter(Cr.type,Wo,"invalid buffer type"),an=Wo[Cr.type]),"dimension"in Cr&&(Re.type(Cr.dimension,"number","invalid dimension"),Lr=Cr.dimension|0),"length"in Cr&&(Re.nni(hi,"buffer length must be a nonnegative integer"),hi=Cr.length|0)),Tr.bind(),Wn?$r(Tr,Wn,nn,an,Lr,pn):(hi&&W.bufferData(Tr.type,hi,nn),Tr.dtype=an||$a,Tr.usage=nn,Tr.dimension=Lr,Tr.byteLength=hi),Qe.profile&&(Tr.stats.size=Tr.byteLength*Qu[Tr.dtype]),gn}function Br(Cr,nn){Re(nn+Cr.byteLength<=Tr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Cr.byteLength+" starting from offset "+nn+" to a buffer of size "+Tr.byteLength),W.bufferSubData(Tr.type,nn,Cr)}function cn(Cr,nn){var Wn=(nn||0)|0,hi;if(Tr.bind(),se(Cr)||Cr instanceof ArrayBuffer)Br(Cr,Wn);else if(Array.isArray(Cr)){if(Cr.length>0)if(typeof Cr[0]=="number"){var an=Je.allocType(Tr.dtype,Cr.length);Wh(an,Cr),Br(an,Wn),Je.freeType(an)}else if(Array.isArray(Cr[0])||se(Cr[0])){hi=Ku(Cr);var Lr=ku(Cr,hi,Tr.dtype);Br(Lr,Wn),Je.freeType(Lr)}else Re.raise("invalid buffer data")}else if(Fa(Cr)){hi=Cr.shape;var _r=Cr.stride,Xn=0,pr=0,yn=0,xt=0;hi.length===1?(Xn=hi[0],pr=1,yn=_r[0],xt=0):hi.length===2?(Xn=hi[0],pr=hi[1],yn=_r[0],xt=_r[1]):Re.raise("invalid shape");var ci=Array.isArray(Cr.data)?Tr.dtype:Sf(Cr.data),ri=Je.allocType(ci,Xn*pr);Af(ri,Cr.data,Xn,pr,yn,xt,Cr.offset),Br(ri,Wn),Je.freeType(ri)}else Re.raise("invalid data for buffer subdata");return gn}return zr||gn(Bt),gn._reglType="buffer",gn._buffer=Tr,gn.subdata=cn,Qe.profile&&(gn.stats=Tr.stats),gn.destroy=function(){en(Tr)},gn}function qr(){zi(er).forEach(function(Bt){Bt.buffer=W.createBuffer(),W.bindBuffer(Bt.type,Bt.buffer),W.bufferData(Bt.type,Bt.persistentData||Bt.byteLength,Bt.usage)})}return Qe.profile&&(we.getTotalBufferSize=function(){var Bt=0;return Object.keys(er).forEach(function(or){Bt+=er[or].stats.size}),Bt}),{create:kr,createStream:Or,destroyStream:Qr,clear:function(){zi(er).forEach(en),Ur.forEach(en)},getBuffer:function(Bt){return Bt&&Bt._buffer instanceof Zt?Bt._buffer:null},restore:qr,_initBuffer:$r}}var fh=0,hh=0,Gh=1,Xh=1,Np=4,jc=4,Du={points:fh,point:hh,lines:Gh,line:Xh,triangles:Np,triangle:jc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},$h=0,Go=1,Hl=4,Al=5120,js=5121,Tl=5122,nu=5123,mi=5124,Hs=5125,Lu=34963,Ju=35040,ph=35044;function Yh(W,we,Qe,Qt){var mr={},er=0,Zt={uint8:js,uint16:nu};we.oes_element_index_uint&&(Zt.uint32=Hs);function Ur(qr){this.id=er++,mr[this.id]=this,this.buffer=qr,this.primType=Hl,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var Or=[];function Qr(qr){var Bt=Or.pop();return Bt||(Bt=new Ur(Qe.create(null,Lu,!0,!1)._buffer)),$r(Bt,qr,Ju,-1,-1,0,0),Bt}function jr(qr){Or.push(qr)}function $r(qr,Bt,or,zr,pn,Tr,gn){qr.buffer.bind();var Br;if(Bt){var cn=gn;!gn&&(!se(Bt)||Fa(Bt)&&!se(Bt.data))&&(cn=we.oes_element_index_uint?Hs:nu),Qe._initBuffer(qr.buffer,Bt,or,cn,3)}else W.bufferData(Lu,Tr,or),qr.buffer.dtype=Br||js,qr.buffer.usage=or,qr.buffer.dimension=3,qr.buffer.byteLength=Tr;if(Br=gn,!gn){switch(qr.buffer.dtype){case js:case Al:Br=js;break;case nu:case Tl:Br=nu;break;case Hs:case mi:Br=Hs;break;default:Re.raise("unsupported type for element array")}qr.buffer.dtype=Br}qr.type=Br,Re(Br!==Hs||!!we.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Cr=pn;Cr<0&&(Cr=qr.buffer.byteLength,Br===nu?Cr>>=1:Br===Hs&&(Cr>>=2)),qr.vertCount=Cr;var nn=zr;if(zr<0){nn=Hl;var Wn=qr.buffer.dimension;Wn===1&&(nn=$h),Wn===2&&(nn=Go),Wn===3&&(nn=Hl)}qr.primType=nn}function en(qr){Qt.elementsCount--,Re(qr.buffer!==null,"must not double destroy elements"),delete mr[qr.id],qr.buffer.destroy(),qr.buffer=null}function kr(qr,Bt){var or=Qe.create(null,Lu,!0),zr=new Ur(or._buffer);Qt.elementsCount++;function pn(Tr){if(!Tr)or(),zr.primType=Hl,zr.vertCount=0,zr.type=js;else if(typeof Tr=="number")or(Tr),zr.primType=Hl,zr.vertCount=Tr|0,zr.type=js;else{var gn=null,Br=ph,cn=-1,Cr=-1,nn=0,Wn=0;Array.isArray(Tr)||se(Tr)||Fa(Tr)?gn=Tr:(Re.type(Tr,"object","invalid arguments for elements"),"data"in Tr&&(gn=Tr.data,Re(Array.isArray(gn)||se(gn)||Fa(gn),"invalid data for element buffer")),"usage"in Tr&&(Re.parameter(Tr.usage,Ou,"invalid element buffer usage"),Br=Ou[Tr.usage]),"primitive"in Tr&&(Re.parameter(Tr.primitive,Du,"invalid element buffer primitive"),cn=Du[Tr.primitive]),"count"in Tr&&(Re(typeof Tr.count=="number"&&Tr.count>=0,"invalid vertex count for elements"),Cr=Tr.count|0),"type"in Tr&&(Re.parameter(Tr.type,Zt,"invalid buffer type"),Wn=Zt[Tr.type]),"length"in Tr?nn=Tr.length|0:(nn=Cr,Wn===nu||Wn===Tl?nn*=2:(Wn===Hs||Wn===mi)&&(nn*=4))),$r(zr,gn,Br,cn,Cr,nn,Wn)}return pn}return pn(qr),pn._reglType="elements",pn._elements=zr,pn.subdata=function(Tr,gn){return or.subdata(Tr,gn),pn},pn.destroy=function(){en(zr)},pn}return{create:kr,createStream:Qr,destroyStream:jr,getElements:function(qr){return typeof qr=="function"&&qr._elements instanceof Ur?qr._elements:null},clear:function(){zi(mr).forEach(en)}}}var On=new Float32Array(1),Ws=new Uint32Array(On.buffer),cs=5123;function du(W){for(var we=Je.allocType(cs,W.length),Qe=0;Qe<W.length;++Qe)if(isNaN(W[Qe]))we[Qe]=65535;else if(W[Qe]===Infinity)we[Qe]=31744;else if(W[Qe]===-Infinity)we[Qe]=64512;else{On[0]=W[Qe];var Qt=Ws[0],mr=Qt>>>31<<15,er=(Qt<<1>>>24)-127,Zt=Qt>>13&(1<<10)-1;if(er<-24)we[Qe]=mr;else if(er<-14){var Ur=-14-er;we[Qe]=mr+(Zt+(1<<10)>>Ur)}else er>15?we[Qe]=mr+31744:we[Qe]=mr+(er+15<<10)+Zt}return we}function Na(W){return Array.isArray(W)||se(W)}var Tf=function(W){return!(W&W-1)&&!!W},qh=34467,es=3553,wl=34067,Bu=34069,el=6408,wf=6406,Hc=6407,vu=6409,Aa=6410,tl=32854,Fu=32855,Kh=36194,Wc=32819,ma=32820,dc=33635,Gc=34042,rl=6402,mu=34041,dh=35904,vc=35906,nl=36193,Cl=33776,mc=33777,il=33778,gc=33779,yc=35986,vh=35987,Rl=34798,gu=35840,Xc=35841,mh=35842,$c=35843,yu=36196,Nu=5121,_c=5123,xc=5125,Wl=5126,Qh=10242,bc=10243,Jh=10497,Cf=33071,ep=33648,Rf=10240,Ya=10241,Mf=9728,tp=9729,Ec=9984,gh=9985,Gl=9986,oa=9987,Sc=33170,Gs=4352,Ml=4353,Di=4354,ga=34046,Ps=3317,If=37440,Ac=37441,Pf=37443,Uu=37444,Of=33984,Yc=[Ec,Gl,gh,oa],Xl=[0,vu,Aa,Hc,el],Po={};Po[vu]=Po[wf]=Po[rl]=1,Po[mu]=Po[Aa]=2,Po[Hc]=Po[dh]=3,Po[el]=Po[vc]=4;function Ia(W){return"[object "+W+"]"}var qc=Ia("HTMLCanvasElement"),rp=Ia("OffscreenCanvas"),Pa=Ia("CanvasRenderingContext2D"),An=Ia("ImageBitmap"),fs=Ia("HTMLImageElement"),Tc=Ia("HTMLVideoElement"),Kc=Object.keys(Ln).concat([qc,rp,Pa,An,fs,Tc]),hs=[];hs[Nu]=1,hs[Wl]=4,hs[nl]=2,hs[_c]=2,hs[xc]=4;var sa=[];sa[tl]=2,sa[Fu]=2,sa[Kh]=2,sa[mu]=4,sa[Cl]=.5,sa[mc]=.5,sa[il]=1,sa[gc]=1,sa[yc]=.5,sa[vh]=1,sa[Rl]=1,sa[gu]=.5,sa[Xc]=.25,sa[mh]=.5,sa[$c]=.25,sa[yu]=.5;function kf(W){return Array.isArray(W)&&(W.length===0||typeof W[0]=="number")}function ln(W){if(!Array.isArray(W))return!1;var we=W.length;return!(we===0||!Na(W[0]))}function Il(W){return Object.prototype.toString.call(W)}function Qc(W){return Il(W)===qc}function Df(W){return Il(W)===rp}function Xs(W){return Il(W)===Pa}function $s(W){return Il(W)===An}function Lf(W){return Il(W)===fs}function Bf(W){return Il(W)===Tc}function ps(W){if(!W)return!1;var we=Il(W);return Kc.indexOf(we)>=0?!0:kf(W)||ln(W)||Fa(W)}function zu(W){return Ln[Object.prototype.toString.call(W)]|0}function yh(W,we){var Qe=we.length;switch(W.type){case Nu:case _c:case xc:case Wl:var Qt=Je.allocType(W.type,Qe);Qt.set(we),W.data=Qt;break;case nl:W.data=du(we);break;default:Re.raise("unsupported texture type, must specify a typed array")}}function wc(W,we){return Je.allocType(W.type===nl?Wl:W.type,we)}function Ff(W,we){W.type===nl?(W.data=du(we),Je.freeType(we)):W.data=we}function Jc(W,we,Qe,Qt,mr,er){for(var Zt=W.width,Ur=W.height,Or=W.channels,Qr=Zt*Ur*Or,jr=wc(W,Qr),$r=0,en=0;en<Ur;++en)for(var kr=0;kr<Zt;++kr)for(var qr=0;qr<Or;++qr)jr[$r++]=we[Qe*kr+Qt*en+mr*qr+er];Ff(W,jr)}function ds(W,we,Qe,Qt,mr,er){var Zt;if(typeof sa[W]!="undefined"?Zt=sa[W]:Zt=Po[W]*hs[we],er&&(Zt*=6),mr){for(var Ur=0,Or=Qe;Or>=1;)Ur+=Zt*Or*Or,Or/=2;return Ur}else return Zt*Qe*Qt}function Ys(W,we,Qe,Qt,mr,er,Zt){var Ur={"don't care":Gs,"dont care":Gs,nice:Di,fast:Ml},Or={repeat:Jh,clamp:Cf,mirror:ep},Qr={nearest:Mf,linear:tp},jr=Z({mipmap:oa,"nearest mipmap nearest":Ec,"linear mipmap nearest":gh,"nearest mipmap linear":Gl,"linear mipmap linear":oa},Qr),$r={none:0,browser:Uu},en={uint8:Nu,rgba4:Wc,rgb565:dc,"rgb5 a1":ma},kr={alpha:wf,luminance:vu,"luminance alpha":Aa,rgb:Hc,rgba:el,rgba4:tl,"rgb5 a1":Fu,rgb565:Kh},qr={};we.ext_srgb&&(kr.srgb=dh,kr.srgba=vc),we.oes_texture_float&&(en.float32=en.float=Wl),we.oes_texture_half_float&&(en.float16=en["half float"]=nl),we.webgl_depth_texture&&(Z(kr,{depth:rl,"depth stencil":mu}),Z(en,{uint16:_c,uint32:xc,"depth stencil":Gc})),we.webgl_compressed_texture_s3tc&&Z(qr,{"rgb s3tc dxt1":Cl,"rgba s3tc dxt1":mc,"rgba s3tc dxt3":il,"rgba s3tc dxt5":gc}),we.webgl_compressed_texture_atc&&Z(qr,{"rgb atc":yc,"rgba atc explicit alpha":vh,"rgba atc interpolated alpha":Rl}),we.webgl_compressed_texture_pvrtc&&Z(qr,{"rgb pvrtc 4bppv1":gu,"rgb pvrtc 2bppv1":Xc,"rgba pvrtc 4bppv1":mh,"rgba pvrtc 2bppv1":$c}),we.webgl_compressed_texture_etc1&&(qr["rgb etc1"]=yu);var Bt=Array.prototype.slice.call(W.getParameter(qh));Object.keys(qr).forEach(function(Ge){var tr=qr[Ge];Bt.indexOf(tr)>=0&&(kr[Ge]=tr)});var or=Object.keys(kr);Qe.textureFormats=or;var zr=[];Object.keys(kr).forEach(function(Ge){var tr=kr[Ge];zr[tr]=Ge});var pn=[];Object.keys(en).forEach(function(Ge){var tr=en[Ge];pn[tr]=Ge});var Tr=[];Object.keys(Qr).forEach(function(Ge){var tr=Qr[Ge];Tr[tr]=Ge});var gn=[];Object.keys(jr).forEach(function(Ge){var tr=jr[Ge];gn[tr]=Ge});var Br=[];Object.keys(Or).forEach(function(Ge){var tr=Or[Ge];Br[tr]=Ge});var cn=or.reduce(function(Ge,tr){var Gt=kr[tr];return Gt===vu||Gt===wf||Gt===vu||Gt===Aa||Gt===rl||Gt===mu||we.ext_srgb&&(Gt===dh||Gt===vc)?Ge[Gt]=Gt:Gt===Fu||tr.indexOf("rgba")>=0?Ge[Gt]=el:Ge[Gt]=Hc,Ge},{});function Cr(){this.internalformat=el,this.format=el,this.type=Nu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Uu,this.width=0,this.height=0,this.channels=0}function nn(Ge,tr){Ge.internalformat=tr.internalformat,Ge.format=tr.format,Ge.type=tr.type,Ge.compressed=tr.compressed,Ge.premultiplyAlpha=tr.premultiplyAlpha,Ge.flipY=tr.flipY,Ge.unpackAlignment=tr.unpackAlignment,Ge.colorSpace=tr.colorSpace,Ge.width=tr.width,Ge.height=tr.height,Ge.channels=tr.channels}function Wn(Ge,tr){if(!(typeof tr!="object"||!tr)){if("premultiplyAlpha"in tr&&(Re.type(tr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ge.premultiplyAlpha=tr.premultiplyAlpha),"flipY"in tr&&(Re.type(tr.flipY,"boolean","invalid texture flip"),Ge.flipY=tr.flipY),"alignment"in tr&&(Re.oneOf(tr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ge.unpackAlignment=tr.alignment),"colorSpace"in tr&&(Re.parameter(tr.colorSpace,$r,"invalid colorSpace"),Ge.colorSpace=$r[tr.colorSpace]),"type"in tr){var Gt=tr.type;Re(we.oes_texture_float||!(Gt==="float"||Gt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Re(we.oes_texture_half_float||!(Gt==="half float"||Gt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Re(we.webgl_depth_texture||!(Gt==="uint16"||Gt==="uint32"||Gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Re.parameter(Gt,en,"invalid texture type"),Ge.type=en[Gt]}var xn=Ge.width,Si=Ge.height,la=Ge.channels,ve=!1;"shape"in tr?(Re(Array.isArray(tr.shape)&&tr.shape.length>=2,"shape must be an array"),xn=tr.shape[0],Si=tr.shape[1],tr.shape.length===3&&(la=tr.shape[2],Re(la>0&&la<=4,"invalid number of channels"),ve=!0),Re(xn>=0&&xn<=Qe.maxTextureSize,"invalid width"),Re(Si>=0&&Si<=Qe.maxTextureSize,"invalid height")):("radius"in tr&&(xn=Si=tr.radius,Re(xn>=0&&xn<=Qe.maxTextureSize,"invalid radius")),"width"in tr&&(xn=tr.width,Re(xn>=0&&xn<=Qe.maxTextureSize,"invalid width")),"height"in tr&&(Si=tr.height,Re(Si>=0&&Si<=Qe.maxTextureSize,"invalid height")),"channels"in tr&&(la=tr.channels,Re(la>0&&la<=4,"invalid number of channels"),ve=!0)),Ge.width=xn|0,Ge.height=Si|0,Ge.channels=la|0;var Ie=!1;if("format"in tr){var Ke=tr.format;Re(we.webgl_depth_texture||!(Ke==="depth"||Ke==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Re.parameter(Ke,kr,"invalid texture format");var Xt=Ge.internalformat=kr[Ke];Ge.format=cn[Xt],Ke in en&&("type"in tr||(Ge.type=en[Ke])),Ke in qr&&(Ge.compressed=!0),Ie=!0}!ve&&Ie?Ge.channels=Po[Ge.format]:ve&&!Ie?Ge.channels!==Xl[Ge.format]&&(Ge.format=Ge.internalformat=Xl[Ge.channels]):Ie&&ve&&Re(Ge.channels===Po[Ge.format],"number of channels inconsistent with specified format")}}function hi(Ge){W.pixelStorei(If,Ge.flipY),W.pixelStorei(Ac,Ge.premultiplyAlpha),W.pixelStorei(Pf,Ge.colorSpace),W.pixelStorei(Ps,Ge.unpackAlignment)}function an(){Cr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Lr(Ge,tr){var Gt=null;if(ps(tr)?Gt=tr:tr&&(Re.type(tr,"object","invalid pixel data type"),Wn(Ge,tr),"x"in tr&&(Ge.xOffset=tr.x|0),"y"in tr&&(Ge.yOffset=tr.y|0),ps(tr.data)&&(Gt=tr.data)),Re(!Ge.compressed||Gt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),tr.copy){Re(!Gt,"can not specify copy and data field for the same texture");var xn=mr.viewportWidth,Si=mr.viewportHeight;Ge.width=Ge.width||xn-Ge.xOffset,Ge.height=Ge.height||Si-Ge.yOffset,Ge.needsCopy=!0,Re(Ge.xOffset>=0&&Ge.xOffset<xn&&Ge.yOffset>=0&&Ge.yOffset<Si&&Ge.width>0&&Ge.width<=xn&&Ge.height>0&&Ge.height<=Si,"copy texture read out of bounds")}else if(!Gt)Ge.width=Ge.width||1,Ge.height=Ge.height||1,Ge.channels=Ge.channels||4;else if(se(Gt))Ge.channels=Ge.channels||4,Ge.data=Gt,!("type"in tr)&&Ge.type===Nu&&(Ge.type=zu(Gt));else if(kf(Gt))Ge.channels=Ge.channels||4,yh(Ge,Gt),Ge.alignment=1,Ge.needsFree=!0;else if(Fa(Gt)){var la=Gt.data;!Array.isArray(la)&&Ge.type===Nu&&(Ge.type=zu(la));var ve=Gt.shape,Ie=Gt.stride,Ke,Xt,Vt,ut,mt,At;ve.length===3?(Vt=ve[2],At=Ie[2]):(Re(ve.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Vt=1,At=1),Ke=ve[0],Xt=ve[1],ut=Ie[0],mt=Ie[1],Ge.alignment=1,Ge.width=Ke,Ge.height=Xt,Ge.channels=Vt,Ge.format=Ge.internalformat=Xl[Vt],Ge.needsFree=!0,Jc(Ge,la,ut,mt,At,Gt.offset)}else if(Qc(Gt)||Df(Gt)||Xs(Gt))Qc(Gt)||Df(Gt)?Ge.element=Gt:Ge.element=Gt.canvas,Ge.width=Ge.element.width,Ge.height=Ge.element.height,Ge.channels=4;else if($s(Gt))Ge.element=Gt,Ge.width=Gt.width,Ge.height=Gt.height,Ge.channels=4;else if(Lf(Gt))Ge.element=Gt,Ge.width=Gt.naturalWidth,Ge.height=Gt.naturalHeight,Ge.channels=4;else if(Bf(Gt))Ge.element=Gt,Ge.width=Gt.videoWidth,Ge.height=Gt.videoHeight,Ge.channels=4;else if(ln(Gt)){var Xe=Ge.width||Gt[0].length,ft=Ge.height||Gt.length,Me=Ge.channels;Na(Gt[0][0])?Me=Me||Gt[0][0].length:Me=Me||1;for(var dt=Ho.shape(Gt),ir=1,jt=0;jt<dt.length;++jt)ir*=dt[jt];var wr=wc(Ge,ir);Ho.flatten(Gt,dt,"",wr),Ff(Ge,wr),Ge.alignment=1,Ge.width=Xe,Ge.height=ft,Ge.channels=Me,Ge.format=Ge.internalformat=Xl[Me],Ge.needsFree=!0}Ge.type===Wl?Re(Qe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ge.type===nl&&Re(Qe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function _r(Ge,tr,Gt){var xn=Ge.element,Si=Ge.data,la=Ge.internalformat,ve=Ge.format,Ie=Ge.type,Ke=Ge.width,Xt=Ge.height;hi(Ge),xn?W.texImage2D(tr,Gt,ve,ve,Ie,xn):Ge.compressed?W.compressedTexImage2D(tr,Gt,la,Ke,Xt,0,Si):Ge.needsCopy?(Qt(),W.copyTexImage2D(tr,Gt,ve,Ge.xOffset,Ge.yOffset,Ke,Xt,0)):W.texImage2D(tr,Gt,ve,Ke,Xt,0,ve,Ie,Si||null)}function Xn(Ge,tr,Gt,xn,Si){var la=Ge.element,ve=Ge.data,Ie=Ge.internalformat,Ke=Ge.format,Xt=Ge.type,Vt=Ge.width,ut=Ge.height;hi(Ge),la?W.texSubImage2D(tr,Si,Gt,xn,Ke,Xt,la):Ge.compressed?W.compressedTexSubImage2D(tr,Si,Gt,xn,Ie,Vt,ut,ve):Ge.needsCopy?(Qt(),W.copyTexSubImage2D(tr,Si,Gt,xn,Ge.xOffset,Ge.yOffset,Vt,ut)):W.texSubImage2D(tr,Si,Gt,xn,Vt,ut,Ke,Xt,ve)}var pr=[];function yn(){return pr.pop()||new an}function xt(Ge){Ge.needsFree&&Je.freeType(Ge.data),an.call(Ge),pr.push(Ge)}function ci(){Cr.call(this),this.genMipmaps=!1,this.mipmapHint=Gs,this.mipmask=0,this.images=Array(16)}function ri(Ge,tr,Gt){var xn=Ge.images[0]=yn();Ge.mipmask=1,xn.width=Ge.width=tr,xn.height=Ge.height=Gt,xn.channels=Ge.channels=4}function Gi(Ge,tr){var Gt=null;if(ps(tr))Gt=Ge.images[0]=yn(),nn(Gt,Ge),Lr(Gt,tr),Ge.mipmask=1;else if(Wn(Ge,tr),Array.isArray(tr.mipmap))for(var xn=tr.mipmap,Si=0;Si<xn.length;++Si)Gt=Ge.images[Si]=yn(),nn(Gt,Ge),Gt.width>>=Si,Gt.height>>=Si,Lr(Gt,xn[Si]),Ge.mipmask|=1<<Si;else Gt=Ge.images[0]=yn(),nn(Gt,Ge),Lr(Gt,tr),Ge.mipmask=1;nn(Ge,Ge.images[0]),Ge.compressed&&(Ge.internalformat===Cl||Ge.internalformat===mc||Ge.internalformat===il||Ge.internalformat===gc)&&Re(Ge.width%4==0&&Ge.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function co(Ge,tr){for(var Gt=Ge.images,xn=0;xn<Gt.length;++xn){if(!Gt[xn])return;_r(Gt[xn],tr,xn)}}var Bo=[];function Ai(){var Ge=Bo.pop()||new ci;Cr.call(Ge),Ge.mipmask=0;for(var tr=0;tr<16;++tr)Ge.images[tr]=null;return Ge}function fo(Ge){for(var tr=Ge.images,Gt=0;Gt<tr.length;++Gt)tr[Gt]&&xt(tr[Gt]),tr[Gt]=null;Bo.push(Ge)}function Ea(){this.minFilter=Mf,this.magFilter=Mf,this.wrapS=Cf,this.wrapT=Cf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Gs}function ho(Ge,tr){if("min"in tr){var Gt=tr.min;Re.parameter(Gt,jr),Ge.minFilter=jr[Gt],Yc.indexOf(Ge.minFilter)>=0&&!("faces"in tr)&&(Ge.genMipmaps=!0)}if("mag"in tr){var xn=tr.mag;Re.parameter(xn,Qr),Ge.magFilter=Qr[xn]}var Si=Ge.wrapS,la=Ge.wrapT;if("wrap"in tr){var ve=tr.wrap;typeof ve=="string"?(Re.parameter(ve,Or),Si=la=Or[ve]):Array.isArray(ve)&&(Re.parameter(ve[0],Or),Re.parameter(ve[1],Or),Si=Or[ve[0]],la=Or[ve[1]])}else{if("wrapS"in tr){var Ie=tr.wrapS;Re.parameter(Ie,Or),Si=Or[Ie]}if("wrapT"in tr){var Ke=tr.wrapT;Re.parameter(Ke,Or),la=Or[Ke]}}if(Ge.wrapS=Si,Ge.wrapT=la,"anisotropic"in tr){var Xt=tr.anisotropic;Re(typeof Xt=="number"&&Xt>=1&&Xt<=Qe.maxAnisotropic,"aniso samples must be between 1 and "),Ge.anisotropic=tr.anisotropic}if("mipmap"in tr){var Vt=!1;switch(typeof tr.mipmap){case"string":Re.parameter(tr.mipmap,Ur,"invalid mipmap hint"),Ge.mipmapHint=Ur[tr.mipmap],Ge.genMipmaps=!0,Vt=!0;break;case"boolean":Vt=Ge.genMipmaps=tr.mipmap;break;case"object":Re(Array.isArray(tr.mipmap),"invalid mipmap type"),Ge.genMipmaps=!1,Vt=!0;break;default:Re.raise("invalid mipmap type")}Vt&&!("min"in tr)&&(Ge.minFilter=Ec)}}function po(Ge,tr){W.texParameteri(tr,Ya,Ge.minFilter),W.texParameteri(tr,Rf,Ge.magFilter),W.texParameteri(tr,Qh,Ge.wrapS),W.texParameteri(tr,bc,Ge.wrapT),we.ext_texture_filter_anisotropic&&W.texParameteri(tr,ga,Ge.anisotropic),Ge.genMipmaps&&(W.hint(Sc,Ge.mipmapHint),W.generateMipmap(tr))}var za=0,wo={},ns=Qe.maxTextureUnits,Co=Array(ns).map(function(){return null});function Ei(Ge){Cr.call(this),this.mipmask=0,this.internalformat=el,this.id=za++,this.refCount=1,this.target=Ge,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ea,Zt.profile&&(this.stats={size:0})}function is(Ge){W.activeTexture(Of),W.bindTexture(Ge.target,Ge.texture)}function Ji(){var Ge=Co[0];Ge?W.bindTexture(Ge.target,Ge.texture):W.bindTexture(es,null)}function Kn(Ge){var tr=Ge.texture;Re(tr,"must not double destroy texture");var Gt=Ge.unit,xn=Ge.target;Gt>=0&&(W.activeTexture(Of+Gt),W.bindTexture(xn,null),Co[Gt]=null),W.deleteTexture(tr),Ge.texture=null,Ge.params=null,Ge.pixels=null,Ge.refCount=0,delete wo[Ge.id],er.textureCount--}Z(Ei.prototype,{bind:function(){var Ge=this;Ge.bindCount+=1;var tr=Ge.unit;if(tr<0){for(var Gt=0;Gt<ns;++Gt){var xn=Co[Gt];if(xn){if(xn.bindCount>0)continue;xn.unit=-1}Co[Gt]=Ge,tr=Gt;break}tr>=ns&&Re.raise("insufficient number of texture units"),Zt.profile&&er.maxTextureUnits<tr+1&&(er.maxTextureUnits=tr+1),Ge.unit=tr,W.activeTexture(Of+tr),W.bindTexture(Ge.target,Ge.texture)}return tr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Kn(this)}});function Oi(Ge,tr){var Gt=new Ei(es);wo[Gt.id]=Gt,er.textureCount++;function xn(ve,Ie){var Ke=Gt.texInfo;Ea.call(Ke);var Xt=Ai();return typeof ve=="number"?typeof Ie=="number"?ri(Xt,ve|0,Ie|0):ri(Xt,ve|0,ve|0):ve?(Re.type(ve,"object","invalid arguments to regl.texture"),ho(Ke,ve),Gi(Xt,ve)):ri(Xt,1,1),Ke.genMipmaps&&(Xt.mipmask=(Xt.width<<1)-1),Gt.mipmask=Xt.mipmask,nn(Gt,Xt),Re.texture2D(Ke,Xt,Qe),Gt.internalformat=Xt.internalformat,xn.width=Xt.width,xn.height=Xt.height,is(Gt),co(Xt,es),po(Ke,es),Ji(),fo(Xt),Zt.profile&&(Gt.stats.size=ds(Gt.internalformat,Gt.type,Xt.width,Xt.height,Ke.genMipmaps,!1)),xn.format=zr[Gt.internalformat],xn.type=pn[Gt.type],xn.mag=Tr[Ke.magFilter],xn.min=gn[Ke.minFilter],xn.wrapS=Br[Ke.wrapS],xn.wrapT=Br[Ke.wrapT],xn}function Si(ve,Ie,Ke,Xt){Re(!!ve,"must specify image data");var Vt=Ie|0,ut=Ke|0,mt=Xt|0,At=yn();return nn(At,Gt),At.width=0,At.height=0,Lr(At,ve),At.width=At.width||(Gt.width>>mt)-Vt,At.height=At.height||(Gt.height>>mt)-ut,Re(Gt.type===At.type&&Gt.format===At.format&&Gt.internalformat===At.internalformat,"incompatible format for texture.subimage"),Re(Vt>=0&&ut>=0&&Vt+At.width<=Gt.width&&ut+At.height<=Gt.height,"texture.subimage write out of bounds"),Re(Gt.mipmask&1<<mt,"missing mipmap data"),Re(At.data||At.element||At.needsCopy,"missing image data"),is(Gt),Xn(At,es,Vt,ut,mt),Ji(),xt(At),xn}function la(ve,Ie){var Ke=ve|0,Xt=Ie|0||Ke;if(Ke===Gt.width&&Xt===Gt.height)return xn;xn.width=Gt.width=Ke,xn.height=Gt.height=Xt,is(Gt);for(var Vt=0;Gt.mipmask>>Vt;++Vt){var ut=Ke>>Vt,mt=Xt>>Vt;if(!ut||!mt)break;W.texImage2D(es,Vt,Gt.format,ut,mt,0,Gt.format,Gt.type,null)}return Ji(),Zt.profile&&(Gt.stats.size=ds(Gt.internalformat,Gt.type,Ke,Xt,!1,!1)),xn}return xn(Ge,tr),xn.subimage=Si,xn.resize=la,xn._reglType="texture2d",xn._texture=Gt,Zt.profile&&(xn.stats=Gt.stats),xn.destroy=function(){Gt.decRef()},xn}function Xi(Ge,tr,Gt,xn,Si,la){var ve=new Ei(wl);wo[ve.id]=ve,er.cubeCount++;var Ie=new Array(6);function Ke(ut,mt,At,Xe,ft,Me){var dt,ir=ve.texInfo;for(Ea.call(ir),dt=0;dt<6;++dt)Ie[dt]=Ai();if(typeof ut=="number"||!ut){var jt=ut|0||1;for(dt=0;dt<6;++dt)ri(Ie[dt],jt,jt)}else if(typeof ut=="object")if(mt)Gi(Ie[0],ut),Gi(Ie[1],mt),Gi(Ie[2],At),Gi(Ie[3],Xe),Gi(Ie[4],ft),Gi(Ie[5],Me);else if(ho(ir,ut),Wn(ve,ut),"faces"in ut){var wr=ut.faces;for(Re(Array.isArray(wr)&&wr.length===6,"cube faces must be a length 6 array"),dt=0;dt<6;++dt)Re(typeof wr[dt]=="object"&&!!wr[dt],"invalid input for cube map face"),nn(Ie[dt],ve),Gi(Ie[dt],wr[dt])}else for(dt=0;dt<6;++dt)Gi(Ie[dt],ut);else Re.raise("invalid arguments to cube map");for(nn(ve,Ie[0]),Qe.npotTextureCube||Re(Tf(ve.width)&&Tf(ve.height),"your browser does not support non power or two texture dimensions"),ir.genMipmaps?ve.mipmask=(Ie[0].width<<1)-1:ve.mipmask=Ie[0].mipmask,Re.textureCube(ve,ir,Ie,Qe),ve.internalformat=Ie[0].internalformat,Ke.width=Ie[0].width,Ke.height=Ie[0].height,is(ve),dt=0;dt<6;++dt)co(Ie[dt],Bu+dt);for(po(ir,wl),Ji(),Zt.profile&&(ve.stats.size=ds(ve.internalformat,ve.type,Ke.width,Ke.height,ir.genMipmaps,!0)),Ke.format=zr[ve.internalformat],Ke.type=pn[ve.type],Ke.mag=Tr[ir.magFilter],Ke.min=gn[ir.minFilter],Ke.wrapS=Br[ir.wrapS],Ke.wrapT=Br[ir.wrapT],dt=0;dt<6;++dt)fo(Ie[dt]);return Ke}function Xt(ut,mt,At,Xe,ft){Re(!!mt,"must specify image data"),Re(typeof ut=="number"&&ut===(ut|0)&&ut>=0&&ut<6,"invalid face");var Me=At|0,dt=Xe|0,ir=ft|0,jt=yn();return nn(jt,ve),jt.width=0,jt.height=0,Lr(jt,mt),jt.width=jt.width||(ve.width>>ir)-Me,jt.height=jt.height||(ve.height>>ir)-dt,Re(ve.type===jt.type&&ve.format===jt.format&&ve.internalformat===jt.internalformat,"incompatible format for texture.subimage"),Re(Me>=0&&dt>=0&&Me+jt.width<=ve.width&&dt+jt.height<=ve.height,"texture.subimage write out of bounds"),Re(ve.mipmask&1<<ir,"missing mipmap data"),Re(jt.data||jt.element||jt.needsCopy,"missing image data"),is(ve),Xn(jt,Bu+ut,Me,dt,ir),Ji(),xt(jt),Ke}function Vt(ut){var mt=ut|0;if(mt!==ve.width){Ke.width=ve.width=mt,Ke.height=ve.height=mt,is(ve);for(var At=0;At<6;++At)for(var Xe=0;ve.mipmask>>Xe;++Xe)W.texImage2D(Bu+At,Xe,ve.format,mt>>Xe,mt>>Xe,0,ve.format,ve.type,null);return Ji(),Zt.profile&&(ve.stats.size=ds(ve.internalformat,ve.type,Ke.width,Ke.height,!1,!0)),Ke}}return Ke(Ge,tr,Gt,xn,Si,la),Ke.subimage=Xt,Ke.resize=Vt,Ke._reglType="textureCube",Ke._texture=ve,Zt.profile&&(Ke.stats=ve.stats),Ke.destroy=function(){ve.decRef()},Ke}function vo(){for(var Ge=0;Ge<ns;++Ge)W.activeTexture(Of+Ge),W.bindTexture(es,null),Co[Ge]=null;zi(wo).forEach(Kn),er.cubeCount=0,er.textureCount=0}Zt.profile&&(er.getTotalTextureSize=function(){var Ge=0;return Object.keys(wo).forEach(function(tr){Ge+=wo[tr].stats.size}),Ge});function vl(){for(var Ge=0;Ge<ns;++Ge){var tr=Co[Ge];tr&&(tr.bindCount=0,tr.unit=-1,Co[Ge]=null)}zi(wo).forEach(function(Gt){Gt.texture=W.createTexture(),W.bindTexture(Gt.target,Gt.texture);for(var xn=0;xn<32;++xn)if((Gt.mipmask&1<<xn)!=0)if(Gt.target===es)W.texImage2D(es,xn,Gt.internalformat,Gt.width>>xn,Gt.height>>xn,0,Gt.internalformat,Gt.type,null);else for(var Si=0;Si<6;++Si)W.texImage2D(Bu+Si,xn,Gt.internalformat,Gt.width>>xn,Gt.height>>xn,0,Gt.internalformat,Gt.type,null);po(Gt.texInfo,Gt.target)})}return{create2D:Oi,createCube:Xi,clear:vo,getTexture:function(Ge){return null},restore:vl}}var St=36161,Be=32854,F=32855,Oo=36194,Ae=33189,al=36168,ba=34041,ko=35907,ol=34836,wn=34842,Cn=34843,Es=[];Es[Be]=2,Es[F]=2,Es[Oo]=2,Es[Ae]=2,Es[al]=1,Es[ba]=4,Es[ko]=4,Es[ol]=16,Es[wn]=8,Es[Cn]=6;function Eo(W,we,Qe){return Es[W]*we*Qe}var _u=function(W,we,Qe,Qt,mr){var er={rgba4:Be,rgb565:Oo,"rgb5 a1":F,depth:Ae,stencil:al,"depth stencil":ba};we.ext_srgb&&(er.srgba=ko),we.ext_color_buffer_half_float&&(er.rgba16f=wn,er.rgb16f=Cn),we.webgl_color_buffer_float&&(er.rgba32f=ol);var Zt=[];Object.keys(er).forEach(function(kr){var qr=er[kr];Zt[qr]=kr});var Ur=0,Or={};function Qr(kr){this.id=Ur++,this.refCount=1,this.renderbuffer=kr,this.format=Be,this.width=0,this.height=0,mr.profile&&(this.stats={size:0})}Qr.prototype.decRef=function(){--this.refCount<=0&&jr(this)};function jr(kr){var qr=kr.renderbuffer;Re(qr,"must not double destroy renderbuffer"),W.bindRenderbuffer(St,null),W.deleteRenderbuffer(qr),kr.renderbuffer=null,kr.refCount=0,delete Or[kr.id],Qt.renderbufferCount--}function $r(kr,qr){var Bt=new Qr(W.createRenderbuffer());Or[Bt.id]=Bt,Qt.renderbufferCount++;function or(pn,Tr){var gn=0,Br=0,cn=Be;if(typeof pn=="object"&&pn){var Cr=pn;if("shape"in Cr){var nn=Cr.shape;Re(Array.isArray(nn)&&nn.length>=2,"invalid renderbuffer shape"),gn=nn[0]|0,Br=nn[1]|0}else"radius"in Cr&&(gn=Br=Cr.radius|0),"width"in Cr&&(gn=Cr.width|0),"height"in Cr&&(Br=Cr.height|0);"format"in Cr&&(Re.parameter(Cr.format,er,"invalid renderbuffer format"),cn=er[Cr.format])}else typeof pn=="number"?(gn=pn|0,typeof Tr=="number"?Br=Tr|0:Br=gn):pn?Re.raise("invalid arguments to renderbuffer constructor"):gn=Br=1;if(Re(gn>0&&Br>0&&gn<=Qe.maxRenderbufferSize&&Br<=Qe.maxRenderbufferSize,"invalid renderbuffer size"),!(gn===Bt.width&&Br===Bt.height&&cn===Bt.format))return or.width=Bt.width=gn,or.height=Bt.height=Br,Bt.format=cn,W.bindRenderbuffer(St,Bt.renderbuffer),W.renderbufferStorage(St,cn,gn,Br),Re(W.getError()===0,"invalid render buffer format"),mr.profile&&(Bt.stats.size=Eo(Bt.format,Bt.width,Bt.height)),or.format=Zt[Bt.format],or}function zr(pn,Tr){var gn=pn|0,Br=Tr|0||gn;return gn===Bt.width&&Br===Bt.height||(Re(gn>0&&Br>0&&gn<=Qe.maxRenderbufferSize&&Br<=Qe.maxRenderbufferSize,"invalid renderbuffer size"),or.width=Bt.width=gn,or.height=Bt.height=Br,W.bindRenderbuffer(St,Bt.renderbuffer),W.renderbufferStorage(St,Bt.format,gn,Br),Re(W.getError()===0,"invalid render buffer format"),mr.profile&&(Bt.stats.size=Eo(Bt.format,Bt.width,Bt.height))),or}return or(kr,qr),or.resize=zr,or._reglType="renderbuffer",or._renderbuffer=Bt,mr.profile&&(or.stats=Bt.stats),or.destroy=function(){Bt.decRef()},or}mr.profile&&(Qt.getTotalRenderbufferSize=function(){var kr=0;return Object.keys(Or).forEach(function(qr){kr+=Or[qr].stats.size}),kr});function en(){zi(Or).forEach(function(kr){kr.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(St,kr.renderbuffer),W.renderbufferStorage(St,kr.format,kr.width,kr.height)}),W.bindRenderbuffer(St,null)}return{create:$r,clear:function(){zi(Or).forEach(jr)},restore:en}},Oa=36160,iu=36161,Zu=3553,sl=34069,Vi=36064,Do=36096,Nf=36128,Pl=33306,Uf=36053,ul=36054,Os=36055,Ol=36057,xu=36061,ef=36193,Cc=5121,tf=5126,zf=6407,$l=6408,Yl=6402,_h=[zf,$l],Vu=[];Vu[$l]=4,Vu[zf]=3;var Xo=[];Xo[Cc]=1,Xo[tf]=4,Xo[ef]=2;var Zf=32854,ll=32855,au=36194,xh=33189,rf=36168,cl=34041,Vf=35907,h=34836,v=34842,d=34843,g=[Zf,ll,au,Vf,v,d,h],S={};S[Uf]="complete",S[ul]="incomplete attachment",S[Ol]="incomplete dimensions",S[Os]="incomplete, missing attachment",S[xu]="unsupported";function C(W,we,Qe,Qt,mr,er){var Zt={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],Or=["rgba4","rgb565","rgb5 a1"];we.ext_srgb&&Or.push("srgba"),we.ext_color_buffer_half_float&&Or.push("rgba16f","rgb16f"),we.webgl_color_buffer_float&&Or.push("rgba32f");var Qr=["uint8"];we.oes_texture_half_float&&Qr.push("half float","float16"),we.oes_texture_float&&Qr.push("float","float32");function jr(an,Lr,_r){this.target=an,this.texture=Lr,this.renderbuffer=_r;var Xn=0,pr=0;Lr?(Xn=Lr.width,pr=Lr.height):_r&&(Xn=_r.width,pr=_r.height),this.width=Xn,this.height=pr}function $r(an){an&&(an.texture&&an.texture._texture.decRef(),an.renderbuffer&&an.renderbuffer._renderbuffer.decRef())}function en(an,Lr,_r){if(!!an)if(an.texture){var Xn=an.texture._texture,pr=Math.max(1,Xn.width),yn=Math.max(1,Xn.height);Re(pr===Lr&&yn===_r,"inconsistent width/height for supplied texture"),Xn.refCount+=1}else{var xt=an.renderbuffer._renderbuffer;Re(xt.width===Lr&&xt.height===_r,"inconsistent width/height for renderbuffer"),xt.refCount+=1}}function kr(an,Lr){Lr&&(Lr.texture?W.framebufferTexture2D(Oa,an,Lr.target,Lr.texture._texture.texture,0):W.framebufferRenderbuffer(Oa,an,iu,Lr.renderbuffer._renderbuffer.renderbuffer))}function qr(an){var Lr=Zu,_r=null,Xn=null,pr=an;typeof an=="object"&&(pr=an.data,"target"in an&&(Lr=an.target|0)),Re.type(pr,"function","invalid attachment data");var yn=pr._reglType;return yn==="texture2d"?(_r=pr,Re(Lr===Zu)):yn==="textureCube"?(_r=pr,Re(Lr>=sl&&Lr<sl+6,"invalid cube map target")):yn==="renderbuffer"?(Xn=pr,Lr=iu):Re.raise("invalid regl object for attachment"),new jr(Lr,_r,Xn)}function Bt(an,Lr,_r,Xn,pr){if(_r){var yn=Qt.create2D({width:an,height:Lr,format:Xn,type:pr});return yn._texture.refCount=0,new jr(Zu,yn,null)}else{var xt=mr.create({width:an,height:Lr,format:Xn});return xt._renderbuffer.refCount=0,new jr(iu,null,xt)}}function or(an){return an&&(an.texture||an.renderbuffer)}function zr(an,Lr,_r){an&&(an.texture?an.texture.resize(Lr,_r):an.renderbuffer&&an.renderbuffer.resize(Lr,_r),an.width=Lr,an.height=_r)}var pn=0,Tr={};function gn(){this.id=pn++,Tr[this.id]=this,this.framebuffer=W.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Br(an){an.colorAttachments.forEach($r),$r(an.depthAttachment),$r(an.stencilAttachment),$r(an.depthStencilAttachment)}function cn(an){var Lr=an.framebuffer;Re(Lr,"must not double destroy framebuffer"),W.deleteFramebuffer(Lr),an.framebuffer=null,er.framebufferCount--,delete Tr[an.id]}function Cr(an){var Lr;W.bindFramebuffer(Oa,an.framebuffer);var _r=an.colorAttachments;for(Lr=0;Lr<_r.length;++Lr)kr(Vi+Lr,_r[Lr]);for(Lr=_r.length;Lr<Qe.maxColorAttachments;++Lr)W.framebufferTexture2D(Oa,Vi+Lr,Zu,null,0);W.framebufferTexture2D(Oa,Pl,Zu,null,0),W.framebufferTexture2D(Oa,Do,Zu,null,0),W.framebufferTexture2D(Oa,Nf,Zu,null,0),kr(Do,an.depthAttachment),kr(Nf,an.stencilAttachment),kr(Pl,an.depthStencilAttachment);var Xn=W.checkFramebufferStatus(Oa);!W.isContextLost()&&Xn!==Uf&&Re.raise("framebuffer configuration not supported, status = "+S[Xn]),W.bindFramebuffer(Oa,Zt.next?Zt.next.framebuffer:null),Zt.cur=Zt.next,W.getError()}function nn(an,Lr){var _r=new gn;er.framebufferCount++;function Xn(yn,xt){var ci;Re(Zt.next!==_r,"can not update framebuffer which is currently in use");var ri=0,Gi=0,co=!0,Bo=!0,Ai=null,fo=!0,Ea="rgba",ho="uint8",po=1,za=null,wo=null,ns=null,Co=!1;if(typeof yn=="number")ri=yn|0,Gi=xt|0||ri;else if(!yn)ri=Gi=1;else{Re.type(yn,"object","invalid arguments for framebuffer");var Ei=yn;if("shape"in Ei){var is=Ei.shape;Re(Array.isArray(is)&&is.length>=2,"invalid shape for framebuffer"),ri=is[0],Gi=is[1]}else"radius"in Ei&&(ri=Gi=Ei.radius),"width"in Ei&&(ri=Ei.width),"height"in Ei&&(Gi=Ei.height);("color"in Ei||"colors"in Ei)&&(Ai=Ei.color||Ei.colors,Array.isArray(Ai)&&Re(Ai.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),Ai||("colorCount"in Ei&&(po=Ei.colorCount|0,Re(po>0,"invalid color buffer count")),"colorTexture"in Ei&&(fo=!!Ei.colorTexture,Ea="rgba4"),"colorType"in Ei&&(ho=Ei.colorType,fo?(Re(we.oes_texture_float||!(ho==="float"||ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Re(we.oes_texture_half_float||!(ho==="half float"||ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ho==="half float"||ho==="float16"?(Re(we.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ea="rgba16f"):(ho==="float"||ho==="float32")&&(Re(we.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ea="rgba32f"),Re.oneOf(ho,Qr,"invalid color type")),"colorFormat"in Ei&&(Ea=Ei.colorFormat,Ur.indexOf(Ea)>=0?fo=!0:Or.indexOf(Ea)>=0?fo=!1:fo?Re.oneOf(Ei.colorFormat,Ur,"invalid color format for texture"):Re.oneOf(Ei.colorFormat,Or,"invalid color format for renderbuffer"))),("depthTexture"in Ei||"depthStencilTexture"in Ei)&&(Co=!!(Ei.depthTexture||Ei.depthStencilTexture),Re(!Co||we.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ei&&(typeof Ei.depth=="boolean"?co=Ei.depth:(za=Ei.depth,Bo=!1)),"stencil"in Ei&&(typeof Ei.stencil=="boolean"?Bo=Ei.stencil:(wo=Ei.stencil,co=!1)),"depthStencil"in Ei&&(typeof Ei.depthStencil=="boolean"?co=Bo=Ei.depthStencil:(ns=Ei.depthStencil,co=!1,Bo=!1))}var Ji=null,Kn=null,Oi=null,Xi=null;if(Array.isArray(Ai))Ji=Ai.map(qr);else if(Ai)Ji=[qr(Ai)];else for(Ji=new Array(po),ci=0;ci<po;++ci)Ji[ci]=Bt(ri,Gi,fo,Ea,ho);Re(we.webgl_draw_buffers||Ji.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Re(Ji.length<=Qe.maxColorAttachments,"too many color attachments, not supported"),ri=ri||Ji[0].width,Gi=Gi||Ji[0].height,za?Kn=qr(za):co&&!Bo&&(Kn=Bt(ri,Gi,Co,"depth","uint32")),wo?Oi=qr(wo):Bo&&!co&&(Oi=Bt(ri,Gi,!1,"stencil","uint8")),ns?Xi=qr(ns):!za&&!wo&&Bo&&co&&(Xi=Bt(ri,Gi,Co,"depth stencil","depth stencil")),Re(!!za+!!wo+!!ns<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var vo=null;for(ci=0;ci<Ji.length;++ci)if(en(Ji[ci],ri,Gi),Re(!Ji[ci]||Ji[ci].texture&&_h.indexOf(Ji[ci].texture._texture.format)>=0||Ji[ci].renderbuffer&&g.indexOf(Ji[ci].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ci+" is invalid"),Ji[ci]&&Ji[ci].texture){var vl=Vu[Ji[ci].texture._texture.format]*Xo[Ji[ci].texture._texture.type];vo===null?vo=vl:Re(vo===vl,"all color attachments much have the same number of bits per pixel.")}return en(Kn,ri,Gi),Re(!Kn||Kn.texture&&Kn.texture._texture.format===Yl||Kn.renderbuffer&&Kn.renderbuffer._renderbuffer.format===xh,"invalid depth attachment for framebuffer object"),en(Oi,ri,Gi),Re(!Oi||Oi.renderbuffer&&Oi.renderbuffer._renderbuffer.format===rf,"invalid stencil attachment for framebuffer object"),en(Xi,ri,Gi),Re(!Xi||Xi.texture&&Xi.texture._texture.format===cl||Xi.renderbuffer&&Xi.renderbuffer._renderbuffer.format===cl,"invalid depth-stencil attachment for framebuffer object"),Br(_r),_r.width=ri,_r.height=Gi,_r.colorAttachments=Ji,_r.depthAttachment=Kn,_r.stencilAttachment=Oi,_r.depthStencilAttachment=Xi,Xn.color=Ji.map(or),Xn.depth=or(Kn),Xn.stencil=or(Oi),Xn.depthStencil=or(Xi),Xn.width=_r.width,Xn.height=_r.height,Cr(_r),Xn}function pr(yn,xt){Re(Zt.next!==_r,"can not resize a framebuffer which is currently in use");var ci=Math.max(yn|0,1),ri=Math.max(xt|0||ci,1);if(ci===_r.width&&ri===_r.height)return Xn;for(var Gi=_r.colorAttachments,co=0;co<Gi.length;++co)zr(Gi[co],ci,ri);return zr(_r.depthAttachment,ci,ri),zr(_r.stencilAttachment,ci,ri),zr(_r.depthStencilAttachment,ci,ri),_r.width=Xn.width=ci,_r.height=Xn.height=ri,Cr(_r),Xn}return Xn(an,Lr),Z(Xn,{resize:pr,_reglType:"framebuffer",_framebuffer:_r,destroy:function(){cn(_r),Br(_r)},use:function(yn){Zt.setFBO({framebuffer:Xn},yn)}})}function Wn(an){var Lr=Array(6);function _r(pr){var yn;Re(Lr.indexOf(Zt.next)<0,"can not update framebuffer which is currently in use");var xt={color:null},ci=0,ri=null,Gi="rgba",co="uint8",Bo=1;if(typeof pr=="number")ci=pr|0;else if(!pr)ci=1;else{Re.type(pr,"object","invalid arguments for framebuffer");var Ai=pr;if("shape"in Ai){var fo=Ai.shape;Re(Array.isArray(fo)&&fo.length>=2,"invalid shape for framebuffer"),Re(fo[0]===fo[1],"cube framebuffer must be square"),ci=fo[0]}else"radius"in Ai&&(ci=Ai.radius|0),"width"in Ai?(ci=Ai.width|0,"height"in Ai&&Re(Ai.height===ci,"must be square")):"height"in Ai&&(ci=Ai.height|0);("color"in Ai||"colors"in Ai)&&(ri=Ai.color||Ai.colors,Array.isArray(ri)&&Re(ri.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),ri||("colorCount"in Ai&&(Bo=Ai.colorCount|0,Re(Bo>0,"invalid color buffer count")),"colorType"in Ai&&(Re.oneOf(Ai.colorType,Qr,"invalid color type"),co=Ai.colorType),"colorFormat"in Ai&&(Gi=Ai.colorFormat,Re.oneOf(Ai.colorFormat,Ur,"invalid color format for texture"))),"depth"in Ai&&(xt.depth=Ai.depth),"stencil"in Ai&&(xt.stencil=Ai.stencil),"depthStencil"in Ai&&(xt.depthStencil=Ai.depthStencil)}var Ea;if(ri)if(Array.isArray(ri))for(Ea=[],yn=0;yn<ri.length;++yn)Ea[yn]=ri[yn];else Ea=[ri];else{Ea=Array(Bo);var ho={radius:ci,format:Gi,type:co};for(yn=0;yn<Bo;++yn)Ea[yn]=Qt.createCube(ho)}for(xt.color=Array(Ea.length),yn=0;yn<Ea.length;++yn){var po=Ea[yn];Re(typeof po=="function"&&po._reglType==="textureCube","invalid cube map"),ci=ci||po.width,Re(po.width===ci&&po.height===ci,"invalid cube map shape"),xt.color[yn]={target:sl,data:Ea[yn]}}for(yn=0;yn<6;++yn){for(var za=0;za<Ea.length;++za)xt.color[za].target=sl+yn;yn>0&&(xt.depth=Lr[0].depth,xt.stencil=Lr[0].stencil,xt.depthStencil=Lr[0].depthStencil),Lr[yn]?Lr[yn](xt):Lr[yn]=nn(xt)}return Z(_r,{width:ci,height:ci,color:Ea})}function Xn(pr){var yn,xt=pr|0;if(Re(xt>0&&xt<=Qe.maxCubeMapSize,"invalid radius for cube fbo"),xt===_r.width)return _r;var ci=_r.color;for(yn=0;yn<ci.length;++yn)ci[yn].resize(xt);for(yn=0;yn<6;++yn)Lr[yn].resize(xt);return _r.width=_r.height=xt,_r}return _r(an),Z(_r,{faces:Lr,resize:Xn,_reglType:"framebufferCube",destroy:function(){Lr.forEach(function(pr){pr.destroy()})}})}function hi(){Zt.cur=null,Zt.next=null,Zt.dirty=!0,zi(Tr).forEach(function(an){an.framebuffer=W.createFramebuffer(),Cr(an)})}return Z(Zt,{getFramebuffer:function(an){if(typeof an=="function"&&an._reglType==="framebuffer"){var Lr=an._framebuffer;if(Lr instanceof gn)return Lr}return null},create:nn,createCube:Wn,clear:function(){zi(Tr).forEach(cn)},restore:hi})}var R=5126,k=34962;function G(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function J(W,we,Qe,Qt,mr){for(var er=Qe.maxAttributes,Zt=new Array(er),Ur=0;Ur<er;++Ur)Zt[Ur]=new G;var Or=0,Qr={},jr={Record:G,scope:{},state:Zt,currentVAO:null,targetVAO:null,restore:en()?Tr:function(){},createVAO:gn,getVAO:qr,destroyBuffer:$r,setVAO:en()?Bt:or,clear:en()?zr:function(){}};function $r(Br){for(var cn=0;cn<Zt.length;++cn){var Cr=Zt[cn];Cr.buffer===Br&&(W.disableVertexAttribArray(cn),Cr.buffer=null)}}function en(){return we.oes_vertex_array_object}function kr(){return we.angle_instanced_arrays}function qr(Br){return typeof Br=="function"&&Br._vao?Br._vao:null}function Bt(Br){if(Br!==jr.currentVAO){var cn=en();Br?cn.bindVertexArrayOES(Br.vao):cn.bindVertexArrayOES(null),jr.currentVAO=Br}}function or(Br){if(Br!==jr.currentVAO){if(Br)Br.bindAttrs();else for(var cn=kr(),Cr=0;Cr<Zt.length;++Cr){var nn=Zt[Cr];nn.buffer?(W.enableVertexAttribArray(Cr),W.vertexAttribPointer(Cr,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),cn&&cn.vertexAttribDivisorANGLE(Cr,nn.divisor)):(W.disableVertexAttribArray(Cr),W.vertexAttrib4f(Cr,nn.x,nn.y,nn.z,nn.w))}jr.currentVAO=Br}}function zr(){zi(Qr).forEach(function(Br){Br.destroy()})}function pn(){this.id=++Or,this.attributes=[];var Br=en();Br?this.vao=Br.createVertexArrayOES():this.vao=null,Qr[this.id]=this,this.buffers=[]}pn.prototype.bindAttrs=function(){for(var Br=kr(),cn=this.attributes,Cr=0;Cr<cn.length;++Cr){var nn=cn[Cr];nn.buffer?(W.enableVertexAttribArray(Cr),W.bindBuffer(k,nn.buffer.buffer),W.vertexAttribPointer(Cr,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),Br&&Br.vertexAttribDivisorANGLE(Cr,nn.divisor)):(W.disableVertexAttribArray(Cr),W.vertexAttrib4f(Cr,nn.x,nn.y,nn.z,nn.w))}for(var Wn=cn.length;Wn<er;++Wn)W.disableVertexAttribArray(Wn)},pn.prototype.refresh=function(){var Br=en();Br&&(Br.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=this)},pn.prototype.destroy=function(){if(this.vao){var Br=en();this===jr.currentVAO&&(jr.currentVAO=null,Br.bindVertexArrayOES(null)),Br.deleteVertexArrayOES(this.vao),this.vao=null}Qr[this.id]&&(delete Qr[this.id],Qt.vaoCount-=1)};function Tr(){var Br=en();Br&&zi(Qr).forEach(function(cn){cn.refresh()})}function gn(Br){var cn=new pn;Qt.vaoCount+=1;function Cr(nn){Re(Array.isArray(nn),"arguments to vertex array constructor must be an array"),Re(nn.length<er,"too many attributes"),Re(nn.length>0,"must specify at least one attribute");for(var Wn=0;Wn<cn.buffers.length;++Wn)cn.buffers[Wn].destroy();cn.buffers.length=0;var hi=cn.attributes;hi.length=nn.length;for(var an=0;an<nn.length;++an){var Lr=nn[an],_r=hi[an]=new G;if(Array.isArray(Lr)||se(Lr)||Fa(Lr)){var Xn=mr.create(Lr,k,!1,!0);_r.buffer=mr.getBuffer(Xn),_r.size=_r.buffer.dimension|0,_r.normalized=!1,_r.type=_r.buffer.dtype,_r.offset=0,_r.stride=0,_r.divisor=0,_r.state=1,cn.buffers.push(Xn)}else mr.getBuffer(Lr)?(_r.buffer=mr.getBuffer(Lr),_r.size=_r.buffer.dimension|0,_r.normalized=!1,_r.type=_r.buffer.dtype,_r.offset=0,_r.stride=0,_r.divisor=0,_r.state=1):mr.getBuffer(Lr.buffer)?(_r.buffer=mr.getBuffer(Lr.buffer),_r.size=(+Lr.size||_r.buffer.dimension)|0,_r.normalized=!!Lr.normalized||!1,"type"in Lr?(Re.parameter(Lr.type,Wo,"invalid buffer type"),_r.type=Wo[Lr.type]):_r.type=_r.buffer.dtype,_r.offset=(Lr.offset||0)|0,_r.stride=(Lr.stride||0)|0,_r.divisor=(Lr.divisor||0)|0,_r.state=1,Re(_r.size>=1&&_r.size<=4,"size must be between 1 and 4"),Re(_r.offset>=0,"invalid offset"),Re(_r.stride>=0&&_r.stride<=255,"stride must be between 0 and 255"),Re(_r.divisor>=0,"divisor must be positive"),Re(!_r.divisor||!!we.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Lr?(Re(an>0,"first attribute must not be a constant"),_r.x=+Lr.x||0,_r.y=+Lr.y||0,_r.z=+Lr.z||0,_r.w=+Lr.w||0,_r.state=2):Re(!1,"invalid attribute spec for location "+an)}return cn.refresh(),Cr}return Cr.destroy=function(){cn.destroy()},Cr._vao=cn,Cr._reglType="vao",Cr(Br)}return jr}var _e=35632,be=35633,Te=35718,$e=35721;function Ve(W,we,Qe,Qt){var mr={},er={};function Zt(Bt,or,zr,pn){this.name=Bt,this.id=or,this.location=zr,this.info=pn}function Ur(Bt,or){for(var zr=0;zr<Bt.length;++zr)if(Bt[zr].id===or.id){Bt[zr].location=or.location;return}Bt.push(or)}function Or(Bt,or,zr){var pn=Bt===_e?mr:er,Tr=pn[or];if(!Tr){var gn=we.str(or);Tr=W.createShader(Bt),W.shaderSource(Tr,gn),W.compileShader(Tr),Re.shaderError(W,Tr,gn,Bt,zr),pn[or]=Tr}return Tr}var Qr={},jr=[],$r=0;function en(Bt,or){this.id=$r++,this.fragId=Bt,this.vertId=or,this.program=null,this.uniforms=[],this.attributes=[],Qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function kr(Bt,or,zr){var pn,Tr,gn=Or(_e,Bt.fragId),Br=Or(be,Bt.vertId),cn=Bt.program=W.createProgram();if(W.attachShader(cn,gn),W.attachShader(cn,Br),zr)for(pn=0;pn<zr.length;++pn){var Cr=zr[pn];W.bindAttribLocation(cn,Cr[0],Cr[1])}W.linkProgram(cn),Re.linkError(W,cn,we.str(Bt.fragId),we.str(Bt.vertId),or);var nn=W.getProgramParameter(cn,Te);Qt.profile&&(Bt.stats.uniformsCount=nn);var Wn=Bt.uniforms;for(pn=0;pn<nn;++pn)if(Tr=W.getActiveUniform(cn,pn),Tr)if(Tr.size>1)for(var hi=0;hi<Tr.size;++hi){var an=Tr.name.replace("[0]","["+hi+"]");Ur(Wn,new Zt(an,we.id(an),W.getUniformLocation(cn,an),Tr))}else Ur(Wn,new Zt(Tr.name,we.id(Tr.name),W.getUniformLocation(cn,Tr.name),Tr));var Lr=W.getProgramParameter(cn,$e);Qt.profile&&(Bt.stats.attributesCount=Lr);var _r=Bt.attributes;for(pn=0;pn<Lr;++pn)Tr=W.getActiveAttrib(cn,pn),Tr&&Ur(_r,new Zt(Tr.name,we.id(Tr.name),W.getAttribLocation(cn,Tr.name),Tr))}Qt.profile&&(Qe.getMaxUniformsCount=function(){var Bt=0;return jr.forEach(function(or){or.stats.uniformsCount>Bt&&(Bt=or.stats.uniformsCount)}),Bt},Qe.getMaxAttributesCount=function(){var Bt=0;return jr.forEach(function(or){or.stats.attributesCount>Bt&&(Bt=or.stats.attributesCount)}),Bt});function qr(){mr={},er={};for(var Bt=0;Bt<jr.length;++Bt)kr(jr[Bt],null,jr[Bt].attributes.map(function(or){return[or.location,or.name]}))}return{clear:function(){var Bt=W.deleteShader.bind(W);zi(mr).forEach(Bt),mr={},zi(er).forEach(Bt),er={},jr.forEach(function(or){W.deleteProgram(or.program)}),jr.length=0,Qr={},Qe.shaderCount=0},program:function(Bt,or,zr,pn){Re.command(Bt>=0,"missing vertex shader",zr),Re.command(or>=0,"missing fragment shader",zr);var Tr=Qr[or];Tr||(Tr=Qr[or]={});var gn=Tr[Bt];if(gn&&!pn)return gn;var Br=new en(or,Bt);return Qe.shaderCount++,kr(Br,zr,pn),gn||(Tr[Bt]=Br),jr.push(Br),Br},restore:qr,shader:Or,frag:-1,vert:-1}}var st=6408,Fe=5121,at=3333,bt=5126;function Nt(W,we,Qe,Qt,mr,er,Zt){function Ur(jr){var $r;we.next===null?(Re(mr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),$r=Fe):(Re(we.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),$r=we.next.colorAttachments[0].texture._texture.type,er.oes_texture_float?(Re($r===Fe||$r===bt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),$r===bt&&Re(Zt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Re($r===Fe,"Reading from a framebuffer is only allowed for the type 'uint8'"));var en=0,kr=0,qr=Qt.framebufferWidth,Bt=Qt.framebufferHeight,or=null;se(jr)?or=jr:jr&&(Re.type(jr,"object","invalid arguments to regl.read()"),en=jr.x|0,kr=jr.y|0,Re(en>=0&&en<Qt.framebufferWidth,"invalid x offset for regl.read"),Re(kr>=0&&kr<Qt.framebufferHeight,"invalid y offset for regl.read"),qr=(jr.width||Qt.framebufferWidth-en)|0,Bt=(jr.height||Qt.framebufferHeight-kr)|0,or=jr.data||null),or&&($r===Fe?Re(or instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):$r===bt&&Re(or instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Re(qr>0&&qr+en<=Qt.framebufferWidth,"invalid width for read pixels"),Re(Bt>0&&Bt+kr<=Qt.framebufferHeight,"invalid height for read pixels"),Qe();var zr=qr*Bt*4;return or||($r===Fe?or=new Uint8Array(zr):$r===bt&&(or=or||new Float32Array(zr))),Re.isTypedArray(or,"data buffer for regl.read() must be a typedarray"),Re(or.byteLength>=zr,"data buffer for regl.read() too small"),W.pixelStorei(at,4),W.readPixels(en,kr,qr,Bt,st,$r,or),or}function Or(jr){var $r;return we.setFBO({framebuffer:jr.framebuffer},function(){$r=Ur(jr)}),$r}function Qr(jr){return!jr||!("framebuffer"in jr)?Ur(jr):Or(jr)}return Qr}function nr(W){return Array.prototype.slice.call(W)}function qt(W){return nr(W).join("")}function fr(){var W=0,we=[],Qe=[];function Qt($r){for(var en=0;en<Qe.length;++en)if(Qe[en]===$r)return we[en];var kr="g"+W++;return we.push(kr),Qe.push($r),kr}function mr(){var $r=[];function en(){$r.push.apply($r,nr(arguments))}var kr=[];function qr(){var Bt="v"+W++;return kr.push(Bt),arguments.length>0&&($r.push(Bt,"="),$r.push.apply($r,nr(arguments)),$r.push(";")),Bt}return Z(en,{def:qr,toString:function(){return qt([kr.length>0?"var "+kr.join(",")+";":"",qt($r)])}})}function er(){var $r=mr(),en=mr(),kr=$r.toString,qr=en.toString;function Bt(or,zr){en(or,zr,"=",$r.def(or,zr),";")}return Z(function(){$r.apply($r,nr(arguments))},{def:$r.def,entry:$r,exit:en,save:Bt,set:function(or,zr,pn){Bt(or,zr),$r(or,zr,"=",pn,";")},toString:function(){return kr()+qr()}})}function Zt(){var $r=qt(arguments),en=er(),kr=er(),qr=en.toString,Bt=kr.toString;return Z(en,{then:function(){return en.apply(en,nr(arguments)),this},else:function(){return kr.apply(kr,nr(arguments)),this},toString:function(){var or=Bt();return or&&(or="else{"+or+"}"),qt(["if(",$r,"){",qr(),"}",or])}})}var Ur=mr(),Or={};function Qr($r,en){var kr=[];function qr(){var Tr="a"+kr.length;return kr.push(Tr),Tr}en=en||0;for(var Bt=0;Bt<en;++Bt)qr();var or=er(),zr=or.toString,pn=Or[$r]=Z(or,{arg:qr,toString:function(){return qt(["function(",kr.join(),"){",zr(),"}"])}});return pn}function jr(){var $r=['"use strict";',Ur,"return {"];Object.keys(Or).forEach(function(qr){$r.push('"',qr,'":',Or[qr].toString(),",")}),$r.push("}");var en=qt($r).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),kr=Function.apply(null,we.concat(en));return kr.apply(null,Qe)}return{global:Ur,link:Qt,block:mr,proc:Qr,scope:er,cond:Zt,compile:jr}}var Er="xyzw".split(""),Gr=5121,Zr=1,vn=2,zn=0,Hn=1,Fn=2,Bi=3,bn=4,ui="dither",bi="blend.enable",ti="blend.color",ii="blend.equation",gi="blend.func",Jn="depth.enable",ei="depth.func",uo="depth.range",qa="depth.mask",$o="colorMask",lo="cull.enable",Ta="cull.face",Ka="frontFace",Ss="lineWidth",ts="polygonOffset.enable",fl="polygonOffset.offset",As="sample.alpha",ou="sample.enable",ks="sample.coverage",Rc="stencil.enable",ql="stencil.mask",qs="stencil.func",hl="stencil.opFront",kl="stencil.opBack",bu="scissor.enable",pl="scissor.box",Lo="viewport",ka="profile",Ds="framebuffer",su="vert",Eu="frag",Li="elements",Yo="primitive",So="count",uu="offset",Mc="instances",ju="vao",nf="Width",Kl="Height",Ao=Ds+nf,Mr=Ds+Kl,Ql=Lo+nf,Pd=Lo+Kl,Ua="drawingBuffer",ao=Ua+nf,af=Ua+Kl,np=[gi,ii,qs,hl,kl,ks,Lo,pl,fl],Su=34962,jf=34963,Up=35632,d0=35633,ip=3553,zp=34067,of=2884,Zp=3042,Ic=3024,bh=2960,Zv=2929,Vv=3089,Od=32823,v0=32926,Vp=32928,ap=5126,jp=35664,Eh=35665,Pc=35666,Oc=5124,op=35667,ro=35668,sf=35669,Hp=35670,Jl=35671,dl=35672,kc=35673,Hf=35674,Wf=35675,ec=35676,Gf=35678,Dc=35680,sp=4,Dl=1028,uf=1029,Au=2304,Wp=2305,Gp=32775,Xp=32776,Tu=519,Lc=7680,Xf=0,kd=1,up=32774,Dd=513,Ll=36160,Ld=36064,Hu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Sh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Bc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},tc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Bl={frag:Up,vert:d0},Fc={cw:Au,ccw:Wp};function Ah(W){return Array.isArray(W)||se(W)||Fa(W)}function Th(W){return W.sort(function(we,Qe){return we===Lo?-1:Qe===Lo?1:we<Qe?-1:1})}function rs(W,we,Qe,Qt){this.thisDep=W,this.contextDep=we,this.propDep=Qe,this.append=Qt}function qo(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function To(W){return new rs(!1,!1,!1,W)}function lu(W,we){var Qe=W.type;if(Qe===zn){var Qt=W.data.length;return new rs(!0,Qt>=1,Qt>=2,we)}else if(Qe===bn){var mr=W.data;return new rs(mr.thisDep,mr.contextDep,mr.propDep,we)}else return new rs(Qe===Bi,Qe===Fn,Qe===Hn,we)}var Bd=new rs(!1,!1,!1,function(){});function $f(W,we,Qe,Qt,mr,er,Zt,Ur,Or,Qr,jr,$r,en,kr,qr){var Bt=Qr.Record,or={add:32774,subtract:32778,"reverse subtract":32779};Qe.ext_blend_minmax&&(or.min=Gp,or.max=Xp);var zr=Qe.angle_instanced_arrays,pn=Qe.webgl_draw_buffers,Tr={dirty:!0,profile:qr.profile},gn={},Br=[],cn={},Cr={};function nn(ve){return ve.replace(".","_")}function Wn(ve,Ie,Ke){var Xt=nn(ve);Br.push(ve),gn[Xt]=Tr[Xt]=!!Ke,cn[Xt]=Ie}function hi(ve,Ie,Ke){var Xt=nn(ve);Br.push(ve),Array.isArray(Ke)?(Tr[Xt]=Ke.slice(),gn[Xt]=Ke.slice()):Tr[Xt]=gn[Xt]=Ke,Cr[Xt]=Ie}Wn(ui,Ic),Wn(bi,Zp),hi(ti,"blendColor",[0,0,0,0]),hi(ii,"blendEquationSeparate",[up,up]),hi(gi,"blendFuncSeparate",[kd,Xf,kd,Xf]),Wn(Jn,Zv,!0),hi(ei,"depthFunc",Dd),hi(uo,"depthRange",[0,1]),hi(qa,"depthMask",!0),hi($o,$o,[!0,!0,!0,!0]),Wn(lo,of),hi(Ta,"cullFace",uf),hi(Ka,Ka,Wp),hi(Ss,Ss,1),Wn(ts,Od),hi(fl,"polygonOffset",[0,0]),Wn(As,v0),Wn(ou,Vp),hi(ks,"sampleCoverage",[1,!1]),Wn(Rc,bh),hi(ql,"stencilMask",-1),hi(qs,"stencilFunc",[Tu,0,-1]),hi(hl,"stencilOpSeparate",[Dl,Lc,Lc,Lc]),hi(kl,"stencilOpSeparate",[uf,Lc,Lc,Lc]),Wn(bu,Vv),hi(pl,"scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),hi(Lo,Lo,[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var an={gl:W,context:en,strings:we,next:gn,current:Tr,draw:$r,elements:er,buffer:mr,shader:jr,attributes:Qr.state,vao:Qr,uniforms:Or,framebuffer:Ur,extensions:Qe,timer:kr,isBufferArgs:Ah},Lr={primTypes:Du,compareFuncs:Bc,blendFuncs:Hu,blendEquations:or,stencilOps:tc,glTypes:Wo,orientationType:Fc};Re.optional(function(){an.isArrayLike=Na}),pn&&(Lr.backBuffer=[uf],Lr.drawBuffer=yt(Qt.maxDrawbuffers,function(ve){return ve===0?[0]:yt(ve,function(Ie){return Ld+Ie})}));var _r=0;function Xn(){var ve=fr(),Ie=ve.link,Ke=ve.global;ve.id=_r++,ve.batchId="0";var Xt=Ie(an),Vt=ve.shared={props:"a0"};Object.keys(an).forEach(function(ft){Vt[ft]=Ke.def(Xt,".",ft)}),Re.optional(function(){ve.CHECK=Ie(Re),ve.commandStr=Re.guessCommand(),ve.command=Ie(ve.commandStr),ve.assert=function(ft,Me,dt){ft("if(!(",Me,"))",this.CHECK,".commandRaise(",Ie(dt),",",this.command,");")},Lr.invalidBlendCombinations=Sh});var ut=ve.next={},mt=ve.current={};Object.keys(Cr).forEach(function(ft){Array.isArray(Tr[ft])&&(ut[ft]=Ke.def(Vt.next,".",ft),mt[ft]=Ke.def(Vt.current,".",ft))});var At=ve.constants={};Object.keys(Lr).forEach(function(ft){At[ft]=Ke.def(JSON.stringify(Lr[ft]))}),ve.invoke=function(ft,Me){switch(Me.type){case zn:var dt=["this",Vt.context,Vt.props,ve.batchId];return ft.def(Ie(Me.data),".call(",dt.slice(0,Math.max(Me.data.length+1,4)),")");case Hn:return ft.def(Vt.props,Me.data);case Fn:return ft.def(Vt.context,Me.data);case Bi:return ft.def("this",Me.data);case bn:return Me.data.append(ve,ft),Me.data.ref}},ve.attribCache={};var Xe={};return ve.scopeAttrib=function(ft){var Me=we.id(ft);if(Me in Xe)return Xe[Me];var dt=Qr.scope[Me];dt||(dt=Qr.scope[Me]=new Bt);var ir=Xe[Me]=Ie(dt);return ir},ve}function pr(ve){var Ie=ve.static,Ke=ve.dynamic,Xt;if(ka in Ie){var Vt=!!Ie[ka];Xt=To(function(mt,At){return Vt}),Xt.enable=Vt}else if(ka in Ke){var ut=Ke[ka];Xt=lu(ut,function(mt,At){return mt.invoke(At,ut)})}return Xt}function yn(ve,Ie){var Ke=ve.static,Xt=ve.dynamic;if(Ds in Ke){var Vt=Ke[Ds];return Vt?(Vt=Ur.getFramebuffer(Vt),Re.command(Vt,"invalid framebuffer object"),To(function(mt,At){var Xe=mt.link(Vt),ft=mt.shared;At.set(ft.framebuffer,".next",Xe);var Me=ft.context;return At.set(Me,"."+Ao,Xe+".width"),At.set(Me,"."+Mr,Xe+".height"),Xe})):To(function(mt,At){var Xe=mt.shared;At.set(Xe.framebuffer,".next","null");var ft=Xe.context;return At.set(ft,"."+Ao,ft+"."+ao),At.set(ft,"."+Mr,ft+"."+af),"null"})}else if(Ds in Xt){var ut=Xt[Ds];return lu(ut,function(mt,At){var Xe=mt.invoke(At,ut),ft=mt.shared,Me=ft.framebuffer,dt=At.def(Me,".getFramebuffer(",Xe,")");Re.optional(function(){mt.assert(At,"!"+Xe+"||"+dt,"invalid framebuffer object")}),At.set(Me,".next",dt);var ir=ft.context;return At.set(ir,"."+Ao,dt+"?"+dt+".width:"+ir+"."+ao),At.set(ir,"."+Mr,dt+"?"+dt+".height:"+ir+"."+af),dt})}else return null}function xt(ve,Ie,Ke){var Xt=ve.static,Vt=ve.dynamic;function ut(Xe){if(Xe in Xt){var ft=Xt[Xe];Re.commandType(ft,"object","invalid "+Xe,Ke.commandStr);var Me=!0,dt=ft.x|0,ir=ft.y|0,jt,wr;return"width"in ft?(jt=ft.width|0,Re.command(jt>=0,"invalid "+Xe,Ke.commandStr)):Me=!1,"height"in ft?(wr=ft.height|0,Re.command(wr>=0,"invalid "+Xe,Ke.commandStr)):Me=!1,new rs(!Me&&Ie&&Ie.thisDep,!Me&&Ie&&Ie.contextDep,!Me&&Ie&&Ie.propDep,function(Dn,Tn){var Mn=Dn.shared.context,Qn=jt;"width"in ft||(Qn=Tn.def(Mn,".",Ao,"-",dt));var ai=wr;return"height"in ft||(ai=Tn.def(Mn,".",Mr,"-",ir)),[dt,ir,Qn,ai]})}else if(Xe in Vt){var Sr=Vt[Xe],Dr=lu(Sr,function(Dn,Tn){var Mn=Dn.invoke(Tn,Sr);Re.optional(function(){Dn.assert(Tn,Mn+"&&typeof "+Mn+'==="object"',"invalid "+Xe)});var Qn=Dn.shared.context,ai=Tn.def(Mn,".x|0"),ea=Tn.def(Mn,".y|0"),Ro=Tn.def('"width" in ',Mn,"?",Mn,".width|0:","(",Qn,".",Ao,"-",ai,")"),Ko=Tn.def('"height" in ',Mn,"?",Mn,".height|0:","(",Qn,".",Mr,"-",ea,")");return Re.optional(function(){Dn.assert(Tn,Ro+">=0&&"+Ko+">=0","invalid "+Xe)}),[ai,ea,Ro,Ko]});return Ie&&(Dr.thisDep=Dr.thisDep||Ie.thisDep,Dr.contextDep=Dr.contextDep||Ie.contextDep,Dr.propDep=Dr.propDep||Ie.propDep),Dr}else return Ie?new rs(Ie.thisDep,Ie.contextDep,Ie.propDep,function(Dn,Tn){var Mn=Dn.shared.context;return[0,0,Tn.def(Mn,".",Ao),Tn.def(Mn,".",Mr)]}):null}var mt=ut(Lo);if(mt){var At=mt;mt=new rs(mt.thisDep,mt.contextDep,mt.propDep,function(Xe,ft){var Me=At.append(Xe,ft),dt=Xe.shared.context;return ft.set(dt,"."+Ql,Me[2]),ft.set(dt,"."+Pd,Me[3]),Me})}return{viewport:mt,scissor_box:ut(pl)}}function ci(ve,Ie){var Ke=ve.static,Xt=typeof Ke[Eu]=="string"&&typeof Ke[su]=="string";if(Xt){if(Object.keys(Ie.dynamic).length>0)return null;var Vt=Ie.static,ut=Object.keys(Vt);if(ut.length>0&&typeof Vt[ut[0]]=="number"){for(var mt=[],At=0;At<ut.length;++At)Re(typeof Vt[ut[At]]=="number","must specify all vertex attribute locations when using vaos"),mt.push([Vt[ut[At]]|0,ut[At]]);return mt}}return null}function ri(ve,Ie,Ke){var Xt=ve.static,Vt=ve.dynamic;function ut(Me){if(Me in Xt){var dt=we.id(Xt[Me]);Re.optional(function(){jr.shader(Bl[Me],dt,Re.guessCommand())});var ir=To(function(){return dt});return ir.id=dt,ir}else if(Me in Vt){var jt=Vt[Me];return lu(jt,function(wr,Sr){var Dr=wr.invoke(Sr,jt),Dn=Sr.def(wr.shared.strings,".id(",Dr,")");return Re.optional(function(){Sr(wr.shared.shader,".shader(",Bl[Me],",",Dn,",",wr.command,");")}),Dn})}return null}var mt=ut(Eu),At=ut(su),Xe=null,ft;return qo(mt)&&qo(At)?(Xe=jr.program(At.id,mt.id,null,Ke),ft=To(function(Me,dt){return Me.link(Xe)})):ft=new rs(mt&&mt.thisDep||At&&At.thisDep,mt&&mt.contextDep||At&&At.contextDep,mt&&mt.propDep||At&&At.propDep,function(Me,dt){var ir=Me.shared.shader,jt;mt?jt=mt.append(Me,dt):jt=dt.def(ir,".",Eu);var wr;At?wr=At.append(Me,dt):wr=dt.def(ir,".",su);var Sr=ir+".program("+wr+","+jt;return Re.optional(function(){Sr+=","+Me.command}),dt.def(Sr+")")}),{frag:mt,vert:At,progVar:ft,program:Xe}}function Gi(ve,Ie){var Ke=ve.static,Xt=ve.dynamic;function Vt(){if(Li in Ke){var Me=Ke[Li];Ah(Me)?Me=er.getElements(er.create(Me,!0)):Me&&(Me=er.getElements(Me),Re.command(Me,"invalid elements",Ie.commandStr));var dt=To(function(jt,wr){if(Me){var Sr=jt.link(Me);return jt.ELEMENTS=Sr,Sr}return jt.ELEMENTS=null,null});return dt.value=Me,dt}else if(Li in Xt){var ir=Xt[Li];return lu(ir,function(jt,wr){var Sr=jt.shared,Dr=Sr.isBufferArgs,Dn=Sr.elements,Tn=jt.invoke(wr,ir),Mn=wr.def("null"),Qn=wr.def(Dr,"(",Tn,")"),ai=jt.cond(Qn).then(Mn,"=",Dn,".createStream(",Tn,");").else(Mn,"=",Dn,".getElements(",Tn,");");return Re.optional(function(){jt.assert(ai.else,"!"+Tn+"||"+Mn,"invalid elements")}),wr.entry(ai),wr.exit(jt.cond(Qn).then(Dn,".destroyStream(",Mn,");")),jt.ELEMENTS=Mn,Mn})}return null}var ut=Vt();function mt(){if(Yo in Ke){var Me=Ke[Yo];return Re.commandParameter(Me,Du,"invalid primitve",Ie.commandStr),To(function(ir,jt){return Du[Me]})}else if(Yo in Xt){var dt=Xt[Yo];return lu(dt,function(ir,jt){var wr=ir.constants.primTypes,Sr=ir.invoke(jt,dt);return Re.optional(function(){ir.assert(jt,Sr+" in "+wr,"invalid primitive, must be one of "+Object.keys(Du))}),jt.def(wr,"[",Sr,"]")})}else if(ut)return qo(ut)?ut.value?To(function(ir,jt){return jt.def(ir.ELEMENTS,".primType")}):To(function(){return sp}):new rs(ut.thisDep,ut.contextDep,ut.propDep,function(ir,jt){var wr=ir.ELEMENTS;return jt.def(wr,"?",wr,".primType:",sp)});return null}function At(Me,dt){if(Me in Ke){var ir=Ke[Me]|0;return Re.command(!dt||ir>=0,"invalid "+Me,Ie.commandStr),To(function(wr,Sr){return dt&&(wr.OFFSET=ir),ir})}else if(Me in Xt){var jt=Xt[Me];return lu(jt,function(wr,Sr){var Dr=wr.invoke(Sr,jt);return dt&&(wr.OFFSET=Dr,Re.optional(function(){wr.assert(Sr,Dr+">=0","invalid "+Me)})),Dr})}else if(dt&&ut)return To(function(wr,Sr){return wr.OFFSET="0",0});return null}var Xe=At(uu,!0);function ft(){if(So in Ke){var Me=Ke[So]|0;return Re.command(typeof Me=="number"&&Me>=0,"invalid vertex count",Ie.commandStr),To(function(){return Me})}else if(So in Xt){var dt=Xt[So];return lu(dt,function(wr,Sr){var Dr=wr.invoke(Sr,dt);return Re.optional(function(){wr.assert(Sr,"typeof "+Dr+'==="number"&&'+Dr+">=0&&"+Dr+"===("+Dr+"|0)","invalid vertex count")}),Dr})}else if(ut)if(qo(ut)){if(ut)return Xe?new rs(Xe.thisDep,Xe.contextDep,Xe.propDep,function(wr,Sr){var Dr=Sr.def(wr.ELEMENTS,".vertCount-",wr.OFFSET);return Re.optional(function(){wr.assert(Sr,Dr+">=0","invalid vertex offset/element buffer too small")}),Dr}):To(function(wr,Sr){return Sr.def(wr.ELEMENTS,".vertCount")});var ir=To(function(){return-1});return Re.optional(function(){ir.MISSING=!0}),ir}else{var jt=new rs(ut.thisDep||Xe.thisDep,ut.contextDep||Xe.contextDep,ut.propDep||Xe.propDep,function(wr,Sr){var Dr=wr.ELEMENTS;return wr.OFFSET?Sr.def(Dr,"?",Dr,".vertCount-",wr.OFFSET,":-1"):Sr.def(Dr,"?",Dr,".vertCount:-1")});return Re.optional(function(){jt.DYNAMIC=!0}),jt}return null}return{elements:ut,primitive:mt(),count:ft(),instances:At(Mc,!1),offset:Xe}}function co(ve,Ie){var Ke=ve.static,Xt=ve.dynamic,Vt={};return Br.forEach(function(ut){var mt=nn(ut);function At(Xe,ft){if(ut in Ke){var Me=Xe(Ke[ut]);Vt[mt]=To(function(){return Me})}else if(ut in Xt){var dt=Xt[ut];Vt[mt]=lu(dt,function(ir,jt){return ft(ir,jt,ir.invoke(jt,dt))})}}switch(ut){case lo:case bi:case ui:case Rc:case Jn:case bu:case ts:case As:case ou:case qa:return At(function(Xe){return Re.commandType(Xe,"boolean",ut,Ie.commandStr),Xe},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,"typeof "+Me+'==="boolean"',"invalid flag "+ut,Xe.commandStr)}),Me});case ei:return At(function(Xe){return Re.commandParameter(Xe,Bc,"invalid "+ut,Ie.commandStr),Bc[Xe]},function(Xe,ft,Me){var dt=Xe.constants.compareFuncs;return Re.optional(function(){Xe.assert(ft,Me+" in "+dt,"invalid "+ut+", must be one of "+Object.keys(Bc))}),ft.def(dt,"[",Me,"]")});case uo:return At(function(Xe){return Re.command(Na(Xe)&&Xe.length===2&&typeof Xe[0]=="number"&&typeof Xe[1]=="number"&&Xe[0]<=Xe[1],"depth range is 2d array",Ie.commandStr),Xe},function(Xe,ft,Me){Re.optional(function(){Xe.assert(ft,Xe.shared.isArrayLike+"("+Me+")&&"+Me+".length===2&&typeof "+Me+'[0]==="number"&&typeof '+Me+'[1]==="number"&&'+Me+"[0]<="+Me+"[1]","depth range must be a 2d array")});var dt=ft.def("+",Me,"[0]"),ir=ft.def("+",Me,"[1]");return[dt,ir]});case gi:return At(function(Xe){Re.commandType(Xe,"object","blend.func",Ie.commandStr);var ft="srcRGB"in Xe?Xe.srcRGB:Xe.src,Me="srcAlpha"in Xe?Xe.srcAlpha:Xe.src,dt="dstRGB"in Xe?Xe.dstRGB:Xe.dst,ir="dstAlpha"in Xe?Xe.dstAlpha:Xe.dst;return Re.commandParameter(ft,Hu,mt+".srcRGB",Ie.commandStr),Re.commandParameter(Me,Hu,mt+".srcAlpha",Ie.commandStr),Re.commandParameter(dt,Hu,mt+".dstRGB",Ie.commandStr),Re.commandParameter(ir,Hu,mt+".dstAlpha",Ie.commandStr),Re.command(Sh.indexOf(ft+", "+dt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ft+", "+dt+")",Ie.commandStr),[Hu[ft],Hu[dt],Hu[Me],Hu[ir]]},function(Xe,ft,Me){var dt=Xe.constants.blendFuncs;Re.optional(function(){Xe.assert(ft,Me+"&&typeof "+Me+'==="object"',"invalid blend func, must be an object")});function ir(Mn,Qn){var ai=ft.def('"',Mn,Qn,'" in ',Me,"?",Me,".",Mn,Qn,":",Me,".",Mn);return Re.optional(function(){Xe.assert(ft,ai+" in "+dt,"invalid "+ut+"."+Mn+Qn+", must be one of "+Object.keys(Hu))}),ai}var jt=ir("src","RGB"),wr=ir("dst","RGB");Re.optional(function(){var Mn=Xe.constants.invalidBlendCombinations;Xe.assert(ft,Mn+".indexOf("+jt+'+", "+'+wr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Sr=ft.def(dt,"[",jt,"]"),Dr=ft.def(dt,"[",ir("src","Alpha"),"]"),Dn=ft.def(dt,"[",wr,"]"),Tn=ft.def(dt,"[",ir("dst","Alpha"),"]");return[Sr,Dn,Dr,Tn]});case ii:return At(function(Xe){if(typeof Xe=="string")return Re.commandParameter(Xe,or,"invalid "+ut,Ie.commandStr),[or[Xe],or[Xe]];if(typeof Xe=="object")return Re.commandParameter(Xe.rgb,or,ut+".rgb",Ie.commandStr),Re.commandParameter(Xe.alpha,or,ut+".alpha",Ie.commandStr),[or[Xe.rgb],or[Xe.alpha]];Re.commandRaise("invalid blend.equation",Ie.commandStr)},function(Xe,ft,Me){var dt=Xe.constants.blendEquations,ir=ft.def(),jt=ft.def(),wr=Xe.cond("typeof ",Me,'==="string"');return Re.optional(function(){function Sr(Dr,Dn,Tn){Xe.assert(Dr,Tn+" in "+dt,"invalid "+Dn+", must be one of "+Object.keys(or))}Sr(wr.then,ut,Me),Xe.assert(wr.else,Me+"&&typeof "+Me+'==="object"',"invalid "+ut),Sr(wr.else,ut+".rgb",Me+".rgb"),Sr(wr.else,ut+".alpha",Me+".alpha")}),wr.then(ir,"=",jt,"=",dt,"[",Me,"];"),wr.else(ir,"=",dt,"[",Me,".rgb];",jt,"=",dt,"[",Me,".alpha];"),ft(wr),[ir,jt]});case ti:return At(function(Xe){return Re.command(Na(Xe)&&Xe.length===4,"blend.color must be a 4d array",Ie.commandStr),yt(4,function(ft){return+Xe[ft]})},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,Xe.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","blend.color must be a 4d array")}),yt(4,function(dt){return ft.def("+",Me,"[",dt,"]")})});case ql:return At(function(Xe){return Re.commandType(Xe,"number",mt,Ie.commandStr),Xe|0},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,"typeof "+Me+'==="number"',"invalid stencil.mask")}),ft.def(Me,"|0")});case qs:return At(function(Xe){Re.commandType(Xe,"object",mt,Ie.commandStr);var ft=Xe.cmp||"keep",Me=Xe.ref||0,dt="mask"in Xe?Xe.mask:-1;return Re.commandParameter(ft,Bc,ut+".cmp",Ie.commandStr),Re.commandType(Me,"number",ut+".ref",Ie.commandStr),Re.commandType(dt,"number",ut+".mask",Ie.commandStr),[Bc[ft],Me,dt]},function(Xe,ft,Me){var dt=Xe.constants.compareFuncs;Re.optional(function(){function Sr(){Xe.assert(ft,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Sr(Me+"&&typeof ",Me,'==="object"'),Sr('!("cmp" in ',Me,")||(",Me,".cmp in ",dt,")")});var ir=ft.def('"cmp" in ',Me,"?",dt,"[",Me,".cmp]",":",Lc),jt=ft.def(Me,".ref|0"),wr=ft.def('"mask" in ',Me,"?",Me,".mask|0:-1");return[ir,jt,wr]});case hl:case kl:return At(function(Xe){Re.commandType(Xe,"object",mt,Ie.commandStr);var ft=Xe.fail||"keep",Me=Xe.zfail||"keep",dt=Xe.zpass||"keep";return Re.commandParameter(ft,tc,ut+".fail",Ie.commandStr),Re.commandParameter(Me,tc,ut+".zfail",Ie.commandStr),Re.commandParameter(dt,tc,ut+".zpass",Ie.commandStr),[ut===kl?uf:Dl,tc[ft],tc[Me],tc[dt]]},function(Xe,ft,Me){var dt=Xe.constants.stencilOps;Re.optional(function(){Xe.assert(ft,Me+"&&typeof "+Me+'==="object"',"invalid "+ut)});function ir(jt){return Re.optional(function(){Xe.assert(ft,'!("'+jt+'" in '+Me+")||("+Me+"."+jt+" in "+dt+")","invalid "+ut+"."+jt+", must be one of "+Object.keys(tc))}),ft.def('"',jt,'" in ',Me,"?",dt,"[",Me,".",jt,"]:",Lc)}return[ut===kl?uf:Dl,ir("fail"),ir("zfail"),ir("zpass")]});case fl:return At(function(Xe){Re.commandType(Xe,"object",mt,Ie.commandStr);var ft=Xe.factor|0,Me=Xe.units|0;return Re.commandType(ft,"number",mt+".factor",Ie.commandStr),Re.commandType(Me,"number",mt+".units",Ie.commandStr),[ft,Me]},function(Xe,ft,Me){Re.optional(function(){Xe.assert(ft,Me+"&&typeof "+Me+'==="object"',"invalid "+ut)});var dt=ft.def(Me,".factor|0"),ir=ft.def(Me,".units|0");return[dt,ir]});case Ta:return At(function(Xe){var ft=0;return Xe==="front"?ft=Dl:Xe==="back"&&(ft=uf),Re.command(!!ft,mt,Ie.commandStr),ft},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,Me+'==="front"||'+Me+'==="back"',"invalid cull.face")}),ft.def(Me,'==="front"?',Dl,":",uf)});case Ss:return At(function(Xe){return Re.command(typeof Xe=="number"&&Xe>=Qt.lineWidthDims[0]&&Xe<=Qt.lineWidthDims[1],"invalid line width, must be a positive number between "+Qt.lineWidthDims[0]+" and "+Qt.lineWidthDims[1],Ie.commandStr),Xe},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,"typeof "+Me+'==="number"&&'+Me+">="+Qt.lineWidthDims[0]+"&&"+Me+"<="+Qt.lineWidthDims[1],"invalid line width")}),Me});case Ka:return At(function(Xe){return Re.commandParameter(Xe,Fc,mt,Ie.commandStr),Fc[Xe]},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,Me+'==="cw"||'+Me+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ft.def(Me+'==="cw"?'+Au+":"+Wp)});case $o:return At(function(Xe){return Re.command(Na(Xe)&&Xe.length===4,"color.mask must be length 4 array",Ie.commandStr),Xe.map(function(ft){return!!ft})},function(Xe,ft,Me){return Re.optional(function(){Xe.assert(ft,Xe.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","invalid color.mask")}),yt(4,function(dt){return"!!"+Me+"["+dt+"]"})});case ks:return At(function(Xe){Re.command(typeof Xe=="object"&&Xe,mt,Ie.commandStr);var ft="value"in Xe?Xe.value:1,Me=!!Xe.invert;return Re.command(typeof ft=="number"&&ft>=0&&ft<=1,"sample.coverage.value must be a number between 0 and 1",Ie.commandStr),[ft,Me]},function(Xe,ft,Me){Re.optional(function(){Xe.assert(ft,Me+"&&typeof "+Me+'==="object"',"invalid sample.coverage")});var dt=ft.def('"value" in ',Me,"?+",Me,".value:1"),ir=ft.def("!!",Me,".invert");return[dt,ir]})}}),Vt}function Bo(ve,Ie){var Ke=ve.static,Xt=ve.dynamic,Vt={};return Object.keys(Ke).forEach(function(ut){var mt=Ke[ut],At;if(typeof mt=="number"||typeof mt=="boolean")At=To(function(){return mt});else if(typeof mt=="function"){var Xe=mt._reglType;Xe==="texture2d"||Xe==="textureCube"?At=To(function(ft){return ft.link(mt)}):Xe==="framebuffer"||Xe==="framebufferCube"?(Re.command(mt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ut+'"',Ie.commandStr),At=To(function(ft){return ft.link(mt.color[0])})):Re.commandRaise('invalid data for uniform "'+ut+'"',Ie.commandStr)}else Na(mt)?At=To(function(ft){var Me=ft.global.def("[",yt(mt.length,function(dt){return Re.command(typeof mt[dt]=="number"||typeof mt[dt]=="boolean","invalid uniform "+ut,ft.commandStr),mt[dt]}),"]");return Me}):Re.commandRaise('invalid or missing data for uniform "'+ut+'"',Ie.commandStr);At.value=mt,Vt[ut]=At}),Object.keys(Xt).forEach(function(ut){var mt=Xt[ut];Vt[ut]=lu(mt,function(At,Xe){return At.invoke(Xe,mt)})}),Vt}function Ai(ve,Ie){var Ke=ve.static,Xt=ve.dynamic,Vt={};return Object.keys(Ke).forEach(function(ut){var mt=Ke[ut],At=we.id(ut),Xe=new Bt;if(Ah(mt))Xe.state=Zr,Xe.buffer=mr.getBuffer(mr.create(mt,Su,!1,!0)),Xe.type=0;else{var ft=mr.getBuffer(mt);if(ft)Xe.state=Zr,Xe.buffer=ft,Xe.type=0;else if(Re.command(typeof mt=="object"&&mt,"invalid data for attribute "+ut,Ie.commandStr),"constant"in mt){var Me=mt.constant;Xe.buffer="null",Xe.state=vn,typeof Me=="number"?Xe.x=Me:(Re.command(Na(Me)&&Me.length>0&&Me.length<=4,"invalid constant for attribute "+ut,Ie.commandStr),Er.forEach(function(Dn,Tn){Tn<Me.length&&(Xe[Dn]=Me[Tn])}))}else{Ah(mt.buffer)?ft=mr.getBuffer(mr.create(mt.buffer,Su,!1,!0)):ft=mr.getBuffer(mt.buffer),Re.command(!!ft,'missing buffer for attribute "'+ut+'"',Ie.commandStr);var dt=mt.offset|0;Re.command(dt>=0,'invalid offset for attribute "'+ut+'"',Ie.commandStr);var ir=mt.stride|0;Re.command(ir>=0&&ir<256,'invalid stride for attribute "'+ut+'", must be integer betweeen [0, 255]',Ie.commandStr);var jt=mt.size|0;Re.command(!("size"in mt)||jt>0&&jt<=4,'invalid size for attribute "'+ut+'", must be 1,2,3,4',Ie.commandStr);var wr=!!mt.normalized,Sr=0;"type"in mt&&(Re.commandParameter(mt.type,Wo,"invalid type for attribute "+ut,Ie.commandStr),Sr=Wo[mt.type]);var Dr=mt.divisor|0;"divisor"in mt&&(Re.command(Dr===0||zr,'cannot specify divisor for attribute "'+ut+'", instancing not supported',Ie.commandStr),Re.command(Dr>=0,'invalid divisor for attribute "'+ut+'"',Ie.commandStr)),Re.optional(function(){var Dn=Ie.commandStr,Tn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(mt).forEach(function(Mn){Re.command(Tn.indexOf(Mn)>=0,'unknown parameter "'+Mn+'" for attribute pointer "'+ut+'" (valid parameters are '+Tn+")",Dn)})}),Xe.buffer=ft,Xe.state=Zr,Xe.size=jt,Xe.normalized=wr,Xe.type=Sr||ft.dtype,Xe.offset=dt,Xe.stride=ir,Xe.divisor=Dr}}Vt[ut]=To(function(Dn,Tn){var Mn=Dn.attribCache;if(At in Mn)return Mn[At];var Qn={isStream:!1};return Object.keys(Xe).forEach(function(ai){Qn[ai]=Xe[ai]}),Xe.buffer&&(Qn.buffer=Dn.link(Xe.buffer),Qn.type=Qn.type||Qn.buffer+".dtype"),Mn[At]=Qn,Qn})}),Object.keys(Xt).forEach(function(ut){var mt=Xt[ut];function At(Xe,ft){var Me=Xe.invoke(ft,mt),dt=Xe.shared,ir=Xe.constants,jt=dt.isBufferArgs,wr=dt.buffer;Re.optional(function(){Xe.assert(ft,Me+"&&(typeof "+Me+'==="object"||typeof '+Me+'==="function")&&('+jt+"("+Me+")||"+wr+".getBuffer("+Me+")||"+wr+".getBuffer("+Me+".buffer)||"+jt+"("+Me+'.buffer)||("constant" in '+Me+"&&(typeof "+Me+'.constant==="number"||'+dt.isArrayLike+"("+Me+".constant))))",'invalid dynamic attribute "'+ut+'"')});var Sr={isStream:ft.def(!1)},Dr=new Bt;Dr.state=Zr,Object.keys(Dr).forEach(function(Qn){Sr[Qn]=ft.def(""+Dr[Qn])});var Dn=Sr.buffer,Tn=Sr.type;ft("if(",jt,"(",Me,")){",Sr.isStream,"=true;",Dn,"=",wr,".createStream(",Su,",",Me,");",Tn,"=",Dn,".dtype;","}else{",Dn,"=",wr,".getBuffer(",Me,");","if(",Dn,"){",Tn,"=",Dn,".dtype;",'}else if("constant" in ',Me,"){",Sr.state,"=",vn,";","if(typeof "+Me+'.constant === "number"){',Sr[Er[0]],"=",Me,".constant;",Er.slice(1).map(function(Qn){return Sr[Qn]}).join("="),"=0;","}else{",Er.map(function(Qn,ai){return Sr[Qn]+"="+Me+".constant.length>"+ai+"?"+Me+".constant["+ai+"]:0;"}).join(""),"}}else{","if(",jt,"(",Me,".buffer)){",Dn,"=",wr,".createStream(",Su,",",Me,".buffer);","}else{",Dn,"=",wr,".getBuffer(",Me,".buffer);","}",Tn,'="type" in ',Me,"?",ir.glTypes,"[",Me,".type]:",Dn,".dtype;",Sr.normalized,"=!!",Me,".normalized;");function Mn(Qn){ft(Sr[Qn],"=",Me,".",Qn,"|0;")}return Mn("size"),Mn("offset"),Mn("stride"),Mn("divisor"),ft("}}"),ft.exit("if(",Sr.isStream,"){",wr,".destroyStream(",Dn,");","}"),Sr}Vt[ut]=lu(mt,At)}),Vt}function fo(ve,Ie){var Ke=ve.static,Xt=ve.dynamic;if(ju in Ke){var Vt=Ke[ju];return Vt!==null&&Qr.getVAO(Vt)===null&&(Vt=Qr.createVAO(Vt)),To(function(mt){return mt.link(Qr.getVAO(Vt))})}else if(ju in Xt){var ut=Xt[ju];return lu(ut,function(mt,At){var Xe=mt.invoke(At,ut);return At.def(mt.shared.vao+".getVAO("+Xe+")")})}return null}function Ea(ve){var Ie=ve.static,Ke=ve.dynamic,Xt={};return Object.keys(Ie).forEach(function(Vt){var ut=Ie[Vt];Xt[Vt]=To(function(mt,At){return typeof ut=="number"||typeof ut=="boolean"?""+ut:mt.link(ut)})}),Object.keys(Ke).forEach(function(Vt){var ut=Ke[Vt];Xt[Vt]=lu(ut,function(mt,At){return mt.invoke(At,ut)})}),Xt}function ho(ve,Ie,Ke,Xt,Vt){var ut=ve.static,mt=ve.dynamic;Re.optional(function(){var Mn=[Ds,su,Eu,Li,Yo,uu,So,Mc,ka,ju].concat(Br);function Qn(ai){Object.keys(ai).forEach(function(ea){Re.command(Mn.indexOf(ea)>=0,'unknown parameter "'+ea+'"',Vt.commandStr)})}Qn(ut),Qn(mt)});var At=ci(ve,Ie),Xe=yn(ve,Vt),ft=xt(ve,Xe,Vt),Me=Gi(ve,Vt),dt=co(ve,Vt),ir=ri(ve,Vt,At);function jt(Mn){var Qn=ft[Mn];Qn&&(dt[Mn]=Qn)}jt(Lo),jt(nn(pl));var wr=Object.keys(dt).length>0,Sr={framebuffer:Xe,draw:Me,shader:ir,state:dt,dirty:wr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Sr.profile=pr(ve,Vt),Sr.uniforms=Bo(Ke,Vt),Sr.drawVAO=Sr.scopeVAO=fo(ve,Vt),!Sr.drawVAO&&ir.program&&!At&&Qe.angle_instanced_arrays){var Dr=!0,Dn=ir.program.attributes.map(function(Mn){var Qn=Ie.static[Mn];return Dr=Dr&&!!Qn,Qn});if(Dr&&Dn.length>0){var Tn=Qr.getVAO(Qr.createVAO(Dn));Sr.drawVAO=new rs(null,null,null,function(Mn,Qn){return Mn.link(Tn)}),Sr.useVAO=!0}}return At?Sr.useVAO=!0:Sr.attributes=Ai(Ie,Vt),Sr.context=Ea(Xt,Vt),Sr}function po(ve,Ie,Ke){var Xt=ve.shared,Vt=Xt.context,ut=ve.scope();Object.keys(Ke).forEach(function(mt){Ie.save(Vt,"."+mt);var At=Ke[mt];ut(Vt,".",mt,"=",At.append(ve,Ie),";")}),Ie(ut)}function za(ve,Ie,Ke,Xt){var Vt=ve.shared,ut=Vt.gl,mt=Vt.framebuffer,At;pn&&(At=Ie.def(Vt.extensions,".webgl_draw_buffers"));var Xe=ve.constants,ft=Xe.drawBuffer,Me=Xe.backBuffer,dt;Ke?dt=Ke.append(ve,Ie):dt=Ie.def(mt,".next"),Xt||Ie("if(",dt,"!==",mt,".cur){"),Ie("if(",dt,"){",ut,".bindFramebuffer(",Ll,",",dt,".framebuffer);"),pn&&Ie(At,".drawBuffersWEBGL(",ft,"[",dt,".colorAttachments.length]);"),Ie("}else{",ut,".bindFramebuffer(",Ll,",null);"),pn&&Ie(At,".drawBuffersWEBGL(",Me,");"),Ie("}",mt,".cur=",dt,";"),Xt||Ie("}")}function wo(ve,Ie,Ke){var Xt=ve.shared,Vt=Xt.gl,ut=ve.current,mt=ve.next,At=Xt.current,Xe=Xt.next,ft=ve.cond(At,".dirty");Br.forEach(function(Me){var dt=nn(Me);if(!(dt in Ke.state)){var ir,jt;if(dt in mt){ir=mt[dt],jt=ut[dt];var wr=yt(Tr[dt].length,function(Dr){return ft.def(ir,"[",Dr,"]")});ft(ve.cond(wr.map(function(Dr,Dn){return Dr+"!=="+jt+"["+Dn+"]"}).join("||")).then(Vt,".",Cr[dt],"(",wr,");",wr.map(function(Dr,Dn){return jt+"["+Dn+"]="+Dr}).join(";"),";"))}else{ir=ft.def(Xe,".",dt);var Sr=ve.cond(ir,"!==",At,".",dt);ft(Sr),dt in cn?Sr(ve.cond(ir).then(Vt,".enable(",cn[dt],");").else(Vt,".disable(",cn[dt],");"),At,".",dt,"=",ir,";"):Sr(Vt,".",Cr[dt],"(",ir,");",At,".",dt,"=",ir,";")}}}),Object.keys(Ke.state).length===0&&ft(At,".dirty=false;"),Ie(ft)}function ns(ve,Ie,Ke,Xt){var Vt=ve.shared,ut=ve.current,mt=Vt.current,At=Vt.gl;Th(Object.keys(Ke)).forEach(function(Xe){var ft=Ke[Xe];if(!(Xt&&!Xt(ft))){var Me=ft.append(ve,Ie);if(cn[Xe]){var dt=cn[Xe];qo(ft)?Me?Ie(At,".enable(",dt,");"):Ie(At,".disable(",dt,");"):Ie(ve.cond(Me).then(At,".enable(",dt,");").else(At,".disable(",dt,");")),Ie(mt,".",Xe,"=",Me,";")}else if(Na(Me)){var ir=ut[Xe];Ie(At,".",Cr[Xe],"(",Me,");",Me.map(function(jt,wr){return ir+"["+wr+"]="+jt}).join(";"),";")}else Ie(At,".",Cr[Xe],"(",Me,");",mt,".",Xe,"=",Me,";")}})}function Co(ve,Ie){zr&&(ve.instancing=Ie.def(ve.shared.extensions,".angle_instanced_arrays"))}function Ei(ve,Ie,Ke,Xt,Vt){var ut=ve.shared,mt=ve.stats,At=ut.current,Xe=ut.timer,ft=Ke.profile;function Me(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var dt,ir;function jt(Mn){dt=Ie.def(),Mn(dt,"=",Me(),";"),typeof Vt=="string"?Mn(mt,".count+=",Vt,";"):Mn(mt,".count++;"),kr&&(Xt?(ir=Ie.def(),Mn(ir,"=",Xe,".getNumPendingQueries();")):Mn(Xe,".beginQuery(",mt,");"))}function wr(Mn){Mn(mt,".cpuTime+=",Me(),"-",dt,";"),kr&&(Xt?Mn(Xe,".pushScopeStats(",ir,",",Xe,".getNumPendingQueries(),",mt,");"):Mn(Xe,".endQuery();"))}function Sr(Mn){var Qn=Ie.def(At,".profile");Ie(At,".profile=",Mn,";"),Ie.exit(At,".profile=",Qn,";")}var Dr;if(ft){if(qo(ft)){ft.enable?(jt(Ie),wr(Ie.exit),Sr("true")):Sr("false");return}Dr=ft.append(ve,Ie),Sr(Dr)}else Dr=Ie.def(At,".profile");var Dn=ve.block();jt(Dn),Ie("if(",Dr,"){",Dn,"}");var Tn=ve.block();wr(Tn),Ie.exit("if(",Dr,"){",Tn,"}")}function is(ve,Ie,Ke,Xt,Vt){var ut=ve.shared;function mt(Xe){switch(Xe){case jp:case op:case Jl:return 2;case Eh:case ro:case dl:return 3;case Pc:case sf:case kc:return 4;default:return 1}}function At(Xe,ft,Me){var dt=ut.gl,ir=Ie.def(Xe,".location"),jt=Ie.def(ut.attributes,"[",ir,"]"),wr=Me.state,Sr=Me.buffer,Dr=[Me.x,Me.y,Me.z,Me.w],Dn=["buffer","normalized","offset","stride"];function Tn(){Ie("if(!",jt,".buffer){",dt,".enableVertexAttribArray(",ir,");}");var Qn=Me.type,ai;if(Me.size?ai=Ie.def(Me.size,"||",ft):ai=ft,Ie("if(",jt,".type!==",Qn,"||",jt,".size!==",ai,"||",Dn.map(function(Ro){return jt+"."+Ro+"!=="+Me[Ro]}).join("||"),"){",dt,".bindBuffer(",Su,",",Sr,".buffer);",dt,".vertexAttribPointer(",[ir,ai,Qn,Me.normalized,Me.stride,Me.offset],");",jt,".type=",Qn,";",jt,".size=",ai,";",Dn.map(function(Ro){return jt+"."+Ro+"="+Me[Ro]+";"}).join(""),"}"),zr){var ea=Me.divisor;Ie("if(",jt,".divisor!==",ea,"){",ve.instancing,".vertexAttribDivisorANGLE(",[ir,ea],");",jt,".divisor=",ea,";}")}}function Mn(){Ie("if(",jt,".buffer){",dt,".disableVertexAttribArray(",ir,");",jt,".buffer=null;","}if(",Er.map(function(Qn,ai){return jt+"."+Qn+"!=="+Dr[ai]}).join("||"),"){",dt,".vertexAttrib4f(",ir,",",Dr,");",Er.map(function(Qn,ai){return jt+"."+Qn+"="+Dr[ai]+";"}).join(""),"}")}wr===Zr?Tn():wr===vn?Mn():(Ie("if(",wr,"===",Zr,"){"),Tn(),Ie("}else{"),Mn(),Ie("}"))}Xt.forEach(function(Xe){var ft=Xe.name,Me=Ke.attributes[ft],dt;if(Me){if(!Vt(Me))return;dt=Me.append(ve,Ie)}else{if(!Vt(Bd))return;var ir=ve.scopeAttrib(ft);Re.optional(function(){ve.assert(Ie,ir+".state","missing attribute "+ft)}),dt={},Object.keys(new Bt).forEach(function(jt){dt[jt]=Ie.def(ir,".",jt)})}At(ve.link(Xe),mt(Xe.info.type),dt)})}function Ji(ve,Ie,Ke,Xt,Vt){for(var ut=ve.shared,mt=ut.gl,At,Xe=0;Xe<Xt.length;++Xe){var ft=Xt[Xe],Me=ft.name,dt=ft.info.type,ir=Ke.uniforms[Me],jt=ve.link(ft),wr=jt+".location",Sr;if(ir){if(!Vt(ir))continue;if(qo(ir)){var Dr=ir.value;if(Re.command(Dr!==null&&typeof Dr!="undefined",'missing uniform "'+Me+'"',ve.commandStr),dt===Gf||dt===Dc){Re.command(typeof Dr=="function"&&(dt===Gf&&(Dr._reglType==="texture2d"||Dr._reglType==="framebuffer")||dt===Dc&&(Dr._reglType==="textureCube"||Dr._reglType==="framebufferCube")),"invalid texture for uniform "+Me,ve.commandStr);var Dn=ve.link(Dr._texture||Dr.color[0]._texture);Ie(mt,".uniform1i(",wr,",",Dn+".bind());"),Ie.exit(Dn,".unbind();")}else if(dt===Hf||dt===Wf||dt===ec){Re.optional(function(){Re.command(Na(Dr),"invalid matrix for uniform "+Me,ve.commandStr),Re.command(dt===Hf&&Dr.length===4||dt===Wf&&Dr.length===9||dt===ec&&Dr.length===16,"invalid length for matrix uniform "+Me,ve.commandStr)});var Tn=ve.global.def("new Float32Array(["+Array.prototype.slice.call(Dr)+"])"),Mn=2;dt===Wf?Mn=3:dt===ec&&(Mn=4),Ie(mt,".uniformMatrix",Mn,"fv(",wr,",false,",Tn,");")}else{switch(dt){case ap:Re.commandType(Dr,"number","uniform "+Me,ve.commandStr),At="1f";break;case jp:Re.command(Na(Dr)&&Dr.length===2,"uniform "+Me,ve.commandStr),At="2f";break;case Eh:Re.command(Na(Dr)&&Dr.length===3,"uniform "+Me,ve.commandStr),At="3f";break;case Pc:Re.command(Na(Dr)&&Dr.length===4,"uniform "+Me,ve.commandStr),At="4f";break;case Hp:Re.commandType(Dr,"boolean","uniform "+Me,ve.commandStr),At="1i";break;case Oc:Re.commandType(Dr,"number","uniform "+Me,ve.commandStr),At="1i";break;case Jl:Re.command(Na(Dr)&&Dr.length===2,"uniform "+Me,ve.commandStr),At="2i";break;case op:Re.command(Na(Dr)&&Dr.length===2,"uniform "+Me,ve.commandStr),At="2i";break;case dl:Re.command(Na(Dr)&&Dr.length===3,"uniform "+Me,ve.commandStr),At="3i";break;case ro:Re.command(Na(Dr)&&Dr.length===3,"uniform "+Me,ve.commandStr),At="3i";break;case kc:Re.command(Na(Dr)&&Dr.length===4,"uniform "+Me,ve.commandStr),At="4i";break;case sf:Re.command(Na(Dr)&&Dr.length===4,"uniform "+Me,ve.commandStr),At="4i";break}Ie(mt,".uniform",At,"(",wr,",",Na(Dr)?Array.prototype.slice.call(Dr):Dr,");")}continue}else Sr=ir.append(ve,Ie)}else{if(!Vt(Bd))continue;Sr=Ie.def(ut.uniforms,"[",we.id(Me),"]")}dt===Gf?Ie("if(",Sr,"&&",Sr,'._reglType==="framebuffer"){',Sr,"=",Sr,".color[0];","}"):dt===Dc&&Ie("if(",Sr,"&&",Sr,'._reglType==="framebufferCube"){',Sr,"=",Sr,".color[0];","}"),Re.optional(function(){function Ko(Wu,Rh){ve.assert(Ie,Wu,'bad data or missing for uniform "'+Me+'".  '+Rh)}function cf(Wu){Ko("typeof "+Sr+'==="'+Wu+'"',"invalid type, expected "+Wu)}function Ls(Wu,Rh){Ko(ut.isArrayLike+"("+Sr+")&&"+Sr+".length==="+Wu,"invalid vector, should have length "+Wu,ve.commandStr)}function jd(Wu){Ko("typeof "+Sr+'==="function"&&'+Sr+'._reglType==="texture'+(Wu===ip?"2d":"Cube")+'"',"invalid texture type",ve.commandStr)}switch(dt){case Oc:cf("number");break;case op:Ls(2,"number");break;case ro:Ls(3,"number");break;case sf:Ls(4,"number");break;case ap:cf("number");break;case jp:Ls(2,"number");break;case Eh:Ls(3,"number");break;case Pc:Ls(4,"number");break;case Hp:cf("boolean");break;case Jl:Ls(2,"boolean");break;case dl:Ls(3,"boolean");break;case kc:Ls(4,"boolean");break;case Hf:Ls(4,"number");break;case Wf:Ls(9,"number");break;case ec:Ls(16,"number");break;case Gf:jd(ip);break;case Dc:jd(zp);break}});var Qn=1;switch(dt){case Gf:case Dc:var ai=Ie.def(Sr,"._texture");Ie(mt,".uniform1i(",wr,",",ai,".bind());"),Ie.exit(ai,".unbind();");continue;case Oc:case Hp:At="1i";break;case op:case Jl:At="2i",Qn=2;break;case ro:case dl:At="3i",Qn=3;break;case sf:case kc:At="4i",Qn=4;break;case ap:At="1f";break;case jp:At="2f",Qn=2;break;case Eh:At="3f",Qn=3;break;case Pc:At="4f",Qn=4;break;case Hf:At="Matrix2fv";break;case Wf:At="Matrix3fv";break;case ec:At="Matrix4fv";break}if(Ie(mt,".uniform",At,"(",wr,","),At.charAt(0)==="M"){var ea=Math.pow(dt-Hf+2,2),Ro=ve.global.def("new Float32Array(",ea,")");Ie("false,(Array.isArray(",Sr,")||",Sr," instanceof Float32Array)?",Sr,":(",yt(ea,function(Ko){return Ro+"["+Ko+"]="+Sr+"["+Ko+"]"}),",",Ro,")")}else Qn>1?Ie(yt(Qn,function(Ko){return Sr+"["+Ko+"]"})):Ie(Sr);Ie(");")}}function Kn(ve,Ie,Ke,Xt){var Vt=ve.shared,ut=Vt.gl,mt=Vt.draw,At=Xt.draw;function Xe(){var ai=At.elements,ea,Ro=Ie;return ai?((ai.contextDep&&Xt.contextDynamic||ai.propDep)&&(Ro=Ke),ea=ai.append(ve,Ro)):ea=Ro.def(mt,".",Li),ea&&Ro("if("+ea+")"+ut+".bindBuffer("+jf+","+ea+".buffer.buffer);"),ea}function ft(){var ai=At.count,ea,Ro=Ie;return ai?((ai.contextDep&&Xt.contextDynamic||ai.propDep)&&(Ro=Ke),ea=ai.append(ve,Ro),Re.optional(function(){ai.MISSING&&ve.assert(Ie,"false","missing vertex count"),ai.DYNAMIC&&ve.assert(Ro,ea+">=0","missing vertex count")})):(ea=Ro.def(mt,".",So),Re.optional(function(){ve.assert(Ro,ea+">=0","missing vertex count")})),ea}var Me=Xe();function dt(ai){var ea=At[ai];return ea?ea.contextDep&&Xt.contextDynamic||ea.propDep?ea.append(ve,Ke):ea.append(ve,Ie):Ie.def(mt,".",ai)}var ir=dt(Yo),jt=dt(uu),wr=ft();if(typeof wr=="number"){if(wr===0)return}else Ke("if(",wr,"){"),Ke.exit("}");var Sr,Dr;zr&&(Sr=dt(Mc),Dr=ve.instancing);var Dn=Me+".type",Tn=At.elements&&qo(At.elements);function Mn(){function ai(){Ke(Dr,".drawElementsInstancedANGLE(",[ir,wr,Dn,jt+"<<(("+Dn+"-"+Gr+")>>1)",Sr],");")}function ea(){Ke(Dr,".drawArraysInstancedANGLE(",[ir,jt,wr,Sr],");")}Me?Tn?ai():(Ke("if(",Me,"){"),ai(),Ke("}else{"),ea(),Ke("}")):ea()}function Qn(){function ai(){Ke(ut+".drawElements("+[ir,wr,Dn,jt+"<<(("+Dn+"-"+Gr+")>>1)"]+");")}function ea(){Ke(ut+".drawArrays("+[ir,jt,wr]+");")}Me?Tn?ai():(Ke("if(",Me,"){"),ai(),Ke("}else{"),ea(),Ke("}")):ea()}zr&&(typeof Sr!="number"||Sr>=0)?typeof Sr=="string"?(Ke("if(",Sr,">0){"),Mn(),Ke("}else if(",Sr,"<0){"),Qn(),Ke("}")):Mn():Qn()}function Oi(ve,Ie,Ke,Xt,Vt){var ut=Xn(),mt=ut.proc("body",Vt);return Re.optional(function(){ut.commandStr=Ie.commandStr,ut.command=ut.link(Ie.commandStr)}),zr&&(ut.instancing=mt.def(ut.shared.extensions,".angle_instanced_arrays")),ve(ut,mt,Ke,Xt),ut.compile().body}function Xi(ve,Ie,Ke,Xt){Co(ve,Ie),Ke.useVAO?Ke.drawVAO?Ie(ve.shared.vao,".setVAO(",Ke.drawVAO.append(ve,Ie),");"):Ie(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(Ie(ve.shared.vao,".setVAO(null);"),is(ve,Ie,Ke,Xt.attributes,function(){return!0})),Ji(ve,Ie,Ke,Xt.uniforms,function(){return!0}),Kn(ve,Ie,Ie,Ke)}function vo(ve,Ie){var Ke=ve.proc("draw",1);Co(ve,Ke),po(ve,Ke,Ie.context),za(ve,Ke,Ie.framebuffer),wo(ve,Ke,Ie),ns(ve,Ke,Ie.state),Ei(ve,Ke,Ie,!1,!0);var Xt=Ie.shader.progVar.append(ve,Ke);if(Ke(ve.shared.gl,".useProgram(",Xt,".program);"),Ie.shader.program)Xi(ve,Ke,Ie,Ie.shader.program);else{Ke(ve.shared.vao,".setVAO(null);");var Vt=ve.global.def("{}"),ut=Ke.def(Xt,".id"),mt=Ke.def(Vt,"[",ut,"]");Ke(ve.cond(mt).then(mt,".call(this,a0);").else(mt,"=",Vt,"[",ut,"]=",ve.link(function(At){return Oi(Xi,ve,Ie,At,1)}),"(",Xt,");",mt,".call(this,a0);"))}Object.keys(Ie.state).length>0&&Ke(ve.shared.current,".dirty=true;")}function vl(ve,Ie,Ke,Xt){ve.batchId="a1",Co(ve,Ie);function Vt(){return!0}is(ve,Ie,Ke,Xt.attributes,Vt),Ji(ve,Ie,Ke,Xt.uniforms,Vt),Kn(ve,Ie,Ie,Ke)}function Ge(ve,Ie,Ke,Xt){Co(ve,Ie);var Vt=Ke.contextDep,ut=Ie.def(),mt="a0",At="a1",Xe=Ie.def();ve.shared.props=Xe,ve.batchId=ut;var ft=ve.scope(),Me=ve.scope();Ie(ft.entry,"for(",ut,"=0;",ut,"<",At,";++",ut,"){",Xe,"=",mt,"[",ut,"];",Me,"}",ft.exit);function dt(Dn){return Dn.contextDep&&Vt||Dn.propDep}function ir(Dn){return!dt(Dn)}if(Ke.needsContext&&po(ve,Me,Ke.context),Ke.needsFramebuffer&&za(ve,Me,Ke.framebuffer),ns(ve,Me,Ke.state,dt),Ke.profile&&dt(Ke.profile)&&Ei(ve,Me,Ke,!1,!0),Xt)Ke.useVAO?Ke.drawVAO?dt(Ke.drawVAO)?Me(ve.shared.vao,".setVAO(",Ke.drawVAO.append(ve,Me),");"):ft(ve.shared.vao,".setVAO(",Ke.drawVAO.append(ve,ft),");"):ft(ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"):(ft(ve.shared.vao,".setVAO(null);"),is(ve,ft,Ke,Xt.attributes,ir),is(ve,Me,Ke,Xt.attributes,dt)),Ji(ve,ft,Ke,Xt.uniforms,ir),Ji(ve,Me,Ke,Xt.uniforms,dt),Kn(ve,ft,Me,Ke);else{var jt=ve.global.def("{}"),wr=Ke.shader.progVar.append(ve,Me),Sr=Me.def(wr,".id"),Dr=Me.def(jt,"[",Sr,"]");Me(ve.shared.gl,".useProgram(",wr,".program);","if(!",Dr,"){",Dr,"=",jt,"[",Sr,"]=",ve.link(function(Dn){return Oi(vl,ve,Ke,Dn,2)}),"(",wr,");}",Dr,".call(this,a0[",ut,"],",ut,");")}}function tr(ve,Ie){var Ke=ve.proc("batch",2);ve.batchId="0",Co(ve,Ke);var Xt=!1,Vt=!0;Object.keys(Ie.context).forEach(function(jt){Xt=Xt||Ie.context[jt].propDep}),Xt||(po(ve,Ke,Ie.context),Vt=!1);var ut=Ie.framebuffer,mt=!1;ut?(ut.propDep?Xt=mt=!0:ut.contextDep&&Xt&&(mt=!0),mt||za(ve,Ke,ut)):za(ve,Ke,null),Ie.state.viewport&&Ie.state.viewport.propDep&&(Xt=!0);function At(jt){return jt.contextDep&&Xt||jt.propDep}wo(ve,Ke,Ie),ns(ve,Ke,Ie.state,function(jt){return!At(jt)}),(!Ie.profile||!At(Ie.profile))&&Ei(ve,Ke,Ie,!1,"a1"),Ie.contextDep=Xt,Ie.needsContext=Vt,Ie.needsFramebuffer=mt;var Xe=Ie.shader.progVar;if(Xe.contextDep&&Xt||Xe.propDep)Ge(ve,Ke,Ie,null);else{var ft=Xe.append(ve,Ke);if(Ke(ve.shared.gl,".useProgram(",ft,".program);"),Ie.shader.program)Ge(ve,Ke,Ie,Ie.shader.program);else{Ke(ve.shared.vao,".setVAO(null);");var Me=ve.global.def("{}"),dt=Ke.def(ft,".id"),ir=Ke.def(Me,"[",dt,"]");Ke(ve.cond(ir).then(ir,".call(this,a0,a1);").else(ir,"=",Me,"[",dt,"]=",ve.link(function(jt){return Oi(Ge,ve,Ie,jt,2)}),"(",ft,");",ir,".call(this,a0,a1);"))}}Object.keys(Ie.state).length>0&&Ke(ve.shared.current,".dirty=true;")}function Gt(ve,Ie){var Ke=ve.proc("scope",3);ve.batchId="a2";var Xt=ve.shared,Vt=Xt.current;po(ve,Ke,Ie.context),Ie.framebuffer&&Ie.framebuffer.append(ve,Ke),Th(Object.keys(Ie.state)).forEach(function(mt){var At=Ie.state[mt],Xe=At.append(ve,Ke);Na(Xe)?Xe.forEach(function(ft,Me){Ke.set(ve.next[mt],"["+Me+"]",ft)}):Ke.set(Xt.next,"."+mt,Xe)}),Ei(ve,Ke,Ie,!0,!0),[Li,uu,So,Mc,Yo].forEach(function(mt){var At=Ie.draw[mt];!At||Ke.set(Xt.draw,"."+mt,""+At.append(ve,Ke))}),Object.keys(Ie.uniforms).forEach(function(mt){Ke.set(Xt.uniforms,"["+we.id(mt)+"]",Ie.uniforms[mt].append(ve,Ke))}),Object.keys(Ie.attributes).forEach(function(mt){var At=Ie.attributes[mt].append(ve,Ke),Xe=ve.scopeAttrib(mt);Object.keys(new Bt).forEach(function(ft){Ke.set(Xe,"."+ft,At[ft])})}),Ie.scopeVAO&&Ke.set(Xt.vao,".targetVAO",Ie.scopeVAO.append(ve,Ke));function ut(mt){var At=Ie.shader[mt];At&&Ke.set(Xt.shader,"."+mt,At.append(ve,Ke))}ut(su),ut(Eu),Object.keys(Ie.state).length>0&&(Ke(Vt,".dirty=true;"),Ke.exit(Vt,".dirty=true;")),Ke("a1(",ve.shared.context,",a0,",ve.batchId,");")}function xn(ve){if(!(typeof ve!="object"||Na(ve))){for(var Ie=Object.keys(ve),Ke=0;Ke<Ie.length;++Ke)if(sn.isDynamic(ve[Ie[Ke]]))return!0;return!1}}function Si(ve,Ie,Ke){var Xt=Ie.static[Ke];if(!Xt||!xn(Xt))return;var Vt=ve.global,ut=Object.keys(Xt),mt=!1,At=!1,Xe=!1,ft=ve.global.def("{}");ut.forEach(function(dt){var ir=Xt[dt];if(sn.isDynamic(ir)){typeof ir=="function"&&(ir=Xt[dt]=sn.unbox(ir));var jt=lu(ir,null);mt=mt||jt.thisDep,Xe=Xe||jt.propDep,At=At||jt.contextDep}else{switch(Vt(ft,".",dt,"="),typeof ir){case"number":Vt(ir);break;case"string":Vt('"',ir,'"');break;case"object":Array.isArray(ir)&&Vt("[",ir.join(),"]");break;default:Vt(ve.link(ir));break}Vt(";")}});function Me(dt,ir){ut.forEach(function(jt){var wr=Xt[jt];if(!!sn.isDynamic(wr)){var Sr=dt.invoke(ir,wr);ir(ft,".",jt,"=",Sr,";")}})}Ie.dynamic[Ke]=new sn.DynamicVariable(bn,{thisDep:mt,contextDep:At,propDep:Xe,ref:ft,append:Me}),delete Ie.static[Ke]}function la(ve,Ie,Ke,Xt,Vt){var ut=Xn();ut.stats=ut.link(Vt),Object.keys(Ie.static).forEach(function(At){Si(ut,Ie,At)}),np.forEach(function(At){Si(ut,ve,At)});var mt=ho(ve,Ie,Ke,Xt,ut);return vo(ut,mt),Gt(ut,mt),tr(ut,mt),ut.compile()}return{next:gn,current:Tr,procs:function(){var ve=Xn(),Ie=ve.proc("poll"),Ke=ve.proc("refresh"),Xt=ve.block();Ie(Xt),Ke(Xt);var Vt=ve.shared,ut=Vt.gl,mt=Vt.next,At=Vt.current;Xt(At,".dirty=false;"),za(ve,Ie),za(ve,Ke,null,!0);var Xe;zr&&(Xe=ve.link(zr)),Qe.oes_vertex_array_object&&Ke(ve.link(Qe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ft=0;ft<Qt.maxAttributes;++ft){var Me=Ke.def(Vt.attributes,"[",ft,"]"),dt=ve.cond(Me,".buffer");dt.then(ut,".enableVertexAttribArray(",ft,");",ut,".bindBuffer(",Su,",",Me,".buffer.buffer);",ut,".vertexAttribPointer(",ft,",",Me,".size,",Me,".type,",Me,".normalized,",Me,".stride,",Me,".offset);").else(ut,".disableVertexAttribArray(",ft,");",ut,".vertexAttrib4f(",ft,",",Me,".x,",Me,".y,",Me,".z,",Me,".w);",Me,".buffer=null;"),Ke(dt),zr&&Ke(Xe,".vertexAttribDivisorANGLE(",ft,",",Me,".divisor);")}return Ke(ve.shared.vao,".currentVAO=null;",ve.shared.vao,".setVAO(",ve.shared.vao,".targetVAO);"),Object.keys(cn).forEach(function(ir){var jt=cn[ir],wr=Xt.def(mt,".",ir),Sr=ve.block();Sr("if(",wr,"){",ut,".enable(",jt,")}else{",ut,".disable(",jt,")}",At,".",ir,"=",wr,";"),Ke(Sr),Ie("if(",wr,"!==",At,".",ir,"){",Sr,"}")}),Object.keys(Cr).forEach(function(ir){var jt=Cr[ir],wr=Tr[ir],Sr,Dr,Dn=ve.block();if(Dn(ut,".",jt,"("),Na(wr)){var Tn=wr.length;Sr=ve.global.def(mt,".",ir),Dr=ve.global.def(At,".",ir),Dn(yt(Tn,function(Mn){return Sr+"["+Mn+"]"}),");",yt(Tn,function(Mn){return Dr+"["+Mn+"]="+Sr+"["+Mn+"];"}).join("")),Ie("if(",yt(Tn,function(Mn){return Sr+"["+Mn+"]!=="+Dr+"["+Mn+"]"}).join("||"),"){",Dn,"}")}else Sr=Xt.def(mt,".",ir),Dr=Xt.def(At,".",ir),Dn(Sr,");",At,".",ir,"=",Sr,";"),Ie("if(",Sr,"!==",Dr,"){",Dn,"}");Ke(Dn)}),ve.compile()}(),compile:la}}function lp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Fd=34918,Nd=34919,Ud=35007,jv=function(W,we){if(!we.ext_disjoint_timer_query)return null;var Qe=[];function Qt(){return Qe.pop()||we.ext_disjoint_timer_query.createQueryEXT()}function mr(zr){Qe.push(zr)}var er=[];function Zt(zr){var pn=Qt();we.ext_disjoint_timer_query.beginQueryEXT(Ud,pn),er.push(pn),kr(er.length-1,er.length,zr)}function Ur(){we.ext_disjoint_timer_query.endQueryEXT(Ud)}function Or(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Qr=[];function jr(){return Qr.pop()||new Or}function $r(zr){Qr.push(zr)}var en=[];function kr(zr,pn,Tr){var gn=jr();gn.startQueryIndex=zr,gn.endQueryIndex=pn,gn.sum=0,gn.stats=Tr,en.push(gn)}var qr=[],Bt=[];function or(){var zr,pn,Tr=er.length;if(Tr!==0){Bt.length=Math.max(Bt.length,Tr+1),qr.length=Math.max(qr.length,Tr+1),qr[0]=0,Bt[0]=0;var gn=0;for(zr=0,pn=0;pn<er.length;++pn){var Br=er[pn];we.ext_disjoint_timer_query.getQueryObjectEXT(Br,Nd)?(gn+=we.ext_disjoint_timer_query.getQueryObjectEXT(Br,Fd),mr(Br)):er[zr++]=Br,qr[pn+1]=gn,Bt[pn+1]=zr}for(er.length=zr,zr=0,pn=0;pn<en.length;++pn){var cn=en[pn],Cr=cn.startQueryIndex,nn=cn.endQueryIndex;cn.sum+=qr[nn]-qr[Cr];var Wn=Bt[Cr],hi=Bt[nn];hi===Wn?(cn.stats.gpuTime+=cn.sum/1e6,$r(cn)):(cn.startQueryIndex=Wn,cn.endQueryIndex=hi,en[zr++]=cn)}en.length=zr}}return{beginQuery:Zt,endQuery:Ur,pushScopeStats:kr,update:or,getNumPendingQueries:function(){return er.length},clear:function(){Qe.push.apply(Qe,er);for(var zr=0;zr<Qe.length;zr++)we.ext_disjoint_timer_query.deleteQueryEXT(Qe[zr]);er.length=0,Qe.length=0},restore:function(){er.length=0,Qe.length=0}}},cp=16384,Ts=256,Hv=1024,wh=34962,Ch="webglcontextlost",zd="webglcontextrestored",lf=1,Wv=2,Gv=3;function Zd(W,we){for(var Qe=0;Qe<W.length;++Qe)if(W[Qe]===we)return Qe;return-1}function Vd(W){var we=Ot(W);if(!we)return null;var Qe=we.gl,Qt=Qe.getContextAttributes(),mr=Qe.isContextLost(),er=kt(Qe,we);if(!er)return null;var Zt=fe(),Ur=lp(),Or=er.extensions,Qr=jv(Qe,Or),jr=Wi(),$r=Qe.drawingBufferWidth,en=Qe.drawingBufferHeight,kr={tick:0,time:0,viewportWidth:$r,viewportHeight:en,framebufferWidth:$r,framebufferHeight:en,drawingBufferWidth:$r,drawingBufferHeight:en,pixelRatio:we.pixelRatio},qr={},Bt={elements:null,primitive:4,count:-1,offset:0,instances:-1},or=pc(Qe,Or),zr=ch(Qe,Ur,we,Tr),pn=J(Qe,Or,or,Ur,zr);function Tr(Kn){return pn.destroyBuffer(Kn)}var gn=Yh(Qe,Or,zr,Ur),Br=Ve(Qe,Zt,Ur,we),cn=Ys(Qe,Or,or,function(){Wn.procs.poll()},kr,Ur,we),Cr=_u(Qe,Or,or,Ur,we),nn=C(Qe,Or,or,cn,Cr,Ur),Wn=$f(Qe,Zt,Or,or,zr,gn,cn,nn,qr,pn,Br,Bt,kr,Qr,we),hi=Nt(Qe,nn,Wn.procs.poll,kr,Qt,Or,or),an=Wn.next,Lr=Qe.canvas,_r=[],Xn=[],pr=[],yn=[we.onDestroy],xt=null;function ci(){if(_r.length===0){Qr&&Qr.update(),xt=null;return}xt=Vn.next(ci),ns();for(var Kn=_r.length-1;Kn>=0;--Kn){var Oi=_r[Kn];Oi&&Oi(kr,null,0)}Qe.flush(),Qr&&Qr.update()}function ri(){!xt&&_r.length>0&&(xt=Vn.next(ci))}function Gi(){xt&&(Vn.cancel(ci),xt=null)}function co(Kn){Kn.preventDefault(),mr=!0,Gi(),Xn.forEach(function(Oi){Oi()})}function Bo(Kn){Qe.getError(),mr=!1,er.restore(),Br.restore(),zr.restore(),cn.restore(),Cr.restore(),nn.restore(),pn.restore(),Qr&&Qr.restore(),Wn.procs.refresh(),ri(),pr.forEach(function(Oi){Oi()})}Lr&&(Lr.addEventListener(Ch,co,!1),Lr.addEventListener(zd,Bo,!1));function Ai(){_r.length=0,Gi(),Lr&&(Lr.removeEventListener(Ch,co),Lr.removeEventListener(zd,Bo)),Br.clear(),nn.clear(),Cr.clear(),cn.clear(),gn.clear(),zr.clear(),pn.clear(),Qr&&Qr.clear(),yn.forEach(function(Kn){Kn()})}function fo(Kn){Re(!!Kn,"invalid args to regl({...})"),Re.type(Kn,"object","invalid args to regl({...})");function Oi(Vt){var ut=Z({},Vt);delete ut.uniforms,delete ut.attributes,delete ut.context,delete ut.vao,"stencil"in ut&&ut.stencil.op&&(ut.stencil.opBack=ut.stencil.opFront=ut.stencil.op,delete ut.stencil.op);function mt(At){if(At in ut){var Xe=ut[At];delete ut[At],Object.keys(Xe).forEach(function(ft){ut[At+"."+ft]=Xe[ft]})}}return mt("blend"),mt("depth"),mt("cull"),mt("stencil"),mt("polygonOffset"),mt("scissor"),mt("sample"),"vao"in Vt&&(ut.vao=Vt.vao),ut}function Xi(Vt){var ut={},mt={};return Object.keys(Vt).forEach(function(At){var Xe=Vt[At];sn.isDynamic(Xe)?mt[At]=sn.unbox(Xe,At):ut[At]=Xe}),{dynamic:mt,static:ut}}var vo=Xi(Kn.context||{}),vl=Xi(Kn.uniforms||{}),Ge=Xi(Kn.attributes||{}),tr=Xi(Oi(Kn)),Gt={gpuTime:0,cpuTime:0,count:0},xn=Wn.compile(tr,Ge,vl,vo,Gt),Si=xn.draw,la=xn.batch,ve=xn.scope,Ie=[];function Ke(Vt){for(;Ie.length<Vt;)Ie.push(null);return Ie}function Xt(Vt,ut){var mt;if(mr&&Re.raise("context lost"),typeof Vt=="function")return ve.call(this,null,Vt,0);if(typeof ut=="function")if(typeof Vt=="number")for(mt=0;mt<Vt;++mt)ve.call(this,null,ut,mt);else if(Array.isArray(Vt))for(mt=0;mt<Vt.length;++mt)ve.call(this,Vt[mt],ut,mt);else return ve.call(this,Vt,ut,0);else if(typeof Vt=="number"){if(Vt>0)return la.call(this,Ke(Vt|0),Vt|0)}else if(Array.isArray(Vt)){if(Vt.length)return la.call(this,Vt,Vt.length)}else return Si.call(this,Vt)}return Z(Xt,{stats:Gt})}var Ea=nn.setFBO=fo({framebuffer:sn.define.call(null,lf,"framebuffer")});function ho(Kn,Oi){var Xi=0;Wn.procs.poll();var vo=Oi.color;vo&&(Qe.clearColor(+vo[0]||0,+vo[1]||0,+vo[2]||0,+vo[3]||0),Xi|=cp),"depth"in Oi&&(Qe.clearDepth(+Oi.depth),Xi|=Ts),"stencil"in Oi&&(Qe.clearStencil(Oi.stencil|0),Xi|=Hv),Re(!!Xi,"called regl.clear with no buffer specified"),Qe.clear(Xi)}function po(Kn){if(Re(typeof Kn=="object"&&Kn,"regl.clear() takes an object as input"),"framebuffer"in Kn)if(Kn.framebuffer&&Kn.framebuffer_reglType==="framebufferCube")for(var Oi=0;Oi<6;++Oi)Ea(Z({framebuffer:Kn.framebuffer.faces[Oi]},Kn),ho);else Ea(Kn,ho);else ho(null,Kn)}function za(Kn){Re.type(Kn,"function","regl.frame() callback must be a function"),_r.push(Kn);function Oi(){var Xi=Zd(_r,Kn);Re(Xi>=0,"cannot cancel a frame twice");function vo(){var vl=Zd(_r,vo);_r[vl]=_r[_r.length-1],_r.length-=1,_r.length<=0&&Gi()}_r[Xi]=vo}return ri(),{cancel:Oi}}function wo(){var Kn=an.viewport,Oi=an.scissor_box;Kn[0]=Kn[1]=Oi[0]=Oi[1]=0,kr.viewportWidth=kr.framebufferWidth=kr.drawingBufferWidth=Kn[2]=Oi[2]=Qe.drawingBufferWidth,kr.viewportHeight=kr.framebufferHeight=kr.drawingBufferHeight=Kn[3]=Oi[3]=Qe.drawingBufferHeight}function ns(){kr.tick+=1,kr.time=Ei(),wo(),Wn.procs.poll()}function Co(){wo(),Wn.procs.refresh(),Qr&&Qr.update()}function Ei(){return(Wi()-jr)/1e3}Co();function is(Kn,Oi){Re.type(Oi,"function","listener callback must be a function");var Xi;switch(Kn){case"frame":return za(Oi);case"lost":Xi=Xn;break;case"restore":Xi=pr;break;case"destroy":Xi=yn;break;default:Re.raise("invalid event, must be one of frame,lost,restore,destroy")}return Xi.push(Oi),{cancel:function(){for(var vo=0;vo<Xi.length;++vo)if(Xi[vo]===Oi){Xi[vo]=Xi[Xi.length-1],Xi.pop();return}}}}var Ji=Z(fo,{clear:po,prop:sn.define.bind(null,lf),context:sn.define.bind(null,Wv),this:sn.define.bind(null,Gv),draw:fo({}),buffer:function(Kn){return zr.create(Kn,wh,!1,!1)},elements:function(Kn){return gn.create(Kn,!1)},texture:cn.create2D,cube:cn.createCube,renderbuffer:Cr.create,framebuffer:nn.create,framebufferCube:nn.createCube,vao:pn.createVAO,attributes:Qt,frame:za,on:is,limits:or,hasExtension:function(Kn){return or.extensions.indexOf(Kn.toLowerCase())>=0},read:hi,destroy:Ai,_gl:Qe,_refresh:Co,poll:function(){ns(),Qr&&Qr.update()},now:Ei,stats:Ur});return we.onDone(null,Ji),Ji}return Vd})},69848:function(vr){(function(se,Z){vr.exports=Z()})(this,function(){"use strict";function se(It,ct,Ft,ht,sr,br){if(!(sr-ht<=Ft)){var te=ht+sr>>1;Z(It,ct,te,ht,sr,br%2),se(It,ct,Ft,ht,te-1,br+1),se(It,ct,Ft,te+1,sr,br+1)}}function Z(It,ct,Ft,ht,sr,br){for(;sr>ht;){if(sr-ht>600){var te=sr-ht+1,Ne=Ft-ht+1,O=Math.log(te),Pe=.5*Math.exp(2*O/3),Ce=.5*Math.sqrt(O*Pe*(te-Pe)/te)*(Ne-te/2<0?-1:1),pt=Math.max(ht,Math.floor(Ft-Ne*Pe/te+Ce)),Ye=Math.min(sr,Math.floor(Ft+(te-Ne)*Pe/te+Ce));Z(It,ct,Ft,pt,Ye,br)}var We=ct[2*Ft+br],ot=ht,Tt=sr;for(ge(It,ct,ht,Ft),ct[2*sr+br]>We&&ge(It,ct,ht,sr);ot<Tt;){for(ge(It,ct,ot,Tt),ot++,Tt--;ct[2*ot+br]<We;)ot++;for(;ct[2*Tt+br]>We;)Tt--}ct[2*ht+br]===We?ge(It,ct,ht,Tt):(Tt++,ge(It,ct,Tt,sr)),Tt<=Ft&&(ht=Tt+1),Ft<=Tt&&(sr=Tt-1)}}function ge(It,ct,Ft,ht){oe(It,Ft,ht),oe(ct,2*Ft,2*ht),oe(ct,2*Ft+1,2*ht+1)}function oe(It,ct,Ft){var ht=It[ct];It[ct]=It[Ft],It[Ft]=ht}function _(It,ct,Ft,ht,sr,br,te){for(var Ne=[0,It.length-1,0],O=[],Pe,Ce;Ne.length;){var pt=Ne.pop(),Ye=Ne.pop(),We=Ne.pop();if(Ye-We<=te){for(var ot=We;ot<=Ye;ot++)Pe=ct[2*ot],Ce=ct[2*ot+1],Pe>=Ft&&Pe<=sr&&Ce>=ht&&Ce<=br&&O.push(It[ot]);continue}var Tt=Math.floor((We+Ye)/2);Pe=ct[2*Tt],Ce=ct[2*Tt+1],Pe>=Ft&&Pe<=sr&&Ce>=ht&&Ce<=br&&O.push(It[Tt]);var gr=(pt+1)%2;(pt===0?Ft<=Pe:ht<=Ce)&&(Ne.push(We),Ne.push(Tt-1),Ne.push(gr)),(pt===0?sr>=Pe:br>=Ce)&&(Ne.push(Tt+1),Ne.push(Ye),Ne.push(gr))}return O}function de(It,ct,Ft,ht,sr,br){for(var te=[0,It.length-1,0],Ne=[],O=sr*sr;te.length;){var Pe=te.pop(),Ce=te.pop(),pt=te.pop();if(Ce-pt<=br){for(var Ye=pt;Ye<=Ce;Ye++)j(ct[2*Ye],ct[2*Ye+1],Ft,ht)<=O&&Ne.push(It[Ye]);continue}var We=Math.floor((pt+Ce)/2),ot=ct[2*We],Tt=ct[2*We+1];j(ot,Tt,Ft,ht)<=O&&Ne.push(It[We]);var gr=(Pe+1)%2;(Pe===0?Ft-sr<=ot:ht-sr<=Tt)&&(te.push(pt),te.push(We-1),te.push(gr)),(Pe===0?Ft+sr>=ot:ht+sr>=Tt)&&(te.push(We+1),te.push(Ce),te.push(gr))}return Ne}function j(It,ct,Ft,ht){var sr=It-Ft,br=ct-ht;return sr*sr+br*br}var ue=function(It){return It[0]},ie=function(It){return It[1]},De=function(ct,Ft,ht,sr,br){Ft===void 0&&(Ft=ue),ht===void 0&&(ht=ie),sr===void 0&&(sr=64),br===void 0&&(br=Float64Array),this.nodeSize=sr,this.points=ct;for(var te=ct.length<65536?Uint16Array:Uint32Array,Ne=this.ids=new te(ct.length),O=this.coords=new br(ct.length*2),Pe=0;Pe<ct.length;Pe++)Ne[Pe]=Pe,O[2*Pe]=Ft(ct[Pe]),O[2*Pe+1]=ht(ct[Pe]);se(Ne,O,sr,0,Ne.length-1,0)};De.prototype.range=function(ct,Ft,ht,sr){return _(this.ids,this.coords,ct,Ft,ht,sr,this.nodeSize)},De.prototype.within=function(ct,Ft,ht){return de(this.ids,this.coords,ct,Ft,ht,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(It){return It}},Ze=Math.fround||function(It){return function(ct){return It[0]=+ct,It[0]}}(new Float32Array(1)),nt=function(ct){this.options=Fr(Object.create(ne),ct),this.trees=new Array(this.options.maxZoom+1)};nt.prototype.load=function(ct){var Ft=this.options,ht=Ft.log,sr=Ft.minZoom,br=Ft.maxZoom,te=Ft.nodeSize;ht&&console.time("total time");var Ne="prepare "+ct.length+" points";ht&&console.time(Ne),this.points=ct;for(var O=[],Pe=0;Pe<ct.length;Pe++)!ct[Pe].geometry||O.push(Pt(ct[Pe],Pe));this.trees[br+1]=new De(O,Ar,dr,te,Float32Array),ht&&console.timeEnd(Ne);for(var Ce=br;Ce>=sr;Ce--){var pt=+Date.now();O=this._cluster(O,Ce),this.trees[Ce]=new De(O,Ar,dr,te,Float32Array),ht&&console.log("z%d: %d clusters in %dms",Ce,O.length,+Date.now()-pt)}return ht&&console.timeEnd("total time"),this},nt.prototype.getClusters=function(ct,Ft){var ht=((ct[0]+180)%360+360)%360-180,sr=Math.max(-90,Math.min(90,ct[1])),br=ct[2]===180?180:((ct[2]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,ct[3]));if(ct[2]-ct[0]>=360)ht=-180,br=180;else if(ht>br){var Ne=this.getClusters([ht,sr,180,te],Ft),O=this.getClusters([-180,sr,br,te],Ft);return Ne.concat(O)}for(var Pe=this.trees[this._limitZoom(Ft)],Ce=Pe.range(rr(ht),zt(te),rr(br),zt(sr)),pt=[],Ye=0,We=Ce;Ye<We.length;Ye+=1){var ot=We[Ye],Tt=Pe.points[ot];pt.push(Tt.numPoints?Ct(Tt):this.points[Tt.index])}return pt},nt.prototype.getChildren=function(ct){var Ft=this._getOriginId(ct),ht=this._getOriginZoom(ct),sr="No cluster with the specified id.",br=this.trees[ht];if(!br)throw new Error(sr);var te=br.points[Ft];if(!te)throw new Error(sr);for(var Ne=this.options.radius/(this.options.extent*Math.pow(2,ht-1)),O=br.within(te.x,te.y,Ne),Pe=[],Ce=0,pt=O;Ce<pt.length;Ce+=1){var Ye=pt[Ce],We=br.points[Ye];We.parentId===ct&&Pe.push(We.numPoints?Ct(We):this.points[We.index])}if(Pe.length===0)throw new Error(sr);return Pe},nt.prototype.getLeaves=function(ct,Ft,ht){Ft=Ft||10,ht=ht||0;var sr=[];return this._appendLeaves(sr,ct,Ft,ht,0),sr},nt.prototype.getTile=function(ct,Ft,ht){var sr=this.trees[this._limitZoom(ct)],br=Math.pow(2,ct),te=this.options,Ne=te.extent,O=te.radius,Pe=O/Ne,Ce=(ht-Pe)/br,pt=(ht+1+Pe)/br,Ye={features:[]};return this._addTileFeatures(sr.range((Ft-Pe)/br,Ce,(Ft+1+Pe)/br,pt),sr.points,Ft,ht,br,Ye),Ft===0&&this._addTileFeatures(sr.range(1-Pe/br,Ce,1,pt),sr.points,br,ht,br,Ye),Ft===br-1&&this._addTileFeatures(sr.range(0,Ce,Pe/br,pt),sr.points,-1,ht,br,Ye),Ye.features.length?Ye:null},nt.prototype.getClusterExpansionZoom=function(ct){for(var Ft=this._getOriginZoom(ct)-1;Ft<=this.options.maxZoom;){var ht=this.getChildren(ct);if(Ft++,ht.length!==1)break;ct=ht[0].properties.cluster_id}return Ft},nt.prototype._appendLeaves=function(ct,Ft,ht,sr,br){for(var te=this.getChildren(Ft),Ne=0,O=te;Ne<O.length;Ne+=1){var Pe=O[Ne],Ce=Pe.properties;if(Ce&&Ce.cluster?br+Ce.point_count<=sr?br+=Ce.point_count:br=this._appendLeaves(ct,Ce.cluster_id,ht,sr,br):br<sr?br++:ct.push(Pe),ct.length===ht)break}return br},nt.prototype._addTileFeatures=function(ct,Ft,ht,sr,br,te){for(var Ne=0,O=ct;Ne<O.length;Ne+=1){var Pe=O[Ne],Ce=Ft[Pe],pt=Ce.numPoints,Ye=void 0,We=void 0,ot=void 0;if(pt)Ye=$t(Ce),We=Ce.x,ot=Ce.y;else{var Tt=this.points[Ce.index];Ye=Tt.properties,We=rr(Tt.geometry.coordinates[0]),ot=zt(Tt.geometry.coordinates[1])}var gr={type:1,geometry:[[Math.round(this.options.extent*(We*br-ht)),Math.round(this.options.extent*(ot*br-sr))]],tags:Ye},wt=void 0;pt?wt=Ce.id:this.options.generateId?wt=Ce.index:this.points[Ce.index].id&&(wt=this.points[Ce.index].id),wt!==void 0&&(gr.id=wt),te.features.push(gr)}},nt.prototype._limitZoom=function(ct){return Math.max(this.options.minZoom,Math.min(Math.floor(+ct),this.options.maxZoom+1))},nt.prototype._cluster=function(ct,Ft){for(var ht=[],sr=this.options,br=sr.radius,te=sr.extent,Ne=sr.reduce,O=sr.minPoints,Pe=br/(te*Math.pow(2,Ft)),Ce=0;Ce<ct.length;Ce++){var pt=ct[Ce];if(!(pt.zoom<=Ft)){pt.zoom=Ft;for(var Ye=this.trees[Ft+1],We=Ye.within(pt.x,pt.y,Pe),ot=pt.numPoints||1,Tt=ot,gr=0,wt=We;gr<wt.length;gr+=1){var hn=wt[gr],Hr=Ye.points[hn];Hr.zoom>Ft&&(Tt+=Hr.numPoints||1)}if(Tt>ot&&Tt>=O){for(var Vr=pt.x*ot,qn=pt.y*ot,Nn=Ne&&ot>1?this._map(pt,!0):null,dn=(Ce<<5)+(Ft+1)+this.points.length,Ci=0,di=We;Ci<di.length;Ci+=1){var ta=di[Ci],Rn=Ye.points[ta];if(!(Rn.zoom<=Ft)){Rn.zoom=Ft;var Bn=Rn.numPoints||1;Vr+=Rn.x*Bn,qn+=Rn.y*Bn,Rn.parentId=dn,Ne&&(Nn||(Nn=this._map(pt,!0)),Ne(Nn,this._map(Rn)))}}pt.parentId=dn,ht.push(rt(Vr/Tt,qn/Tt,dn,Tt,Nn))}else if(ht.push(pt),Tt>1)for(var _a=0,Hi=We;_a<Hi.length;_a+=1){var Wa=Hi[_a],Ga=Ye.points[Wa];Ga.zoom<=Ft||(Ga.zoom=Ft,ht.push(Ga))}}}return ht},nt.prototype._getOriginId=function(ct){return ct-this.points.length>>5},nt.prototype._getOriginZoom=function(ct){return(ct-this.points.length)%32},nt.prototype._map=function(ct,Ft){if(ct.numPoints)return Ft?Fr({},ct.properties):ct.properties;var ht=this.points[ct.index].properties,sr=this.options.map(ht);return Ft&&sr===ht?Fr({},sr):sr};function rt(It,ct,Ft,ht,sr){return{x:Ze(It),y:Ze(ct),zoom:Infinity,id:Ft,parentId:-1,numPoints:ht,properties:sr}}function Pt(It,ct){var Ft=It.geometry.coordinates,ht=Ft[0],sr=Ft[1];return{x:Ze(rr(ht)),y:Ze(zt(sr)),zoom:Infinity,index:ct,parentId:-1}}function Ct(It){return{type:"Feature",id:It.id,properties:$t(It),geometry:{type:"Point",coordinates:[Mt(It.x),Et(It.y)]}}}function $t(It){var ct=It.numPoints,Ft=ct>=1e4?Math.round(ct/1e3)+"k":ct>=1e3?Math.round(ct/100)/10+"k":ct;return Fr(Fr({},It.properties),{cluster:!0,cluster_id:It.id,point_count:ct,point_count_abbreviated:Ft})}function rr(It){return It/360+.5}function zt(It){var ct=Math.sin(It*Math.PI/180),Ft=.5-.25*Math.log((1+ct)/(1-ct))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function Mt(It){return(It-.5)*360}function Et(It){var ct=(180-It*360)*Math.PI/180;return 360*Math.atan(Math.exp(ct))/Math.PI-90}function Fr(It,ct){for(var Ft in ct)It[Ft]=ct[Ft];return It}function Ar(It){return It.x}function dr(It){return It.y}return nt})}}]);
